{
  "version": 3,
  "sources": ["js/main.js", "js/storage/preferences.js", "js/state.js", "js/utils.js", "js/lectures/scheduler.js", "js/storage/lecture-schema.js", "js/storage/idb.js", "js/storage/lectures.js", "js/search.js", "js/storage/export.js", "js/review/constants.js", "js/review/settings.js", "js/review/sr-data.js", "js/validators.js", "js/storage/storage.js", "js/storage/block-catalog.js", "js/ui/components/confirm.js", "js/lectures/actions.js", "js/ui/components/pass-colors.js", "js/ui/settings.js", "js/ui/components/window-manager.js", "js/ui/components/media-upload.js", "js/ui/components/rich-text.js", "js/ui/components/editor.js", "js/ui/components/linker.js", "js/ui/components/cardlist.js", "js/ui/components/cards.js", "js/study/study-sessions.js", "js/ui/components/sections.js", "js/ui/components/section-utils.js", "js/review/scheduler.js", "js/review/pool.js", "js/ui/components/builder.js", "js/storage/transfers.js", "js/ui/components/lectures.js", "js/ui/components/flashcards.js", "js/ui/components/review.js", "js/ui/components/quiz.js", "js/ui/components/block-mode.js", "js/ui/components/block-board.js", "js/ui/components/exams.js", "js/ui/components/popup.js", "js/ui/components/map.js", "js/ui/components/entry-controls.js", "js/app-shell.js"],
  "sourcesContent": ["import { state, setTab, setSubtab, setQuery } from './state.js';\nimport { initDB, findItemsByFilter } from './storage/storage.js';\nimport { loadBlockCatalog } from './storage/block-catalog.js';\nimport { renderSettings } from './ui/settings.js';\nimport { renderCardList } from './ui/components/cardlist.js';\nimport { renderCards } from './ui/components/cards.js';\nimport { renderBuilder } from './ui/components/builder.js';\nimport { renderLectures } from './ui/components/lectures.js';\nimport { renderFlashcards } from './ui/components/flashcards.js';\nimport { renderReview } from './ui/components/review.js';\nimport { renderQuiz } from './ui/components/quiz.js';\nimport { renderBlockMode } from './ui/components/block-mode.js';\nimport { renderBlockBoard } from './ui/components/block-board.js';\nimport { renderExams, renderExamRunner } from './ui/components/exams.js';\nimport { renderMap } from './ui/components/map.js';\nimport { createEntryAddControl } from './ui/components/entry-controls.js';\nimport { createAppShell } from './app-shell.js';\n\nconst { renderApp, tabs, resolveListKind } = createAppShell({\n  state,\n  setTab,\n  setSubtab,\n  setQuery,\n  findItemsByFilter,\n  renderSettings,\n  renderCardList,\n  renderCards,\n  renderBuilder,\n  renderLectures,\n  renderFlashcards,\n  renderReview,\n  renderQuiz,\n  renderBlockMode,\n  renderBlockBoard,\n  renderExams,\n  renderExamRunner,\n  renderMap,\n  createEntryAddControl\n});\n\nasync function bootstrap() {\n  try {\n    await initDB();\n    try {\n      await loadBlockCatalog();\n    } catch (err) {\n      console.warn('Failed to prime block catalog', err);\n    }\n    renderApp();\n  } catch (err) {\n    const root = document.getElementById('app');\n    if (root) root.textContent = 'Failed to load app';\n    console.error(err);\n  }\n}\n\nif (typeof window !== 'undefined' && !globalThis.__SEVENN_TEST__) {\n  bootstrap();\n}\n\nexport { renderApp, renderApp as render, tabs, resolveListKind };\n", "const STORAGE_KEY = 'sevenn-ui-preferences';\nlet cache = null;\n\nfunction canUseStorage() {\n  try {\n    return typeof localStorage !== 'undefined';\n  } catch (err) {\n    return false;\n  }\n}\n\nfunction readPreferences() {\n  if (cache) {\n    return cache;\n  }\n  if (!canUseStorage()) {\n    cache = {};\n    return cache;\n  }\n  try {\n    const raw = localStorage.getItem(STORAGE_KEY);\n    if (!raw) {\n      cache = {};\n      return cache;\n    }\n    const parsed = JSON.parse(raw);\n    cache = parsed && typeof parsed === 'object' ? parsed : {};\n  } catch (err) {\n    console.warn('Failed to read UI preferences', err);\n    cache = {};\n  }\n  return cache;\n}\n\nexport function loadUIPreferences() {\n  const stored = readPreferences();\n  return stored ? { ...stored } : {};\n}\n\nexport function updateUIPreferences(patch) {\n  if (!patch || typeof patch !== 'object') {\n    return loadUIPreferences();\n  }\n  const current = { ...readPreferences() };\n  let changed = false;\n  for (const [key, value] of Object.entries(patch)) {\n    if (typeof value === 'undefined') continue;\n    if (current[key] !== value) {\n      current[key] = value;\n      changed = true;\n    }\n  }\n  if (!changed) {\n    return current;\n  }\n  cache = current;\n  if (canUseStorage()) {\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(current));\n    } catch (err) {\n      console.warn('Failed to persist UI preferences', err);\n    }\n  }\n  return current;\n}\n", "import { loadUIPreferences, updateUIPreferences } from './storage/preferences.js';\n\nconst DEFAULT_ENTRY_FILTERS = {\n  types: ['disease', 'drug', 'concept'],\n  block: '',\n  week: '',\n  onlyFav: false,\n  sort: 'updated-desc'\n};\n\nconst DEFAULT_LECTURE_STATE = {\n  query: '',\n  blockId: '',\n  week: '',\n  status: '',\n  tag: '',\n  sort: 'position-asc',\n  openBlocks: [],\n  openWeeks: [],\n  openSnapshot: 0,\n  scrollTop: 0\n};\n\nconst DEFAULT_ENTRY_LAYOUT = {\n  mode: 'list',\n  columns: 3,\n  scale: 1,\n  controlsVisible: false\n};\n\nconst DEFAULT_EXAM_LAYOUT = {\n  mode: 'grid',\n  detailsVisible: true\n};\n\nconst preferences = loadUIPreferences();\n\nfunction sanitizeEntryFilters(value) {\n  if (!value || typeof value !== 'object') return {};\n  const next = {};\n  if (Array.isArray(value.types)) {\n    const unique = Array.from(\n      new Set(\n        value.types\n          .map(entry => (typeof entry === 'string' ? entry.trim() : ''))\n          .filter(Boolean)\n      )\n    );\n    if (unique.length) next.types = unique;\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'block')) {\n    next.block = String(value.block ?? '');\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'week')) {\n    const raw = value.week;\n    if (raw === '' || raw === null || typeof raw === 'undefined') {\n      next.week = '';\n    } else if (Number.isFinite(Number(raw))) {\n      next.week = String(Number(raw));\n    }\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'onlyFav')) {\n    next.onlyFav = Boolean(value.onlyFav);\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'sort')) {\n    next.sort = String(value.sort ?? '');\n  }\n  return next;\n}\n\nfunction sanitizeLectureState(value, { forPersist = false } = {}) {\n  if (!value || typeof value !== 'object') return {};\n  const next = {};\n  const stringKeys = ['query', 'blockId', 'week', 'status', 'tag', 'sort'];\n  stringKeys.forEach(key => {\n    if (Object.prototype.hasOwnProperty.call(value, key)) {\n      next[key] = String(value[key] ?? '');\n    }\n  });\n  if (Array.isArray(value.openBlocks)) {\n    const uniqueBlocks = Array.from(\n      new Set(value.openBlocks.map(block => String(block ?? '')))\n    );\n    next.openBlocks = uniqueBlocks;\n  }\n  if (Array.isArray(value.openWeeks)) {\n    const uniqueWeeks = Array.from(\n      new Set(value.openWeeks.map(week => String(week ?? '')))\n    );\n    next.openWeeks = uniqueWeeks;\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'openSnapshot')) {\n    const stamp = Number(value.openSnapshot);\n    next.openSnapshot = Number.isFinite(stamp) ? stamp : 0;\n  }\n  if (!forPersist && Object.prototype.hasOwnProperty.call(value, 'scrollTop')) {\n    const top = Number(value.scrollTop);\n    next.scrollTop = Number.isFinite(top) && top > 0 ? Math.max(0, Math.round(top)) : 0;\n  }\n  return next;\n}\n\nfunction sanitizeEntryLayout(value) {\n  if (!value || typeof value !== 'object') return {};\n  const next = {};\n  if (Object.prototype.hasOwnProperty.call(value, 'mode')) {\n    next.mode = value.mode === 'grid' ? 'grid' : 'list';\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'columns')) {\n    const cols = Number(value.columns);\n    if (!Number.isNaN(cols)) {\n      next.columns = Math.max(1, Math.min(6, Math.round(cols)));\n    }\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'scale')) {\n    const scl = Number(value.scale);\n    if (!Number.isNaN(scl)) {\n      next.scale = Math.max(0.6, Math.min(1.4, scl));\n    }\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'controlsVisible')) {\n    next.controlsVisible = Boolean(value.controlsVisible);\n  }\n  return next;\n}\n\nfunction sanitizeExamLayout(value) {\n  if (!value || typeof value !== 'object') return {};\n  const next = {};\n  if (value.mode === 'row' || value.mode === 'grid') {\n    next.mode = value.mode;\n  }\n  if (Object.prototype.hasOwnProperty.call(value, 'detailsVisible')) {\n    next.detailsVisible = Boolean(value.detailsVisible);\n  }\n  return next;\n}\n\nconst initialFilters = { ...DEFAULT_ENTRY_FILTERS, ...sanitizeEntryFilters(preferences.filters) };\nconst initialLectures = { ...DEFAULT_LECTURE_STATE, ...sanitizeLectureState(preferences.lectures || {}) };\nconst initialEntryLayout = { ...DEFAULT_ENTRY_LAYOUT, ...sanitizeEntryLayout(preferences.entryLayout) };\nconst initialExamLayout = { ...DEFAULT_EXAM_LAYOUT, ...sanitizeExamLayout(preferences.examLayout) };\n\nexport const state = {\n  tab: \"Block Board\",\n  subtab: {\n    Diseases: \"Browse\",\n    Drugs: \"Browse\",\n    Concepts: \"Browse\",\n    Lists: \"Diseases\",\n    Study: \"Builder\",\n    Exams: \"\", // placeholder\n    Map: \"\",\n    Settings: \"\"\n  },\n  query: \"\",\n  filters: initialFilters,\n  lectures: initialLectures,\n  entryLayout: initialEntryLayout,\n  blockBoard: {\n    collapsedBlocks: [],\n    hiddenTimelines: [],\n    autoCollapsed: [],\n    autoHidden: [],\n    manualExpanded: [],\n    manualTimeline: []\n  },\n  builder: {\n    blocks:[],\n    weeks:[],\n    lectures:[],\n    types:[\"disease\",\"drug\",\"concept\"],\n    tags:[],\n    onlyFav:false,\n    manualPicks:[],\n    collapsedBlocks:[],\n    collapsedWeeks:[],\n    activeBlockId:'',\n    activeWeekKey:''\n  },\n  cards: {\n    collapsedBlocks: [],\n    collapsedWeeks: [],\n    initialized: false\n  },\n  cohort: [],\n  review: { count:20, format:\"flashcards\" },\n  quizSession: null,\n  flashSession: null,\n  examSession: null,\n  examAttemptExpanded: {},\n  examLayout: initialExamLayout,\n  map: { panzoom:false },\n  blockMode: { section:\"\", assignments:{}, reveal:{}, order:{} },\n  study: { selectedMode: 'Flashcards' },\n  studySessions: {},\n  studySessionsLoaded: false\n};\n\nexport function setTab(t){ state.tab = t; }\nexport function setSubtab(tab, sub){ state.subtab[tab] = sub; }\nexport function setQuery(q){ state.query = q; }\nexport function setFilters(patch) {\n  if (!patch) return;\n  const next = { ...state.filters };\n  if (Array.isArray(patch.types)) {\n    const unique = Array.from(\n      new Set(\n        patch.types\n          .map(entry => (typeof entry === 'string' ? entry.trim() : ''))\n          .filter(Boolean)\n      )\n    );\n    if (unique.length) {\n      next.types = unique;\n    }\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'block')) {\n    next.block = String(patch.block ?? '');\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'week')) {\n    const raw = patch.week;\n    if (raw === '' || raw === null || typeof raw === 'undefined') {\n      next.week = '';\n    } else if (Number.isFinite(Number(raw))) {\n      next.week = String(Number(raw));\n    }\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'onlyFav')) {\n    next.onlyFav = Boolean(patch.onlyFav);\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'sort')) {\n    next.sort = String(patch.sort ?? '');\n  }\n  state.filters = next;\n  updateUIPreferences({ filters: sanitizeEntryFilters(next) });\n}\nexport function setBuilder(patch){ Object.assign(state.builder, patch); }\nexport function setBlockBoardState(patch) {\n  if (!patch) return;\n  if (!state.blockBoard) {\n    state.blockBoard = {\n      collapsedBlocks: [],\n      hiddenTimelines: [],\n      autoCollapsed: [],\n      autoHidden: [],\n      manualExpanded: [],\n      manualTimeline: []\n    };\n  }\n  const current = state.blockBoard;\n  if (!Array.isArray(current.hiddenTimelines)) {\n    current.hiddenTimelines = [];\n  }\n  if (!Array.isArray(current.autoCollapsed)) {\n    current.autoCollapsed = [];\n  }\n  if (!Array.isArray(current.autoHidden)) {\n    current.autoHidden = [];\n  }\n  if (!Array.isArray(current.manualExpanded)) {\n    current.manualExpanded = [];\n  }\n  if (!Array.isArray(current.manualTimeline)) {\n    current.manualTimeline = [];\n  }\n  if (Array.isArray(patch.collapsedBlocks)) {\n    const unique = Array.from(new Set(patch.collapsedBlocks.map(id => String(id))));\n    current.collapsedBlocks = unique;\n  }\n  if (Array.isArray(patch.hiddenTimelines)) {\n    const uniqueHidden = Array.from(new Set(patch.hiddenTimelines.map(id => String(id))));\n    current.hiddenTimelines = uniqueHidden;\n  }\n  if (Array.isArray(patch.autoCollapsed)) {\n    const autoSet = Array.from(new Set(patch.autoCollapsed.map(id => String(id))));\n    current.autoCollapsed = autoSet;\n  }\n  if (Array.isArray(patch.autoHidden)) {\n    const autoHiddenSet = Array.from(new Set(patch.autoHidden.map(id => String(id))));\n    current.autoHidden = autoHiddenSet;\n  }\n  if (Array.isArray(patch.manualExpanded)) {\n    const manualExpandedSet = Array.from(new Set(patch.manualExpanded.map(id => String(id))));\n    current.manualExpanded = manualExpandedSet;\n  }\n  if (Array.isArray(patch.manualTimeline)) {\n    const manualTimelineSet = Array.from(new Set(patch.manualTimeline.map(id => String(id))));\n    current.manualTimeline = manualTimelineSet;\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'showDensity')) {\n    const show = Boolean(patch.showDensity);\n    if (show) {\n      current.hiddenTimelines = current.hiddenTimelines.filter(id => id !== '__all__');\n    } else if (!current.hiddenTimelines.includes('__all__')) {\n      current.hiddenTimelines = [...current.hiddenTimelines, '__all__'];\n    }\n  }\n}\nexport function setLecturesState(patch) {\n  if (!patch) return;\n  if (!state.lectures) {\n    state.lectures = { ...DEFAULT_LECTURE_STATE };\n  }\n  const next = { ...state.lectures };\n  const stringKeys = ['query', 'blockId', 'week', 'status', 'tag'];\n  stringKeys.forEach(key => {\n    if (Object.prototype.hasOwnProperty.call(patch, key)) {\n      next[key] = String(patch[key] ?? '');\n    }\n  });\n  if (Object.prototype.hasOwnProperty.call(patch, 'sort')) {\n    const value = patch.sort;\n    if (typeof value === 'string') {\n      next.sort = value;\n    } else if (value && typeof value === 'object') {\n      const field =\n        typeof value.field === 'string' && value.field.trim() ? value.field.trim() : 'position';\n      const direction = value.direction === 'desc' ? 'desc' : 'asc';\n      next.sort = `${field}-${direction}`;\n    }\n  }\n  if (Array.isArray(patch.openBlocks)) {\n    next.openBlocks = Array.from(\n      new Set(patch.openBlocks.map(block => String(block ?? '')))\n    );\n  }\n  if (Array.isArray(patch.openWeeks)) {\n    next.openWeeks = Array.from(\n      new Set(patch.openWeeks.map(week => String(week ?? '')))\n    );\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'openSnapshot')) {\n    const stamp = Number(patch.openSnapshot);\n    next.openSnapshot = Number.isFinite(stamp) ? stamp : 0;\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'scrollTop')) {\n    const top = Number(patch.scrollTop);\n    next.scrollTop = Number.isFinite(top) && top > 0 ? Math.max(0, Math.round(top)) : 0;\n  }\n  state.lectures = next;\n  updateUIPreferences({ lectures: sanitizeLectureState(next, { forPersist: true }) });\n}\n\nexport function resetLecturesState() {\n  state.lectures = { ...DEFAULT_LECTURE_STATE };\n  updateUIPreferences({ lectures: sanitizeLectureState(state.lectures, { forPersist: true }) });\n}\nexport function setCardsState(patch){\n  if (!patch) return;\n  if (!state.cards) {\n    state.cards = { collapsedBlocks: [], collapsedWeeks: [], initialized: false };\n  }\n  const { collapsedBlocks, collapsedWeeks } = patch;\n  if (Array.isArray(collapsedBlocks)) {\n    const unique = Array.from(new Set(collapsedBlocks.filter(Boolean)));\n    state.cards.collapsedBlocks = unique;\n  }\n  if (Array.isArray(collapsedWeeks)) {\n    const unique = Array.from(new Set(collapsedWeeks.filter(Boolean)));\n    state.cards.collapsedWeeks = unique;\n  }\n  state.cards.initialized = true;\n}\nexport function setCohort(items){ state.cohort = items; }\nexport function resetTransientSessions(){ state.quizSession = null; state.flashSession = null; state.examSession = null; }\nexport function setFlashSession(sess){ state.flashSession = sess; }\nexport function setQuizSession(sess){ state.quizSession = sess; }\nexport function setReviewConfig(patch){ Object.assign(state.review, patch); }\nexport function setExamSession(sess){ state.examSession = sess; }\nexport function setExamAttemptExpanded(examId, expanded){\n  state.examAttemptExpanded[examId] = expanded;\n}\nexport function setExamLayout(patch) {\n  if (!patch) return;\n  const current = state.examLayout ? { ...state.examLayout } : { ...DEFAULT_EXAM_LAYOUT };\n  if (patch.mode === 'row' || patch.mode === 'grid') {\n    current.mode = patch.mode;\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'detailsVisible')) {\n    current.detailsVisible = Boolean(patch.detailsVisible);\n  }\n  state.examLayout = current;\n  updateUIPreferences({ examLayout: sanitizeExamLayout(current) });\n}\nexport function setBlockMode(patch){ Object.assign(state.blockMode, patch); }\nexport function resetBlockMode(){ state.blockMode = { section:\"\", assignments:{}, reveal:{}, order:{} }; }\nexport function setEntryLayout(patch) {\n  if (!patch) return;\n  const layout = state.entryLayout;\n  if (Object.prototype.hasOwnProperty.call(patch, 'columns')) {\n    const cols = Number(patch.columns);\n    if (!Number.isNaN(cols)) {\n      layout.columns = Math.max(1, Math.min(6, Math.round(cols)));\n    }\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'scale')) {\n    const scl = Number(patch.scale);\n    if (!Number.isNaN(scl)) {\n      layout.scale = Math.max(0.6, Math.min(1.4, scl));\n    }\n  }\n  if (patch.mode === 'list' || patch.mode === 'grid') {\n    layout.mode = patch.mode;\n  }\n  if (Object.prototype.hasOwnProperty.call(patch, 'controlsVisible')) {\n    layout.controlsVisible = Boolean(patch.controlsVisible);\n  }\n  updateUIPreferences({ entryLayout: sanitizeEntryLayout(layout) });\n}\n\nexport function setStudySelectedMode(mode) {\n  if (!state.study) state.study = { selectedMode: 'Flashcards' };\n  if (mode === 'Flashcards' || mode === 'Quiz' || mode === 'Blocks') {\n    state.study.selectedMode = mode;\n  }\n}\n\nexport function setStudySessions(map) {\n  state.studySessions = map ? { ...map } : {};\n  state.studySessionsLoaded = true;\n}\n\nexport function setStudySessionEntry(mode, entry) {\n  if (!mode) return;\n  const next = { ...(state.studySessions || {}) };\n  if (entry) {\n    next[mode] = entry;\n  } else {\n    delete next[mode];\n  }\n  state.studySessions = next;\n}\n\nexport function clearStudySessionsState() {\n  state.studySessions = {};\n  state.studySessionsLoaded = false;\n}\n", "export function uid() {\n  const g = globalThis;\n  return g.crypto?.randomUUID?.() || Math.random().toString(36).slice(2);\n}\n\nexport function debounce(fn, delay = 150) {\n  let t;\n  return (...args) => {\n    clearTimeout(t);\n    t = setTimeout(() => fn(...args), delay);\n  };\n}\n\nexport function clamp(value, min, max) {\n  return Math.min(max, Math.max(min, value));\n}\n\nconst structuredCloneFn = typeof globalThis.structuredClone === 'function'\n  ? globalThis.structuredClone.bind(globalThis)\n  : null;\n\nfunction cloneArrayBuffer(buffer) {\n  if (typeof buffer.slice === 'function') {\n    return buffer.slice(0);\n  }\n  const copy = new ArrayBuffer(buffer.byteLength);\n  new Uint8Array(copy).set(new Uint8Array(buffer));\n  return copy;\n}\n\nfunction cloneArrayBufferView(view, seen) {\n  if (typeof view?.constructor?.from === 'function') {\n    return view.constructor.from(view);\n  }\n  if (ArrayBuffer.isView(view)) {\n    const bufferCopy = deepClone(view.buffer, seen);\n    if (typeof DataView !== 'undefined' && view instanceof DataView) {\n      return new DataView(bufferCopy, view.byteOffset, view.byteLength);\n    }\n    return new view.constructor(bufferCopy, view.byteOffset, view.length ?? undefined);\n  }\n  return view;\n}\n\nexport function deepClone(value, seen = new WeakMap()) {\n  if (value == null || typeof value !== 'object') {\n    return value;\n  }\n\n  if (structuredCloneFn) {\n    try {\n      return structuredCloneFn(value);\n    } catch (err) {\n      // Fall through to manual cloning when structuredClone cannot handle the input\n      // (for example, functions or DOM nodes).\n    }\n  }\n\n  if (seen.has(value)) {\n    return seen.get(value);\n  }\n\n  if (value instanceof Date) {\n    return new Date(value.getTime());\n  }\n\n  if (value instanceof RegExp) {\n    const copy = new RegExp(value.source, value.flags);\n    copy.lastIndex = value.lastIndex;\n    return copy;\n  }\n\n  if (ArrayBuffer.isView(value)) {\n    const cloned = cloneArrayBufferView(value, seen);\n    seen.set(value, cloned);\n    return cloned;\n  }\n\n  if (value instanceof ArrayBuffer) {\n    const copy = cloneArrayBuffer(value);\n    seen.set(value, copy);\n    return copy;\n  }\n\n  if (Array.isArray(value)) {\n    const result = [];\n    seen.set(value, result);\n    for (let i = 0; i < value.length; i += 1) {\n      result[i] = deepClone(value[i], seen);\n    }\n    return result;\n  }\n\n  if (value instanceof Map) {\n    const result = new Map();\n    seen.set(value, result);\n    value.forEach((mapValue, key) => {\n      const clonedKey = typeof key === 'object' && key !== null\n        ? deepClone(key, seen)\n        : key;\n      result.set(clonedKey, deepClone(mapValue, seen));\n    });\n    return result;\n  }\n\n  if (value instanceof Set) {\n    const result = new Set();\n    seen.set(value, result);\n    value.forEach(entry => {\n      result.add(deepClone(entry, seen));\n    });\n    return result;\n  }\n\n  const result = {};\n  seen.set(value, result);\n  for (const [key, val] of Object.entries(value)) {\n    result[key] = deepClone(val, seen);\n  }\n  return result;\n}\n\nfunction parseDateValue(value) {\n  if (!value) return Number.NaN;\n  if (value instanceof Date) {\n    const time = value.getTime();\n    return Number.isNaN(time) ? Number.NaN : time;\n  }\n  const date = new Date(value);\n  const time = date.getTime();\n  return Number.isNaN(time) ? Number.NaN : time;\n}\n\nexport function findActiveBlockId(blocks, now = Date.now()) {\n  if (!Array.isArray(blocks) || blocks.length === 0) return '';\n  const nowTs = Number.isFinite(now) ? now : Date.now();\n  let current = null;\n  let upcoming = null;\n  let recent = null;\n\n  blocks.forEach(block => {\n    if (!block || block.blockId == null) return;\n    const id = String(block.blockId);\n    const start = parseDateValue(block.startDate);\n    const end = parseDateValue(block.endDate);\n\n    const hasStart = Number.isFinite(start);\n    const hasEnd = Number.isFinite(end);\n\n    if (hasStart && hasEnd) {\n      if (start <= nowTs && nowTs <= end) {\n        if (!current || start < current.start || (start === current.start && end < current.end)) {\n          current = { id, start, end };\n        }\n        return;\n      }\n      if (start > nowTs) {\n        if (!upcoming || start < upcoming.start) {\n          upcoming = { id, start };\n        }\n        return;\n      }\n      if (!recent || end > recent.end) {\n        recent = { id, end };\n      }\n      return;\n    }\n\n    if (hasStart) {\n      if (start <= nowTs) {\n        if (!recent || start > recent.end) {\n          recent = { id, end: start };\n        }\n      } else if (!upcoming || start < upcoming.start) {\n        upcoming = { id, start };\n      }\n      return;\n    }\n\n    if (hasEnd) {\n      if (nowTs <= end) {\n        if (!current || end < current.end) {\n          current = { id, start: end, end };\n        }\n      } else if (!recent || end > recent.end) {\n        recent = { id, end };\n      }\n    }\n  });\n\n  if (current) return current.id;\n  if (upcoming) return upcoming.id;\n  if (recent) return recent.id;\n\n  const first = blocks.find(block => block && block.blockId != null);\n  return first ? String(first.blockId) : '';\n}\n\nexport function setToggleState(element, active, className = 'active') {\n  if (!element) return;\n  const isActive = Boolean(active);\n  if (element.dataset) {\n    element.dataset.toggle = 'true';\n    element.dataset.active = isActive ? 'true' : 'false';\n  }\n  if (className && element.classList) {\n    element.classList.toggle(className, isActive);\n  }\n  if (typeof HTMLElement !== 'undefined' && element instanceof HTMLElement) {\n    const role = element.getAttribute('role');\n    if ((element.tagName === 'BUTTON' || role === 'button') && typeof element.setAttribute === 'function') {\n      element.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n    }\n  }\n}\n", "import { deepClone } from '../utils.js';\n\nconst DAY_MINUTES = 24 * 60;\nconst MINUTE_MS = 60 * 1000;\n\nexport const DEFAULT_PASS_COLORS = [\n  '#38bdf8',\n  '#0ea5e9',\n  '#34d399',\n  '#10b981',\n  '#facc15',\n  '#f97316',\n  '#f472b6',\n  '#a855f7',\n  '#818cf8',\n  '#2dd4bf'\n];\n\nconst clone = deepClone;\n\nfunction toNumber(value, fallback = 0) {\n  const num = Number(value);\n  return Number.isFinite(num) ? num : fallback;\n}\n\nfunction sanitizeLabel(label, order) {\n  if (typeof label === 'string' && label.trim()) return label.trim();\n  return `Pass ${order}`;\n}\n\nfunction sanitizeAction(action) {\n  if (typeof action === 'string') {\n    const trimmed = action.trim();\n    if (trimmed) return trimmed;\n  }\n  return '';\n}\n\nfunction inferAnchor(offsetMinutes) {\n  if (!Number.isFinite(offsetMinutes)) return 'today';\n  if (offsetMinutes < DAY_MINUTES) return 'today';\n  if (offsetMinutes < DAY_MINUTES * 2) return 'tomorrow';\n  return 'upcoming';\n}\n\nfunction startOfDay(timestamp) {\n  const date = new Date(timestamp);\n  date.setHours(0, 0, 0, 0);\n  return date.getTime();\n}\n\nfunction computeAnchoredDue(startAt, step, plannerDefaults) {\n  const offsetMinutes = toNumber(step?.offsetMinutes, 0);\n  const base = startAt + Math.round(offsetMinutes * MINUTE_MS);\n  if (!plannerDefaults || typeof plannerDefaults !== 'object') return base;\n  const anchorName = typeof step?.anchor === 'string' && step.anchor.trim()\n    ? step.anchor.trim()\n    : inferAnchor(offsetMinutes);\n  const anchorOffsets = plannerDefaults.anchorOffsets || {};\n  const anchorMinutes = toNumber(anchorOffsets[anchorName], null);\n  if (anchorMinutes == null) return base;\n  const anchorBase = startOfDay(base) + Math.round(anchorMinutes * MINUTE_MS);\n  if (!Number.isFinite(anchorBase)) return base;\n  if (offsetMinutes >= 0 && anchorBase < base) {\n    return base;\n  }\n  return anchorBase;\n}\n\nexport const DEFAULT_PASS_PLAN = {\n  id: 'default',\n  schedule: [\n    { order: 1, label: 'Pass 1', offsetMinutes: 0, anchor: 'today', action: 'Notes' },\n    { order: 2, label: 'Pass 2', offsetMinutes: 24 * 60, anchor: 'tomorrow', action: 'Review' },\n    { order: 3, label: 'Pass 3', offsetMinutes: 72 * 60, anchor: 'upcoming', action: 'Quiz' }\n  ]\n};\n\nexport const DEFAULT_PLANNER_DEFAULTS = {\n  anchorOffsets: {\n    today: 0,\n    tomorrow: 8 * 60,\n    upcoming: 8 * 60\n  },\n  passes: DEFAULT_PASS_PLAN.schedule.map(entry => ({\n    order: entry.order,\n    label: entry.label,\n    offsetMinutes: entry.offsetMinutes,\n    anchor: entry.anchor\n  })),\n  passColors: DEFAULT_PASS_COLORS\n};\n\nexport function normalizePassPlan(plan) {\n  const source = plan && typeof plan === 'object' ? plan : {};\n  const mergedSchedule = Array.isArray(source.schedule)\n    ? source.schedule\n    : DEFAULT_PASS_PLAN.schedule;\n  const normalizedSchedule = (Array.isArray(mergedSchedule) ? mergedSchedule : [])\n    .map((step, index) => {\n      const order = toNumber(step?.order, index + 1);\n      const offsetMinutes = toNumber(step?.offsetMinutes, DEFAULT_PASS_PLAN.schedule[index]?.offsetMinutes ?? 0);\n      const anchor = typeof step?.anchor === 'string' && step.anchor.trim()\n        ? step.anchor.trim()\n        : inferAnchor(offsetMinutes);\n      const label = sanitizeLabel(step?.label, order);\n      const action = sanitizeAction(step?.action ?? DEFAULT_PASS_PLAN.schedule[index]?.action);\n      return { order, offsetMinutes, anchor, label, action };\n    })\n    .sort((a, b) => a.order - b.order);\n  return {\n    id: typeof source.id === 'string' && source.id.trim() ? source.id.trim() : DEFAULT_PASS_PLAN.id,\n    schedule: normalizedSchedule\n  };\n}\n\nexport function normalizePlannerDefaults(raw) {\n  const source = raw && typeof raw === 'object' ? raw : {};\n  const anchorOffsets = {};\n  const defaultAnchors = DEFAULT_PLANNER_DEFAULTS.anchorOffsets;\n  const incomingAnchors = source.anchorOffsets && typeof source.anchorOffsets === 'object'\n    ? source.anchorOffsets\n    : {};\n  const allKeys = new Set([\n    ...Object.keys(defaultAnchors),\n    ...Object.keys(incomingAnchors)\n  ]);\n  for (const key of allKeys) {\n    const fallback = defaultAnchors[key] ?? 0;\n    const value = incomingAnchors[key];\n    anchorOffsets[key] = toNumber(value, fallback);\n  }\n\n  const passesSource = Array.isArray(source.passes)\n    ? source.passes\n    : DEFAULT_PLANNER_DEFAULTS.passes;\n  const normalizedPlan = normalizePassPlan({ schedule: passesSource });\n\n  const paletteSource = Array.isArray(source.passColors) && source.passColors.length\n    ? source.passColors\n    : DEFAULT_PASS_COLORS;\n  const passColors = paletteSource.map((color, index) => {\n    if (typeof color === 'string') {\n      const trimmed = color.trim();\n      if (trimmed) return trimmed;\n    }\n    return DEFAULT_PASS_COLORS[index % DEFAULT_PASS_COLORS.length];\n  });\n  const palette = passColors.length ? passColors : DEFAULT_PASS_COLORS.slice();\n\n  return {\n    anchorOffsets,\n    passes: normalizedPlan.schedule.map(step => ({\n      order: step.order,\n      label: step.label,\n      offsetMinutes: step.offsetMinutes,\n      anchor: step.anchor,\n      action: step.action\n    })),\n    passColors: palette\n  };\n}\n\nfunction sanitizeAttachments(raw) {\n  if (!Array.isArray(raw)) return [];\n  return raw\n    .filter(att => att != null)\n    .map(att => (typeof att === 'object' ? deepClone(att) : att));\n}\n\nexport function normalizeLecturePasses({\n  plan,\n  passes,\n  plannerDefaults,\n  startAt,\n  now = Date.now()\n} = {}) {\n  const normalizedPlan = normalizePassPlan(plan || DEFAULT_PASS_PLAN);\n  const schedule = normalizedPlan.schedule;\n  const existingList = Array.isArray(passes) ? passes : [];\n  const existingByOrder = new Map();\n  existingList.forEach((entry, index) => {\n    if (!entry || typeof entry !== 'object') return;\n    const order = toNumber(entry.order, index + 1);\n    if (!existingByOrder.has(order)) {\n      existingByOrder.set(order, entry);\n    }\n  });\n  const planner = normalizePlannerDefaults(plannerDefaults || {});\n  const anchorConfig = {\n    anchorOffsets: planner.anchorOffsets,\n    schedule: planner.passes\n  };\n  const startTimestamp = Number.isFinite(startAt) ? startAt : now;\n  const normalizedPasses = schedule.map((step, index) => {\n    const existing = existingByOrder.get(step.order) || existingList[index] || {};\n    const dueCandidate = Number.isFinite(existing?.due) ? existing.due : null;\n    const due = dueCandidate != null\n      ? dueCandidate\n      : computeAnchoredDue(startTimestamp, step, anchorConfig);\n    const completedAt = Number.isFinite(existing?.completedAt) ? existing.completedAt : null;\n    const label = sanitizeLabel(existing?.label ?? step.label, step.order);\n    const anchor = typeof (existing?.anchor ?? step.anchor) === 'string'\n      ? (existing?.anchor ?? step.anchor)\n      : inferAnchor(step.offsetMinutes);\n    const attachments = sanitizeAttachments(existing.attachments);\n    const action = sanitizeAction(existing?.action ?? step.action);\n    return {\n      order: step.order,\n      label,\n      offsetMinutes: step.offsetMinutes,\n      anchor,\n      due,\n      completedAt,\n      attachments,\n      action\n    };\n  });\n  return normalizedPasses;\n}\n\nexport function calculateNextDue(passes) {\n  if (!Array.isArray(passes) || !passes.length) return null;\n  const dueTimes = passes\n    .filter(pass => pass && !pass.completedAt)\n    .map(pass => Number.isFinite(pass.due) ? pass.due : null)\n    .filter(due => due != null)\n    .sort((a, b) => a - b);\n  return dueTimes.length ? dueTimes[0] : null;\n}\n\nexport function deriveLectureStatus(passes, base = {}) {\n  const total = Array.isArray(passes) ? passes.length : 0;\n  const completed = Array.isArray(passes)\n    ? passes.filter(pass => Number.isFinite(pass?.completedAt)).length\n    : 0;\n  const lastCompletedAt = Array.isArray(passes)\n    ? passes.reduce((max, pass) => {\n        const ts = Number.isFinite(pass?.completedAt) ? pass.completedAt : null;\n        if (ts == null) return max;\n        return max == null ? ts : Math.max(max, ts);\n      }, null)\n    : null;\n  let state = 'pending';\n  if (total === 0) {\n    state = 'unscheduled';\n  } else if (completed === 0) {\n    state = 'pending';\n  } else if (completed < total) {\n    state = 'in-progress';\n  } else {\n    state = 'complete';\n  }\n  const merged = {\n    ...base,\n    completedPasses: completed,\n    lastCompletedAt,\n    state\n  };\n  return merged;\n}\n\nexport function markPassCompleted(lecture, passIndex, completedAt = Date.now()) {\n  if (!lecture || typeof lecture !== 'object') return null;\n  const passes = Array.isArray(lecture.passes) ? lecture.passes.map(pass => ({ ...pass })) : [];\n  if (!Number.isFinite(passIndex)) return { ...lecture, passes, nextDueAt: calculateNextDue(passes), status: deriveLectureStatus(passes, lecture.status) };\n  if (passes.length === 0) {\n    return { ...lecture, passes, nextDueAt: calculateNextDue(passes), status: deriveLectureStatus(passes, lecture.status) };\n  }\n  const clamped = Math.floor(passIndex);\n  if (clamped < 0 || clamped >= passes.length) {\n    return { ...lecture, passes, nextDueAt: calculateNextDue(passes), status: deriveLectureStatus(passes, lecture.status) };\n  }\n  if (passes[clamped]) {\n    passes[clamped].completedAt = completedAt;\n  }\n  const status = deriveLectureStatus(passes, lecture.status);\n  const nextDueAt = calculateNextDue(passes);\n  return {\n    ...lecture,\n    passes,\n    status,\n    nextDueAt\n  };\n}\n\nexport function shiftLecturePasses(lecture, shiftMinutes, { includeCompleted = false } = {}) {\n  if (!lecture || typeof lecture !== 'object') return null;\n  const shiftMs = Math.round(toNumber(shiftMinutes, 0) * MINUTE_MS);\n  const passes = Array.isArray(lecture.passes)\n    ? lecture.passes.map(pass => {\n        if (!pass || !Number.isFinite(pass.due)) return { ...pass };\n        if (!includeCompleted && Number.isFinite(pass.completedAt)) {\n          return { ...pass };\n        }\n        return { ...pass, due: pass.due + shiftMs };\n      })\n    : [];\n  const status = deriveLectureStatus(passes, lecture.status);\n  const nextDueAt = calculateNextDue(passes);\n  return {\n    ...lecture,\n    passes,\n    status,\n    nextDueAt\n  };\n}\n\nexport function recalcLectureSchedule(lecture, { plannerDefaults, startAt, now = Date.now() } = {}) {\n  if (!lecture || typeof lecture !== 'object') return null;\n  const normalizedPlan = normalizePassPlan(lecture.passPlan || DEFAULT_PASS_PLAN);\n  const normalizedPlanner = normalizePlannerDefaults(plannerDefaults || lecture.plannerDefaults || {});\n  const passes = normalizeLecturePasses({\n    plan: normalizedPlan,\n    passes: lecture.passes,\n    plannerDefaults: normalizedPlanner,\n    startAt,\n    now\n  });\n  const status = deriveLectureStatus(passes, lecture.status);\n  const nextDueAt = calculateNextDue(passes);\n  return {\n    ...lecture,\n    passPlan: normalizedPlan,\n    plannerDefaults: normalizedPlanner,\n    passes,\n    status,\n    nextDueAt\n  };\n}\n\nexport function groupLectureQueues(lectures, { now = Date.now() } = {}) {\n  const result = {\n    overdue: [],\n    today: [],\n    tomorrow: [],\n    upcoming: []\n  };\n  if (!Array.isArray(lectures) || !lectures.length) return result;\n  const startToday = startOfDay(now);\n  const startTomorrow = startToday + DAY_MINUTES * MINUTE_MS;\n  const startDayAfter = startTomorrow + DAY_MINUTES * MINUTE_MS;\n  const addEntry = (bucket, entry) => {\n    result[bucket].push(entry);\n  };\n  for (const lecture of lectures) {\n    if (!lecture || typeof lecture !== 'object') continue;\n    const passes = Array.isArray(lecture.passes) ? lecture.passes : [];\n    const nextPass = passes.find(pass => pass && !Number.isFinite(pass.completedAt));\n    const due = Number.isFinite(nextPass?.due) ? nextPass.due : null;\n    const entry = { lecture, pass: nextPass || null, due };\n    if (due == null) {\n      addEntry('upcoming', entry);\n      continue;\n    }\n    if (due <= now) {\n      addEntry('overdue', entry);\n    } else if (due < startTomorrow) {\n      addEntry('today', entry);\n    } else if (due < startDayAfter) {\n      addEntry('tomorrow', entry);\n    } else {\n      addEntry('upcoming', entry);\n    }\n  }\n  for (const key of Object.keys(result)) {\n    result[key].sort((a, b) => {\n      if (a.due == null && b.due == null) return 0;\n      if (a.due == null) return 1;\n      if (b.due == null) return -1;\n      return a.due - b.due;\n    });\n  }\n  return result;\n}\n\nexport function clonePlannerDefaults() {\n  return clone(DEFAULT_PLANNER_DEFAULTS);\n}\n\nexport function clonePassPlan(plan = DEFAULT_PASS_PLAN) {\n  return clone(plan || DEFAULT_PASS_PLAN);\n}\n\nexport function plannerDefaultsToPassPlan(defaults) {\n  const normalized = normalizePlannerDefaults(defaults || {});\n  const schedule = (normalized?.passes || []).map((step, index) => {\n    const order = toNumber(step?.order, index + 1);\n    const offsetMinutes = toNumber(\n      step?.offsetMinutes,\n      DEFAULT_PASS_PLAN.schedule[index]?.offsetMinutes ?? 0\n    );\n    const anchor = typeof step?.anchor === 'string' && step.anchor.trim()\n      ? step.anchor.trim()\n      : inferAnchor(offsetMinutes);\n    const label = sanitizeLabel(step?.label, order);\n    const action = sanitizeAction(step?.action ?? DEFAULT_PASS_PLAN.schedule[index]?.action);\n    return { order, offsetMinutes, anchor, label, action };\n  }).sort((a, b) => a.order - b.order);\n  return {\n    id: normalized?.id || 'planner-defaults',\n    schedule\n  };\n}\n\n", "import {\n  DEFAULT_PASS_PLAN,\n  normalizePassPlan,\n  normalizeLecturePasses,\n  calculateNextDue,\n  deriveLectureStatus,\n  normalizePlannerDefaults\n} from '../lectures/scheduler.js';\nimport { deepClone } from '../utils.js';\nexport { DEFAULT_PASS_PLAN } from '../lectures/scheduler.js';\n\nconst KEY_SEPARATOR = '|';\n\nexport const DEFAULT_LECTURE_STATUS = {\n  state: 'pending',\n  completedPasses: 0,\n  lastCompletedAt: null\n};\n\nexport function lectureKey(blockId, lectureId) {\n  return `${blockId}${KEY_SEPARATOR}${lectureId}`;\n}\n\nexport function cloneDefaultPassPlan() {\n  return deepClone(DEFAULT_PASS_PLAN);\n}\n\nexport function cloneDefaultStatus() {\n  return deepClone(DEFAULT_LECTURE_STATUS);\n}\n\nexport function normalizeLectureRecord(blockId, lecture, now = Date.now()) {\n  if (!lecture || blockId == null || lecture.id == null) return null;\n  const key = lecture.key || lectureKey(blockId, lecture.id);\n  const name = typeof lecture.name === 'string' ? lecture.name : '';\n  const weekRaw = lecture.week;\n  let week = null;\n  if (typeof weekRaw === 'number' && Number.isFinite(weekRaw)) {\n    week = weekRaw;\n  } else if (typeof weekRaw === 'string' && weekRaw.trim()) {\n    const parsed = Number(weekRaw);\n    if (!Number.isNaN(parsed)) week = parsed;\n  }\n  const startRaw = lecture.startAt;\n  let startAt = null;\n  if (Number.isFinite(startRaw)) {\n    startAt = startRaw;\n  } else if (typeof startRaw === 'string' && startRaw.trim()) {\n    const parsedStart = Number(startRaw);\n    if (!Number.isNaN(parsedStart)) {\n      startAt = parsedStart;\n    }\n  }\n  if (!Number.isFinite(startAt)) {\n    startAt = Number.isFinite(lecture.createdAt) ? lecture.createdAt : now;\n  }\n\n  const tags = Array.isArray(lecture.tags)\n    ? lecture.tags.filter(tag => typeof tag === 'string' && tag.trim()).map(tag => tag.trim())\n    : [];\n  const passPlan = lecture.passPlan\n    ? normalizePassPlan({ ...cloneDefaultPassPlan(), ...lecture.passPlan })\n    : normalizePassPlan(cloneDefaultPassPlan());\n\n  const plannerDefaults = normalizePlannerDefaults(lecture.plannerDefaults || {});\n  const passes = normalizeLecturePasses({\n    plan: passPlan,\n    passes: lecture.passes,\n    plannerDefaults,\n    startAt,\n    now\n  });\n\n  const statusBase = lecture.status\n    ? { ...cloneDefaultStatus(), ...lecture.status }\n    : cloneDefaultStatus();\n  const status = deriveLectureStatus(passes, statusBase);\n  const nextDueAt = calculateNextDue(passes);\n  const createdAt = typeof lecture.createdAt === 'number' ? lecture.createdAt : now;\n  const updatedAt = now;\n\n  return {\n    key,\n    blockId,\n    id: lecture.id,\n    name,\n    week,\n    tags,\n    passes,\n    passPlan,\n    plannerDefaults,\n    status,\n    nextDueAt,\n    startAt,\n    createdAt,\n    updatedAt\n  };\n}\n\n", "import { normalizeLectureRecord } from './lecture-schema.js';\nimport { deepClone } from '../utils.js';\n\nconst DB_NAME = 'sevenn-db';\nconst DB_VERSION = 5;\nconst MEMORY_STORAGE_KEY = 'sevenn-memory-db';\n\nconst STORE_KEY_PATHS = {\n  items: 'id',\n  blocks: 'blockId',\n  exams: 'id',\n  settings: 'id',\n  exam_sessions: 'examId',\n  study_sessions: 'mode',\n  lectures: 'key'\n};\n\nconst enqueue = typeof queueMicrotask === 'function'\n  ? queueMicrotask.bind(globalThis)\n  : (cb => Promise.resolve().then(cb));\n\nconst clone = deepClone;\n\nclass MemoryRequest {\n  constructor(tx, executor) {\n    this.result = undefined;\n    this.error = null;\n    this.onsuccess = null;\n    this.onerror = null;\n    tx._requestStarted();\n    enqueue(() => {\n      try {\n        this.result = executor();\n        if (typeof this.onsuccess === 'function') {\n          this.onsuccess({ target: this });\n        }\n        tx._requestFinished();\n      } catch (err) {\n        this.error = err;\n        if (typeof this.onerror === 'function') {\n          this.onerror({ target: this });\n        }\n        tx._requestFailed(err);\n      }\n    });\n  }\n}\n\nclass MemoryIndex {\n  constructor(store, extractor, multiEntry = false) {\n    this.store = store;\n    this.extractor = extractor;\n    this.multiEntry = multiEntry;\n  }\n\n  getAll(value) {\n    return new MemoryRequest(this.store.tx, () => {\n      const results = [];\n      for (const item of this.store._map().values()) {\n        const extracted = this.extractor(item);\n        if (this.multiEntry && Array.isArray(extracted)) {\n          if (extracted.includes(value)) results.push(clone(item));\n        } else if (extracted === value) {\n          results.push(clone(item));\n        }\n      }\n      return results;\n    });\n  }\n\n  getAllKeys(value) {\n    return new MemoryRequest(this.store.tx, () => {\n      const results = [];\n      for (const [key, item] of this.store._map()) {\n        const extracted = this.extractor(item);\n        if (this.multiEntry && Array.isArray(extracted)) {\n          if (extracted.includes(value)) results.push(key);\n        } else if (extracted === value) {\n          results.push(key);\n        }\n      }\n      return results;\n    });\n  }\n}\n\nclass MemoryStore {\n  constructor(tx, name) {\n    this.tx = tx;\n    this.name = name;\n  }\n\n  _map() {\n    if (!this.tx.db.maps[this.name]) {\n      this.tx.db.maps[this.name] = new Map();\n    }\n    return this.tx.db.maps[this.name];\n  }\n\n  _keyFromValue(value) {\n    const keyPath = STORE_KEY_PATHS[this.name];\n    if (!keyPath) return undefined;\n    return value?.[keyPath];\n  }\n\n  get(key) {\n    return new MemoryRequest(this.tx, () => {\n      const found = this._map().get(key);\n      return clone(found);\n    });\n  }\n\n  getAll() {\n    return new MemoryRequest(this.tx, () => {\n      return Array.from(this._map().values()).map(clone);\n    });\n  }\n\n  put(value) {\n    return new MemoryRequest(this.tx, () => {\n      const key = this._keyFromValue(value);\n      if (key == null) throw new Error(`Missing key for store ${this.name}`);\n      this._map().set(key, clone(value));\n      this.tx.db._persist();\n      return clone(value);\n    });\n  }\n\n  delete(key) {\n    return new MemoryRequest(this.tx, () => {\n      this._map().delete(key);\n      this.tx.db._persist();\n      return undefined;\n    });\n  }\n\n  clear() {\n    return new MemoryRequest(this.tx, () => {\n      this._map().clear();\n      this.tx.db._persist();\n      return undefined;\n    });\n  }\n\n  index(name) {\n    if (this.name === 'items') {\n      switch (name) {\n        case 'by_kind':\n          return new MemoryIndex(this, item => item.kind || null);\n        case 'by_blocks':\n          return new MemoryIndex(this, item => item.blocks || [], true);\n        case 'by_weeks':\n          return new MemoryIndex(this, item => item.weeks || [], true);\n        case 'by_favorite':\n          return new MemoryIndex(this, item => !!item.favorite);\n        default:\n          break;\n      }\n    } else if (this.name === 'lectures') {\n      switch (name) {\n        case 'by_block':\n          return new MemoryIndex(this, item => item.blockId || null);\n        case 'by_tags':\n          return new MemoryIndex(this, item => item.tags || [], true);\n        case 'by_nextDue':\n          return new MemoryIndex(this, item => item.nextDueAt ?? null);\n        default:\n          break;\n      }\n    }\n    return {\n      getAll: () => new MemoryRequest(this.tx, () => []),\n      getAllKeys: () => new MemoryRequest(this.tx, () => [])\n    };\n  }\n}\n\nclass MemoryTransaction {\n  constructor(db, names, mode) {\n    this.db = db;\n    this.names = Array.isArray(names) ? names : [names];\n    this.mode = mode;\n    this._stores = new Map();\n    this._pending = 0;\n    this._failed = false;\n    this._completePending = false;\n    this._errorPending = null;\n    this._oncomplete = null;\n    this._onerror = null;\n\n    Object.defineProperty(this, 'oncomplete', {\n      get: () => this._oncomplete,\n      set: fn => {\n        this._oncomplete = fn;\n        if (this._completePending && typeof fn === 'function') {\n          this._completePending = false;\n          enqueue(() => fn({ target: this }));\n        }\n      }\n    });\n\n    Object.defineProperty(this, 'onerror', {\n      get: () => this._onerror,\n      set: fn => {\n        this._onerror = fn;\n        if (this._errorPending && typeof fn === 'function') {\n          const err = this._errorPending;\n          this._errorPending = null;\n          enqueue(() => fn({ target: this, error: err }));\n        }\n      }\n    });\n  }\n\n  objectStore(name) {\n    if (!this._stores.has(name)) {\n      this._stores.set(name, new MemoryStore(this, name));\n    }\n    return this._stores.get(name);\n  }\n\n  _requestStarted() {\n    this._pending += 1;\n  }\n\n  _requestFinished() {\n    if (this._pending > 0) this._pending -= 1;\n    if (this._pending === 0 && !this._failed) {\n      if (typeof this._oncomplete === 'function') {\n        enqueue(() => this._oncomplete({ target: this }));\n      } else {\n        this._completePending = true;\n      }\n    }\n  }\n\n  _requestFailed(error) {\n    this._failed = true;\n    if (typeof this._onerror === 'function') {\n      enqueue(() => this._onerror({ target: this, error }));\n    } else {\n      this._errorPending = error;\n    }\n  }\n}\n\nclass MemoryDB {\n  constructor() {\n    this.maps = {};\n    this.persistKey = MEMORY_STORAGE_KEY;\n    this.canPersist = false;\n    if (typeof localStorage !== 'undefined') {\n      try {\n        const testKey = `${MEMORY_STORAGE_KEY}-test`;\n        localStorage.setItem(testKey, '1');\n        localStorage.removeItem(testKey);\n        this.canPersist = true;\n      } catch (err) {\n        this.canPersist = false;\n      }\n    }\n    for (const name of Object.keys(STORE_KEY_PATHS)) {\n      this.maps[name] = new Map();\n    }\n    this._load();\n  }\n\n  _load() {\n    if (!this.canPersist) return;\n    try {\n      const raw = localStorage.getItem(this.persistKey);\n      if (!raw) return;\n      const parsed = JSON.parse(raw);\n      for (const name of Object.keys(STORE_KEY_PATHS)) {\n        const list = parsed?.[name];\n        if (Array.isArray(list)) {\n          for (const entry of list) {\n            const keyPath = STORE_KEY_PATHS[name];\n            const key = entry?.[keyPath];\n            if (key != null) {\n              this.maps[name].set(key, clone(entry));\n            }\n          }\n        }\n      }\n    } catch (err) {\n      console.warn('Failed to load memory DB from storage', err);\n      for (const name of Object.keys(STORE_KEY_PATHS)) {\n        this.maps[name].clear();\n      }\n    }\n  }\n\n  _persist() {\n    if (!this.canPersist) return;\n    try {\n      const payload = {};\n      for (const name of Object.keys(STORE_KEY_PATHS)) {\n        payload[name] = Array.from(this.maps[name].values()).map(clone);\n      }\n      localStorage.setItem(this.persistKey, JSON.stringify(payload));\n    } catch (err) {\n      console.warn('Failed to persist memory DB', err);\n      this.canPersist = false;\n    }\n  }\n\n  transaction(names, mode = 'readonly') {\n    return new MemoryTransaction(this, names, mode);\n  }\n\n  close() {}\n}\n\nfunction fallbackToMemory(message, error) {\n  if (message) {\n    console.warn(message, error);\n  }\n  return new MemoryDB();\n}\n\nexport function openDB() {\n  if (!('indexedDB' in globalThis)) {\n    return Promise.resolve(fallbackToMemory('IndexedDB unavailable, using in-memory storage.'));\n  }\n  return new Promise(resolve => {\n    let settled = false;\n    let req;\n    try {\n      req = indexedDB.open(DB_NAME, DB_VERSION);\n    } catch (err) {\n      settled = true;\n      resolve(fallbackToMemory('IndexedDB threw during open, using in-memory storage.', err));\n      return;\n    }\n    const timer = setTimeout(() => {\n      if (!settled) {\n        settled = true;\n        resolve(fallbackToMemory('IndexedDB open timeout, using in-memory storage.'));\n      }\n    }, 5000);\n    req.onerror = () => {\n      if (settled) return;\n      settled = true;\n      clearTimeout(timer);\n      resolve(fallbackToMemory('IndexedDB failed to open, using in-memory storage.', req.error));\n    };\n    req.onupgradeneeded = event => {\n      const db = req.result;\n      const tx = req.transaction;\n\n      if (!db.objectStoreNames.contains('items')) {\n        const items = db.createObjectStore('items', { keyPath: 'id' });\n        items.createIndex('by_kind', 'kind');\n        items.createIndex('by_updatedAt', 'updatedAt');\n        items.createIndex('by_favorite', 'favorite');\n        items.createIndex('by_blocks', 'blocks', { multiEntry: true });\n        items.createIndex('by_weeks', 'weeks', { multiEntry: true });\n        items.createIndex('by_lecture_ids', 'lectures.id', { multiEntry: true });\n        items.createIndex('by_search', 'tokens');\n      }\n\n      if (!db.objectStoreNames.contains('blocks')) {\n        const blocks = db.createObjectStore('blocks', { keyPath: 'blockId' });\n        blocks.createIndex('by_title', 'title');\n        blocks.createIndex('by_createdAt', 'createdAt');\n      }\n\n      if (!db.objectStoreNames.contains('exams')) {\n        const exams = db.createObjectStore('exams', { keyPath: 'id' });\n        exams.createIndex('by_createdAt', 'createdAt');\n      }\n\n      if (!db.objectStoreNames.contains('settings')) {\n        db.createObjectStore('settings', { keyPath: 'id' });\n      }\n\n      if (!db.objectStoreNames.contains('exam_sessions')) {\n        const sessions = db.createObjectStore('exam_sessions', { keyPath: 'examId' });\n        sessions.createIndex('by_updatedAt', 'updatedAt');\n      }\n\n      if (!db.objectStoreNames.contains('study_sessions')) {\n        const sessions = db.createObjectStore('study_sessions', { keyPath: 'mode' });\n        sessions.createIndex('by_updatedAt', 'updatedAt');\n      }\n\n      let lecturesStore = null;\n      if (!db.objectStoreNames.contains('lectures')) {\n        lecturesStore = db.createObjectStore('lectures', { keyPath: 'key' });\n        lecturesStore.createIndex('by_block', 'blockId');\n        lecturesStore.createIndex('by_tags', 'tags', { multiEntry: true });\n        lecturesStore.createIndex('by_nextDue', 'nextDueAt');\n      } else if (tx) {\n        try {\n          lecturesStore = tx.objectStore('lectures');\n          if (lecturesStore) {\n            const indexNames = Array.from(lecturesStore.indexNames || []);\n            if (!indexNames.includes('by_block')) {\n              lecturesStore.createIndex('by_block', 'blockId');\n            }\n            if (!indexNames.includes('by_tags')) {\n              lecturesStore.createIndex('by_tags', 'tags', { multiEntry: true });\n            }\n            if (!indexNames.includes('by_nextDue')) {\n              lecturesStore.createIndex('by_nextDue', 'nextDueAt');\n            }\n          }\n        } catch (err) {\n          console.warn('Failed to ensure lecture indexes', err);\n        }\n      }\n\n      if (tx && lecturesStore && event.oldVersion < 5) {\n        try {\n          const blocksStore = tx.objectStore('blocks');\n          if (blocksStore && typeof blocksStore.getAll === 'function') {\n            const readReq = blocksStore.getAll();\n            readReq.onsuccess = () => {\n              const blocks = Array.isArray(readReq.result) ? readReq.result : [];\n              const now = Date.now();\n              for (const block of blocks) {\n                const originalLectures = Array.isArray(block?.lectures) ? block.lectures : [];\n                const hadLecturesField = Object.prototype.hasOwnProperty.call(block || {}, 'lectures');\n                if (originalLectures.length) {\n                  const sanitized = { ...block };\n                  delete sanitized.lectures;\n                  try {\n                    blocksStore.put(sanitized);\n                  } catch (err) {\n                    console.warn('Failed to persist migrated block', err);\n                  }\n                  for (const lecture of originalLectures) {\n                    const normalized = normalizeLectureRecord(block.blockId, lecture, now);\n                    if (!normalized) continue;\n                    try {\n                      lecturesStore.put(normalized);\n                    } catch (err) {\n                      console.warn('Failed to migrate lecture', err);\n                    }\n                  }\n                } else if (hadLecturesField) {\n                  const sanitized = { ...block };\n                  delete sanitized.lectures;\n                  try {\n                    blocksStore.put(sanitized);\n                  } catch (err) {\n                    console.warn('Failed to clean block lectures field', err);\n                  }\n                }\n              }\n            };\n            readReq.onerror = () => {\n              console.warn('Failed to read blocks during lecture migration', readReq.error);\n            };\n          }\n        } catch (err) {\n          console.warn('Lecture migration failed', err);\n        }\n      }\n    };\n    req.onsuccess = () => {\n      if (settled) return;\n      settled = true;\n      clearTimeout(timer);\n      resolve(req.result);\n    };\n  });\n}\n", "import { openDB } from './idb.js';\nimport { lectureKey, normalizeLectureRecord } from './lecture-schema.js';\nimport { deepClone } from '../utils.js';\n\nconst clone = deepClone;\n\nfunction prom(req) {\n  return new Promise((resolve, reject) => {\n    req.onsuccess = () => resolve(req.result);\n    req.onerror = () => reject(req.error);\n  });\n}\n\nasync function lectureStore(mode = 'readonly') {\n  const db = await openDB();\n  return db.transaction('lectures', mode).objectStore('lectures');\n}\n\nasync function fetchLecturesForBlock(storeRef, blockId) {\n  if (!blockId) return [];\n  try {\n    if (typeof storeRef.index === 'function') {\n      const idx = storeRef.index('by_block');\n      if (idx && typeof idx.getAll === 'function') {\n        const results = await prom(idx.getAll(blockId));\n        return Array.isArray(results) ? results : [];\n      }\n    }\n  } catch (err) {\n    console.warn('Failed to use lecture block index, falling back to scan', err);\n  }\n  const all = await prom(storeRef.getAll());\n  return (Array.isArray(all) ? all : []).filter(entry => entry?.blockId === blockId);\n}\n\nfunction buildNormalizedLecture(blockId, input, existing, now) {\n  const lectureId = input?.id ?? existing?.id;\n  if (blockId == null || lectureId == null) return null;\n  const tags = Array.isArray(input?.tags)\n    ? input.tags\n    : Array.isArray(existing?.tags)\n      ? existing.tags\n      : undefined;\n  const explicitPasses = Array.isArray(input?.passes);\n  const passPlanChanged = Boolean(input?.passPlan);\n  const plannerDefaultsChanged = Boolean(input?.plannerDefaults);\n  const startProvided = input?.startAt !== undefined;\n  const passContextChanged = passPlanChanged || plannerDefaultsChanged || startProvided;\n  const shouldPreserveScheduleState = !explicitPasses && !passContextChanged;\n  let passes;\n  if (explicitPasses) {\n    passes = input.passes;\n  } else if (passContextChanged && Array.isArray(existing?.passes)) {\n    passes = existing.passes.map(pass => {\n      if (!pass || typeof pass !== 'object') return pass;\n      const next = { ...pass };\n      delete next.due;\n      return next;\n    });\n  } else {\n    passes = Array.isArray(existing?.passes)\n      ? existing.passes\n      : undefined;\n  }\n  const passPlan = passPlanChanged\n    ? { ...(existing?.passPlan || {}), ...input.passPlan }\n    : existing?.passPlan;\n  const status = input?.status\n    ? { ...(existing?.status || {}), ...input.status }\n    : existing?.status;\n  const plannerDefaults = plannerDefaultsChanged\n    ? { ...(existing?.plannerDefaults || {}), ...input.plannerDefaults }\n    : existing?.plannerDefaults;\n  const nextDueAt = input?.nextDueAt !== undefined\n    ? input.nextDueAt\n    : existing?.nextDueAt;\n\n  const composite = {\n    ...(existing || {}),\n    ...(input || {}),\n    blockId,\n    id: lectureId,\n    key: lectureKey(blockId, lectureId),\n    tags,\n    passes,\n    passPlan,\n    plannerDefaults,\n    status,\n    nextDueAt\n  };\n\n  const normalized = normalizeLectureRecord(blockId, composite, now);\n  if (existing?.createdAt != null) normalized.createdAt = existing.createdAt;\n  if (existing && !input?.passPlan && existing.passPlan) normalized.passPlan = clone(existing.passPlan);\n  if (existing && shouldPreserveScheduleState && !input?.status && existing.status) {\n    normalized.status = clone(existing.status);\n  }\n  if (existing && shouldPreserveScheduleState && Array.isArray(existing.passes)) {\n    normalized.passes = clone(existing.passes);\n  }\n  if (existing && !Array.isArray(input?.tags) && Array.isArray(existing.tags)) {\n    normalized.tags = clone(existing.tags);\n  }\n  if (existing && shouldPreserveScheduleState && input?.nextDueAt === undefined && existing.nextDueAt !== undefined) {\n    normalized.nextDueAt = existing.nextDueAt ?? null;\n  }\n  return normalized;\n}\n\nexport async function listLecturesByBlock(blockId) {\n  try {\n    const store = await lectureStore();\n    const rows = await fetchLecturesForBlock(store, blockId);\n    return rows.map(clone);\n  } catch (err) {\n    console.warn('listLecturesByBlock failed', err);\n    return [];\n  }\n}\n\nexport async function listAllLectures() {\n  try {\n    const store = await lectureStore();\n    const rows = await prom(store.getAll());\n    return Array.isArray(rows) ? rows.map(clone) : [];\n  } catch (err) {\n    console.warn('listAllLectures failed', err);\n    return [];\n  }\n}\n\nexport async function saveLecture(lecture) {\n  if (!lecture || lecture.blockId == null) {\n    throw new Error('Missing lecture identity for save');\n  }\n  const store = await lectureStore('readwrite');\n  let lectureId = lecture.id;\n  if (lectureId == null) {\n    const rows = await fetchLecturesForBlock(store, lecture.blockId);\n    let maxId = 0;\n    for (const row of rows) {\n      const value = Number(row?.id);\n      if (Number.isFinite(value) && value > maxId) {\n        maxId = value;\n      }\n    }\n    lectureId = maxId + 1;\n  }\n  if (typeof lectureId === 'string') {\n    const parsed = Number(lectureId);\n    if (!Number.isNaN(parsed)) {\n      lectureId = parsed;\n    }\n  }\n  const key = lectureKey(lecture.blockId, lectureId);\n  const existing = await prom(store.get(key));\n  const now = Date.now();\n  const normalized = buildNormalizedLecture(lecture.blockId, { ...lecture, id: lectureId }, existing, now);\n  if (!normalized) throw new Error('Failed to normalize lecture payload');\n  await prom(store.put(normalized));\n  return clone(normalized);\n}\n\nexport async function deleteLectureRecord(blockId, lectureId) {\n  if (blockId == null || lectureId == null) return;\n  const store = await lectureStore('readwrite');\n  await prom(store.delete(lectureKey(blockId, lectureId)));\n}\n\nexport async function removeLecturesForBlock(blockId) {\n  if (!blockId) return;\n  const store = await lectureStore('readwrite');\n  const rows = await fetchLecturesForBlock(store, blockId);\n  for (const row of rows) {\n    await prom(store.delete(row.key));\n  }\n}\n\nexport async function bulkUpdateLectureStatus(updates) {\n  if (!Array.isArray(updates) || !updates.length) return;\n  const store = await lectureStore('readwrite');\n  const now = Date.now();\n  for (const update of updates) {\n    if (!update || update.blockId == null || update.lectureId == null) continue;\n    const key = lectureKey(update.blockId, update.lectureId);\n    const existing = await prom(store.get(key));\n    if (!existing) continue;\n    const normalized = buildNormalizedLecture(\n      update.blockId,\n      {\n        id: update.lectureId,\n        status: update.status,\n        passes: update.passes,\n        nextDueAt: update.nextDueAt,\n        passPlan: update.passPlan,\n        tags: update.tags\n      },\n      existing,\n      now\n    );\n    if (!normalized) continue;\n    await prom(store.put(normalized));\n  }\n}\n\nexport {\n  DEFAULT_PASS_PLAN,\n  DEFAULT_LECTURE_STATUS,\n  lectureKey\n} from './lecture-schema.js';\n\n", "const contentFields = [\n  'etiology','pathophys','clinical','diagnosis','treatment','complications','mnemonic',\n  'class','source','moa','uses','sideEffects','contraindications',\n  'type','definition','mechanism','clinicalRelevance','example'\n];\n\nfunction stripHtml(value = '') {\n  return value\n    .replace(/<br\\s*\\/?>(\\s*)/gi, ' ')\n    .replace(/<[^>]+>/g, ' ')\n    .replace(/&nbsp;/gi, ' ')\n    .replace(/&[#a-z0-9]+;/gi, ' ');\n}\n\nexport function tokenize(str) {\n  return str.toLowerCase().replace(/[^\\p{L}\\p{N}\\s]/gu, ' ').split(/\\s+/).filter(Boolean);\n}\n\nexport function buildTokens(item) {\n  const fields = [];\n  if (item.name) fields.push(item.name);\n  if (item.concept) fields.push(item.concept);\n  fields.push(...(item.tags || []));\n  if (Array.isArray(item.extras)) {\n    item.extras.forEach(extra => {\n      if (!extra) return;\n      if (extra.title) fields.push(extra.title);\n      if (extra.body) fields.push(stripHtml(extra.body));\n    });\n  } else if (item.facts && item.facts.length) {\n    fields.push(...item.facts);\n  }\n  if (item.lectures) fields.push(...item.lectures.map(l => l.name));\n  contentFields.forEach(field => {\n    if (typeof item[field] === 'string' && item[field]) {\n      fields.push(stripHtml(item[field]));\n    }\n  });\n  return Array.from(new Set(tokenize(fields.join(' ')))).slice(0,200).join(' ');\n}\n\nexport function buildSearchMeta(item) {\n  const pieces = [];\n  if (item.name) pieces.push(item.name);\n  if (item.concept) pieces.push(item.concept);\n  pieces.push(...(item.tags || []));\n  pieces.push(...(item.blocks || []));\n  if (Array.isArray(item.lectures)) {\n    pieces.push(...item.lectures.map(l => l?.name || ''));\n  }\n  return pieces.join(' ').toLowerCase();\n}\n", "import { openDB } from './idb.js';\nimport { buildTokens, buildSearchMeta } from '../search.js';\nimport { lectureKey, normalizeLectureRecord } from './lecture-schema.js';\nimport { deepClone } from '../utils.js';\n\nconst MAP_CONFIG_KEY = 'map-config';\nconst TRANSACTION_STORES = [\n  'items',\n  'blocks',\n  'exams',\n  'settings',\n  'exam_sessions',\n  'study_sessions',\n  'lectures'\n];\n\nfunction prom(req){\n  return new Promise((resolve,reject)=>{\n    req.onsuccess = ()=> resolve(req.result);\n    req.onerror = ()=> reject(req.error);\n  });\n}\n\nexport async function exportJSON(){\n  const db = await openDB();\n  const tx = db.transaction(TRANSACTION_STORES);\n  const itemsStore = tx.objectStore('items');\n  const blocksStore = tx.objectStore('blocks');\n  const examsStore = tx.objectStore('exams');\n  const settingsStore = tx.objectStore('settings');\n  const examSessionsStore = tx.objectStore('exam_sessions');\n  const studySessionsStore = tx.objectStore('study_sessions');\n  const lecturesStore = tx.objectStore('lectures');\n\n  const [\n    items = [],\n    blocks = [],\n    exams = [],\n    settingsArr = [],\n    examSessions = [],\n    studySessions = [],\n    lectures = []\n  ] = await Promise.all([\n    prom(itemsStore.getAll()),\n    prom(blocksStore.getAll()),\n    prom(examsStore.getAll()),\n    prom(settingsStore.getAll()),\n    prom(examSessionsStore.getAll()),\n    prom(studySessionsStore.getAll()),\n    prom(lecturesStore.getAll())\n  ]);\n\n  const settings = settingsArr.find(s => s?.id === 'app') || { id:'app', dailyCount:20, theme:'dark' };\n  const mapConfigEntry = settingsArr.find(s => s?.id === MAP_CONFIG_KEY);\n  const mapConfig = mapConfigEntry && typeof mapConfigEntry === 'object' ? mapConfigEntry.config : null;\n  const additionalSettings = settingsArr.filter(entry => {\n    if (!entry || typeof entry !== 'object') return false;\n    if (!entry.id || entry.id === 'app' || entry.id === MAP_CONFIG_KEY) return false;\n    return true;\n  });\n\n  return {\n    items,\n    blocks,\n    exams,\n    lectures,\n    examSessions,\n    studySessions,\n    settings,\n    mapConfig,\n    settingsEntries: additionalSettings\n  };\n}\n\nexport async function importJSON(dbDump){\n  try {\n    const db = await openDB();\n    const tx = db.transaction(TRANSACTION_STORES,'readwrite');\n    const items = tx.objectStore('items');\n    const blocks = tx.objectStore('blocks');\n    const exams = tx.objectStore('exams');\n    const settings = tx.objectStore('settings');\n    const examSessions = tx.objectStore('exam_sessions');\n    const studySessions = tx.objectStore('study_sessions');\n    const lectures = tx.objectStore('lectures');\n\n    await Promise.all([\n      prom(items.clear()),\n      prom(blocks.clear()),\n      prom(exams.clear()),\n      prom(settings.clear()),\n      prom(examSessions.clear()),\n      prom(studySessions.clear()),\n      prom(lectures.clear())\n    ]);\n\n    const additionalSettings = Array.isArray(dbDump?.settingsEntries)\n      ? dbDump.settingsEntries.filter(entry => entry && typeof entry === 'object' && entry.id && entry.id !== 'app')\n      : [];\n\n    if (dbDump?.settings && typeof dbDump.settings === 'object') {\n      await prom(settings.put({ ...dbDump.settings, id:'app' }));\n    } else {\n      await prom(settings.put({ id:'app', dailyCount:20, theme:'dark' }));\n    }\n    if (dbDump?.mapConfig && typeof dbDump.mapConfig === 'object') {\n      await prom(settings.put({ id: MAP_CONFIG_KEY, config: dbDump.mapConfig }));\n    }\n    for (const entry of additionalSettings) {\n      await prom(settings.put(entry));\n    }\n    const lectureRecords = new Map();\n    const addLectureRecord = (record, { preferExisting = false } = {}) => {\n      if (!record || typeof record !== 'object') return;\n      const blockId = record.blockId ?? record.block ?? null;\n      const lectureId = record.id ?? record.lectureId ?? null;\n      if (blockId == null || lectureId == null) return;\n      const key = record.key || lectureKey(blockId, lectureId);\n      if (!key) return;\n      if (preferExisting && lectureRecords.has(key)) return;\n      const payload = deepClone({ ...record, key, blockId, id: lectureId });\n      lectureRecords.set(key, payload);\n    };\n\n    if (Array.isArray(dbDump?.lectures)) {\n      for (const lecture of dbDump.lectures) {\n        addLectureRecord(lecture);\n      }\n    }\n\n    const migrationTimestamp = Date.now();\n    if (Array.isArray(dbDump?.blocks)) {\n      for (const b of dbDump.blocks) {\n        if (!b || typeof b !== 'object') continue;\n        const { lectures: legacyLectures, ...rest } = b;\n        await prom(blocks.put(rest));\n        if (!Array.isArray(legacyLectures) || legacyLectures.length === 0) continue;\n        const blockId = rest?.blockId;\n        if (blockId == null) continue;\n        for (const legacy of legacyLectures) {\n          const normalized = normalizeLectureRecord(blockId, legacy, migrationTimestamp);\n          if (!normalized) continue;\n          if (typeof legacy?.createdAt === 'number' && Number.isFinite(legacy.createdAt)) {\n            normalized.createdAt = legacy.createdAt;\n          }\n          if (typeof legacy?.updatedAt === 'number' && Number.isFinite(legacy.updatedAt)) {\n            normalized.updatedAt = legacy.updatedAt;\n          }\n          addLectureRecord(normalized, { preferExisting: true });\n        }\n      }\n    }\n\n    if (lectureRecords.size) {\n      for (const lecture of lectureRecords.values()) {\n        await prom(lectures.put(lecture));\n      }\n    }\n\n    if (Array.isArray(dbDump?.items)) {\n      for (const it of dbDump.items) {\n        if (!it || typeof it !== 'object') continue;\n        it.tokens = buildTokens(it);\n        it.searchMeta = buildSearchMeta(it);\n        await prom(items.put(it));\n      }\n    }\n    if (Array.isArray(dbDump?.exams)) {\n      for (const ex of dbDump.exams) {\n        if (!ex || typeof ex !== 'object') continue;\n        await prom(exams.put(ex));\n      }\n    }\n    if (Array.isArray(dbDump?.examSessions)) {\n      for (const session of dbDump.examSessions) {\n        if (!session || typeof session !== 'object') continue;\n        await prom(examSessions.put(session));\n      }\n    }\n    if (Array.isArray(dbDump?.studySessions)) {\n      for (const session of dbDump.studySessions) {\n        if (!session || typeof session !== 'object') continue;\n        await prom(studySessions.put(session));\n      }\n    }\n\n    await new Promise((resolve,reject)=>{ tx.oncomplete=()=>resolve(); tx.onerror=()=>reject(tx.error); });\n    if (db && typeof db.close === 'function') {\n      try { db.close(); } catch (_) {}\n    }\n    return { ok:true, message:'Import complete' };\n  } catch (e) {\n    return { ok:false, message:e.message };\n  }\n}\n\nfunction escapeCSV(value){\n  return '\"' + String(value).replace(/\"/g,'\"\"') + '\"';\n}\n\nexport async function exportAnkiCSV(profile, cohort){\n  const rows = [];\n  if (profile === 'cloze') {\n    const regex = /\\{\\{c\\d+::(.*?)\\}\\}/g;\n    for (const item of cohort) {\n      const title = item.name || item.concept || '';\n      for (const [key, val] of Object.entries(item)) {\n        if (typeof val !== 'string') continue;\n        let m;\n        while ((m = regex.exec(val))) {\n          const answer = m[1];\n          const question = val.replace(regex, '_____');\n          rows.push([question, answer, title]);\n        }\n      }\n    }\n  } else {\n    const qaMap = {\n      disease: [\n        ['etiology','Etiology of NAME?'],\n        ['pathophys','Pathophysiology of NAME?'],\n        ['clinical','Clinical features of NAME?'],\n        ['diagnosis','Diagnosis of NAME?'],\n        ['treatment','Treatment of NAME?'],\n        ['complications','Complications of NAME?']\n      ],\n      drug: [\n        ['class','Class of NAME?'],\n        ['moa','Mechanism of action of NAME?'],\n        ['uses','Uses of NAME?'],\n        ['sideEffects','Side effects of NAME?'],\n        ['contraindications','Contraindications of NAME?']\n      ],\n      concept: [\n        ['definition','Definition of NAME?'],\n        ['mechanism','Mechanism of NAME?'],\n        ['clinicalRelevance','Clinical relevance of NAME?'],\n        ['example','Example of NAME?']\n      ]\n    };\n    for (const item of cohort) {\n      const title = item.name || item.concept || '';\n      const mappings = qaMap[item.kind] || [];\n      for (const [field, tmpl] of mappings) {\n        const val = item[field];\n        if (!val) continue;\n        const question = tmpl.replace('NAME', title);\n        rows.push([question, val, title]);\n      }\n    }\n  }\n  const csv = rows.map(r => r.map(escapeCSV).join(',')).join('\\n');\n  return new Blob([csv], { type:'text/csv' });\n}\n\n", "export const REVIEW_RATINGS = ['again', 'hard', 'good', 'easy'];\nexport const RETIRE_RATING = 'retire';\n\n// Stored as minutes to keep persistence compact.\nexport const DEFAULT_REVIEW_STEPS = {\n  again: 10,\n  hard: 60,\n  good: 720,\n  easy: 2160\n};\n", "import { DEFAULT_REVIEW_STEPS, REVIEW_RATINGS } from './constants.js';\n\nexport function normalizeReviewSteps(raw) {\n  const normalized = { ...DEFAULT_REVIEW_STEPS };\n  if (!raw || typeof raw !== 'object') return normalized;\n  for (const key of REVIEW_RATINGS) {\n    const value = raw[key];\n    const num = Number(value);\n    if (Number.isFinite(num) && num > 0) {\n      normalized[key] = num;\n    }\n  }\n  return normalized;\n}\n", "import { REVIEW_RATINGS, RETIRE_RATING } from './constants.js';\n\nexport const SR_VERSION = 2;\n\nfunction sanitizeNumber(value, fallback = 0) {\n  const num = Number(value);\n  if (!Number.isFinite(num) || num < 0) return fallback;\n  return num;\n}\n\nexport function defaultSectionState() {\n  return {\n    streak: 0,\n    lastRating: null,\n    last: 0,\n    due: 0,\n    retired: false,\n    contentDigest: null,\n    lectureScope: []\n  };\n}\n\nexport function normalizeSectionRecord(record) {\n  const base = defaultSectionState();\n  if (!record || typeof record !== 'object') return base;\n  if (typeof record.streak === 'number' && Number.isFinite(record.streak) && record.streak > 0) {\n    base.streak = Math.max(0, Math.round(record.streak));\n  }\n  if (typeof record.lastRating === 'string') {\n    const rating = record.lastRating;\n    if (REVIEW_RATINGS.includes(rating) || rating === RETIRE_RATING) {\n      base.lastRating = rating;\n    }\n  }\n  base.last = sanitizeNumber(record.last, 0);\n  base.due = sanitizeNumber(record.due, 0);\n  base.retired = Boolean(record.retired);\n  if (typeof record.contentDigest === 'string' && record.contentDigest) {\n    base.contentDigest = record.contentDigest;\n  }\n  if (Array.isArray(record.lectureScope) && record.lectureScope.length) {\n    const normalizedScope = record.lectureScope\n      .map(entry => (typeof entry === 'string' ? entry.trim() : ''))\n      .filter(Boolean);\n    base.lectureScope = Array.from(new Set(normalizedScope)).sort();\n  }\n  return base;\n}\n\nexport function normalizeSrRecord(sr) {\n  const normalized = { version: SR_VERSION, sections: {} };\n  if (!sr || typeof sr !== 'object') return normalized;\n  const sections = sr.sections && typeof sr.sections === 'object' ? sr.sections : {};\n  for (const [key, value] of Object.entries(sections)) {\n    if (!key) continue;\n    normalized.sections[key] = normalizeSectionRecord(value);\n  }\n  return normalized;\n}\n", "import { normalizeSrRecord } from './review/sr-data.js';\n\nconst randomId = () => (globalThis.crypto?.randomUUID?.() ?? Math.random().toString(36).slice(2));\n\nconst MAX_GRAVITY_BOOST = 999;\n\nfunction escapeHtml(str = '') {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction sanitizeGravityBoost(value) {\n  if (value === null || value === undefined) return 0;\n  const num = Number(value);\n  if (!Number.isFinite(num) || num <= 0) return 0;\n  const clamped = Math.min(MAX_GRAVITY_BOOST, num);\n  return Math.round(clamped * 100) / 100;\n}\n\nfunction legacyFactsToHtml(facts = []) {\n  return facts\n    .map(f => `<p>${escapeHtml(f)}</p>`)\n    .join('');\n}\n\nexport function cleanItem(item) {\n  const extras = Array.isArray(item.extras) ? item.extras : [];\n  const normalizedExtras = extras\n    .map(ex => {\n      if (!ex || typeof ex !== 'object') return null;\n      const id = typeof ex.id === 'string' && ex.id ? ex.id : randomId();\n      const title = typeof ex.title === 'string' ? ex.title : '';\n      const body = typeof ex.body === 'string' ? ex.body : '';\n      if (!title.trim() && !body.trim()) return null;\n      return { id, title: title.trim(), body };\n    })\n    .filter(Boolean);\n  if (!normalizedExtras.length && Array.isArray(item.facts) && item.facts.length) {\n    normalizedExtras.push({\n      id: randomId(),\n      title: 'Highlights',\n      body: legacyFactsToHtml(item.facts)\n    });\n  }\n  return {\n    ...item,\n    favorite: !!item.favorite,\n    color: item.color || null,\n    extras: normalizedExtras,\n    facts: normalizedExtras.length ? [] : (Array.isArray(item.facts) ? item.facts : []),\n    tags: item.tags || [],\n    links: item.links || [],\n    blocks: item.blocks || [],\n    weeks: item.weeks || [],\n    lectures: item.lectures || [],\n    mapPos: item.mapPos || null,\n    mapHidden: !!item.mapHidden,\n    mapGravityBoost: sanitizeGravityBoost(item.mapGravityBoost),\n    sr: normalizeSrRecord(item.sr)\n  };\n}\n", "import { openDB } from './idb.js';\nimport {\n  listLecturesByBlock as fetchLecturesByBlock,\n  listAllLectures as fetchAllLectures,\n  saveLecture as persistLecture,\n  deleteLectureRecord as dropLectureRecord,\n  removeLecturesForBlock as dropLecturesForBlock,\n  lectureKey as composeLectureKey\n} from './lectures.js';\n\nexport {\n  listLecturesByBlock,\n  listAllLectures,\n  saveLecture,\n  deleteLectureRecord,\n  removeLecturesForBlock,\n  bulkUpdateLectureStatus,\n  DEFAULT_PASS_PLAN,\n  DEFAULT_LECTURE_STATUS,\n  lectureKey\n} from './lectures.js';\nimport { exportJSON, importJSON, exportAnkiCSV } from './export.js';\nimport { DEFAULT_REVIEW_STEPS } from '../review/constants.js';\nimport { normalizeReviewSteps } from '../review/settings.js';\nimport { DEFAULT_PLANNER_DEFAULTS, normalizePlannerDefaults } from '../lectures/scheduler.js';\nimport { deepClone } from '../utils.js';\n\nlet dbPromise;\n\nconst DEFAULT_KINDS = ['disease', 'drug', 'concept'];\nconst RESULT_BATCH_SIZE = 50;\nconst MAP_CONFIG_KEY = 'map-config';\nconst MAP_CONFIG_BACKUP_KEY = 'sevenn-map-config-backup';\nconst DATA_BACKUP_KEY = 'sevenn-backup-snapshot';\nconst DATA_BACKUP_STORES = ['items', 'blocks', 'exams', 'settings', 'exam_sessions', 'study_sessions', 'lectures'];\n\nconst DEFAULT_APP_SETTINGS = {\n  id: 'app',\n  dailyCount: 20,\n  theme: 'dark',\n  reviewSteps: { ...DEFAULT_REVIEW_STEPS },\n  plannerDefaults: normalizePlannerDefaults(DEFAULT_PLANNER_DEFAULTS)\n};\n\nlet backupTimer = null;\n\nconst DEFAULT_MAP_CONFIG = {\n  activeTabId: 'default',\n  tabs: [\n    {\n      id: 'default',\n      name: 'All concepts',\n      includeLinked: true,\n      manualMode: false,\n      manualIds: [],\n      layout: {},\n      layoutSeeded: true,\n      filter: { blockId: '', week: '', lectureKey: '' }\n    }\n  ]\n};\n\nfunction prom(req) {\n  return new Promise((resolve, reject) => {\n    req.onsuccess = () => resolve(req.result);\n    req.onerror = () => reject(req.error);\n  });\n}\n\nasync function store(name, mode = 'readonly') {\n  const db = await dbPromise;\n  return db.transaction(name, mode).objectStore(name);\n}\n\nfunction canUseStorage() {\n  return typeof localStorage !== 'undefined';\n}\n\nfunction readMapConfigBackup() {\n  if (!canUseStorage()) return null;\n  try {\n    const raw = localStorage.getItem(MAP_CONFIG_BACKUP_KEY);\n    if (!raw) return null;\n    const parsed = JSON.parse(raw);\n    if (parsed && typeof parsed === 'object') {\n      return parsed;\n    }\n  } catch (err) {\n    console.warn('Failed to read map backup', err);\n  }\n  return null;\n}\n\nfunction writeMapConfigBackup(config) {\n  if (!canUseStorage()) return;\n  try {\n    localStorage.setItem(MAP_CONFIG_BACKUP_KEY, JSON.stringify(config));\n  } catch (err) {\n    console.warn('Failed to persist map backup', err);\n  }\n}\n\nasync function writeDataBackup() {\n  if (!canUseStorage()) return;\n  try {\n    const db = await dbPromise;\n    if (!db || typeof db.transaction !== 'function') return;\n    const snapshot = {};\n    for (const name of DATA_BACKUP_STORES) {\n      try {\n        const tx = db.transaction(name, 'readonly');\n        const s = tx.objectStore(name);\n        const all = await prom(s.getAll());\n        snapshot[name] = Array.isArray(all) ? all : [];\n      } catch (err) {\n        console.warn(`Failed to snapshot store ${name}`, err);\n        snapshot[name] = [];\n      }\n    }\n    snapshot.__timestamp = Date.now();\n    localStorage.setItem(DATA_BACKUP_KEY, JSON.stringify(snapshot));\n  } catch (err) {\n    console.warn('Failed to persist data backup', err);\n  }\n}\n\nfunction scheduleBackup() {\n  if (!canUseStorage()) return;\n  if (backupTimer) clearTimeout(backupTimer);\n  backupTimer = setTimeout(() => {\n    backupTimer = null;\n    writeDataBackup().catch(err => console.warn('Backup write failed', err));\n  }, 1000);\n}\n\nasync function maybeRestoreFromBackup() {\n  if (!canUseStorage()) return;\n  let parsed;\n  try {\n    const raw = localStorage.getItem(DATA_BACKUP_KEY);\n    if (!raw) return;\n    parsed = JSON.parse(raw);\n  } catch (err) {\n    console.warn('Failed to parse saved backup', err);\n    return;\n  }\n  if (!parsed || typeof parsed !== 'object') return;\n  try {\n    const db = await dbPromise;\n    if (!db || typeof db.transaction !== 'function') return;\n    const emptyChecks = await Promise.all(DATA_BACKUP_STORES.map(async name => {\n      try {\n        const tx = db.transaction(name, 'readonly');\n        const s = tx.objectStore(name);\n        const existing = await prom(s.getAll());\n        return !existing || existing.length === 0;\n      } catch (err) {\n        console.warn(`Failed to inspect store ${name}`, err);\n        return false;\n      }\n    }));\n    if (!emptyChecks.every(Boolean)) return;\n    for (const name of DATA_BACKUP_STORES) {\n      const list = Array.isArray(parsed[name]) ? parsed[name] : [];\n      if (!list.length) continue;\n      try {\n        const tx = db.transaction(name, 'readwrite');\n        const s = tx.objectStore(name);\n        for (const entry of list) {\n          await prom(s.put(entry));\n        }\n      } catch (err) {\n        console.warn(`Failed to restore store ${name}`, err);\n      }\n    }\n  } catch (err) {\n    console.warn('Failed to restore data from backup', err);\n  }\n}\n\nexport async function initDB() {\n  if (!dbPromise) dbPromise = openDB();\n  await maybeRestoreFromBackup();\n  const s = await store('settings', 'readwrite');\n  const existing = await prom(s.get('app'));\n  if (!existing) {\n    await prom(s.put(DEFAULT_APP_SETTINGS));\n  }\n  scheduleBackup();\n}\n\nexport async function getSettings() {\n  const s = await store('settings');\n  const settings = await prom(s.get('app'));\n  if (!settings) return { ...DEFAULT_APP_SETTINGS };\n  const merged = { ...DEFAULT_APP_SETTINGS, ...settings };\n  merged.reviewSteps = normalizeReviewSteps(settings.reviewSteps || merged.reviewSteps);\n  merged.plannerDefaults = normalizePlannerDefaults(settings.plannerDefaults || merged.plannerDefaults);\n  return merged;\n}\n\nexport async function saveSettings(patch) {\n  const s = await store('settings', 'readwrite');\n  const current = await prom(s.get('app')) || { ...DEFAULT_APP_SETTINGS };\n  const mergedSteps = normalizeReviewSteps({\n    ...DEFAULT_APP_SETTINGS.reviewSteps,\n    ...(current.reviewSteps || {}),\n    ...(patch.reviewSteps || {})\n  });\n  const basePlanner = current.plannerDefaults || DEFAULT_APP_SETTINGS.plannerDefaults;\n  const patchPlanner = patch?.plannerDefaults || {};\n  const mergedPlannerDefaults = normalizePlannerDefaults({\n    anchorOffsets: {\n      ...(DEFAULT_APP_SETTINGS.plannerDefaults?.anchorOffsets || {}),\n      ...(basePlanner?.anchorOffsets || {}),\n      ...(patchPlanner.anchorOffsets || {})\n    },\n    passes: Array.isArray(patchPlanner.passes) && patchPlanner.passes.length\n      ? patchPlanner.passes\n      : basePlanner?.passes || DEFAULT_APP_SETTINGS.plannerDefaults?.passes,\n    passColors: Array.isArray(patchPlanner.passColors) && patchPlanner.passColors.length\n      ? patchPlanner.passColors\n      : basePlanner?.passColors || DEFAULT_APP_SETTINGS.plannerDefaults?.passColors\n  });\n  const next = {\n    ...current,\n    ...patch,\n    id: 'app',\n    reviewSteps: mergedSteps,\n    plannerDefaults: mergedPlannerDefaults\n  };\n  await prom(s.put(next));\n  scheduleBackup();\n}\n\nfunction cloneConfig(config) {\n  return deepClone(config);\n}\n\nexport async function getMapConfig() {\n  try {\n    const s = await store('settings', 'readwrite');\n    const existing = await prom(s.get(MAP_CONFIG_KEY));\n    if (existing && existing.config) {\n      const config = cloneConfig(existing.config);\n      writeMapConfigBackup(config);\n      return config;\n    }\n    const backup = readMapConfigBackup();\n    if (backup) {\n      const payload = cloneConfig(backup);\n      await prom(s.put({ id: MAP_CONFIG_KEY, config: payload }));\n      writeMapConfigBackup(payload);\n      scheduleBackup();\n      return payload;\n    }\n    const fallback = cloneConfig(DEFAULT_MAP_CONFIG);\n    await prom(s.put({ id: MAP_CONFIG_KEY, config: fallback }));\n    writeMapConfigBackup(fallback);\n    scheduleBackup();\n    return fallback;\n  } catch (err) {\n    console.warn('getMapConfig failed', err);\n    const backup = readMapConfigBackup();\n    if (backup) {\n      return cloneConfig(backup);\n    }\n    return cloneConfig(DEFAULT_MAP_CONFIG);\n  }\n}\n\nexport async function saveMapConfig(config) {\n  const payload = config ? cloneConfig(config) : cloneConfig(DEFAULT_MAP_CONFIG);\n  const s = await store('settings', 'readwrite');\n  await prom(s.put({ id: MAP_CONFIG_KEY, config: payload }));\n  writeMapConfigBackup(payload);\n  scheduleBackup();\n}\n\nexport async function listBlocks() {\n  try {\n    const lecturePromise = fetchAllLectures();\n    const blockStore = await store('blocks');\n    const all = await prom(blockStore.getAll());\n    const lectures = await lecturePromise;\n    const blocks = (all || [])\n      .map(block => {\n        if (!block || typeof block !== 'object') return block;\n        const { lectures: _ignored, ...rest } = block;\n        return { ...rest };\n      })\n      .sort((a, b) => {\n        const ao = a.order ?? a.createdAt;\n        const bo = b.order ?? b.createdAt;\n        return bo - ao;\n      });\n\n    const lectureIndex = {};\n    for (const lecture of lectures || []) {\n      if (!lecture || lecture.blockId == null || lecture.id == null) continue;\n      const blockId = lecture.blockId;\n      if (!lectureIndex[blockId]) lectureIndex[blockId] = {};\n      lectureIndex[blockId][lecture.id] = { ...lecture };\n    }\n\n    return { blocks, lectureIndex };\n  } catch (err) {\n    console.warn('listBlocks failed', err);\n    return { blocks: [], lectureIndex: {} };\n  }\n}\n\nfunction slugifyBlockTitle(title) {\n  if (typeof title !== 'string' || !title.trim()) return 'block';\n  const base = title\n    .toLowerCase()\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n    .slice(0, 40);\n  return base || 'block';\n}\n\nasync function generateBlockId(storeRef, title) {\n  const base = slugifyBlockTitle(title);\n  let candidate = base;\n  let attempt = 1;\n  while (true) {\n    const existing = candidate ? await prom(storeRef.get(candidate)) : null;\n    if (!existing && candidate) {\n      return candidate;\n    }\n    attempt += 1;\n    candidate = `${base}-${attempt}`;\n    if (attempt > 1000) {\n      return `block-${Date.now()}`;\n    }\n  }\n}\n\nfunction normalizeDateInput(value) {\n  if (value == null) return null;\n  if (value instanceof Date) {\n    if (Number.isNaN(value.getTime())) return null;\n    return value.toISOString().slice(0, 10);\n  }\n  if (typeof value === 'number') {\n    const date = new Date(value);\n    if (Number.isNaN(date.getTime())) return null;\n    return date.toISOString().slice(0, 10);\n  }\n  if (typeof value === 'string') {\n    const trimmed = value.trim();\n    if (!trimmed) return null;\n    const date = new Date(trimmed);\n    if (Number.isNaN(date.getTime())) return null;\n    return date.toISOString().slice(0, 10);\n  }\n  return null;\n}\n\nexport async function upsertBlock(def) {\n  const title = typeof def?.title === 'string' ? def.title : '';\n  let blockId = typeof def?.blockId === 'string' && def.blockId.trim() ? def.blockId.trim() : '';\n  const readStore = await store('blocks');\n  if (!blockId) {\n    blockId = await generateBlockId(readStore, title || 'block');\n  }\n  const existing = await prom(readStore.get(blockId));\n  const existingLectures = await fetchLecturesByBlock(blockId);\n  const now = Date.now();\n  const incomingLectures = Array.isArray(def.lectures)\n    ? def.lectures.map(lecture => ({\n        ...lecture,\n        blockId\n      }))\n    : existingLectures.map(lecture => ({\n        blockId: lecture.blockId,\n        id: lecture.id,\n        name: lecture.name,\n        week: lecture.week,\n        tags: Array.isArray(lecture.tags) ? lecture.tags : []\n      }));\n\n  const removedLectureIds = [];\n  let prunedLectures = incomingLectures;\n\n  if (existing && typeof def.weeks === 'number' && def.weeks < existing.weeks) {\n    const maxWeek = def.weeks;\n    prunedLectures = incomingLectures.filter(lecture => {\n      const week = lecture?.week;\n      const keep = week == null || week <= maxWeek;\n      if (!keep && lecture?.id != null) {\n        removedLectureIds.push(lecture.id);\n      }\n      return keep;\n    });\n    const i = await store('items', 'readwrite');\n    const all = await prom(i.getAll());\n    for (const it of all) {\n      let changed = false;\n      if (it.lectures) {\n        const before = it.lectures.length;\n        it.lectures = it.lectures.filter(l => !(l.blockId === blockId && l.week > maxWeek));\n        if (it.lectures.length !== before) changed = true;\n      }\n      if (it.weeks) {\n        const beforeW = it.weeks.length;\n        it.weeks = it.weeks.filter(w => w <= maxWeek);\n        if (it.weeks.length !== beforeW) changed = true;\n      }\n      if (changed) {\n        it.tokens = buildTokens(it);\n        it.searchMeta = buildSearchMeta(it);\n        await prom(i.put(it));\n      }\n    }\n  }\n\n  const next = {\n    ...def,\n    blockId,\n    color: def.color || existing?.color || null,\n    order: def.order || existing?.order || now,\n    createdAt: existing?.createdAt || now,\n    updatedAt: now,\n    weeks: typeof def.weeks === 'number' ? def.weeks : existing?.weeks,\n    startDate:\n      def.startDate !== undefined\n        ? normalizeDateInput(def.startDate)\n        : existing?.startDate\n          ? normalizeDateInput(existing.startDate)\n          : null,\n    endDate:\n      def.endDate !== undefined\n        ? normalizeDateInput(def.endDate)\n        : existing?.endDate\n          ? normalizeDateInput(existing.endDate)\n          : null\n  };\n  delete next.lectures;\n  const writeStore = await store('blocks', 'readwrite');\n  await prom(writeStore.put(next));\n\n  const incomingKeySet = new Set(\n    prunedLectures\n      .filter(lecture => lecture?.id != null)\n      .map(lecture => composeLectureKey(blockId, lecture.id))\n  );\n  for (const lecture of existingLectures) {\n    const key = lecture?.key || composeLectureKey(lecture.blockId, lecture.id);\n    if (!incomingKeySet.has(key) && lecture?.id != null) {\n      removedLectureIds.push(lecture.id);\n    }\n  }\n\n  for (const lecture of prunedLectures) {\n    if (lecture?.id == null) continue;\n    await persistLecture({\n      blockId,\n      id: lecture.id,\n      name: lecture.name,\n      week: lecture.week,\n      tags: Array.isArray(lecture.tags) ? lecture.tags : undefined,\n      passes: Array.isArray(lecture.passes) ? lecture.passes : undefined,\n      passPlan: lecture.passPlan,\n      status: lecture.status,\n      nextDueAt: lecture.nextDueAt\n    });\n  }\n\n  const uniqueRemoved = Array.from(new Set(removedLectureIds.filter(id => id != null)));\n  for (const lectureId of uniqueRemoved) {\n    await dropLectureRecord(blockId, lectureId);\n  }\n  if (uniqueRemoved.length) {\n    await removeLectureReferencesFromItems(blockId, uniqueRemoved);\n  }\n\n  scheduleBackup();\n}\n\nasync function removeLectureReferencesFromItems(blockId, lectureIds) {\n  if (!lectureIds.length) return;\n  const i = await store('items', 'readwrite');\n  const all = await prom(i.getAll());\n  for (const it of all) {\n    const before = it.lectures?.length || 0;\n    if (!before) continue;\n    it.lectures = it.lectures.filter(l => !(l.blockId === blockId && lectureIds.includes(l.id)));\n    if (it.lectures.length !== before) {\n      it.blocks = it.blocks?.filter(bid => bid !== blockId || it.lectures.some(l => l.blockId === bid));\n      const validWeeks = new Set((it.lectures || []).map(l => l.week));\n      it.weeks = Array.from(validWeeks);\n      it.tokens = buildTokens(it);\n      it.searchMeta = buildSearchMeta(it);\n      await prom(i.put(it));\n    }\n  }\n}\n\nexport async function deleteBlock(blockId) {\n  const b = await store('blocks', 'readwrite');\n  await prom(b.delete(blockId));\n  await dropLecturesForBlock(blockId);\n  // remove references from items to keep them \"unlabeled\"\n  const i = await store('items', 'readwrite');\n  const all = await prom(i.getAll());\n  for (const it of all) {\n    const beforeBlocks = it.blocks?.length || 0;\n    const beforeLects = it.lectures?.length || 0;\n    if (beforeBlocks || beforeLects) {\n      if (it.blocks) it.blocks = it.blocks.filter(bId => bId !== blockId);\n      if (it.lectures) it.lectures = it.lectures.filter(l => l.blockId !== blockId);\n      // recompute weeks based on remaining lectures\n      if (it.weeks) {\n        const validWeeks = new Set((it.lectures || []).map(l => l.week));\n        it.weeks = Array.from(validWeeks);\n      }\n      if ((it.blocks?.length || 0) !== beforeBlocks || (it.lectures?.length || 0) !== beforeLects) {\n        it.tokens = buildTokens(it);\n        it.searchMeta = buildSearchMeta(it);\n        await prom(i.put(it));\n      }\n    }\n  }\n  scheduleBackup();\n}\n\nexport async function deleteLecture(blockId, lectureId) {\n  await dropLectureRecord(blockId, lectureId);\n  await removeLectureReferencesFromItems(blockId, [lectureId]);\n  scheduleBackup();\n}\n\nexport async function updateLecture(blockId, lecture) {\n  if (!lecture || lecture.id == null) return;\n  await persistLecture({ ...lecture, blockId });\n  const i = await store('items', 'readwrite');\n  const all = await prom(i.getAll());\n  for (const it of all) {\n    let changed = false;\n    if (it.lectures) {\n      it.lectures = it.lectures.map(l => {\n        if (l.blockId === blockId && l.id === lecture.id) {\n          changed = true;\n          return { blockId, id: lecture.id, name: lecture.name, week: lecture.week };\n        }\n        return l;\n      });\n    }\n    if (changed) {\n      const validWeeks = new Set((it.lectures || []).map(l => l.week));\n      it.weeks = Array.from(validWeeks);\n      it.tokens = buildTokens(it);\n      it.searchMeta = buildSearchMeta(it);\n      await prom(i.put(it));\n    }\n  }\n  scheduleBackup();\n}\n\nimport { buildTokens, tokenize, buildSearchMeta } from '../search.js';\nimport { cleanItem } from '../validators.js';\n\nexport async function listItemsByKind(kind) {\n  const i = await store('items');\n  const idx = i.index('by_kind');\n  return await prom(idx.getAll(kind));\n}\n\nfunction titleOf(item){\n  return item.name || item.concept || '';\n}\n\nconst DEFAULT_SORT = { mode: 'updated', direction: 'desc' };\n\nfunction normalizeSort(sort) {\n  const raw = typeof sort === 'string' ? sort.toLowerCase() : '';\n  switch (raw) {\n    case 'updated-asc':\n      return { mode: 'updated', direction: 'asc' };\n    case 'updated-desc':\n    case 'updated':\n      return { mode: 'updated', direction: 'desc' };\n    case 'created-asc':\n      return { mode: 'created', direction: 'asc' };\n    case 'created-desc':\n    case 'created':\n      return { mode: 'created', direction: 'desc' };\n    case 'lecture-asc':\n      return { mode: 'lecture', direction: 'asc' };\n    case 'lecture-desc':\n    case 'lecture':\n      return { mode: 'lecture', direction: 'desc' };\n    case 'name-desc':\n      return { mode: 'name', direction: 'desc' };\n    case 'name':\n    case 'name-asc':\n      return { mode: 'name', direction: 'asc' };\n    default:\n      return { ...DEFAULT_SORT };\n  }\n}\n\nfunction normalizeFilter(filter = {}) {\n  const rawTypes = Array.isArray(filter.types) ? filter.types.filter(t => typeof t === 'string' && t) : [];\n  const types = rawTypes.length ? Array.from(new Set(rawTypes)) : DEFAULT_KINDS;\n  const block = typeof filter.block === 'string' ? filter.block : '';\n  const weekRaw = filter.week;\n  let week = null;\n  if (typeof weekRaw === 'number' && !Number.isNaN(weekRaw)) {\n    week = weekRaw;\n  } else if (typeof weekRaw === 'string' && weekRaw.trim()) {\n    const parsed = Number(weekRaw);\n    if (!Number.isNaN(parsed)) week = parsed;\n  }\n  const onlyFav = Boolean(filter.onlyFav);\n  const query = typeof filter.query === 'string' ? filter.query.trim() : '';\n  const normalizedQuery = query.toLowerCase();\n  const tokens = query ? tokenize(query) : [];\n  return {\n    types,\n    block,\n    week,\n    onlyFav,\n    tokens: tokens.length ? tokens : null,\n    query: normalizedQuery,\n    sort: normalizeSort(filter.sort)\n  };\n}\n\nasync function getKeySet(storeRef, indexName, value) {\n  if (value === null || value === undefined || value === '' || value !== value) return null;\n  if (typeof storeRef.index !== 'function') return null;\n  const idx = storeRef.index(indexName);\n  if (!idx || typeof idx.getAllKeys !== 'function') return null;\n  const keys = await prom(idx.getAllKeys(value));\n  return new Set(keys);\n}\n\nasync function keysForKinds(storeRef, kinds) {\n  const idx = typeof storeRef.index === 'function' ? storeRef.index('by_kind') : null;\n  const seen = new Set();\n  const allKeys = [];\n  for (const kind of kinds) {\n    if (!kind) continue;\n    let keys = [];\n    if (idx && typeof idx.getAllKeys === 'function') {\n      keys = await prom(idx.getAllKeys(kind));\n    } else if (idx && typeof idx.getAll === 'function') {\n      const values = await prom(idx.getAll(kind));\n      keys = values.map(v => v?.id).filter(Boolean);\n    }\n    for (const key of keys) {\n      if (!seen.has(key)) {\n        seen.add(key);\n        allKeys.push(key);\n      }\n    }\n  }\n  return allKeys;\n}\n\nasync function executeItemQuery(filter) {\n  const normalized = normalizeFilter(filter);\n  const itemsStore = await store('items');\n\n  const blockSet = normalized.block && normalized.block !== '__unlabeled'\n    ? await getKeySet(itemsStore, 'by_blocks', normalized.block)\n    : null;\n  const weekSet = normalized.week != null\n    ? await getKeySet(itemsStore, 'by_weeks', normalized.week)\n    : null;\n  const favoriteSet = normalized.onlyFav\n    ? await getKeySet(itemsStore, 'by_favorite', true)\n    : null;\n\n  const baseKeys = await keysForKinds(itemsStore, normalized.types);\n  const filteredKeys = baseKeys.filter(id => {\n    if (!id) return false;\n    if (blockSet && !blockSet.has(id)) return false;\n    if (weekSet && !weekSet.has(id)) return false;\n    if (favoriteSet && !favoriteSet.has(id)) return false;\n    return true;\n  });\n\n  const results = [];\n  for (let i = 0; i < filteredKeys.length; i += RESULT_BATCH_SIZE) {\n    const chunk = filteredKeys.slice(i, i + RESULT_BATCH_SIZE);\n    const fetched = await Promise.all(chunk.map(id => prom(itemsStore.get(id))));\n    for (const item of fetched) {\n      if (!item) continue;\n      if (normalized.block === '__unlabeled' && Array.isArray(item.blocks) && item.blocks.length) continue;\n      if (normalized.tokens) {\n        const tokenField = item.tokens || '';\n        const metaField = item.searchMeta || buildSearchMeta(item);\n        const matches = normalized.tokens.every(tok => tokenField.includes(tok) || metaField.includes(tok));\n        if (!matches) continue;\n      }\n      results.push(item);\n    }\n  }\n\n  let lectureDateIndex = null;\n  if (normalized.sort.mode === 'lecture') {\n    const lectures = await fetchAllLectures();\n    lectureDateIndex = new Map();\n    (lectures || []).forEach(lecture => {\n      if (!lecture || lecture.blockId == null || lecture.id == null) return;\n      const key = composeLectureKey(lecture.blockId, lecture.id);\n      const created = typeof lecture.createdAt === 'number' ? lecture.createdAt : 0;\n      lectureDateIndex.set(key, created);\n    });\n  }\n\n  const lectureSortCache = new Map();\n  function lectureTimestamp(item) {\n    if (!lectureDateIndex) return 0;\n    const cacheKey = item?.id ?? null;\n    if (cacheKey != null && lectureSortCache.has(cacheKey)) {\n      return lectureSortCache.get(cacheKey);\n    }\n    const links = Array.isArray(item?.lectures) ? item.lectures : [];\n    let latest = 0;\n    for (const link of links) {\n      if (!link || link.blockId == null || link.id == null) continue;\n      const key = composeLectureKey(link.blockId, link.id);\n      const created = lectureDateIndex.get(key);\n      if (typeof created === 'number' && created > latest) {\n        latest = created;\n      }\n    }\n    if (cacheKey != null) lectureSortCache.set(cacheKey, latest);\n    return latest;\n  }\n\n  const queryString = typeof normalized.query === 'string' ? normalized.query : '';\n  const hasQueryString = queryString.length > 0;\n\n  function nameMatchScore(item) {\n    if (!hasQueryString) return 0;\n    const title = titleOf(item).toLowerCase();\n    if (!title) return 0;\n    if (title.startsWith(queryString)) return 2;\n    if (title.includes(queryString)) return 1;\n    return 0;\n  }\n\n  results.sort((a, b) => {\n    if (hasQueryString) {\n      const aScore = nameMatchScore(a);\n      const bScore = nameMatchScore(b);\n      if (aScore !== bScore) {\n        return bScore - aScore;\n      }\n    }\n    let cmp = 0;\n    switch (normalized.sort.mode) {\n      case 'name':\n        cmp = titleOf(a).localeCompare(titleOf(b));\n        break;\n      case 'created': {\n        const av = typeof a.createdAt === 'number' ? a.createdAt : 0;\n        const bv = typeof b.createdAt === 'number' ? b.createdAt : 0;\n        cmp = av - bv;\n        break;\n      }\n      case 'lecture':\n        cmp = lectureTimestamp(a) - lectureTimestamp(b);\n        break;\n      case 'updated':\n      default: {\n        const av = typeof a.updatedAt === 'number' ? a.updatedAt : 0;\n        const bv = typeof b.updatedAt === 'number' ? b.updatedAt : 0;\n        cmp = av - bv;\n        break;\n      }\n    }\n    if (cmp === 0 && normalized.sort.mode !== 'name') {\n      cmp = titleOf(a).localeCompare(titleOf(b));\n    }\n    return normalized.sort.direction === 'asc' ? cmp : -cmp;\n  });\n\n  return results;\n}\n\nexport function findItemsByFilter(filter) {\n  let memo;\n  const run = () => {\n    if (!memo) memo = executeItemQuery(filter);\n    return memo;\n  };\n  return {\n    async toArray() {\n      const items = await run();\n      return items.slice();\n    },\n    async *[Symbol.asyncIterator]() {\n      const items = await run();\n      for (let i = 0; i < items.length; i += RESULT_BATCH_SIZE) {\n        yield items.slice(i, i + RESULT_BATCH_SIZE);\n      }\n    }\n  };\n}\n\nexport async function getItem(id) {\n  const i = await store('items');\n  return await prom(i.get(id));\n}\n\nexport async function upsertItem(item) {\n  const i = await store('items', 'readwrite');\n  const existing = await prom(i.get(item.id));\n  const now = Date.now();\n  const next = cleanItem({\n    ...item,\n    createdAt: existing?.createdAt || now,\n    updatedAt: now,\n  });\n  next.tokens = buildTokens(next);\n  next.searchMeta = buildSearchMeta(next);\n  // enforce link symmetry (basic)\n  for (const link of next.links) {\n    const other = await prom(i.get(link.id));\n    if (other) {\n      other.links = other.links || [];\n      if (!other.links.find(l => l.id === next.id)) {\n        other.links.push({ id: next.id, type: link.type });\n        other.tokens = buildTokens(other);\n        other.searchMeta = buildSearchMeta(other);\n        await prom(i.put(other));\n      }\n    }\n  }\n  await prom(i.put(next));\n  scheduleBackup();\n}\n\nexport async function deleteItem(id) {\n  const i = await store('items', 'readwrite');\n  const all = await prom(i.getAll());\n  for (const it of all) {\n    if (it.links?.some(l => l.id === id)) {\n      it.links = it.links.filter(l => l.id !== id);\n      it.tokens = buildTokens(it);\n      it.searchMeta = buildSearchMeta(it);\n      await prom(i.put(it));\n    }\n  }\n  await prom(i.delete(id));\n  scheduleBackup();\n}\n\nexport async function listExams() {\n  const e = await store('exams');\n  return await prom(e.getAll());\n}\n\nexport async function upsertExam(exam) {\n  const e = await store('exams', 'readwrite');\n  const existing = await prom(e.get(exam.id));\n  const now = Date.now();\n  const next = {\n    ...exam,\n    createdAt: existing?.createdAt || now,\n    updatedAt: now,\n    results: exam.results || existing?.results || []\n  };\n  await prom(e.put(next));\n  scheduleBackup();\n}\n\nexport async function deleteExam(id) {\n  const e = await store('exams', 'readwrite');\n  await prom(e.delete(id));\n  scheduleBackup();\n}\n\nexport async function listExamSessions() {\n  const s = await store('exam_sessions');\n  return await prom(s.getAll());\n}\n\nexport async function loadExamSession(examId) {\n  const s = await store('exam_sessions');\n  return await prom(s.get(examId));\n}\n\nexport async function saveExamSessionProgress(progress) {\n  const s = await store('exam_sessions', 'readwrite');\n  const now = Date.now();\n  await prom(s.put({ ...progress, updatedAt: now }));\n  scheduleBackup();\n}\n\nexport async function deleteExamSessionProgress(examId) {\n  const s = await store('exam_sessions', 'readwrite');\n  await prom(s.delete(examId));\n  scheduleBackup();\n}\n\nexport async function listStudySessions() {\n  try {\n    const s = await store('study_sessions');\n    const list = await prom(s.getAll());\n    return Array.isArray(list) ? list : [];\n  } catch (err) {\n    console.warn('Failed to list study sessions', err);\n    return [];\n  }\n}\n\nexport async function saveStudySessionRecord(record) {\n  if (!record || !record.mode) throw new Error('Study session record requires a mode');\n  const s = await store('study_sessions', 'readwrite');\n  const now = Date.now();\n  await prom(s.put({ ...record, updatedAt: now }));\n  scheduleBackup();\n}\n\nexport async function deleteStudySessionRecord(mode) {\n  if (!mode) return;\n  const s = await store('study_sessions', 'readwrite');\n  await prom(s.delete(mode));\n  scheduleBackup();\n}\n\nexport async function clearAllStudySessionRecords() {\n  const s = await store('study_sessions', 'readwrite');\n  await prom(s.clear());\n  scheduleBackup();\n}\n\n// export/import helpers\nexport { exportJSON, importJSON, exportAnkiCSV };\n", "import { listBlocks } from './storage.js';\n\nlet cache = null;\nlet pending = null;\n\nfunction cloneBlock(block) {\n  if (!block || typeof block !== 'object') return block;\n  return { ...block };\n}\n\nfunction cloneLecture(lecture) {\n  if (!lecture || typeof lecture !== 'object') return lecture;\n  return { ...lecture };\n}\n\nfunction cloneLectureIndex(index) {\n  const copy = {};\n  for (const [blockId, lectures] of Object.entries(index || {})) {\n    const next = {};\n    for (const [lectureId, lecture] of Object.entries(lectures || {})) {\n      next[lectureId] = cloneLecture(lecture);\n    }\n    copy[blockId] = next;\n  }\n  return copy;\n}\n\nfunction sortLectures(a, b) {\n  const aw = a?.week ?? 0;\n  const bw = b?.week ?? 0;\n  if (aw !== bw) return aw - bw;\n  const an = (a?.name || '').toLowerCase();\n  const bn = (b?.name || '').toLowerCase();\n  if (an !== bn) return an.localeCompare(bn);\n  const ai = a?.id ?? 0;\n  const bi = b?.id ?? 0;\n  return ai - bi;\n}\n\nfunction buildLectureLists(index) {\n  const map = {};\n  for (const [blockId, lectures] of Object.entries(index || {})) {\n    const list = Object.values(lectures || {}).map(cloneLecture);\n    list.sort(sortLectures);\n    map[blockId] = list;\n  }\n  return map;\n}\n\nfunction snapshotCatalog(source) {\n  return {\n    blocks: (source?.blocks || []).map(cloneBlock),\n    lectureIndex: cloneLectureIndex(source?.lectureIndex || {}),\n    lectureLists: Object.fromEntries(\n      Object.entries(source?.lectureLists || {}).map(([blockId, list]) => [\n        blockId,\n        list.map(cloneLecture)\n      ])\n    )\n  };\n}\n\nexport async function loadBlockCatalog(options = {}) {\n  if (!pending || options.force) {\n    pending = (async () => {\n      const { blocks, lectureIndex } = await listBlocks();\n      const normalizedBlocks = (blocks || []).map(cloneBlock);\n      const normalizedIndex = cloneLectureIndex(lectureIndex || {});\n      const lectureLists = buildLectureLists(normalizedIndex);\n      cache = { blocks: normalizedBlocks, lectureIndex: normalizedIndex, lectureLists };\n      return snapshotCatalog(cache);\n    })();\n  }\n  return pending;\n}\n\nexport function getBlockCatalog() {\n  if (!cache) return { blocks: [], lectureIndex: {}, lectureLists: {} };\n  return snapshotCatalog(cache);\n}\n\nexport function getLecturesForBlock(blockId) {\n  if (!cache) return [];\n  const list = cache.lectureLists?.[blockId];\n  return Array.isArray(list) ? list.map(cloneLecture) : [];\n}\n\nexport function getLectureIndex() {\n  if (!cache) return {};\n  return cloneLectureIndex(cache.lectureIndex || {});\n}\n\nexport function invalidateBlockCatalog() {\n  cache = null;\n  pending = null;\n}\n", "export function confirmModal(message) {\n  return new Promise(resolve => {\n    const overlay = document.createElement('div');\n    overlay.className = 'modal';\n\n    const box = document.createElement('div');\n    box.className = 'card';\n\n    const msg = document.createElement('p');\n    msg.textContent = message;\n    box.appendChild(msg);\n\n    const actions = document.createElement('div');\n    actions.className = 'row';\n\n    const yes = document.createElement('button');\n    yes.className = 'btn';\n    yes.textContent = 'Yes';\n    yes.addEventListener('click', () => {\n      document.body.removeChild(overlay);\n      resolve(true);\n    });\n\n    const no = document.createElement('button');\n    no.className = 'btn';\n    no.textContent = 'No';\n    no.addEventListener('click', () => {\n      document.body.removeChild(overlay);\n      resolve(false);\n    });\n\n    actions.appendChild(yes);\n    actions.appendChild(no);\n    box.appendChild(actions);\n    overlay.appendChild(box);\n\n    overlay.addEventListener('click', e => {\n      if (e.target === overlay) {\n        document.body.removeChild(overlay);\n        resolve(false);\n      }\n    });\n\n    document.body.appendChild(overlay);\n    yes.focus();\n  });\n}\n", "export const LECTURE_PASS_ACTIONS = [\n  'Notes',\n  'Read',\n  'Tape',\n  'Quiz',\n  'Flashcards',\n  'Summarize',\n  'Review',\n  'Active Recall',\n  'Anki',\n  'Practice Questions',\n  'Teach-Back',\n  'Whiteboard',\n  'Mind Map',\n  'Case Review',\n  'Group Study',\n  'Audio Review',\n  'Lecture Rewatch',\n  'Cheat Sheet',\n  'Sketch/Diagram',\n  'Blocks'\n];\n", "import { DEFAULT_PASS_COLORS } from '../../lectures/scheduler.js';\n\nlet palette = DEFAULT_PASS_COLORS.slice();\n\nfunction normalizePalette(colors = []) {\n  if (!Array.isArray(colors) || !colors.length) {\n    return DEFAULT_PASS_COLORS.slice();\n  }\n  return colors.map((color, index) => {\n    if (typeof color === 'string') {\n      const trimmed = color.trim();\n      if (trimmed) return trimmed;\n    }\n    return DEFAULT_PASS_COLORS[index % DEFAULT_PASS_COLORS.length];\n  });\n}\n\nexport function setPassColorPalette(colors) {\n  palette = normalizePalette(colors);\n}\n\nexport function getPassColorPalette() {\n  return (palette.length ? palette : DEFAULT_PASS_COLORS).slice();\n}\n\nexport function passColorForOrder(order = 1) {\n  const list = palette.length ? palette : DEFAULT_PASS_COLORS;\n  if (!Number.isFinite(order)) {\n    return list[0] || DEFAULT_PASS_COLORS[0];\n  }\n  const index = Math.max(0, Math.floor(order) - 1) % list.length;\n  return list[index];\n}\n\nexport { DEFAULT_PASS_COLORS };\n", "import {\n  upsertBlock,\n  deleteBlock,\n  exportJSON,\n  importJSON,\n  exportAnkiCSV,\n  getSettings,\n  saveSettings\n} from '../storage/storage.js';\nimport { loadBlockCatalog, invalidateBlockCatalog } from '../storage/block-catalog.js';\nimport { confirmModal } from './components/confirm.js';\nimport { DEFAULT_REVIEW_STEPS, REVIEW_RATINGS } from '../review/constants.js';\nimport { DEFAULT_PASS_PLAN, DEFAULT_PLANNER_DEFAULTS, plannerDefaultsToPassPlan } from '../lectures/scheduler.js';\nimport { LECTURE_PASS_ACTIONS } from '../lectures/actions.js';\nimport { DEFAULT_PASS_COLORS } from './components/pass-colors.js';\n\nfunction createEmptyState() {\n  const empty = document.createElement('div');\n  empty.className = 'settings-empty-blocks';\n  empty.textContent = 'No blocks yet. Use \u201CAdd block\u201D to create one.';\n  return empty;\n}\n\nconst DAY_MS = 24 * 60 * 60 * 1000;\nconst DAY_MINUTES = 24 * 60;\nconst MAX_PASS_COUNT = 20;\n\nconst OFFSET_UNITS = [\n  { id: 'minutes', label: 'minutes', minutes: 1 },\n  { id: 'hours', label: 'hours', minutes: 60 },\n  { id: 'days', label: 'days', minutes: 60 * 24 },\n  { id: 'weeks', label: 'weeks', minutes: 60 * 24 * 7 }\n];\n\nfunction formatOffset(minutes) {\n  if (!Number.isFinite(minutes)) return '0m';\n  const abs = Math.abs(minutes);\n  if (abs < 60) return `${Math.round(minutes)}m`;\n  const hours = minutes / 60;\n  if (Math.abs(hours) < 24) return `${Math.round(hours)}h`;\n  const days = minutes / (60 * 24);\n  if (Math.abs(days) < 7) return `${Math.round(days)}d`;\n  const weeks = minutes / (60 * 24 * 7);\n  if (Math.abs(weeks) < 4) return `${Math.round(weeks)}w`;\n  const months = minutes / (60 * 24 * 30);\n  return `${Math.round(months)}mo`;\n}\n\nfunction normalizeOffsetUnit(id) {\n  const fallback = OFFSET_UNITS[2];\n  if (typeof id !== 'string') return fallback.id;\n  const match = OFFSET_UNITS.find(option => option.id === id);\n  return match ? match.id : fallback.id;\n}\n\nfunction splitOffsetMinutes(minutes) {\n  const value = Number.isFinite(minutes) ? Math.max(0, Math.round(minutes)) : 0;\n  if (value === 0) {\n    return { value: 0, unit: 'days' };\n  }\n  const preferred = [...OFFSET_UNITS].reverse().find(option => value % option.minutes === 0);\n  if (preferred) {\n    return { value: Math.round(value / preferred.minutes), unit: preferred.id };\n  }\n  if (value < 60) {\n    return { value, unit: 'minutes' };\n  }\n  if (value < 60 * 24) {\n    return { value: Math.round(value / 60), unit: 'hours' };\n  }\n  return { value: Math.round(value / (60 * 24)), unit: 'days' };\n}\n\nfunction combineOffsetValueUnit(value, unitId) {\n  const normalizedUnit = normalizeOffsetUnit(unitId);\n  const option = OFFSET_UNITS.find(entry => entry.id === normalizedUnit) || OFFSET_UNITS[2];\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric) || numeric <= 0) {\n    return 0;\n  }\n  return Math.max(0, Math.round(numeric * option.minutes));\n}\n\nfunction defaultActionForIndex(index) {\n  if (!Array.isArray(LECTURE_PASS_ACTIONS) || !LECTURE_PASS_ACTIONS.length) return '';\n  const normalized = index % LECTURE_PASS_ACTIONS.length;\n  return LECTURE_PASS_ACTIONS[Math.max(0, normalized)];\n}\n\nfunction baseSchedule(plan) {\n  if (plan && Array.isArray(plan.schedule)) {\n    return plan.schedule;\n  }\n  return DEFAULT_PASS_PLAN.schedule;\n}\n\nfunction computeDefaultGap(schedule) {\n  if (!Array.isArray(schedule) || schedule.length < 2) return DAY_MINUTES;\n  const deltas = [];\n  for (let i = 1; i < schedule.length; i += 1) {\n    const prev = Number(schedule[i - 1]?.offsetMinutes);\n    const current = Number(schedule[i]?.offsetMinutes);\n    if (Number.isFinite(prev) && Number.isFinite(current)) {\n      const delta = current - prev;\n      if (delta > 0) deltas.push(delta);\n    }\n  }\n  return deltas.length ? deltas[deltas.length - 1] : DAY_MINUTES;\n}\n\nfunction fallbackAnchor(index) {\n  if (index === 0) return 'today';\n  if (index === 1) return 'tomorrow';\n  return 'upcoming';\n}\n\nfunction buildScheduleTemplate(plan, count) {\n  const template = baseSchedule(plan);\n  const numericCount = Number(count);\n  const safeCount = Math.max(0, Number.isFinite(numericCount) ? Math.round(numericCount) : 0);\n  const defaultGap = computeDefaultGap(template);\n  const schedule = [];\n  for (let i = 0; i < safeCount; i += 1) {\n    const source = template[i] || {};\n    const previous = schedule[i - 1] || null;\n    const order = i + 1;\n    const offset = Number.isFinite(source.offsetMinutes)\n      ? source.offsetMinutes\n      : previous\n        ? previous.offsetMinutes + defaultGap\n        : i === 0\n          ? 0\n          : defaultGap * i;\n    const anchor = typeof source.anchor === 'string' && source.anchor.trim()\n      ? source.anchor.trim()\n      : previous?.anchor || fallbackAnchor(i);\n    const label = typeof source.label === 'string' && source.label.trim()\n      ? source.label.trim()\n      : `Pass ${order}`;\n    const action = typeof source.action === 'string' && source.action.trim()\n      ? source.action.trim()\n      : defaultActionForIndex(i);\n    schedule.push({\n      order,\n      offsetMinutes: offset,\n      anchor,\n      label,\n      action\n    });\n  }\n  return schedule;\n}\n\nfunction adjustPassConfigs(current, count, plan) {\n  const template = buildScheduleTemplate(plan || { schedule: current }, count);\n  const byOrder = new Map();\n  (Array.isArray(current) ? current : []).forEach(entry => {\n    const order = Number(entry?.order);\n    if (Number.isFinite(order) && !byOrder.has(order)) {\n      byOrder.set(order, entry);\n    }\n  });\n  return template.map((step, index) => {\n    const existing = byOrder.get(step.order) || current[index] || {};\n    const action = typeof existing?.action === 'string' && existing.action.trim()\n      ? existing.action.trim()\n      : step.action;\n    const offsetMinutes = Number.isFinite(existing?.offsetMinutes)\n      ? Math.max(0, Math.round(existing.offsetMinutes))\n      : step.offsetMinutes;\n    const anchor = typeof existing?.anchor === 'string' && existing.anchor.trim()\n      ? existing.anchor.trim()\n      : step.anchor;\n    const label = typeof existing?.label === 'string' && existing.label.trim()\n      ? existing.label.trim()\n      : step.label;\n    return { ...step, action, offsetMinutes, anchor, label };\n  });\n}\n\nfunction clampPassCount(value) {\n  const parsed = Number(value);\n  if (!Number.isFinite(parsed)) return 0;\n  return Math.min(MAX_PASS_COUNT, Math.max(0, Math.round(parsed)));\n}\n\nfunction buildPassPlanPayload(passConfigs, existingPlan) {\n  const planId = existingPlan && typeof existingPlan.id === 'string' && existingPlan.id.trim()\n    ? existingPlan.id.trim()\n    : 'custom';\n  return {\n    id: planId,\n    schedule: passConfigs.map((config, index) => {\n      const order = index + 1;\n      const label = typeof config.label === 'string' && config.label.trim()\n        ? config.label.trim()\n        : `Pass ${order}`;\n      const offset = Number.isFinite(config.offsetMinutes)\n        ? Math.max(0, Math.round(config.offsetMinutes))\n        : index === 0\n          ? 0\n          : (passConfigs[index - 1]?.offsetMinutes ?? 0) + DAY_MINUTES;\n      const anchor = typeof config.anchor === 'string' && config.anchor.trim()\n        ? config.anchor.trim()\n        : fallbackAnchor(index);\n      const action = typeof config.action === 'string' && config.action.trim()\n        ? config.action.trim()\n        : defaultActionForIndex(index);\n      return {\n        order,\n        label,\n        offsetMinutes: offset,\n        anchor,\n        action\n      };\n    })\n  };\n}\n\nfunction formatPassPlan(plan) {\n  if (!plan || !Array.isArray(plan.schedule) || !plan.schedule.length) {\n    return 'No passes scheduled';\n  }\n  const steps = plan.schedule\n    .slice()\n    .sort((a, b) => (a?.order ?? 0) - (b?.order ?? 0))\n    .map(step => {\n      const action = typeof step?.action === 'string' && step.action.trim()\n        ? step.action.trim()\n        : `Pass ${step?.order ?? ''}`;\n      const offset = formatOffset(step?.offsetMinutes ?? 0);\n      return `${action} \u2022 ${offset}`;\n    });\n  return `Plan: ${steps.join(', ')}`;\n}\n\nfunction formatWeekCount(weeks) {\n  if (!Number.isFinite(weeks) || weeks <= 0) return null;\n  const rounded = Math.max(1, Math.round(weeks));\n  return `${rounded} week${rounded === 1 ? '' : 's'}`;\n}\n\nfunction parseBlockDate(value) {\n  if (!value) return null;\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return null;\n  return date;\n}\n\nfunction formatBlockDate(value, options = { month: 'short', day: 'numeric', year: 'numeric' }) {\n  const date = parseBlockDate(value);\n  if (!date) return null;\n  const formatter = new Intl.DateTimeFormat(undefined, options);\n  return formatter.format(date);\n}\n\nfunction formatDateRange(start, end) {\n  const startDate = parseBlockDate(start);\n  const endDate = parseBlockDate(end);\n  if (!startDate && !endDate) return null;\n  if (startDate && endDate) {\n    const formatter = new Intl.DateTimeFormat(undefined, { month: 'short', day: 'numeric', year: 'numeric' });\n    return `${formatter.format(startDate)} \u2192 ${formatter.format(endDate)}`;\n  }\n  if (startDate) {\n    const formatted = formatBlockDate(startDate);\n    return formatted ? `Starts ${formatted}` : null;\n  }\n  const formatted = formatBlockDate(endDate);\n  return formatted ? `Ends ${formatted}` : null;\n}\n\nfunction computeSpanDays(start, end) {\n  const startDate = parseBlockDate(start);\n  const endDate = parseBlockDate(end);\n  if (!startDate || !endDate) return null;\n  const diff = endDate.getTime() - startDate.getTime();\n  if (diff < 0) return null;\n  return Math.round(diff / DAY_MS) + 1;\n}\n\nfunction formatBlockMeta(block) {\n  if (!block) return 'No block data';\n  const parts = [];\n  const weeks = formatWeekCount(Number(block.weeks));\n  if (weeks) parts.push(weeks);\n  const range = formatDateRange(block.startDate, block.endDate);\n  if (range) parts.push(range);\n  const spanDays = computeSpanDays(block.startDate, block.endDate);\n  if (spanDays) parts.push(`${spanDays} day${spanDays === 1 ? '' : 's'}`);\n  return parts.join(' \u2022 ') || 'Block details unavailable';\n}\n\nexport async function renderSettings(root) {\n  root.innerHTML = '';\n\n  const layout = document.createElement('div');\n  layout.className = 'settings-layout';\n  root.appendChild(layout);\n\n  const [catalogResult, settingsResult] = await Promise.allSettled([\n    loadBlockCatalog(),\n    getSettings()\n  ]);\n\n  if (catalogResult.status === 'rejected') {\n    console.warn('Failed to load block catalog', catalogResult.reason);\n  }\n  if (settingsResult.status === 'rejected') {\n    console.warn('Failed to load app settings', settingsResult.reason);\n  }\n\n  const catalog = catalogResult.status === 'fulfilled' && catalogResult.value\n    ? catalogResult.value\n    : { blocks: [] };\n  const settings = settingsResult.status === 'fulfilled' ? settingsResult.value : null;\n  const blocks = Array.isArray(catalog.blocks) ? catalog.blocks : [];\n  const reviewSteps = {\n    ...DEFAULT_REVIEW_STEPS,\n    ...(settings?.reviewSteps || {})\n  };\n  const plannerDefaults = settings?.plannerDefaults || DEFAULT_PLANNER_DEFAULTS;\n\n  const blocksCard = document.createElement('section');\n  blocksCard.className = 'card';\n  const bHeading = document.createElement('h2');\n  bHeading.textContent = 'Blocks';\n  blocksCard.appendChild(bHeading);\n\n  const list = document.createElement('div');\n  list.className = 'block-list';\n  blocksCard.appendChild(list);\n\n  if (!blocks.length) {\n    list.appendChild(createEmptyState());\n  }\n\n  blocks.forEach((block, index) => {\n    if (!block) return;\n    const wrap = document.createElement('div');\n    wrap.className = 'settings-block-row';\n    if (block.color) {\n      wrap.style.setProperty('--block-accent', block.color);\n      wrap.classList.add('has-accent');\n    }\n\n    const header = document.createElement('div');\n    header.className = 'settings-block-header';\n    const title = document.createElement('h3');\n    title.className = 'settings-block-title';\n    title.textContent = block.title || 'Untitled block';\n    if (block.color) {\n      title.style.setProperty('--block-accent', block.color);\n      title.classList.add('has-accent');\n    }\n    header.appendChild(title);\n\n    const meta = document.createElement('div');\n    meta.className = 'settings-block-meta';\n    meta.textContent = formatBlockMeta(block);\n    header.appendChild(meta);\n\n    const controls = document.createElement('div');\n    controls.className = 'settings-block-controls';\n\n    const upBtn = document.createElement('button');\n    upBtn.type = 'button';\n    upBtn.className = 'btn tertiary';\n    upBtn.textContent = '\u2191';\n    upBtn.disabled = index === 0;\n    upBtn.addEventListener('click', async () => {\n      const other = blocks[index - 1];\n      if (!other) return;\n      const tmp = block.order;\n      block.order = other.order;\n      other.order = tmp;\n      await upsertBlock(block);\n      await upsertBlock(other);\n      invalidateBlockCatalog();\n      await renderSettings(root);\n    });\n    controls.appendChild(upBtn);\n\n    const downBtn = document.createElement('button');\n    downBtn.type = 'button';\n    downBtn.className = 'btn tertiary';\n    downBtn.textContent = '\u2193';\n    downBtn.disabled = index === blocks.length - 1;\n    downBtn.addEventListener('click', async () => {\n      const other = blocks[index + 1];\n      if (!other) return;\n      const tmp = block.order;\n      block.order = other.order;\n      other.order = tmp;\n      await upsertBlock(block);\n      await upsertBlock(other);\n      invalidateBlockCatalog();\n      await renderSettings(root);\n    });\n    controls.appendChild(downBtn);\n\n    const editBtn = document.createElement('button');\n    editBtn.type = 'button';\n    editBtn.className = 'btn secondary';\n    editBtn.textContent = 'Edit';\n    controls.appendChild(editBtn);\n\n    const deleteBtn = document.createElement('button');\n    deleteBtn.type = 'button';\n    deleteBtn.className = 'btn secondary';\n    deleteBtn.textContent = 'Delete';\n    deleteBtn.addEventListener('click', async () => {\n      if (!(await confirmModal('Delete block?'))) return;\n      await deleteBlock(block.blockId);\n      invalidateBlockCatalog();\n      await renderSettings(root);\n    });\n    controls.appendChild(deleteBtn);\n\n    header.appendChild(controls);\n\n    wrap.appendChild(header);\n\n    const detailGrid = document.createElement('div');\n    detailGrid.className = 'settings-block-detail-grid';\n\n    const startDetail = document.createElement('div');\n    startDetail.className = 'settings-block-detail';\n    startDetail.innerHTML = `<span>Start</span><strong>${formatBlockDate(block.startDate) || '\u2014'}</strong>`;\n    detailGrid.appendChild(startDetail);\n\n    const endDetail = document.createElement('div');\n    endDetail.className = 'settings-block-detail';\n    endDetail.innerHTML = `<span>End</span><strong>${formatBlockDate(block.endDate) || '\u2014'}</strong>`;\n    detailGrid.appendChild(endDetail);\n\n    const weeksDetail = document.createElement('div');\n    weeksDetail.className = 'settings-block-detail';\n    weeksDetail.innerHTML = `<span>Weeks</span><strong>${formatWeekCount(Number(block.weeks)) || '\u2014'}</strong>`;\n    detailGrid.appendChild(weeksDetail);\n\n    const spanDays = computeSpanDays(block.startDate, block.endDate);\n    const daysDetail = document.createElement('div');\n    daysDetail.className = 'settings-block-detail';\n    daysDetail.innerHTML = `<span>Span</span><strong>${spanDays ? `${spanDays} day${spanDays === 1 ? '' : 's'}` : '\u2014'}</strong>`;\n    detailGrid.appendChild(daysDetail);\n\n    wrap.appendChild(detailGrid);\n\n    const editForm = document.createElement('form');\n    editForm.className = 'settings-block-edit';\n    editForm.hidden = true;\n\n    const titleInput = document.createElement('input');\n    titleInput.type = 'text';\n    titleInput.required = true;\n    titleInput.className = 'input';\n    titleInput.value = block.title || '';\n\n    const weeksInput = document.createElement('input');\n    weeksInput.type = 'number';\n    weeksInput.min = '1';\n    weeksInput.required = true;\n    weeksInput.className = 'input';\n    weeksInput.value = block.weeks != null ? String(block.weeks) : '1';\n\n    const startInput = document.createElement('input');\n    startInput.type = 'date';\n    startInput.className = 'input';\n    startInput.value = block.startDate || '';\n\n    const endInput = document.createElement('input');\n    endInput.type = 'date';\n    endInput.className = 'input';\n    endInput.value = block.endDate || '';\n\n    const colorInput = document.createElement('input');\n    colorInput.type = 'color';\n    colorInput.className = 'input';\n    colorInput.value = block.color || '#ffffff';\n\n    const saveBtn = document.createElement('button');\n    saveBtn.type = 'submit';\n    saveBtn.className = 'btn';\n    saveBtn.textContent = 'Save changes';\n\n    const cancelBtn = document.createElement('button');\n    cancelBtn.type = 'button';\n    cancelBtn.className = 'btn secondary';\n    cancelBtn.textContent = 'Cancel';\n    cancelBtn.addEventListener('click', () => {\n      editForm.hidden = true;\n    });\n\n    editForm.append(titleInput, startInput, endInput, weeksInput, colorInput, saveBtn, cancelBtn);\n    editForm.addEventListener('submit', async event => {\n      event.preventDefault();\n      const titleValue = titleInput.value.trim();\n      const weeksValue = Number(weeksInput.value);\n      if (!titleValue || !Number.isFinite(weeksValue) || weeksValue <= 0) {\n        return;\n      }\n      let startValue = startInput.value || null;\n      let endValue = endInput.value || null;\n      if (startValue && endValue) {\n        const startDate = new Date(startValue);\n        const endDate = new Date(endValue);\n        if (!Number.isNaN(startDate.getTime()) && !Number.isNaN(endDate.getTime()) && startDate > endDate) {\n          const swap = startValue;\n          startValue = endValue;\n          endValue = swap;\n        }\n      }\n      const payload = {\n        ...block,\n        title: titleValue,\n        weeks: weeksValue,\n        color: colorInput.value || null,\n        startDate: startValue,\n        endDate: endValue\n      };\n      await upsertBlock(payload);\n      invalidateBlockCatalog();\n      await renderSettings(root);\n    });\n\n    wrap.appendChild(editForm);\n\n    editBtn.addEventListener('click', () => {\n      editForm.hidden = !editForm.hidden;\n    });\n\n    list.appendChild(wrap);\n  });\n\n  const form = document.createElement('form');\n  form.className = 'settings-block-add';\n\n  const titleInput = document.createElement('input');\n  titleInput.type = 'text';\n  titleInput.required = true;\n  titleInput.placeholder = 'Block title';\n  titleInput.className = 'input';\n\n  const startInput = document.createElement('input');\n  startInput.type = 'date';\n  startInput.className = 'input';\n  startInput.placeholder = 'Start date';\n  startInput.setAttribute('aria-label', 'Block start date');\n\n  const endInput = document.createElement('input');\n  endInput.type = 'date';\n  endInput.className = 'input';\n  endInput.placeholder = 'End date';\n  endInput.setAttribute('aria-label', 'Block end date');\n\n  const weeksInput = document.createElement('input');\n  weeksInput.type = 'number';\n  weeksInput.min = '1';\n  weeksInput.required = true;\n  weeksInput.value = '1';\n  weeksInput.placeholder = 'Weeks';\n  weeksInput.className = 'input';\n\n  const colorInput = document.createElement('input');\n  colorInput.type = 'color';\n  colorInput.className = 'input';\n  colorInput.value = '#ffffff';\n\n  const submitBtn = document.createElement('button');\n  submitBtn.type = 'submit';\n  submitBtn.className = 'btn';\n  submitBtn.textContent = 'Add block (top)';\n\n  form.append(titleInput, startInput, endInput, weeksInput, colorInput, submitBtn);\n\n  form.addEventListener('submit', async event => {\n    event.preventDefault();\n    const titleValue = titleInput.value.trim();\n    const weeksValue = Number(weeksInput.value);\n    if (!titleValue || !Number.isFinite(weeksValue) || weeksValue <= 0) {\n      return;\n    }\n    let startValue = startInput.value || null;\n    let endValue = endInput.value || null;\n    if (startValue && endValue) {\n      const startDate = new Date(startValue);\n      const endDate = new Date(endValue);\n      if (!Number.isNaN(startDate.getTime()) && !Number.isNaN(endDate.getTime()) && startDate > endDate) {\n        const swap = startValue;\n        startValue = endValue;\n        endValue = swap;\n      }\n    }\n    await upsertBlock({\n      title: titleValue,\n      weeks: weeksValue,\n      color: colorInput.value || null,\n      startDate: startValue,\n      endDate: endValue\n    });\n    titleInput.value = '';\n    startInput.value = '';\n    endInput.value = '';\n    weeksInput.value = '1';\n    colorInput.value = '#ffffff';\n    invalidateBlockCatalog();\n    await renderSettings(root);\n  });\n\n  blocksCard.appendChild(form);\n\n  layout.appendChild(blocksCard);\n\n  const reviewCard = document.createElement('section');\n  reviewCard.className = 'card';\n  const rHeading = document.createElement('h2');\n  rHeading.textContent = 'Review';\n  reviewCard.appendChild(rHeading);\n\n  const reviewForm = document.createElement('form');\n  reviewForm.className = 'settings-review-form';\n  reviewForm.dataset.section = 'review';\n\n  const stepsHeading = document.createElement('h3');\n  stepsHeading.className = 'settings-subheading';\n  stepsHeading.textContent = 'Spaced repetition steps (minutes)';\n  reviewForm.appendChild(stepsHeading);\n\n  const grid = document.createElement('div');\n  grid.className = 'settings-review-grid';\n  reviewForm.appendChild(grid);\n\n  const labels = {\n    again: 'Again',\n    hard: 'Hard',\n    good: 'Good',\n    easy: 'Easy'\n  };\n\n  const reviewInputs = new Map();\n  for (const rating of REVIEW_RATINGS) {\n    const row = document.createElement('label');\n    row.className = 'settings-review-row';\n\n    const label = document.createElement('span');\n    label.textContent = labels[rating] || rating;\n    row.appendChild(label);\n\n    const input = document.createElement('input');\n    input.type = 'number';\n    input.min = '1';\n    input.required = true;\n    input.className = 'input settings-review-input';\n    input.value = String(reviewSteps[rating] ?? DEFAULT_REVIEW_STEPS[rating]);\n    input.dataset.rating = rating;\n    row.appendChild(input);\n\n    reviewInputs.set(rating, input);\n    grid.appendChild(row);\n  }\n\n  const saveReviewBtn = document.createElement('button');\n  saveReviewBtn.type = 'submit';\n  saveReviewBtn.className = 'btn';\n  saveReviewBtn.textContent = 'Save review settings';\n  reviewForm.appendChild(saveReviewBtn);\n\n  const reviewStatus = document.createElement('p');\n  reviewStatus.className = 'settings-review-status';\n  reviewStatus.hidden = true;\n  reviewForm.appendChild(reviewStatus);\n\n  reviewForm.addEventListener('submit', async event => {\n    event.preventDefault();\n    reviewStatus.textContent = '';\n    reviewStatus.hidden = true;\n    reviewStatus.classList.remove('is-error');\n\n    const nextSteps = {};\n    for (const [rating, input] of reviewInputs) {\n      const value = Number(input.value);\n      if (!Number.isFinite(value) || value <= 0) {\n        reviewStatus.textContent = 'Enter a positive number of minutes for each step.';\n        reviewStatus.classList.add('is-error');\n        reviewStatus.hidden = false;\n        input.focus();\n        return;\n      }\n      const rounded = Math.max(1, Math.round(value));\n      nextSteps[rating] = rounded;\n    }\n\n    const originalText = saveReviewBtn.textContent;\n    saveReviewBtn.disabled = true;\n    saveReviewBtn.textContent = 'Saving\u2026';\n\n    try {\n      await saveSettings({ reviewSteps: nextSteps });\n      const updated = await getSettings();\n      const normalized = {\n        ...DEFAULT_REVIEW_STEPS,\n        ...(updated?.reviewSteps || {})\n      };\n      for (const [rating, input] of reviewInputs) {\n        const value = normalized[rating];\n        if (Number.isFinite(value) && value > 0) {\n          input.value = String(value);\n        }\n      }\n      reviewStatus.textContent = 'Review settings saved.';\n      reviewStatus.hidden = false;\n    } catch (err) {\n      console.warn('Failed to save review settings', err);\n      reviewStatus.textContent = 'Failed to save review settings.';\n      reviewStatus.classList.add('is-error');\n      reviewStatus.hidden = false;\n    } finally {\n      saveReviewBtn.disabled = false;\n      saveReviewBtn.textContent = originalText;\n    }\n  });\n\n  reviewCard.appendChild(reviewForm);\n  layout.appendChild(reviewCard);\n\n  const passDefaultsCard = document.createElement('section');\n  passDefaultsCard.className = 'card';\n  const passHeading = document.createElement('h2');\n  passHeading.textContent = 'Lecture pass defaults';\n  passDefaultsCard.appendChild(passHeading);\n\n  const passDescription = document.createElement('p');\n  passDescription.className = 'settings-pass-description';\n  passDescription.textContent = 'Configure the default pass count, timing, and pass functions applied to new lectures.';\n  passDefaultsCard.appendChild(passDescription);\n\n  const passForm = document.createElement('form');\n  passForm.className = 'settings-pass-form';\n  passDefaultsCard.appendChild(passForm);\n\n  let currentPlannerDefaults = plannerDefaults;\n  const defaultPlan = plannerDefaultsToPassPlan(currentPlannerDefaults);\n  let planTemplate = defaultPlan;\n  let passConfigs = Array.isArray(defaultPlan.schedule)\n    ? defaultPlan.schedule.map(step => ({ ...step }))\n    : [];\n  let passColors = Array.isArray(currentPlannerDefaults?.passColors) && currentPlannerDefaults.passColors.length\n    ? currentPlannerDefaults.passColors.slice()\n    : DEFAULT_PASS_COLORS.slice();\n\n  function ensurePassColorCount(count) {\n    const normalized = Math.max(0, Number.isFinite(count) ? Math.round(count) : 0);\n    const next = [];\n    for (let i = 0; i < normalized; i += 1) {\n      const existing = passColors[i];\n      if (typeof existing === 'string' && existing.trim()) {\n        next.push(existing.trim());\n      } else {\n        next.push(DEFAULT_PASS_COLORS[i % DEFAULT_PASS_COLORS.length]);\n      }\n    }\n    passColors = next;\n  }\n\n  function resolvedPassColor(index) {\n    if (typeof passColors[index] === 'string' && passColors[index].trim()) {\n      return passColors[index].trim();\n    }\n    return DEFAULT_PASS_COLORS[index % DEFAULT_PASS_COLORS.length];\n  }\n\n  ensurePassColorCount(passConfigs.length);\n\n  const passCountField = document.createElement('label');\n  passCountField.className = 'lecture-pass-count settings-pass-count';\n  passCountField.textContent = 'Default pass count';\n  const passCountInput = document.createElement('input');\n  passCountInput.type = 'number';\n  passCountInput.min = '0';\n  passCountInput.max = String(MAX_PASS_COUNT);\n  passCountInput.className = 'input';\n  passCountInput.value = String(passConfigs.length);\n  passCountField.appendChild(passCountInput);\n  const passCountHelp = document.createElement('span');\n  passCountHelp.className = 'lecture-pass-help';\n  passCountHelp.textContent = 'Set the default number of spaced passes for new lectures.';\n  passCountField.appendChild(passCountHelp);\n  passForm.appendChild(passCountField);\n\n  const passColorSection = document.createElement('div');\n  passColorSection.className = 'settings-pass-colors';\n  const passColorTitle = document.createElement('h3');\n  passColorTitle.className = 'settings-pass-colors-title';\n  passColorTitle.textContent = 'Pass colors';\n  passColorSection.appendChild(passColorTitle);\n  const passColorHint = document.createElement('p');\n  passColorHint.className = 'settings-pass-colors-hint';\n  passColorHint.textContent = 'Choose the accent color used for pass chips and timeline bars.';\n  passColorSection.appendChild(passColorHint);\n  const passColorList = document.createElement('div');\n  passColorList.className = 'settings-pass-color-list';\n  passColorSection.appendChild(passColorList);\n  const passColorActions = document.createElement('div');\n  passColorActions.className = 'settings-pass-color-actions';\n  const passColorReset = document.createElement('button');\n  passColorReset.type = 'button';\n  passColorReset.className = 'settings-pass-colors-reset';\n  passColorReset.textContent = 'Reset to defaults';\n  passColorActions.appendChild(passColorReset);\n  passColorSection.appendChild(passColorActions);\n  passForm.appendChild(passColorSection);\n\n  const passSummary = document.createElement('div');\n  passSummary.className = 'lecture-pass-summary-line settings-pass-summary';\n  passForm.appendChild(passSummary);\n\n  const passAdvanced = document.createElement('details');\n  passAdvanced.className = 'lecture-pass-advanced settings-pass-advanced';\n  passAdvanced.open = true;\n  const passAdvancedSummary = document.createElement('summary');\n  passAdvancedSummary.textContent = `Pass details (${passConfigs.length})`;\n  passAdvanced.appendChild(passAdvancedSummary);\n\n  const passAdvancedHint = document.createElement('p');\n  passAdvancedHint.className = 'lecture-pass-advanced-hint';\n  passAdvancedHint.textContent = 'Tune the pass function and spacing for each default pass.';\n  passAdvanced.appendChild(passAdvancedHint);\n\n  const passList = document.createElement('div');\n  passList.className = 'lecture-pass-editor settings-pass-editor';\n  passAdvanced.appendChild(passList);\n  passForm.appendChild(passAdvanced);\n\n  const passStatus = document.createElement('p');\n  passStatus.className = 'settings-pass-status';\n  passStatus.hidden = true;\n  passForm.appendChild(passStatus);\n\n  const passSaveBtn = document.createElement('button');\n  passSaveBtn.type = 'submit';\n  passSaveBtn.className = 'btn';\n  passSaveBtn.textContent = 'Save pass defaults';\n  passForm.appendChild(passSaveBtn);\n\n  function updatePassSummary() {\n    if (!passConfigs.length) {\n      passSummary.textContent = 'No default passes scheduled.';\n    } else {\n      const previewPlan = buildPassPlanPayload(passConfigs, planTemplate);\n      const previewText = formatPassPlan(previewPlan);\n      const cleaned = previewText.startsWith('Plan: ')\n        ? previewText.slice(6)\n        : previewText;\n      passSummary.textContent = `${passConfigs.length} pass${passConfigs.length === 1 ? '' : 'es'} \u2022 ${cleaned}`;\n    }\n    passAdvancedSummary.textContent = `Pass details (${passConfigs.length})`;\n  }\n\n  function renderPassColorInputs() {\n    passColorList.innerHTML = '';\n    ensurePassColorCount(passConfigs.length);\n    if (!passColors.length) {\n      passColorReset.disabled = true;\n      const empty = document.createElement('p');\n      empty.className = 'settings-pass-colors-empty';\n      empty.textContent = 'Increase the pass count above to configure colors.';\n      passColorList.appendChild(empty);\n      return;\n    }\n    passColorReset.disabled = false;\n    passColors = passColors.map((_, index) => resolvedPassColor(index));\n    passColors.forEach((color, index) => {\n      const row = document.createElement('div');\n      row.className = 'settings-pass-color';\n      const label = document.createElement('span');\n      label.className = 'settings-pass-color-label';\n      label.textContent = `Pass ${index + 1}`;\n      const swatch = document.createElement('span');\n      swatch.className = 'settings-pass-color-swatch';\n      swatch.style.setProperty('--swatch-color', color);\n      const input = document.createElement('input');\n      input.className = 'input settings-pass-color-input';\n      input.type = 'text';\n      input.value = color;\n      input.placeholder = DEFAULT_PASS_COLORS[index % DEFAULT_PASS_COLORS.length];\n      input.addEventListener('input', event => {\n        const next = event.target.value.trim();\n        const value = next || DEFAULT_PASS_COLORS[index % DEFAULT_PASS_COLORS.length];\n        passColors[index] = value;\n        swatch.style.setProperty('--swatch-color', value);\n      });\n      row.append(label, swatch, input);\n      passColorList.appendChild(row);\n    });\n  }\n\n  function renderPassEditor() {\n    passList.innerHTML = '';\n    if (!passConfigs.length) {\n      const empty = document.createElement('div');\n      empty.className = 'lecture-pass-empty';\n      empty.textContent = 'No passes planned. Increase the count above to build a default schedule.';\n      passList.appendChild(empty);\n      updatePassSummary();\n      renderPassColorInputs();\n      return;\n    }\n    passConfigs.forEach((config, index) => {\n      const row = document.createElement('div');\n      row.className = 'lecture-pass-row';\n\n      const label = document.createElement('div');\n      label.className = 'lecture-pass-label';\n      label.textContent = `Pass ${index + 1}`;\n      row.appendChild(label);\n\n      const controls = document.createElement('div');\n      controls.className = 'lecture-pass-controls';\n\n      const actionField = document.createElement('div');\n      actionField.className = 'lecture-pass-field';\n      const actionLabel = document.createElement('span');\n      actionLabel.className = 'lecture-pass-field-label';\n      actionLabel.textContent = 'Pass function';\n      actionField.appendChild(actionLabel);\n      const select = document.createElement('select');\n      select.className = 'input lecture-pass-action';\n      LECTURE_PASS_ACTIONS.forEach(action => {\n        const option = document.createElement('option');\n        option.value = action;\n        option.textContent = action;\n        select.appendChild(option);\n      });\n      if (config.action && !LECTURE_PASS_ACTIONS.includes(config.action)) {\n        const custom = document.createElement('option');\n        custom.value = config.action;\n        custom.textContent = config.action;\n        select.appendChild(custom);\n      }\n      select.value = config.action || '';\n      select.addEventListener('change', event => {\n        const value = event.target.value;\n        passConfigs[index] = { ...passConfigs[index], action: value };\n        updatePassSummary();\n      });\n      actionField.appendChild(select);\n      controls.appendChild(actionField);\n\n      const offsetField = document.createElement('div');\n      offsetField.className = 'lecture-pass-field lecture-pass-offset-field';\n      const offsetLabel = document.createElement('span');\n      offsetLabel.className = 'lecture-pass-field-label';\n      offsetLabel.textContent = 'Timing';\n      offsetField.appendChild(offsetLabel);\n\n      const offsetInputs = document.createElement('div');\n      offsetInputs.className = 'lecture-pass-offset-inputs';\n      const split = splitOffsetMinutes(config.offsetMinutes ?? 0);\n      const offsetInput = document.createElement('input');\n      offsetInput.type = 'number';\n      offsetInput.min = '0';\n      offsetInput.step = '1';\n      offsetInput.className = 'input lecture-pass-offset-value';\n      offsetInput.value = String(split.value);\n      const unitSelect = document.createElement('select');\n      unitSelect.className = 'input lecture-pass-offset-unit';\n      OFFSET_UNITS.forEach(option => {\n        const opt = document.createElement('option');\n        opt.value = option.id;\n        opt.textContent = option.label;\n        unitSelect.appendChild(opt);\n      });\n      unitSelect.value = split.unit;\n      offsetInputs.appendChild(offsetInput);\n      offsetInputs.appendChild(unitSelect);\n      offsetField.appendChild(offsetInputs);\n\n      const preview = document.createElement('span');\n      preview.className = 'lecture-pass-offset-preview';\n      preview.textContent = formatOffset(config.offsetMinutes ?? 0);\n      offsetField.appendChild(preview);\n\n      function commitOffset() {\n        const minutes = combineOffsetValueUnit(offsetInput.value, unitSelect.value);\n        passConfigs[index] = {\n          ...passConfigs[index],\n          offsetMinutes: minutes\n        };\n        preview.textContent = formatOffset(passConfigs[index].offsetMinutes ?? 0);\n        updatePassSummary();\n      }\n\n      offsetInput.addEventListener('change', () => {\n        const numeric = Number(offsetInput.value);\n        if (!Number.isFinite(numeric) || numeric < 0) {\n          offsetInput.value = '0';\n        }\n        commitOffset();\n      });\n      offsetInput.addEventListener('blur', () => {\n        const numeric = Math.max(0, Math.round(Number(offsetInput.value) || 0));\n        offsetInput.value = String(numeric);\n        commitOffset();\n      });\n      unitSelect.addEventListener('change', commitOffset);\n\n      controls.appendChild(offsetField);\n      row.appendChild(controls);\n      passList.appendChild(row);\n    });\n\n    updatePassSummary();\n    renderPassColorInputs();\n  }\n\n  renderPassEditor();\n\n  passColorReset.addEventListener('click', () => {\n    passColors = DEFAULT_PASS_COLORS.slice(0, passConfigs.length || DEFAULT_PASS_COLORS.length);\n    ensurePassColorCount(passConfigs.length);\n    renderPassColorInputs();\n  });\n\n  passCountInput.addEventListener('change', () => {\n    const next = clampPassCount(passCountInput.value);\n    passCountInput.value = String(next);\n    const template = passConfigs.length\n      ? { schedule: passConfigs.slice() }\n      : planTemplate;\n    passConfigs = adjustPassConfigs(passConfigs, next, template);\n    ensurePassColorCount(next);\n    renderPassEditor();\n  });\n\n  passForm.addEventListener('submit', async event => {\n    event.preventDefault();\n    passStatus.textContent = '';\n    passStatus.hidden = true;\n    passStatus.classList.remove('is-error');\n\n    const anchorOffsets = {\n      ...(DEFAULT_PLANNER_DEFAULTS.anchorOffsets || {}),\n      ...(currentPlannerDefaults?.anchorOffsets || {})\n    };\n    const payloadPlan = buildPassPlanPayload(passConfigs, planTemplate);\n    const payloadPasses = payloadPlan.schedule.map(step => ({\n      order: step.order,\n      label: step.label,\n      offsetMinutes: step.offsetMinutes,\n      anchor: step.anchor,\n      action: step.action\n    }));\n\n    const originalText = passSaveBtn.textContent;\n    passSaveBtn.disabled = true;\n    passSaveBtn.textContent = 'Saving\u2026';\n\n    const palette = passColors.map((color, index) => {\n      if (typeof color === 'string') {\n        const trimmed = color.trim();\n        if (trimmed) return trimmed;\n      }\n      return DEFAULT_PASS_COLORS[index % DEFAULT_PASS_COLORS.length];\n    });\n\n    try {\n      await saveSettings({ plannerDefaults: { anchorOffsets, passes: payloadPasses, passColors: palette } });\n      const updated = await getSettings();\n      currentPlannerDefaults = updated?.plannerDefaults || DEFAULT_PLANNER_DEFAULTS;\n      const refreshedPlan = plannerDefaultsToPassPlan(currentPlannerDefaults);\n      planTemplate = refreshedPlan;\n      passConfigs = Array.isArray(refreshedPlan.schedule)\n        ? refreshedPlan.schedule.map(step => ({ ...step }))\n        : [];\n      passColors = Array.isArray(currentPlannerDefaults?.passColors) && currentPlannerDefaults.passColors.length\n        ? currentPlannerDefaults.passColors.slice()\n        : DEFAULT_PASS_COLORS.slice();\n      passCountInput.value = String(passConfigs.length);\n      renderPassEditor();\n      passStatus.textContent = 'Pass defaults saved.';\n      passStatus.hidden = false;\n    } catch (err) {\n      console.warn('Failed to save pass defaults', err);\n      passStatus.textContent = 'Failed to save pass defaults.';\n      passStatus.classList.add('is-error');\n      passStatus.hidden = false;\n    } finally {\n      passSaveBtn.disabled = false;\n      passSaveBtn.textContent = originalText;\n    }\n  });\n\n  layout.appendChild(passDefaultsCard);\n\n  const dataCard = document.createElement('section');\n  dataCard.className = 'card';\n  const dHeading = document.createElement('h2');\n  dHeading.textContent = 'Data';\n  dataCard.appendChild(dHeading);\n\n  async function triggerExportDownload(options = {}) {\n    const { prefix = 'sevenn-export', withTimestamp = false } = options;\n    const dump = await exportJSON();\n    const blob = new Blob([JSON.stringify(dump, null, 2)], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');\n    const suffix = withTimestamp ? `-${timestamp}` : '';\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${prefix}${suffix}.json`;\n    a.click();\n    URL.revokeObjectURL(url);\n  }\n\n  const exportBtn = document.createElement('button');\n  exportBtn.className = 'btn';\n  exportBtn.textContent = 'Export DB';\n  exportBtn.addEventListener('click', async () => {\n    try {\n      await triggerExportDownload();\n    } catch (err) {\n      console.error('Failed to export database', err);\n      alert('Export failed');\n    }\n  });\n  dataCard.appendChild(exportBtn);\n\n  const importInput = document.createElement('input');\n  importInput.type = 'file';\n  importInput.accept = 'application/json';\n  importInput.style.display = 'none';\n  importInput.addEventListener('change', async () => {\n    const file = importInput.files[0];\n    if (!file) return;\n    try {\n      const confirmBackup = window.confirm(\n        'Importing will replace your current data. Would you like to download a backup first?'\n      );\n      if (confirmBackup) {\n        try {\n          await triggerExportDownload({ prefix: 'sevenn-backup', withTimestamp: true });\n        } catch (err) {\n          console.error('Failed to create backup prior to import', err);\n          alert('Backup failed. Import cancelled.');\n          importInput.value = '';\n          return;\n        }\n      }\n      const text = await file.text();\n      const json = JSON.parse(text);\n      const res = await importJSON(json);\n      if (!res?.ok) {\n        alert(res?.message || 'Import failed');\n        return;\n      }\n      alert(res.message || 'Import complete');\n      location.reload();\n    } catch (e) {\n      alert('Import failed');\n    } finally {\n      importInput.value = '';\n    }\n  });\n\n  const importBtn = document.createElement('button');\n  importBtn.className = 'btn';\n  importBtn.textContent = 'Import DB';\n  importBtn.addEventListener('click', () => importInput.click());\n  dataCard.appendChild(importBtn);\n  dataCard.appendChild(importInput);\n\n  const ankiBtn = document.createElement('button');\n  ankiBtn.className = 'btn';\n  ankiBtn.textContent = 'Export Anki CSV';\n  ankiBtn.addEventListener('click', async () => {\n    const dump = await exportJSON();\n    const blob = await exportAnkiCSV('qa', dump.items || []);\n    const a = document.createElement('a');\n    a.href = URL.createObjectURL(blob);\n    a.download = 'sevenn-anki.csv';\n    a.click();\n    URL.revokeObjectURL(a.href);\n  });\n  dataCard.appendChild(ankiBtn);\n\n  layout.appendChild(dataCard);\n}\n", "const windows = new Set();\nlet zIndexCounter = 2000;\nlet dock;\nlet dockList;\nlet dockHandle;\n\nfunction ensureDock(){\n  if (dock) return;\n  dock = document.createElement('div');\n  dock.className = 'window-dock';\n\n  dockHandle = document.createElement('button');\n  dockHandle.type = 'button';\n  dockHandle.className = 'window-dock-handle';\n  dockHandle.textContent = '\uD83D\uDDC2';\n  dockHandle.addEventListener('click', () => {\n    dock.classList.toggle('open');\n  });\n  dock.appendChild(dockHandle);\n\n  dockList = document.createElement('div');\n  dockList.className = 'window-dock-list';\n  dock.appendChild(dockList);\n\n  document.body.appendChild(dock);\n}\n\nfunction bringToFront(win){\n  if (!win) return;\n  zIndexCounter += 1;\n  win.style.zIndex = zIndexCounter;\n}\n\nfunction setupDragging(win, header){\n  let active = null;\n  header.addEventListener('mousedown', (e) => {\n    if (e.target.closest('button')) return;\n    active = {\n      offsetX: e.clientX - win.offsetLeft,\n      offsetY: e.clientY - win.offsetTop\n    };\n    bringToFront(win);\n    document.addEventListener('mousemove', handleMove);\n    document.addEventListener('mouseup', stopDrag);\n    e.preventDefault();\n  });\n\n  function handleMove(e){\n    if (!active) return;\n    const left = e.clientX - active.offsetX;\n    const top = e.clientY - active.offsetY;\n    win.style.left = `${left}px`;\n    win.style.top = `${top}px`;\n  }\n\n  function stopDrag(){\n    active = null;\n    document.removeEventListener('mousemove', handleMove);\n    document.removeEventListener('mouseup', stopDrag);\n  }\n}\n\nexport function createFloatingWindow({ title, width = 520, onClose, onBeforeClose } = {}){\n  ensureDock();\n  const win = document.createElement('div');\n  win.className = 'floating-window';\n  win.style.width = typeof width === 'number' ? `${width}px` : width;\n  win.style.left = `${120 + windows.size * 32}px`;\n  win.style.top = `${100 + windows.size * 24}px`;\n  bringToFront(win);\n\n  const header = document.createElement('div');\n  header.className = 'floating-header';\n  const titleEl = document.createElement('div');\n  titleEl.className = 'floating-title';\n  titleEl.textContent = title || 'Window';\n  header.appendChild(titleEl);\n\n  const actions = document.createElement('div');\n  actions.className = 'floating-actions';\n\n  const minimizeBtn = document.createElement('button');\n  minimizeBtn.type = 'button';\n  minimizeBtn.className = 'floating-action';\n  minimizeBtn.title = 'Minimize';\n  minimizeBtn.textContent = '\u2014';\n  actions.appendChild(minimizeBtn);\n\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'floating-action';\n  closeBtn.title = 'Close';\n  closeBtn.textContent = '\u00D7';\n  actions.appendChild(closeBtn);\n\n  function appendActionButton({\n    text = '',\n    icon,\n    title: actionTitle = '',\n    ariaLabel = '',\n    className = '',\n    onClick,\n    position = 'before-close'\n  } = {}) {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = ['floating-action', className].filter(Boolean).join(' ');\n    if (icon) {\n      btn.innerHTML = icon;\n    } else {\n      btn.textContent = text;\n    }\n    if (actionTitle) btn.title = actionTitle;\n    if (ariaLabel || actionTitle) {\n      btn.setAttribute('aria-label', ariaLabel || actionTitle);\n    }\n    if (typeof onClick === 'function') {\n      btn.addEventListener('click', onClick);\n    }\n    if (position === 'start') {\n      actions.insertBefore(btn, actions.firstChild || null);\n    } else if (position === 'end') {\n      actions.appendChild(btn);\n    } else if (position === 'after-minimize') {\n      if (minimizeBtn.nextSibling) {\n        actions.insertBefore(btn, minimizeBtn.nextSibling);\n      } else {\n        actions.appendChild(btn);\n      }\n    } else if (position === 'before-close' && closeBtn.parentElement === actions) {\n      actions.insertBefore(btn, closeBtn);\n    } else {\n      actions.appendChild(btn);\n    }\n    return btn;\n  }\n\n  header.appendChild(actions);\n  win.appendChild(header);\n\n  const body = document.createElement('div');\n  body.className = 'floating-body';\n  win.appendChild(body);\n\n  const resizeHandle = document.createElement('div');\n  resizeHandle.className = 'floating-resize-handle';\n  win.appendChild(resizeHandle);\n\n  const MIN_WIDTH = 320;\n  const MIN_HEIGHT = 260;\n  let resizeState = null;\n\n  resizeHandle.addEventListener('pointerdown', event => {\n    if (event.button !== 0) return;\n    bringToFront(win);\n    resizeState = {\n      pointerId: event.pointerId,\n      startX: event.clientX,\n      startY: event.clientY,\n      startWidth: win.offsetWidth,\n      startHeight: win.offsetHeight,\n      useGlobalEvents: typeof resizeHandle.setPointerCapture !== 'function'\n    };\n    if (!resizeState.useGlobalEvents && typeof resizeHandle.setPointerCapture === 'function') {\n      resizeHandle.setPointerCapture(event.pointerId);\n    }\n    if (resizeState.useGlobalEvents) {\n      window.addEventListener('pointermove', handlePointerMove);\n      window.addEventListener('pointerup', stopResize);\n      window.addEventListener('pointercancel', stopResize);\n    }\n    event.preventDefault();\n  });\n\n  const handlePointerMove = event => {\n    if (!resizeState || event.pointerId !== resizeState.pointerId) return;\n    const deltaX = event.clientX - resizeState.startX;\n    const deltaY = event.clientY - resizeState.startY;\n    const nextWidth = Math.max(MIN_WIDTH, resizeState.startWidth + deltaX);\n    const nextHeight = Math.max(MIN_HEIGHT, resizeState.startHeight + deltaY);\n    win.style.width = `${nextWidth}px`;\n    win.style.height = `${nextHeight}px`;\n  };\n\n  const stopResize = event => {\n    if (!resizeState || event.pointerId !== resizeState.pointerId) return;\n    const state = resizeState;\n    resizeState = null;\n    if (!state.useGlobalEvents && typeof resizeHandle.releasePointerCapture === 'function') {\n      resizeHandle.releasePointerCapture(event.pointerId);\n    }\n    if (state.useGlobalEvents) {\n      window.removeEventListener('pointermove', handlePointerMove);\n      window.removeEventListener('pointerup', stopResize);\n      window.removeEventListener('pointercancel', stopResize);\n    }\n  };\n\n  resizeHandle.addEventListener('pointermove', handlePointerMove);\n  resizeHandle.addEventListener('pointerup', stopResize);\n  resizeHandle.addEventListener('pointercancel', stopResize);\n\n  let minimized = false;\n  let dockButton = null;\n\n  function handleMinimize(){\n    if (minimized) {\n      restore();\n      return;\n    }\n    minimized = true;\n    win.classList.add('minimized');\n    win.style.display = 'none';\n    dock.classList.add('open');\n    dockButton = document.createElement('button');\n    dockButton.type = 'button';\n    dockButton.className = 'dock-entry';\n    dockButton.textContent = titleEl.textContent;\n    dockButton.addEventListener('click', () => restore());\n    dockList.appendChild(dockButton);\n  }\n\n  function destroyDockButton(){\n    if (dockButton && dockButton.parentElement) {\n      dockButton.parentElement.removeChild(dockButton);\n    }\n    dockButton = null;\n    if (!dockList.childElementCount) {\n      dock.classList.remove('open');\n    }\n  }\n\n  function restore(){\n    if (!minimized) return;\n    minimized = false;\n    win.classList.remove('minimized');\n    win.style.display = '';\n    bringToFront(win);\n    destroyDockButton();\n  }\n\n  minimizeBtn.addEventListener('click', handleMinimize);\n\n  async function close(reason){\n    if (typeof onBeforeClose === 'function') {\n      try {\n        const shouldClose = await onBeforeClose(reason);\n        if (shouldClose === false) return false;\n      } catch (err) {\n        console.error(err);\n        return false;\n      }\n    }\n    destroyDockButton();\n    windows.delete(win);\n    if (win.parentElement) win.parentElement.removeChild(win);\n    if (typeof onClose === 'function') onClose(reason);\n    return true;\n  }\n\n  closeBtn.addEventListener('click', () => { void close('close'); });\n\n  function isInteractiveTarget(target){\n    if (!(target instanceof HTMLElement)) return false;\n    if (target.closest('input, textarea, select, [contenteditable=\"true\"], button, label, .rich-editor-area')) {\n      return true;\n    }\n    return false;\n  }\n\n  win.addEventListener('mousedown', (event) => {\n\n    if (isInteractiveTarget(event.target)) {\n      requestAnimationFrame(() => bringToFront(win));\n      return;\n    }\n\n    bringToFront(win);\n  });\n\n  win.addEventListener('focusin', () => bringToFront(win));\n\n  setupDragging(win, header);\n\n  document.body.appendChild(win);\n  windows.add(win);\n\n  return {\n    element: win,\n    body,\n    header,\n    actions,\n    setContent(node){\n      body.innerHTML = '';\n      if (node) body.appendChild(node);\n    },\n    close,\n    minimize: handleMinimize,\n    restore,\n    setTitle(text){\n      titleEl.textContent = text;\n      if (dockButton) dockButton.textContent = text;\n    },\n    isMinimized(){\n      return minimized;\n    },\n    focus(){\n      bringToFront(win);\n    },\n    addAction: appendActionButton\n  };\n}\n", "const DEFAULT_FRAME_WIDTH = 520;\n\nfunction clamp(value, min, max) {\n  if (Number.isNaN(value)) return min;\n  if (value < min) return min;\n  if (value > max) return max;\n  return value;\n}\n\nfunction sanitizeAspectRatio(ratio) {\n  if (!Number.isFinite(ratio) || ratio <= 0) return 1;\n  return clamp(ratio, 0.25, 4);\n}\n\nfunction toDataUrl(canvas, mimeType, quality) {\n  try {\n    return canvas.toDataURL(mimeType, quality);\n  } catch (err) {\n    console.error('Failed to export canvas', err);\n    return canvas.toDataURL();\n  }\n}\n\nexport function cropImageFile(file) {\n  if (!(file instanceof File) || !file.type?.startsWith('image/')) {\n    return Promise.reject(new Error('File must be an image.'));\n  }\n\n  return new Promise((resolve, reject) => {\n    const objectUrl = URL.createObjectURL(file);\n    const image = new Image();\n    image.onload = () => {\n      URL.revokeObjectURL(objectUrl);\n      try {\n        openCropDialog({ image, file }, { mimeType: file.type }).then(resolve).catch(reject);\n      } catch (err) {\n        reject(err);\n      }\n    };\n    image.onerror = () => {\n      URL.revokeObjectURL(objectUrl);\n      reject(new Error('Failed to load image file.'));\n    };\n    image.src = objectUrl;\n  });\n}\n\nfunction inferMimeFromDataUrl(src) {\n  if (typeof src !== 'string') return '';\n  const match = src.match(/^data:([^;,]+)[;,]/i);\n  return match ? match[1] : '';\n}\n\nexport function editImageSource(src, { altText = '', width, height, mimeType } = {}) {\n  if (!src) {\n    return Promise.reject(new Error('Image source is required.'));\n  }\n\n  return new Promise((resolve, reject) => {\n    const image = new Image();\n    image.onload = () => {\n      const options = {\n        initialAlt: altText,\n        initialWidth: typeof width === 'number' && width > 0 ? width : undefined,\n        initialHeight: typeof height === 'number' && height > 0 ? height : undefined,\n        mimeType: mimeType || inferMimeFromDataUrl(src) || 'image/png'\n      };\n      try {\n        openCropDialog({ image, file: null }, options).then(resolve).catch(reject);\n      } catch (err) {\n        reject(err);\n      }\n    };\n    image.onerror = () => {\n      reject(new Error('Failed to load image.'));\n    };\n    try {\n      if (!/^data:/i.test(src) && !/^blob:/i.test(src)) {\n        image.crossOrigin = 'anonymous';\n      }\n      image.src = src;\n    } catch (err) {\n      reject(err);\n    }\n  });\n}\n\nfunction openCropDialog({ image, file }, options = {}) {\n  return new Promise((resolve) => {\n    const overlay = document.createElement('div');\n    overlay.className = 'media-cropper-overlay';\n    overlay.setAttribute('role', 'dialog');\n    overlay.setAttribute('aria-modal', 'true');\n\n    const dialog = document.createElement('div');\n    dialog.className = 'media-cropper-dialog';\n    overlay.appendChild(dialog);\n\n    const header = document.createElement('header');\n    header.className = 'media-cropper-header';\n    const title = document.createElement('h3');\n    title.textContent = 'Upload image';\n    header.appendChild(title);\n    const closeBtn = document.createElement('button');\n    closeBtn.type = 'button';\n    closeBtn.className = 'icon-btn ghost media-cropper-close';\n    closeBtn.title = 'Cancel';\n    closeBtn.textContent = '\u2715';\n    header.appendChild(closeBtn);\n    dialog.appendChild(header);\n\n  const body = document.createElement('div');\n  body.className = 'media-cropper-body';\n  dialog.appendChild(body);\n\n    const preview = document.createElement('div');\n    preview.className = 'media-cropper-preview';\n    const canvas = document.createElement('canvas');\n    canvas.width = DEFAULT_FRAME_WIDTH;\n    canvas.height = Math.round(DEFAULT_FRAME_WIDTH * 0.75);\n    preview.appendChild(canvas);\n    body.appendChild(preview);\n\n    const controls = document.createElement('div');\n    controls.className = 'media-cropper-controls';\n    body.appendChild(controls);\n\n    const ratioRow = document.createElement('div');\n    ratioRow.className = 'media-cropper-row';\n    const ratioLabel = document.createElement('label');\n    ratioLabel.textContent = 'Aspect ratio';\n    const ratioSelect = document.createElement('select');\n    ratioSelect.className = 'media-cropper-select';\n    const naturalRatio = sanitizeAspectRatio(image.naturalWidth / image.naturalHeight || 1);\n  const ratioOptions = [\n    { value: 'original', label: 'Original', ratio: naturalRatio },\n      { value: '1:1', label: 'Square', ratio: 1 },\n      { value: '4:3', label: '4 : 3', ratio: 4 / 3 },\n      { value: '3:4', label: '3 : 4', ratio: 3 / 4 },\n      { value: '16:9', label: '16 : 9', ratio: 16 / 9 }\n    ];\n    ratioOptions.forEach(opt => {\n      const option = document.createElement('option');\n      option.value = opt.value;\n      option.textContent = opt.label;\n      ratioSelect.appendChild(option);\n    });\n    ratioSelect.value = 'original';\n    ratioLabel.appendChild(ratioSelect);\n    ratioRow.appendChild(ratioLabel);\n    controls.appendChild(ratioRow);\n\n    const zoomRow = document.createElement('div');\n    zoomRow.className = 'media-cropper-row media-cropper-zoom';\n    const zoomLabel = document.createElement('span');\n    zoomLabel.textContent = 'Zoom';\n    zoomRow.appendChild(zoomLabel);\n    const zoomRange = document.createElement('input');\n    zoomRange.type = 'range';\n    zoomRange.min = '1';\n    zoomRange.max = '3';\n    zoomRange.step = '0.01';\n    zoomRange.value = '1';\n    zoomRange.className = 'media-cropper-zoom-range';\n    zoomRow.appendChild(zoomRange);\n    const zoomValue = document.createElement('span');\n    zoomValue.className = 'media-cropper-zoom-value';\n    zoomValue.textContent = '100%';\n    zoomRow.appendChild(zoomValue);\n    controls.appendChild(zoomRow);\n\n  const sizeRow = document.createElement('div');\n  sizeRow.className = 'media-cropper-row';\n  const widthLabel = document.createElement('label');\n  widthLabel.textContent = 'Output width';\n  const widthInput = document.createElement('input');\n  widthInput.type = 'number';\n  widthInput.min = '64';\n  const naturalWidth = Math.round(image.naturalWidth) || Math.round(image.width) || 1024;\n  widthInput.max = String(Math.max(64, naturalWidth));\n  const presetWidth = Math.round(options.initialWidth || 0);\n  const defaultWidth = Math.min(960, naturalWidth || 960);\n  widthInput.value = String(presetWidth > 0 ? Math.min(Math.max(64, presetWidth), Math.max(64, naturalWidth)) : defaultWidth);\n  widthInput.className = 'media-cropper-size-input';\n  widthLabel.appendChild(widthInput);\n    sizeRow.appendChild(widthLabel);\n    const dimensions = document.createElement('span');\n    dimensions.className = 'media-cropper-dimensions';\n    dimensions.textContent = '\u00D7';\n    sizeRow.appendChild(dimensions);\n    controls.appendChild(sizeRow);\n\n    const altRow = document.createElement('div');\n    altRow.className = 'media-cropper-row';\n    const altLabel = document.createElement('label');\n    altLabel.textContent = 'Alt text';\n  const altInput = document.createElement('input');\n  altInput.type = 'text';\n  altInput.placeholder = 'Describe the image';\n  const defaultAlt = options.initialAlt != null && options.initialAlt !== ''\n    ? options.initialAlt\n    : (file?.name || '').replace(/\\.[^.]+$/, '').replace(/[_-]+/g, ' ').trim();\n  altInput.value = defaultAlt;\n    altInput.className = 'media-cropper-alt-input';\n    altLabel.appendChild(altInput);\n    altRow.appendChild(altLabel);\n    controls.appendChild(altRow);\n\n    const actions = document.createElement('div');\n    actions.className = 'media-cropper-actions';\n    const cancelBtn = document.createElement('button');\n    cancelBtn.type = 'button';\n    cancelBtn.className = 'btn subtle';\n    cancelBtn.textContent = 'Cancel';\n    const confirmBtn = document.createElement('button');\n    confirmBtn.type = 'button';\n    confirmBtn.className = 'btn';\n    confirmBtn.textContent = 'Insert image';\n    actions.appendChild(cancelBtn);\n    actions.appendChild(confirmBtn);\n    dialog.appendChild(actions);\n\n    document.body.appendChild(overlay);\n\n    const ctx = canvas.getContext('2d');\n    ctx.imageSmoothingQuality = 'high';\n\n    let aspectRatio = naturalRatio;\n    let frameWidth = Math.min(DEFAULT_FRAME_WIDTH, presetWidth > 0 ? presetWidth : naturalWidth || DEFAULT_FRAME_WIDTH);\n    if (!Number.isFinite(frameWidth) || frameWidth <= 0) frameWidth = DEFAULT_FRAME_WIDTH;\n    let frameHeight = Math.max(120, Math.round(frameWidth / aspectRatio));\n    let minZoom = 1;\n    let zoom = 1;\n    let offsetX = 0;\n    let offsetY = 0;\n    let dragging = false;\n    let dragStartX = 0;\n    let dragStartY = 0;\n    let dragOffsetX = 0;\n    let dragOffsetY = 0;\n\n    function focusDefault() {\n      requestAnimationFrame(() => {\n        altInput.focus({ preventScroll: true });\n      });\n    }\n\n    function updateCanvasSize() {\n      frameHeight = Math.max(120, Math.round(frameWidth / aspectRatio));\n      canvas.width = frameWidth;\n      canvas.height = frameHeight;\n      updateZoomBounds();\n    }\n\n    function updateZoomBounds() {\n      const widthRatio = frameWidth / (image.naturalWidth || image.width || 1);\n      const heightRatio = frameHeight / (image.naturalHeight || image.height || 1);\n      const nextMin = sanitizeAspectRatio(Math.max(widthRatio, heightRatio));\n      minZoom = nextMin;\n      if (!Number.isFinite(zoom) || zoom < minZoom) {\n        zoom = minZoom;\n      }\n      zoomRange.min = String(Math.max(0.1, minZoom));\n      zoomRange.max = String(Math.max(minZoom * 4, minZoom + 0.5));\n      if (Number(zoomRange.value) < minZoom) {\n        zoomRange.value = String(minZoom);\n      }\n      render();\n    }\n\n    function clampOffsets() {\n      const scaledWidth = (image.naturalWidth || image.width || frameWidth) * zoom;\n      const scaledHeight = (image.naturalHeight || image.height || frameHeight) * zoom;\n      const maxOffsetX = Math.max(0, (scaledWidth - frameWidth) / 2);\n      const maxOffsetY = Math.max(0, (scaledHeight - frameHeight) / 2);\n      offsetX = clamp(offsetX, -maxOffsetX, maxOffsetX);\n      offsetY = clamp(offsetY, -maxOffsetY, maxOffsetY);\n    }\n\n    function getOutputWidth() {\n      const raw = Number(widthInput.value);\n      const maxWidth = Math.max(64, naturalWidth);\n      if (!Number.isFinite(raw)) return Math.min(maxWidth, 960);\n      return clamp(Math.round(raw), 64, maxWidth);\n    }\n\n    function updateMeta() {\n      const zoomPercent = Math.round((zoom / minZoom) * 100);\n      zoomValue.textContent = `${zoomPercent}%`;\n      const outWidth = getOutputWidth();\n      const outHeight = Math.max(1, Math.round(outWidth / aspectRatio));\n      dimensions.textContent = `${outWidth} \u00D7 ${outHeight}`;\n    }\n\n    function render() {\n      clampOffsets();\n      ctx.fillStyle = 'rgba(15, 23, 42, 0.88)';\n      ctx.fillRect(0, 0, frameWidth, frameHeight);\n      const drawWidth = (image.naturalWidth || image.width || frameWidth) * zoom;\n      const drawHeight = (image.naturalHeight || image.height || frameHeight) * zoom;\n      const originX = (frameWidth - drawWidth) / 2 + offsetX;\n      const originY = (frameHeight - drawHeight) / 2 + offsetY;\n      ctx.save();\n      ctx.imageSmoothingEnabled = true;\n      ctx.imageSmoothingQuality = 'high';\n      ctx.drawImage(image, originX, originY, drawWidth, drawHeight);\n      ctx.restore();\n      ctx.strokeStyle = 'rgba(148, 163, 184, 0.65)';\n      ctx.lineWidth = 1;\n      ctx.strokeRect(0.5, 0.5, frameWidth - 1, frameHeight - 1);\n      updateMeta();\n    }\n\n    function closeDialog(result) {\n      window.removeEventListener('keydown', onKeyDown, true);\n      overlay.remove();\n      resolve(result || null);\n    }\n\n    function onKeyDown(event) {\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        closeDialog(null);\n      }\n    }\n\n    ratioSelect.addEventListener('change', () => {\n      const selected = ratioOptions.find(opt => opt.value === ratioSelect.value);\n      aspectRatio = sanitizeAspectRatio(selected ? selected.ratio : naturalRatio);\n      updateCanvasSize();\n      render();\n    });\n\n    zoomRange.addEventListener('input', () => {\n      const next = Number(zoomRange.value);\n      if (!Number.isFinite(next)) return;\n      const previous = zoom;\n      zoom = Math.max(minZoom, next);\n      if (previous > 0) {\n        const scale = zoom / previous;\n        offsetX *= scale;\n        offsetY *= scale;\n      }\n      render();\n    });\n\n    widthInput.addEventListener('input', () => updateMeta());\n\n    let activePointerId = null;\n    canvas.style.touchAction = 'none';\n\n    canvas.addEventListener('pointerdown', (event) => {\n      activePointerId = event.pointerId;\n      dragging = true;\n      dragStartX = event.clientX;\n      dragStartY = event.clientY;\n      dragOffsetX = offsetX;\n      dragOffsetY = offsetY;\n      canvas.classList.add('dragging');\n      try {\n        canvas.setPointerCapture(event.pointerId);\n      } catch (err) {\n        // Ignore failures on browsers that do not support pointer capture.\n      }\n    });\n\n    const handlePointerEnd = (event) => {\n      if (activePointerId !== null && event.pointerId !== activePointerId) return;\n      dragging = false;\n      canvas.classList.remove('dragging');\n      try {\n        canvas.releasePointerCapture(event.pointerId);\n      } catch (err) {\n        // Ignore\n      }\n      activePointerId = null;\n    };\n\n    canvas.addEventListener('pointerup', handlePointerEnd);\n    canvas.addEventListener('pointerleave', handlePointerEnd);\n\n    canvas.addEventListener('pointermove', (event) => {\n      if (!dragging) return;\n      const dx = event.clientX - dragStartX;\n      const dy = event.clientY - dragStartY;\n      offsetX = dragOffsetX + dx;\n      offsetY = dragOffsetY + dy;\n      render();\n    });\n\n    cancelBtn.addEventListener('click', () => closeDialog(null));\n    closeBtn.addEventListener('click', () => closeDialog(null));\n\n    confirmBtn.addEventListener('click', () => {\n      const exportCanvas = document.createElement('canvas');\n      const outWidth = getOutputWidth();\n      const outHeight = Math.max(1, Math.round(outWidth / aspectRatio));\n      exportCanvas.width = outWidth;\n      exportCanvas.height = outHeight;\n      const exportCtx = exportCanvas.getContext('2d');\n      exportCtx.imageSmoothingEnabled = true;\n      exportCtx.imageSmoothingQuality = 'high';\n\n      const drawWidth = (image.naturalWidth || image.width || outWidth) * zoom;\n      const drawHeight = (image.naturalHeight || image.height || outHeight) * zoom;\n      const originX = (frameWidth - drawWidth) / 2 + offsetX;\n      const originY = (frameHeight - drawHeight) / 2 + offsetY;\n      const cropX = clamp(-originX / zoom, 0, image.naturalWidth || image.width || outWidth);\n      const cropY = clamp(-originY / zoom, 0, image.naturalHeight || image.height || outHeight);\n      const cropWidth = Math.min((frameWidth) / zoom, (image.naturalWidth || image.width || outWidth));\n      const cropHeight = Math.min((frameHeight) / zoom, (image.naturalHeight || image.height || outHeight));\n\n      exportCtx.drawImage(\n        image,\n        cropX,\n        cropY,\n        cropWidth,\n        cropHeight,\n        0,\n        0,\n        exportCanvas.width,\n        exportCanvas.height\n      );\n\n      const preferredMime = options.mimeType || file?.type || '';\n      const mime = /^image\\/jpe?g$/i.test(preferredMime) ? 'image/jpeg' : /^image\\/png$/i.test(preferredMime) ? 'image/png' : 'image/png';\n      const quality = mime === 'image/jpeg' ? 0.92 : undefined;\n      const dataUrl = toDataUrl(exportCanvas, mime, quality);\n      const altText = altInput.value.trim();\n      closeDialog({\n        dataUrl,\n        width: exportCanvas.width,\n        height: exportCanvas.height,\n        mimeType: mime,\n        altText\n      });\n    });\n\n    window.addEventListener('keydown', onKeyDown, true);\n    updateCanvasSize();\n    render();\n    focusDefault();\n  });\n}\n\nexport function readFileAsDataUrl(file) {\n  return new Promise((resolve, reject) => {\n    const reader = new FileReader();\n    reader.onload = () => resolve(reader.result);\n    reader.onerror = () => reject(reader.error || new Error('Failed to read file.'));\n    try {\n      reader.readAsDataURL(file);\n    } catch (err) {\n      reject(err);\n    }\n  });\n}\n", "import { readFileAsDataUrl, editImageSource } from './media-upload.js';\n\nconst allowedTags = new Set([\n  'a','b','strong','i','em','u','s','strike','del','mark','span','font','p','div','br','ul','ol','li','img','sub','sup','blockquote','code','pre','hr','video','audio','source','iframe'\n]);\n\nconst allowedAttributes = {\n  'a': ['href', 'title', 'target', 'rel'],\n  'img': ['src', 'alt', 'title', 'width', 'height'],\n  'span': ['style', 'data-cloze'],\n  'div': ['style'],\n  'p': ['style'],\n  'font': ['style', 'color', 'face', 'size'],\n  'blockquote': ['style'],\n  'code': ['style'],\n  'pre': ['style'],\n  'video': ['src', 'controls', 'width', 'height', 'poster', 'preload', 'loop', 'muted', 'playsinline'],\n  'audio': ['src', 'controls', 'preload', 'loop', 'muted'],\n  'source': ['src', 'type'],\n  'iframe': ['src', 'title', 'width', 'height', 'allow', 'allowfullscreen', 'frameborder']\n};\n\nconst allowedStyles = new Set([\n  'color',\n  'background-color',\n  'font-size',\n  'font-family',\n  'font-weight',\n  'font-style',\n  'text-decoration-line',\n  'text-decoration',\n  'text-decoration-color',\n  'text-decoration-style',\n  'text-align'\n]);\n\nconst RICH_TEXT_CACHE_LIMIT = 400;\nconst richTextCache = new Map();\nconst richTextCacheKeys = [];\n\nfunction escapeHtml(str = ''){\n  return str\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nconst htmlEntityDecoder = typeof document !== 'undefined'\n  ? document.createElement('textarea')\n  : null;\n\nfunction decodeHtmlEntities(str = ''){\n  if (!str) return '';\n  if (!htmlEntityDecoder) return String(str);\n  htmlEntityDecoder.innerHTML = str;\n  return htmlEntityDecoder.value;\n}\n\nfunction isSafeUrl(value = '', { allowData = false, requireHttps = false } = {}){\n  const trimmed = value.trim();\n  if (!trimmed) return false;\n  if (/^javascript:/i.test(trimmed)) return false;\n  if (!allowData && /^data:/i.test(trimmed)) return false;\n  if (/^blob:/i.test(trimmed)) return true;\n  if (requireHttps) {\n    if (trimmed.startsWith('//')) return true;\n    if (trimmed.startsWith('/') || trimmed.startsWith('./') || trimmed.startsWith('../')) return true;\n    if (/^https:/i.test(trimmed)) return true;\n    return false;\n  }\n  return true;\n}\n\nfunction cleanStyles(node){\n  const style = node.getAttribute('style');\n  if (!style) return;\n  const cleaned = style\n    .split(';')\n    .map(part => part.trim())\n    .filter(Boolean)\n    .map(part => {\n      const [rawProp, ...valueParts] = part.split(':');\n      if (!rawProp || !valueParts.length) return null;\n      const prop = rawProp.trim().toLowerCase();\n      if (!allowedStyles.has(prop)) return null;\n      return `${prop}: ${valueParts.join(':').trim()}`;\n    })\n    .filter(Boolean)\n    .join('; ');\n  if (cleaned) node.setAttribute('style', cleaned);\n  else node.removeAttribute('style');\n}\n\nfunction sanitizeNode(node){\n  if (node.nodeType === Node.TEXT_NODE) return;\n  if (node.nodeType === Node.COMMENT_NODE) {\n    node.remove();\n    return;\n  }\n  const tag = node.tagName?.toLowerCase();\n  if (!tag) return;\n  if (!allowedTags.has(tag)) {\n    if (node.childNodes.length) {\n      const parent = node.parentNode;\n      while (node.firstChild) parent.insertBefore(node.firstChild, node);\n      node.remove();\n    } else {\n      node.remove();\n    }\n    return;\n  }\n  const attrs = Array.from(node.attributes || []);\n  const allowList = allowedAttributes[tag] || [];\n  attrs.forEach(attr => {\n    const name = attr.name.toLowerCase();\n    if (name === 'style') {\n      cleanStyles(node);\n      return;\n    }\n    if (!allowList.includes(name)) {\n      node.removeAttribute(attr.name);\n      return;\n    }\n    if (tag === 'a' && name === 'href') {\n      const value = attr.value.trim();\n      if (!value || value.startsWith('javascript:')) {\n        node.removeAttribute(attr.name);\n      } else {\n        node.setAttribute('target', '_blank');\n        node.setAttribute('rel', 'noopener noreferrer');\n      }\n    }\n    if (name === 'src' && ['img','video','audio','source','iframe'].includes(tag)) {\n      const allowData = tag === 'img';\n      const requireHttps = tag === 'iframe';\n      if (!isSafeUrl(attr.value || '', { allowData, requireHttps })) {\n        node.removeAttribute(attr.name);\n      }\n    }\n  });\n  Array.from(node.childNodes).forEach(sanitizeNode);\n}\n\nconst CLOZE_ATTR = 'data-cloze';\nconst CLOZE_VALUE = 'true';\nconst CLOZE_SELECTOR = `[${CLOZE_ATTR}=\"${CLOZE_VALUE}\"]`;\n\nfunction createClozeSpan(content){\n  const span = document.createElement('span');\n  span.setAttribute(CLOZE_ATTR, CLOZE_VALUE);\n  span.textContent = content;\n  return span;\n}\n\nfunction upgradeClozeSyntax(root){\n  if (!root) return;\n  const braceRegex = /\\{([^{}]+)\\}/g;\n  const walker = document.createTreeWalker(\n    root,\n    NodeFilter.SHOW_TEXT,\n    {\n      acceptNode: (node) => {\n        if (!node?.nodeValue || node.nodeValue.indexOf('{') === -1) {\n          return NodeFilter.FILTER_SKIP;\n        }\n        if (node.parentElement?.closest(CLOZE_SELECTOR)) {\n          return NodeFilter.FILTER_SKIP;\n        }\n        return NodeFilter.FILTER_ACCEPT;\n      }\n    }\n  );\n  const targets = [];\n  while (walker.nextNode()) targets.push(walker.currentNode);\n  targets.forEach(node => {\n    const text = node.nodeValue || '';\n    let match;\n    braceRegex.lastIndex = 0;\n    let lastIndex = 0;\n    let replaced = false;\n    const fragment = document.createDocumentFragment();\n    while ((match = braceRegex.exec(text))) {\n      const before = text.slice(lastIndex, match.index);\n      if (before) fragment.appendChild(document.createTextNode(before));\n      const inner = match[1];\n      const trimmed = inner.trim();\n      if (trimmed) {\n        fragment.appendChild(createClozeSpan(trimmed));\n        replaced = true;\n      } else {\n        fragment.appendChild(document.createTextNode(match[0]));\n      }\n      lastIndex = match.index + match[0].length;\n    }\n    if (!replaced) return;\n    const after = text.slice(lastIndex);\n    if (after) fragment.appendChild(document.createTextNode(after));\n    const parent = node.parentNode;\n    if (!parent) return;\n    parent.insertBefore(fragment, node);\n    parent.removeChild(node);\n  });\n}\n\nexport function sanitizeHtml(html = ''){\n  const template = document.createElement('template');\n  template.innerHTML = html;\n  Array.from(template.content.childNodes).forEach(sanitizeNode);\n  upgradeClozeSyntax(template.content);\n  return template.innerHTML;\n}\n\nfunction sanitizeToPlainText(html = '') {\n  if (!html) return '';\n  const template = document.createElement('template');\n  template.innerHTML = sanitizeHtml(html);\n  const text = template.content.textContent || '';\n  return text.replace(/\\u00a0/g, ' ');\n}\n\nexport function htmlToPlainText(html = '') {\n  return sanitizeToPlainText(html);\n}\n\nfunction normalizeInput(value = ''){\n  if (value == null) return '';\n  const str = String(value);\n  if (!str) return '';\n  const looksHtml = /<([a-z][^>]*>)/i.test(str);\n  if (looksHtml) return sanitizeHtml(str);\n  const decoded = decodeHtmlEntities(str);\n  return sanitizeHtml(escapeHtml(decoded).replace(/\\r?\\n/g, '<br>'));\n}\n\nconst FONT_SIZE_VALUES = [10, 12, 14, 16, 18, 20, 22, 24, 28, 32, 36, 40, 48];\n\nconst FONT_OPTIONS = [\n  { value: '', label: 'Default' },\n  { value: '\"Inter\", \"Segoe UI\", sans-serif', label: 'Modern Sans' },\n  { value: '\"Helvetica Neue\", Arial, sans-serif', label: 'Classic Sans' },\n  { value: '\"Times New Roman\", Times, serif', label: 'Serif' },\n  { value: '\"Source Code Pro\", Menlo, monospace', label: 'Monospace' },\n  { value: '\"Comic Neue\", \"Comic Sans MS\", cursive', label: 'Handwriting' }\n];\n\nexport function isEmptyHtml(html = ''){\n  if (!html) return true;\n  const template = document.createElement('template');\n  template.innerHTML = html;\n  const hasMedia = template.content.querySelector('img,video,audio,iframe');\n  const text = template.content.textContent?.replace(/\\u00a0/g, ' ').trim();\n  return !hasMedia && !text;\n}\n\nfunction createToolbarButton(label, title, onClick){\n  const btn = document.createElement('button');\n  btn.type = 'button';\n  btn.className = 'rich-editor-btn';\n  btn.textContent = label;\n  btn.title = title;\n  btn.setAttribute('aria-label', title);\n  btn.dataset.toggle = 'true';\n  btn.dataset.active = 'false';\n  btn.setAttribute('aria-pressed', 'false');\n  btn.addEventListener('mousedown', e => e.preventDefault());\n  btn.addEventListener('click', onClick);\n  return btn;\n}\n\nexport function createRichTextEditor({ value = '', onChange, ariaLabel, ariaLabelledBy } = {}){\n  const wrapper = document.createElement('div');\n  wrapper.className = 'rich-editor';\n\n  const toolbar = document.createElement('div');\n  toolbar.className = 'rich-editor-toolbar';\n  toolbar.setAttribute('role', 'toolbar');\n  toolbar.setAttribute('aria-label', 'Text formatting toolbar');\n  wrapper.appendChild(toolbar);\n\n  const imageFileInput = document.createElement('input');\n  imageFileInput.type = 'file';\n  imageFileInput.accept = 'image/*';\n  imageFileInput.style.display = 'none';\n  wrapper.appendChild(imageFileInput);\n\n  const mediaFileInput = document.createElement('input');\n  mediaFileInput.type = 'file';\n  mediaFileInput.accept = 'video/*,audio/*';\n  mediaFileInput.style.display = 'none';\n  wrapper.appendChild(mediaFileInput);\n\n  let pendingImageTarget = null;\n  let activeImageEditor = null;\n\n  function loadImageDimensions(dataUrl) {\n    return new Promise((resolve, reject) => {\n      const image = new Image();\n      image.onload = () => {\n        resolve({\n          width: image.naturalWidth || image.width || 0,\n          height: image.naturalHeight || image.height || 0\n        });\n      };\n      image.onerror = () => reject(new Error('Failed to load image preview.'));\n      image.src = dataUrl;\n    });\n  }\n\n  function sanitizeImageDimension(value) {\n    if (!Number.isFinite(value)) return null;\n    const MIN_SIZE = 32;\n    const MAX_SIZE = 4096;\n    const clamped = Math.max(MIN_SIZE, Math.min(MAX_SIZE, Math.round(value)));\n    return clamped > 0 ? clamped : null;\n  }\n\n  async function insertImageFile(file, targetImage = null) {\n    if (!(file instanceof File)) return;\n    try {\n      const dataUrl = await readFileAsDataUrl(file);\n      if (!dataUrl) return;\n\n      let dimensions = { width: null, height: null };\n      try {\n        dimensions = await loadImageDimensions(dataUrl);\n      } catch (err) {\n        // Fallback to inserting without explicit dimensions if preview fails\n        dimensions = { width: null, height: null };\n      }\n\n      const width = sanitizeImageDimension(dimensions.width);\n      const height = sanitizeImageDimension(dimensions.height);\n      const defaultAlt = (file.name || '').replace(/\\.[^.]+$/, '').replace(/[_-]+/g, ' ').trim();\n\n      if (targetImage && wrapper.contains(targetImage)) {\n        const existingAlt = targetImage.getAttribute('alt') || '';\n        const altText = existingAlt.trim() || defaultAlt;\n        targetImage.src = dataUrl;\n        if (altText) {\n          targetImage.setAttribute('alt', altText);\n        } else {\n          targetImage.removeAttribute('alt');\n        }\n        setImageSize(targetImage, width, height);\n        triggerEditorChange();\n        if (activeImageEditor && activeImageEditor.image === targetImage && typeof activeImageEditor.update === 'function') {\n          requestAnimationFrame(() => activeImageEditor.update());\n        }\n      } else {\n        const safeAlt = defaultAlt ? escapeHtml(defaultAlt) : '';\n        const altAttr = safeAlt ? ` alt=\"${safeAlt}\"` : '';\n        const widthAttr = width ? ` width=\"${width}\"` : '';\n        const heightAttr = height ? ` height=\"${height}\"` : '';\n        const html = `<img src=\"${dataUrl}\"${widthAttr}${heightAttr}${altAttr}>`;\n        insertHtml(html);\n      }\n    } catch (err) {\n      console.error('Failed to upload image', err);\n    }\n  }\n\n  async function insertMediaFile(file) {\n    try {\n      const dataUrl = await readFileAsDataUrl(file);\n      if (!dataUrl) return;\n      const isAudio = file.type?.startsWith('audio/');\n      if (isAudio) {\n        insertHtml(`<audio controls preload=\"metadata\" src=\"${dataUrl}\"></audio>`);\n      } else {\n        insertHtml(`<video controls preload=\"metadata\" src=\"${dataUrl}\" width=\"640\"></video>`);\n      }\n    } catch (err) {\n      console.error('Failed to add media file', err);\n    }\n  }\n\n  imageFileInput.addEventListener('change', () => {\n    const file = imageFileInput.files?.[0];\n    const target = pendingImageTarget;\n    pendingImageTarget = null;\n    if (file) insertImageFile(file, target);\n    imageFileInput.value = '';\n  });\n\n  mediaFileInput.addEventListener('change', () => {\n    const file = mediaFileInput.files?.[0];\n    if (file) insertMediaFile(file);\n    mediaFileInput.value = '';\n  });\n\n  const editable = document.createElement('div');\n  editable.className = 'rich-editor-area input';\n  editable.contentEditable = 'true';\n  editable.spellcheck = true;\n  editable.innerHTML = normalizeInput(value);\n  if (ariaLabel) editable.setAttribute('aria-label', ariaLabel);\n  if (ariaLabelledBy) editable.setAttribute('aria-labelledby', ariaLabelledBy);\n  wrapper.appendChild(editable);\n\n  editable.addEventListener('paste', (event) => {\n    if (!event.clipboardData) return;\n    const files = Array.from(event.clipboardData.files || []);\n    const imageFile = files.find(file => file && file.type && file.type.startsWith('image/')) || null;\n    if (imageFile) {\n      event.preventDefault();\n      void insertImageFile(imageFile);\n      return;\n    }\n    const mediaFile = files.find(file => file && file.type && (file.type.startsWith('video/') || file.type.startsWith('audio/')));\n    if (mediaFile) {\n      event.preventDefault();\n      void insertMediaFile(mediaFile);\n      return;\n    }\n    const html = event.clipboardData.getData('text/html');\n    let text = event.clipboardData.getData('text/plain');\n    if (!text && html) {\n      text = sanitizeToPlainText(html);\n    }\n    event.preventDefault();\n    insertPlainText(text || '');\n  });\n\n  function triggerEditorChange(){\n    editable.dispatchEvent(new Event('input', { bubbles: true }));\n  }\n\n  function setImageSize(image, width, height){\n    if (!(image instanceof HTMLImageElement)) return;\n    const MIN_SIZE = 32;\n    const MAX_SIZE = 4096;\n    const widthValue = Number.isFinite(width) ? Math.max(MIN_SIZE, Math.min(MAX_SIZE, Math.round(width))) : null;\n    const heightValue = Number.isFinite(height) ? Math.max(MIN_SIZE, Math.min(MAX_SIZE, Math.round(height))) : null;\n    if (widthValue) {\n      image.style.width = `${widthValue}px`;\n      image.setAttribute('width', String(widthValue));\n    } else {\n      image.style.removeProperty('width');\n      image.removeAttribute('width');\n    }\n    if (heightValue) {\n      image.style.height = `${heightValue}px`;\n      image.setAttribute('height', String(heightValue));\n    } else {\n      image.style.removeProperty('height');\n      image.removeAttribute('height');\n    }\n  }\n\n  function destroyActiveImageEditor(){\n    if (activeImageEditor && typeof activeImageEditor.destroy === 'function') {\n      activeImageEditor.destroy();\n    }\n    activeImageEditor = null;\n  }\n\n  function beginImageEditing(image){\n    if (!(image instanceof HTMLImageElement)) return;\n    if (!wrapper.contains(image)) return;\n    if (activeImageEditor && activeImageEditor.image === image) {\n      if (typeof activeImageEditor.update === 'function') {\n        requestAnimationFrame(() => activeImageEditor.update());\n      }\n      return;\n    }\n    destroyActiveImageEditor();\n    activeImageEditor = createImageEditor(image);\n    if (activeImageEditor && typeof activeImageEditor.update === 'function') {\n      requestAnimationFrame(() => activeImageEditor.update());\n    }\n  }\n\n  function createImageEditor(image){\n    const overlay = document.createElement('div');\n    overlay.className = 'rich-editor-image-overlay';\n    overlay.setAttribute('aria-hidden', 'true');\n\n    const toolbar = document.createElement('div');\n    toolbar.className = 'rich-editor-image-toolbar';\n\n    const cropBtn = document.createElement('button');\n    cropBtn.type = 'button';\n    cropBtn.className = 'rich-editor-image-tool';\n    cropBtn.textContent = 'Crop';\n\n    const replaceBtn = document.createElement('button');\n    replaceBtn.type = 'button';\n    replaceBtn.className = 'rich-editor-image-tool';\n    replaceBtn.textContent = 'Replace';\n\n    const doneBtn = document.createElement('button');\n    doneBtn.type = 'button';\n    doneBtn.className = 'rich-editor-image-tool rich-editor-image-tool--primary';\n    doneBtn.textContent = 'Done';\n\n    toolbar.append(cropBtn, replaceBtn, doneBtn);\n    overlay.appendChild(toolbar);\n\n    const handleDefs = [\n      { name: 'se', axis: 'both', label: 'Resize from corner' },\n      { name: 'e', axis: 'x', label: 'Resize width' },\n      { name: 's', axis: 'y', label: 'Resize height' }\n    ];\n\n    let resizeState = null;\n\n    const onPointerMove = (event) => {\n      if (!resizeState) return;\n      event.preventDefault();\n      const dx = event.clientX - resizeState.startX;\n      const dy = event.clientY - resizeState.startY;\n      let nextWidth = resizeState.startWidth;\n      let nextHeight = resizeState.startHeight;\n      if (resizeState.axis === 'both' || resizeState.axis === 'x') {\n        nextWidth = resizeState.startWidth + dx;\n      }\n      if (resizeState.axis === 'both' || resizeState.axis === 'y') {\n        nextHeight = resizeState.startHeight + dy;\n      }\n      if (resizeState.keepRatio && resizeState.ratio > 0) {\n        if (resizeState.axis === 'x') {\n          nextHeight = nextWidth / resizeState.ratio;\n        } else if (resizeState.axis === 'y') {\n          nextWidth = nextHeight * resizeState.ratio;\n        } else {\n          if (Math.abs(dx) >= Math.abs(dy)) {\n            nextHeight = nextWidth / resizeState.ratio;\n          } else {\n            nextWidth = nextHeight * resizeState.ratio;\n          }\n        }\n      }\n      setImageSize(image, nextWidth, nextHeight);\n      requestAnimationFrame(() => update());\n    };\n\n    const stopResize = () => {\n      if (!resizeState) return;\n      window.removeEventListener('pointermove', onPointerMove);\n      window.removeEventListener('pointerup', stopResize);\n      window.removeEventListener('pointercancel', stopResize);\n      if (resizeState.handle && resizeState.pointerId != null) {\n        try {\n          resizeState.handle.releasePointerCapture(resizeState.pointerId);\n        } catch (err) {\n          // ignore\n        }\n      }\n      overlay.classList.remove('is-resizing');\n      resizeState = null;\n      triggerEditorChange();\n      requestAnimationFrame(() => update());\n    };\n\n    handleDefs.forEach(def => {\n      const handle = document.createElement('button');\n      handle.type = 'button';\n      handle.className = `rich-editor-image-handle rich-editor-image-handle--${def.name}`;\n      handle.setAttribute('aria-label', def.label);\n      handle.addEventListener('pointerdown', (event) => {\n        event.preventDefault();\n        event.stopPropagation();\n        const rect = image.getBoundingClientRect();\n        resizeState = {\n          axis: def.axis,\n          startX: event.clientX,\n          startY: event.clientY,\n          startWidth: rect.width,\n          startHeight: rect.height,\n          ratio: rect.height > 0 ? rect.width / rect.height : 1,\n          keepRatio: event.shiftKey,\n          pointerId: event.pointerId,\n          handle\n        };\n        overlay.classList.add('is-resizing');\n        try {\n          handle.setPointerCapture(event.pointerId);\n        } catch (err) {\n          // ignore unsupported pointer capture\n        }\n        window.addEventListener('pointermove', onPointerMove);\n        window.addEventListener('pointerup', stopResize);\n        window.addEventListener('pointercancel', stopResize);\n      });\n      overlay.appendChild(handle);\n    });\n\n    wrapper.appendChild(overlay);\n    image.classList.add('rich-editor-image-active');\n\n    const update = () => {\n      if (!document.body.contains(image)) {\n        destroy();\n        return;\n      }\n      const rect = image.getBoundingClientRect();\n      const wrapperRect = wrapper.getBoundingClientRect();\n      overlay.style.width = `${rect.width}px`;\n      overlay.style.height = `${rect.height}px`;\n      overlay.style.left = `${rect.left - wrapperRect.left}px`;\n      overlay.style.top = `${rect.top - wrapperRect.top}px`;\n    };\n\n    const onScroll = () => update();\n    const onKeyDown = (event) => {\n      if (event.key === 'Escape') {\n        event.preventDefault();\n        destroy();\n      }\n    };\n\n    const handleOutside = (event) => {\n      if (event.target === image) return;\n      if (overlay.contains(event.target)) return;\n      destroy();\n    };\n\n    const resizeObserver = typeof ResizeObserver === 'function'\n      ? new ResizeObserver(() => update())\n      : null;\n    if (resizeObserver) {\n      try {\n        resizeObserver.observe(image);\n      } catch (err) {\n        // ignore\n      }\n    }\n\n    const destroy = () => {\n      if (resizeObserver) resizeObserver.disconnect();\n      document.removeEventListener('scroll', onScroll, true);\n      editable.removeEventListener('scroll', onScroll);\n      window.removeEventListener('resize', update);\n      document.removeEventListener('mousedown', handleOutside, true);\n      document.removeEventListener('keydown', onKeyDown, true);\n      stopResize();\n      overlay.remove();\n      image.classList.remove('rich-editor-image-active');\n      if (pendingImageTarget === image) pendingImageTarget = null;\n    };\n\n    cropBtn.addEventListener('click', async () => {\n      try {\n        const currentWidth = Number(image.getAttribute('width')) || Math.round(image.getBoundingClientRect().width);\n        const currentHeight = Number(image.getAttribute('height')) || Math.round(image.getBoundingClientRect().height);\n        const alt = image.getAttribute('alt') || '';\n        const result = await editImageSource(image.src, { altText: alt, width: currentWidth, height: currentHeight });\n        if (!result) return;\n        image.src = result.dataUrl;\n        if (result.altText) {\n          image.setAttribute('alt', result.altText);\n        } else {\n          image.removeAttribute('alt');\n        }\n        setImageSize(image, result.width, result.height);\n        triggerEditorChange();\n        requestAnimationFrame(() => update());\n      } catch (err) {\n        console.error('Failed to edit image', err);\n      }\n    });\n\n    replaceBtn.addEventListener('click', () => {\n      pendingImageTarget = image;\n      imageFileInput.click();\n    });\n\n    doneBtn.addEventListener('click', () => {\n      destroyActiveImageEditor();\n    });\n\n    document.addEventListener('scroll', onScroll, true);\n    editable.addEventListener('scroll', onScroll);\n    window.addEventListener('resize', update);\n    document.addEventListener('mousedown', handleOutside, true);\n    document.addEventListener('keydown', onKeyDown, true);\n\n    return {\n      image,\n      update,\n      destroy\n    };\n  }\n\n  const commandButtons = [];\n  let sizeSelect = null;\n  let fontSelect = null;\n  let fontNameLabel = null;\n  let fontSizeLabel = null;\n  let clozeButton = null;\n\n  function focusEditor(){\n    editable.focus({ preventScroll: false });\n  }\n\n  let savedRange = null;\n  let suppressSelectionCapture = false;\n\n  function rangeWithinEditor(range, { allowCollapsed = true } = {}){\n    if (!range) return false;\n    if (!allowCollapsed && range.collapsed) return false;\n    const { startContainer, endContainer } = range;\n    if (!startContainer || !endContainer) return false;\n    return editable.contains(startContainer) && editable.contains(endContainer);\n  }\n\n  function captureSelectionRange(){\n    if (suppressSelectionCapture) return;\n    const selection = window.getSelection();\n    if (!selection?.rangeCount) return;\n    const range = selection.getRangeAt(0);\n    if (!rangeWithinEditor(range)) return;\n    savedRange = range.cloneRange();\n  }\n\n  function getSavedRange({ requireSelection = false } = {}){\n    if (!savedRange) return null;\n    return rangeWithinEditor(savedRange, { allowCollapsed: !requireSelection }) ? savedRange : null;\n  }\n\n  function restoreSavedRange({ requireSelection = false } = {}){\n    const range = getSavedRange({ requireSelection });\n    if (!range) return false;\n    const selection = window.getSelection();\n    if (!selection) return false;\n    selection.removeAllRanges();\n    const clone = range.cloneRange();\n    selection.addRange(clone);\n    savedRange = clone.cloneRange();\n    return true;\n  }\n\n  function runCommand(action, { requireSelection = false } = {}){\n    const existing = getSavedRange({ requireSelection });\n    if (!existing) return false;\n\n    const preservedRange = existing.cloneRange();\n    let restored = false;\n\n    suppressSelectionCapture = true;\n    try {\n      focusEditor();\n      savedRange = preservedRange.cloneRange();\n      restored = restoreSavedRange({ requireSelection });\n    } finally {\n      suppressSelectionCapture = false;\n    }\n\n    if (!restored) return false;\n\n    let inputFired = false;\n    const handleInput = () => {\n      inputFired = true;\n    };\n    editable.addEventListener('input', handleInput, { once: true });\n\n    const result = action();\n\n    editable.removeEventListener('input', handleInput);\n    captureSelectionRange();\n    if (!inputFired) {\n      editable.dispatchEvent(new Event('input', { bubbles: true }));\n    }\n    updateInlineState();\n    return result;\n  }\n\n  function exec(command, arg = null, { requireSelection = false, styleWithCss = true } = {}){\n    return runCommand(() => {\n      let previousStyleWithCss = null;\n      try {\n        previousStyleWithCss = document.queryCommandState('styleWithCSS');\n      } catch (err) {\n        previousStyleWithCss = null;\n      }\n      try {\n        document.execCommand('styleWithCSS', false, styleWithCss);\n        return document.execCommand(command, false, arg);\n      } finally {\n        if (previousStyleWithCss !== null) {\n          document.execCommand('styleWithCSS', false, previousStyleWithCss);\n        }\n      }\n    }, { requireSelection });\n  }\n\n  function insertPlainText(text) {\n    if (text == null) return;\n    const normalized = String(text).replace(/\\r\\n/g, '\\n');\n    runCommand(() => {\n      const ok = document.execCommand('insertText', false, normalized);\n      if (ok === false) {\n        const html = escapeHtml(normalized).replace(/\\n/g, '<br>');\n        document.execCommand('insertHTML', false, html);\n      }\n    });\n  }\n\n  function insertHtml(html) {\n    if (!html) return;\n    runCommand(() => document.execCommand('insertHTML', false, html));\n  }\n\n  function selectionWithinEditor({ allowCollapsed = true } = {}){\n    const selection = window.getSelection();\n    if (!selection || selection.rangeCount === 0) return false;\n    if (!allowCollapsed && selection.isCollapsed) return false;\n    const anchor = selection.anchorNode;\n    const focus = selection.focusNode;\n    if (!anchor || !focus) return false;\n    return editable.contains(anchor) && editable.contains(focus);\n  }\n\n  function hasActiveSelection(){\n    return Boolean(getSavedRange({ requireSelection: true }));\n  }\n\n  function collapsedInlineState(){\n    const selection = window.getSelection();\n    if (!selection?.anchorNode) return null;\n    let node = selection.anchorNode;\n    const state = { bold: false, italic: false, underline: false, strike: false };\n\n    const applyFromElement = (el) => {\n      const tag = el.tagName?.toLowerCase();\n      if (tag === 'b' || tag === 'strong') state.bold = true;\n      if (tag === 'i' || tag === 'em') state.italic = true;\n      if (tag === 'u') state.underline = true;\n      if (tag === 's' || tag === 'strike' || tag === 'del') state.strike = true;\n      if (el instanceof Element) {\n        const inlineStyle = el.style;\n        if (inlineStyle) {\n          if (!state.bold) {\n            const weightRaw = inlineStyle.fontWeight || '';\n            const weightText = typeof weightRaw === 'string' ? weightRaw.toLowerCase() : `${weightRaw}`.toLowerCase();\n            const weightValue = Number.parseInt(weightText, 10);\n            if (weightText === 'bold' || weightText === 'bolder' || Number.isFinite(weightValue) && weightValue >= 600) {\n              state.bold = true;\n            }\n          }\n          if (!state.italic && inlineStyle.fontStyle === 'italic') state.italic = true;\n          const deco = `${inlineStyle.textDecorationLine || inlineStyle.textDecoration || ''}`.toLowerCase();\n          if (!state.underline && deco.includes('underline')) state.underline = true;\n          if (!state.strike && (deco.includes('line-through') || deco.includes('strikethrough'))) state.strike = true;\n        }\n      }\n    };\n\n    while (node && node !== editable) {\n      if (node.nodeType === Node.TEXT_NODE) {\n        node = node.parentNode;\n        continue;\n      }\n      if (!(node instanceof Element)) {\n        node = node.parentNode;\n        continue;\n      }\n      applyFromElement(node);\n      node = node.parentNode;\n    }\n\n    return state;\n  }\n\n  function updateInlineState(){\n    const inEditor = selectionWithinEditor();\n    const selection = window.getSelection();\n    const collapsed = Boolean(selection?.isCollapsed);\n    const collapsedState = inEditor && collapsed ? collapsedInlineState() : null;\n\n    commandButtons.forEach(({ btn, command, stateKey }) => {\n      let active = false;\n      if (inEditor) {\n        if (collapsed && collapsedState && stateKey) {\n          active = collapsedState[stateKey];\n        } else {\n          try {\n            active = document.queryCommandState(command);\n          } catch (err) {\n            active = false;\n          }\n        }\n      }\n      const isActive = Boolean(active);\n      btn.classList.toggle('is-active', isActive);\n      btn.dataset.active = isActive ? 'true' : 'false';\n      btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n    });\n\n    const style = inEditor ? computeSelectionStyle() : null;\n    updateTypographyState(style);\n\n    if (clozeButton) {\n      const saved = getSavedRange({ requireSelection: false });\n      const startNode = saved?.startContainer || null;\n      const endNode = saved?.endContainer || null;\n      const startCloze = startNode ? findClozeAncestor(startNode) : null;\n      const endCloze = endNode ? findClozeAncestor(endNode) : null;\n      const active = Boolean(startCloze && startCloze === endCloze);\n      clozeButton.classList.toggle('is-active', active);\n      clozeButton.dataset.active = active ? 'true' : 'false';\n      clozeButton.setAttribute('aria-pressed', active ? 'true' : 'false');\n    }\n  }\n\n  function styleForNode(node) {\n    let current = node;\n    while (current && current !== editable) {\n      if (current instanceof Element) {\n        return window.getComputedStyle(current);\n      }\n      current = current.parentNode;\n    }\n    if (editable instanceof Element) {\n      return window.getComputedStyle(editable);\n    }\n    return null;\n  }\n\n  function computeSelectionStyle() {\n    const selection = window.getSelection();\n    if (!selection || selection.rangeCount === 0) return null;\n    if (selection.isCollapsed) {\n      return styleForNode(selection.anchorNode);\n    }\n    const range = selection.getRangeAt(0);\n    const startStyle = styleForNode(range.startContainer);\n    if (startStyle) return startStyle;\n    const endStyle = styleForNode(range.endContainer);\n    if (endStyle) return endStyle;\n    return styleForNode(range.commonAncestorContainer);\n  }\n\n  function findClozeAncestor(node) {\n    let current = node;\n    while (current && current !== editable) {\n      if (current instanceof HTMLElement && current.getAttribute?.(CLOZE_ATTR) === CLOZE_VALUE) {\n        return current;\n      }\n      current = current.parentNode;\n    }\n    return null;\n  }\n\n  function unwrapClozeElement(element) {\n    const parent = element.parentNode;\n    if (!parent) return;\n    const selection = window.getSelection();\n    const range = document.createRange();\n    let firstChild = null;\n    let lastChild = null;\n    while (element.firstChild) {\n      const child = element.firstChild;\n      parent.insertBefore(child, element);\n      if (!firstChild) firstChild = child;\n      lastChild = child;\n    }\n    const nextSibling = element.nextSibling;\n    parent.removeChild(element);\n    if (firstChild && lastChild) {\n      range.setStartBefore(firstChild);\n      range.setEndAfter(lastChild);\n    } else {\n      const index = Array.prototype.indexOf.call(parent.childNodes, nextSibling);\n      range.setStart(parent, index >= 0 ? index : parent.childNodes.length);\n      range.collapse(true);\n    }\n    if (selection) {\n      selection.removeAllRanges();\n      selection.addRange(range);\n    }\n  }\n\n  function toggleClozeFormatting() {\n    const range = getSavedRange({ requireSelection: false });\n    if (!range) return;\n    const startCloze = findClozeAncestor(range.startContainer);\n    const endCloze = findClozeAncestor(range.endContainer);\n    if (startCloze && startCloze === endCloze) {\n      runCommand(() => {\n        unwrapClozeElement(startCloze);\n      });\n      return;\n    }\n    if (range.collapsed) return;\n    runCommand(() => {\n      const selection = window.getSelection();\n      if (!selection?.rangeCount) return;\n      const activeRange = selection.getRangeAt(0);\n      const fragment = activeRange.extractContents();\n      const span = document.createElement('span');\n      span.setAttribute(CLOZE_ATTR, CLOZE_VALUE);\n      span.appendChild(fragment);\n      activeRange.insertNode(span);\n      selection.removeAllRanges();\n      const newRange = document.createRange();\n      newRange.selectNode(span);\n      selection.addRange(newRange);\n    }, { requireSelection: true });\n  }\n\n  function formatFontFamily(value = '') {\n    if (!value) return 'Default';\n    const primary = value.split(',')[0] || value;\n    return primary.replace(/^['\"]+|['\"]+$/g, '').trim() || 'Default';\n  }\n\n  function updateTypographyState(style) {\n    if (!fontNameLabel || !fontSizeLabel || !sizeSelect) return;\n    const editingSize = document.activeElement === sizeSelect;\n    const editingFont = document.activeElement === fontSelect;\n    if (!style) {\n      fontNameLabel.textContent = 'Font: Default';\n      fontSizeLabel.textContent = 'Size: \u2014';\n      if (!editingFont && fontSelect) {\n        fontSelect.value = '';\n      }\n      if (!editingSize) {\n        sizeSelect.value = '';\n        if (sizeSelect) delete sizeSelect.dataset.customValue;\n      }\n      return;\n    }\n    const family = formatFontFamily(style.fontFamily || '');\n    const sizeText = style.fontSize || '';\n    fontNameLabel.textContent = `Font: ${family}`;\n    fontSizeLabel.textContent = `Size: ${sizeText || '\u2014'}`;\n    if (!editingFont && fontSelect) {\n      const normalized = (style.fontFamily || '').trim().toLowerCase();\n      const match = FONT_OPTIONS.find(option => option.value.trim().toLowerCase() === normalized);\n      if (match) {\n        fontSelect.value = match.value;\n      } else if (normalized) {\n        fontSelect.value = 'custom';\n        fontSelect.dataset.customValue = style.fontFamily || '';\n      } else {\n        fontSelect.value = '';\n      }\n    }\n    if (!editingSize) {\n      const numeric = Number.parseFloat(sizeText);\n      if (Number.isFinite(numeric)) {\n        const rounded = Math.round(numeric);\n        const optionMatch = FONT_SIZE_VALUES.find(val => val === rounded);\n        if (optionMatch) {\n          sizeSelect.value = String(optionMatch);\n        } else {\n          sizeSelect.value = 'custom';\n          sizeSelect.dataset.customValue = String(rounded);\n        }\n      } else {\n        sizeSelect.value = '';\n        delete sizeSelect.dataset.customValue;\n      }\n    }\n  }\n\n  function collectElementsInRange(range) {\n    const elements = [];\n    if (!range) return elements;\n    const walker = document.createTreeWalker(\n      editable,\n      NodeFilter.SHOW_ELEMENT,\n      {\n        acceptNode: (node) => {\n          try {\n            return range.intersectsNode(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_SKIP;\n          } catch (err) {\n            return NodeFilter.FILTER_SKIP;\n          }\n        }\n      }\n    );\n    while (walker.nextNode()) {\n      elements.push(walker.currentNode);\n    }\n    return elements;\n  }\n\n  function removeFontSizeFromRange(range) {\n    const elements = collectElementsInRange(range);\n    elements.forEach(node => {\n      if (!(node instanceof HTMLElement)) return;\n      if (node.style && node.style.fontSize) {\n        node.style.removeProperty('font-size');\n        if (!node.style.length) node.removeAttribute('style');\n      }\n      if (node.tagName?.toLowerCase() === 'font') {\n        const parent = node.parentNode;\n        if (!parent) return;\n        while (node.firstChild) parent.insertBefore(node.firstChild, node);\n        parent.removeChild(node);\n      }\n    });\n  }\n\n  function removeFontFamilyFromRange(range) {\n    const elements = collectElementsInRange(range);\n    elements.forEach(node => {\n      if (!(node instanceof HTMLElement)) return;\n      if (node.style && node.style.fontFamily) {\n        node.style.removeProperty('font-family');\n        if (!node.style.length) node.removeAttribute('style');\n      }\n      if (node.tagName?.toLowerCase() === 'font') {\n        const parent = node.parentNode;\n        if (!parent) return;\n        while (node.firstChild) parent.insertBefore(node.firstChild, node);\n        parent.removeChild(node);\n      }\n    });\n  }\n\n  function applyFontSizeValue(value) {\n    runCommand(() => {\n      const selection = window.getSelection();\n      if (!selection?.rangeCount) return;\n      const range = selection.getRangeAt(0);\n      removeFontSizeFromRange(range);\n      const numeric = Number.parseFloat(value);\n      const hasSize = Number.isFinite(numeric) && numeric > 0;\n      if (!hasSize) {\n        return;\n      }\n      document.execCommand('styleWithCSS', false, true);\n      document.execCommand('fontSize', false, 4);\n      const fonts = editable.querySelectorAll('font');\n      fonts.forEach(node => {\n        const parent = node.parentNode;\n        if (!parent) return;\n        const span = document.createElement('span');\n        span.style.fontSize = `${numeric}px`;\n        while (node.firstChild) span.appendChild(node.firstChild);\n        parent.replaceChild(span, node);\n      });\n    }, { requireSelection: true });\n  }\n\n  function applyFontFamilyValue(value) {\n    runCommand(() => {\n      const selection = window.getSelection();\n      if (!selection?.rangeCount) return;\n      const range = selection.getRangeAt(0);\n      removeFontFamilyFromRange(range);\n      const trimmed = typeof value === 'string' ? value.trim() : '';\n      if (!trimmed) {\n        return;\n      }\n      document.execCommand('styleWithCSS', false, true);\n      document.execCommand('fontName', false, trimmed);\n      const fonts = editable.querySelectorAll('font');\n      fonts.forEach(node => {\n        const parent = node.parentNode;\n        if (!parent) return;\n        const span = document.createElement('span');\n        span.style.fontFamily = trimmed;\n        while (node.firstChild) span.appendChild(node.firstChild);\n        parent.replaceChild(span, node);\n      });\n    }, { requireSelection: true });\n  }\n\n  function createGroup(extraClass){\n    const group = document.createElement('div');\n    group.className = 'rich-editor-group';\n    if (extraClass) group.classList.add(extraClass);\n    toolbar.appendChild(group);\n    return group;\n  }\n  const inlineGroup = createGroup();\n  [\n    ['B', 'Bold', 'bold', 'bold'],\n    ['I', 'Italic', 'italic', 'italic'],\n    ['U', 'Underline', 'underline', 'underline'],\n    ['S', 'Strikethrough', 'strikeThrough', 'strike']\n  ].forEach(([label, title, command, stateKey]) => {\n    const btn = createToolbarButton(label, title, () => exec(command));\n    btn.dataset.command = command;\n    commandButtons.push({ btn, command, stateKey });\n    inlineGroup.appendChild(btn);\n  });\n\n  const colorWrap = document.createElement('label');\n  colorWrap.className = 'rich-editor-color';\n  colorWrap.title = 'Text color';\n  const colorInput = document.createElement('input');\n  colorInput.type = 'color';\n  colorInput.value = '#ffffff';\n  colorInput.dataset.lastColor = '#ffffff';\n  colorInput.addEventListener('input', () => {\n    if (!getSavedRange({ requireSelection: true })) {\n      const previous = colorInput.dataset.lastColor || '#ffffff';\n      colorInput.value = previous;\n      return;\n    }\n    exec('foreColor', colorInput.value, { requireSelection: true });\n    colorInput.dataset.lastColor = colorInput.value;\n  });\n  colorWrap.appendChild(colorInput);\n  const colorGroup = createGroup('rich-editor-color-group');\n  colorGroup.appendChild(colorWrap);\n\n  const highlightRow = document.createElement('div');\n  highlightRow.className = 'rich-editor-highlight-row';\n  colorGroup.appendChild(highlightRow);\n\n  const highlightColors = [\n    ['#facc15', 'Yellow'],\n    ['#f472b6', 'Pink'],\n    ['#f87171', 'Red'],\n    ['#4ade80', 'Green'],\n    ['#38bdf8', 'Blue']\n  ];\n\n  function applyHighlight(color) {\n    if (!getSavedRange({ requireSelection: true })) return;\n    exec('hiliteColor', color, { requireSelection: true });\n  }\n\n  const clearSwatch = document.createElement('button');\n  clearSwatch.type = 'button';\n  clearSwatch.className = 'rich-editor-swatch rich-editor-swatch--clear';\n  clearSwatch.title = 'Remove highlight';\n  clearSwatch.setAttribute('aria-label', 'Remove highlight');\n  clearSwatch.textContent = '\u00D7';\n  clearSwatch.addEventListener('mousedown', e => e.preventDefault());\n  clearSwatch.addEventListener('click', () => {\n    exec('hiliteColor', 'transparent', { requireSelection: true });\n  });\n  highlightRow.appendChild(clearSwatch);\n\n  highlightColors.forEach(([color, label]) => {\n    const swatch = document.createElement('button');\n    swatch.type = 'button';\n    swatch.className = 'rich-editor-swatch';\n    swatch.style.setProperty('--swatch-color', color);\n    swatch.title = `${label} highlight`;\n    swatch.setAttribute('aria-label', `${label} highlight`);\n    swatch.addEventListener('mousedown', e => e.preventDefault());\n    swatch.addEventListener('click', () => applyHighlight(color));\n    highlightRow.appendChild(swatch);\n  });\n\n  const listGroup = createGroup('rich-editor-list-group');\n\n  function applyOrderedStyle(style){\n    const selection = window.getSelection();\n    if (!selection?.rangeCount) return;\n    let node = selection.getRangeAt(0).startContainer;\n    if (node.nodeType === Node.TEXT_NODE) node = node.parentNode;\n    while (node && node !== editable) {\n      if (node.nodeType === Node.ELEMENT_NODE && node.tagName?.toLowerCase() === 'ol') {\n        if (style) node.style.listStyleType = style;\n        else node.style.removeProperty('list-style-type');\n        break;\n      }\n      node = node.parentNode;\n    }\n  }\n\n  function insertOrdered(style){\n    runCommand(() => {\n      document.execCommand('styleWithCSS', false, false);\n      document.execCommand('insertOrderedList', false, null);\n      if (style) applyOrderedStyle(style);\n    });\n  }\n\n  const listButtons = [\n    ['\u2022', 'Bulleted list', () => exec('insertUnorderedList', null, { styleWithCss: false })],\n    ['1.', 'Numbered list', () => insertOrdered('')],\n    ['a.', 'Lettered list', () => insertOrdered('lower-alpha')],\n    ['i.', 'Roman numeral list', () => insertOrdered('lower-roman')]\n  ];\n  listButtons.forEach(([label, title, handler]) => {\n    const btn = createToolbarButton(label, title, handler);\n    listGroup.appendChild(btn);\n  });\n\n  const typographyGroup = createGroup('rich-editor-typography-group');\n\n  const fontInfo = document.createElement('div');\n  fontInfo.className = 'rich-editor-font-info';\n  fontNameLabel = document.createElement('span');\n  fontNameLabel.className = 'rich-editor-font-name';\n  fontNameLabel.textContent = 'Font: Default';\n  fontInfo.appendChild(fontNameLabel);\n  fontSizeLabel = document.createElement('span');\n  fontSizeLabel.className = 'rich-editor-font-size';\n  fontSizeLabel.textContent = 'Size: \u2014';\n  fontInfo.appendChild(fontSizeLabel);\n  typographyGroup.appendChild(fontInfo);\n\n  fontSelect = document.createElement('select');\n  fontSelect.className = 'rich-editor-select rich-editor-font-select';\n  fontSelect.setAttribute('aria-label', 'Font family');\n  FONT_OPTIONS.forEach(option => {\n    const opt = document.createElement('option');\n    opt.value = option.value;\n    opt.textContent = option.label;\n    fontSelect.appendChild(opt);\n  });\n  const customFontOption = document.createElement('option');\n  customFontOption.value = 'custom';\n  customFontOption.textContent = 'Custom\u2026';\n  fontSelect.appendChild(customFontOption);\n  ['mousedown', 'focus', 'keydown'].forEach(evt => {\n    fontSelect.addEventListener(evt, () => captureSelectionRange());\n  });\n  fontSelect.addEventListener('change', () => {\n    if (!hasActiveSelection()) {\n      updateInlineState();\n      return;\n    }\n    let selected = fontSelect.value;\n    if (selected === 'custom') {\n      const current = fontSelect.dataset.customValue || '';\n      const custom = prompt('Enter font family (CSS value)', current || '');\n      if (!custom) {\n        updateInlineState();\n        return;\n      }\n      fontSelect.dataset.customValue = custom;\n      selected = custom;\n    } else if (!selected) {\n      delete fontSelect.dataset.customValue;\n    }\n    applyFontFamilyValue(selected);\n    focusEditor();\n  });\n  typographyGroup.appendChild(fontSelect);\n\n  sizeSelect = document.createElement('select');\n  sizeSelect.className = 'rich-editor-select rich-editor-size';\n  sizeSelect.setAttribute('aria-label', 'Font size');\n  const defaultSizeOption = document.createElement('option');\n  defaultSizeOption.value = '';\n  defaultSizeOption.textContent = 'Size';\n  sizeSelect.appendChild(defaultSizeOption);\n  FONT_SIZE_VALUES.forEach(val => {\n    const opt = document.createElement('option');\n    opt.value = String(val);\n    opt.textContent = `${val}px`;\n    sizeSelect.appendChild(opt);\n  });\n  const customSizeOption = document.createElement('option');\n  customSizeOption.value = 'custom';\n  customSizeOption.textContent = 'Custom\u2026';\n  sizeSelect.appendChild(customSizeOption);\n  ['mousedown', 'focus', 'keydown'].forEach(evt => {\n    sizeSelect.addEventListener(evt, () => captureSelectionRange());\n  });\n  sizeSelect.addEventListener('change', () => {\n    if (!hasActiveSelection()) {\n      updateInlineState();\n      return;\n    }\n    let selected = sizeSelect.value;\n    if (selected === 'custom') {\n      const current = sizeSelect.dataset.customValue || '';\n      const custom = prompt('Enter font size in pixels', current || '16');\n      const numeric = Number.parseFloat(custom || '');\n      if (!custom || !Number.isFinite(numeric) || numeric <= 0) {\n        updateInlineState();\n        return;\n      }\n      const rounded = Math.round(numeric);\n      sizeSelect.dataset.customValue = String(rounded);\n      selected = String(rounded);\n    } else if (!selected) {\n      delete sizeSelect.dataset.customValue;\n    }\n    applyFontSizeValue(selected || null);\n    focusEditor();\n  });\n  typographyGroup.appendChild(sizeSelect);\n\n  const resetSizeBtn = createToolbarButton('\u21BA', 'Reset font size', () => {\n    if (!hasActiveSelection()) return;\n    sizeSelect.value = '';\n    delete sizeSelect.dataset.customValue;\n    applyFontSizeValue(null);\n    focusEditor();\n  });\n  typographyGroup.appendChild(resetSizeBtn);\n\n  const mediaGroup = createGroup('rich-editor-media-group');\n\n  const linkBtn = createToolbarButton('\uD83D\uDD17', 'Insert link', () => {\n    if (!hasActiveSelection()) return;\n    const url = prompt('Enter URL');\n    if (!url) return;\n    exec('createLink', url, { requireSelection: true });\n  });\n  mediaGroup.appendChild(linkBtn);\n\n  const imageBtn = createToolbarButton('\uD83D\uDDBC', 'Upload image (Shift+Click for URL)', (event) => {\n    if (event.shiftKey) {\n      const url = prompt('Enter image URL');\n      if (!url) return;\n      exec('insertImage', url, { styleWithCss: false });\n      return;\n    }\n    imageFileInput.click();\n  });\n  mediaGroup.appendChild(imageBtn);\n\n  const mediaBtn = createToolbarButton('\uD83C\uDFAC', 'Upload media (Shift+Click for URL)', (event) => {\n    if (event.shiftKey) {\n      const url = prompt('Enter media URL');\n      if (!url) return;\n      const typePrompt = prompt('Media type (video/audio/embed)', 'video');\n      const kind = (typePrompt || 'video').toLowerCase();\n      const safeUrl = escapeHtml(url);\n      let html = '';\n      if (kind.startsWith('a')) {\n        html = `<audio controls src=\"${safeUrl}\"></audio>`;\n      } else if (kind.startsWith('e') || kind.startsWith('i')) {\n        html = `<iframe src=\"${safeUrl}\" title=\"Embedded media\" frameborder=\"0\" allow=\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\" allowfullscreen></iframe>`;\n      } else {\n        html = `<video controls src=\"${safeUrl}\"></video>`;\n      }\n      insertHtml(html);\n      return;\n    }\n    mediaFileInput.click();\n  });\n  mediaGroup.appendChild(mediaBtn);\n\n  const clozeTool = createToolbarButton('\u29C9', 'Toggle cloze (hide selected text until clicked)', () => {\n    toggleClozeFormatting();\n    focusEditor();\n  });\n  clozeButton = clozeTool;\n  const clearBtn = createToolbarButton('\u232B', 'Clear formatting', () => exec('removeFormat', null, { requireSelection: true, styleWithCss: false }));\n  const utilityGroup = createGroup('rich-editor-utility-group');\n  utilityGroup.appendChild(clozeTool);\n  utilityGroup.appendChild(clearBtn);\n\n  let settingValue = false;\n  editable.addEventListener('input', () => {\n    if (settingValue) return;\n    if (typeof onChange === 'function') onChange();\n    updateInlineState();\n  });\n\n  editable.addEventListener('dblclick', (event) => {\n    const path = typeof event.composedPath === 'function' ? event.composedPath() : [];\n    const target = path.find(node => node instanceof HTMLImageElement) || event.target;\n    if (target instanceof HTMLImageElement) {\n      event.preventDefault();\n      beginImageEditing(target);\n    }\n  });\n\n  ['keyup','mouseup','focus'].forEach(event => {\n    editable.addEventListener(event, () => updateInlineState());\n  });\n\n  editable.addEventListener('blur', () => {\n    setTimeout(() => updateInlineState(), 0);\n  });\n\n  const selectionHandler = () => {\n    if (!document.body.contains(wrapper)) {\n      document.removeEventListener('selectionchange', selectionHandler);\n      destroyActiveImageEditor();\n      return;\n    }\n    captureSelectionRange();\n    updateInlineState();\n  };\n  document.addEventListener('selectionchange', selectionHandler);\n\n  updateInlineState();\n\n  return {\n    element: wrapper,\n    getValue(){\n      const sanitized = sanitizeHtml(editable.innerHTML);\n      return isEmptyHtml(sanitized) ? '' : sanitized;\n    },\n    setValue(val){\n      settingValue = true;\n      destroyActiveImageEditor();\n      editable.innerHTML = normalizeInput(val);\n      settingValue = false;\n      updateInlineState();\n    },\n    focus(){\n      focusEditor();\n    }\n  };\n}\n\nconst CLOZE_STATE_HIDDEN = 'hidden';\nconst CLOZE_STATE_REVEALED = 'revealed';\n\nfunction setClozeState(node, state){\n  if (!(node instanceof HTMLElement)) return;\n  const next = state === CLOZE_STATE_REVEALED ? CLOZE_STATE_REVEALED : CLOZE_STATE_HIDDEN;\n  node.setAttribute('data-cloze-state', next);\n  if (next === CLOZE_STATE_REVEALED) {\n    node.classList.add('is-cloze-revealed');\n    node.classList.remove('is-cloze-hidden');\n  } else {\n    node.classList.add('is-cloze-hidden');\n    node.classList.remove('is-cloze-revealed');\n  }\n  if (node.classList.contains('cloze-text-interactive')) {\n    node.setAttribute('aria-pressed', next === CLOZE_STATE_REVEALED ? 'true' : 'false');\n  } else if (node.hasAttribute('aria-pressed')) {\n    node.removeAttribute('aria-pressed');\n  }\n}\n\nfunction toggleCloze(node){\n  if (!(node instanceof HTMLElement)) return;\n  const current = node.getAttribute('data-cloze-state');\n  const next = current === CLOZE_STATE_REVEALED ? CLOZE_STATE_HIDDEN : CLOZE_STATE_REVEALED;\n  setClozeState(node, next);\n}\n\nfunction handleClozeClick(event){\n  const target = event.target;\n  if (!(target instanceof HTMLElement)) return;\n  const cloze = target.closest(CLOZE_SELECTOR);\n  if (!cloze) return;\n  event.stopPropagation();\n  toggleCloze(cloze);\n}\n\nfunction handleClozeKey(event){\n  if (event.key !== 'Enter' && event.key !== ' ') return;\n  const target = event.target;\n  if (!(target instanceof HTMLElement)) return;\n  const cloze = target.closest(CLOZE_SELECTOR);\n  if (!cloze) return;\n  event.preventDefault();\n  event.stopPropagation();\n  toggleCloze(cloze);\n}\n\nfunction detachClozeHandlers(container){\n  const handlers = container.__clozeHandlers;\n  if (!handlers) return;\n  container.removeEventListener('click', handlers.click);\n  container.removeEventListener('keydown', handlers.key);\n  delete container.__clozeHandlers;\n}\n\nfunction enhanceClozeContent(target, { clozeMode = 'static' } = {}){\n  const nodes = target.querySelectorAll(CLOZE_SELECTOR);\n  if (!nodes.length) {\n    target.classList.remove('rich-content-with-cloze');\n    detachClozeHandlers(target);\n    return;\n  }\n  target.classList.add('rich-content-with-cloze');\n  const interactive = clozeMode === 'interactive';\n  nodes.forEach(node => {\n    node.classList.add('cloze-text');\n    if (interactive) {\n      node.classList.add('cloze-text-interactive');\n      if (!node.hasAttribute('tabindex')) node.setAttribute('tabindex', '0');\n      node.setAttribute('role', 'button');\n      const current = node.getAttribute('data-cloze-state');\n      if (current !== CLOZE_STATE_REVEALED && current !== CLOZE_STATE_HIDDEN) {\n        setClozeState(node, CLOZE_STATE_HIDDEN);\n      } else {\n        setClozeState(node, current);\n      }\n    } else {\n      node.classList.remove('cloze-text-interactive');\n      if (node.getAttribute('tabindex') === '0') node.removeAttribute('tabindex');\n      if (node.getAttribute('role') === 'button') node.removeAttribute('role');\n      setClozeState(node, CLOZE_STATE_REVEALED);\n    }\n  });\n  if (interactive) {\n    if (!target.__clozeHandlers) {\n      const handlers = {\n        click: handleClozeClick,\n        key: handleClozeKey\n      };\n      target.addEventListener('click', handlers.click);\n      target.addEventListener('keydown', handlers.key);\n      target.__clozeHandlers = handlers;\n    }\n  } else {\n    detachClozeHandlers(target);\n  }\n}\n\nfunction normalizedFromCache(value){\n  if (!value) return '';\n  const key = typeof value === 'string' ? value : null;\n  if (key !== null && richTextCache.has(key)) {\n    return richTextCache.get(key);\n  }\n  const normalized = normalizeInput(value);\n  if (key !== null && key.length <= 20000) {\n    if (!richTextCache.has(key)) {\n      richTextCacheKeys.push(key);\n      if (richTextCacheKeys.length > RICH_TEXT_CACHE_LIMIT) {\n        const oldest = richTextCacheKeys.shift();\n        if (oldest != null) richTextCache.delete(oldest);\n      }\n    }\n    richTextCache.set(key, normalized);\n  }\n  return normalized;\n}\n\nexport function renderRichText(target, value, options = {}){\n  const normalized = normalizedFromCache(value);\n  if (!normalized) {\n    target.textContent = '';\n    target.classList.remove('rich-content');\n    detachClozeHandlers(target);\n    return;\n  }\n  target.classList.add('rich-content');\n  target.innerHTML = normalized;\n  enhanceClozeContent(target, options);\n}\n\nexport function hasRichTextContent(value){\n  return !isEmptyHtml(normalizeInput(value));\n}\n\n", "import { uid, setToggleState } from '../../utils.js';\nimport { upsertItem } from '../../storage/storage.js';\nimport { loadBlockCatalog } from '../../storage/block-catalog.js';\nimport { createFloatingWindow } from './window-manager.js';\nimport { createRichTextEditor } from './rich-text.js';\nimport { confirmModal } from './confirm.js';\n\nconst fieldMap = {\n  disease: [\n    ['etiology', 'Etiology'],\n    ['pathophys', 'Pathophysiology'],\n    ['clinical', 'Clinical Presentation'],\n    ['diagnosis', 'Diagnosis'],\n    ['treatment', 'Treatment'],\n    ['complications', 'Complications'],\n    ['mnemonic', 'Mnemonic']\n  ],\n  drug: [\n    ['class', 'Class'],\n    ['source', 'Source'],\n    ['moa', 'MOA'],\n    ['uses', 'Uses'],\n    ['sideEffects', 'Side Effects'],\n    ['contraindications', 'Contraindications'],\n    ['mnemonic', 'Mnemonic']\n  ],\n  concept: [\n    ['type', 'Type'],\n    ['definition', 'Definition'],\n    ['mechanism', 'Mechanism'],\n    ['clinicalRelevance', 'Clinical Relevance'],\n    ['example', 'Example'],\n    ['mnemonic', 'Mnemonic']\n  ]\n};\n\nconst titleMap = { disease: 'Disease', drug: 'Drug', concept: 'Concept' };\n\nfunction escapeHtml(str = '') {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nexport async function openEditor(kind, onSave, existing = null) {\n  let isDirty = false;\n  let status;\n  let statusFadeTimer = null;\n  let autoSaveTimer = null;\n  const AUTOSAVE_DELAY = 2000;\n\n  const win = createFloatingWindow({\n    title: `${existing ? 'Edit' : 'Add'} ${titleMap[kind] || kind}`,\n    width: 660,\n    onBeforeClose: async (reason) => {\n      if (reason === 'saved') return true;\n      if (autoSaveTimer) {\n        clearTimeout(autoSaveTimer);\n        autoSaveTimer = null;\n      }\n      if (!isDirty) return true;\n      if (reason !== 'close') return true;\n      const shouldSave = await confirmModal('Save changes before closing?');\n      if (shouldSave) {\n        try {\n          await persist({ closeAfter: true });\n        } catch (err) {\n          console.error(err);\n        }\n        return false;\n      }\n      return true;\n    }\n  });\n\n  const form = document.createElement('form');\n  form.className = 'editor-form';\n\n  const nameLabel = document.createElement('label');\n  nameLabel.className = 'editor-field';\n  const nameTitle = document.createElement('span');\n  nameTitle.className = 'editor-field-label';\n  nameTitle.textContent = kind === 'concept' ? 'Concept' : 'Name';\n  nameLabel.appendChild(nameTitle);\n  const nameInput = document.createElement('input');\n  nameInput.className = 'input';\n  nameInput.value = existing ? (existing.name || existing.concept || '') : '';\n  nameInput.placeholder = kind === 'concept' ? 'Enter concept title' : 'Enter name';\n  nameLabel.appendChild(nameInput);\n  form.appendChild(nameLabel);\n\n  const cancelAutoSave = () => {\n    if (autoSaveTimer) {\n      clearTimeout(autoSaveTimer);\n      autoSaveTimer = null;\n    }\n  };\n\n  const queueAutoSave = () => {\n    cancelAutoSave();\n    if (!isDirty) return;\n    if (!nameInput.value.trim()) return;\n    autoSaveTimer = setTimeout(() => {\n      autoSaveTimer = null;\n      if (!isDirty) return;\n      persist({ silent: true }).catch(err => {\n        console.error('Autosave failed', err);\n      });\n    }, AUTOSAVE_DELAY);\n  };\n\n  const markDirty = () => {\n    isDirty = true;\n    if (status) {\n      if (statusFadeTimer) {\n        clearTimeout(statusFadeTimer);\n        statusFadeTimer = null;\n      }\n      status.textContent = '';\n      status.classList.remove('editor-status-muted');\n    }\n    queueAutoSave();\n  };\n\n  nameInput.addEventListener('input', markDirty);\n\n  const fieldInputs = {};\n  fieldMap[kind].forEach(([field, label]) => {\n    const fieldWrap = document.createElement('div');\n    fieldWrap.className = 'editor-field';\n\n    const labelEl = document.createElement('label');\n    labelEl.className = 'editor-field-label';\n    labelEl.textContent = label;\n    const labelId = `field-${field}-${uid()}`;\n    labelEl.id = labelId;\n    fieldWrap.appendChild(labelEl);\n\n    const editor = createRichTextEditor({\n      value: existing ? existing[field] || '' : '',\n      onChange: markDirty,\n      ariaLabelledBy: labelId\n    });\n    const inp = editor.element;\n    fieldInputs[field] = editor;\n    fieldWrap.appendChild(inp);\n    form.appendChild(fieldWrap);\n  });\n\n  const extrasWrap = document.createElement('section');\n  extrasWrap.className = 'editor-extras';\n  const extrasHeader = document.createElement('div');\n  extrasHeader.className = 'editor-extras-header';\n  const extrasTitle = document.createElement('h3');\n  extrasTitle.textContent = 'Custom Sections';\n  extrasHeader.appendChild(extrasTitle);\n  const addExtraBtn = document.createElement('button');\n  addExtraBtn.type = 'button';\n  addExtraBtn.className = 'btn subtle';\n  addExtraBtn.textContent = 'Add Section';\n  extrasHeader.appendChild(addExtraBtn);\n  extrasWrap.appendChild(extrasHeader);\n\n  const extrasList = document.createElement('div');\n  extrasList.className = 'editor-extras-list';\n  extrasWrap.appendChild(extrasList);\n  form.appendChild(extrasWrap);\n\n  const extraControls = new Map();\n\n  function addExtra(extra = null) {\n    const data = extra || {};\n    const id = data.id || uid();\n    const row = document.createElement('div');\n    row.className = 'editor-extra';\n    row.dataset.id = id;\n\n    const titleRow = document.createElement('div');\n    titleRow.className = 'editor-extra-title-row';\n    const titleInput = document.createElement('input');\n    titleInput.className = 'input editor-extra-title';\n    titleInput.placeholder = 'Section title';\n    titleInput.value = data.title || '';\n    titleRow.appendChild(titleInput);\n    const removeBtn = document.createElement('button');\n    removeBtn.type = 'button';\n    removeBtn.className = 'icon-btn ghost';\n    removeBtn.title = 'Remove section';\n    removeBtn.textContent = '\u2715';\n    removeBtn.addEventListener('click', () => {\n      extraControls.delete(id);\n      row.remove();\n      markDirty();\n    });\n    titleRow.appendChild(removeBtn);\n    row.appendChild(titleRow);\n\n    const editor = createRichTextEditor({ value: data.body || '', onChange: markDirty });\n    row.appendChild(editor.element);\n    extrasList.appendChild(row);\n    extraControls.set(id, { id, titleInput, editor });\n\n    titleInput.addEventListener('input', markDirty);\n    row.addEventListener('input', markDirty);\n    if (!extra) markDirty();\n  }\n\n  addExtraBtn.addEventListener('click', () => addExtra());\n\n  const legacyExtras = (() => {\n    if (existing?.extras && existing.extras.length) return existing.extras;\n    if (existing?.facts && existing.facts.length) {\n      return [{\n        id: uid(),\n        title: 'Highlights',\n        body: existing.facts.map(f => `<p>${escapeHtml(f)}</p>`).join('')\n      }];\n    }\n    return [];\n  })();\n\n  legacyExtras.forEach(extra => addExtra(extra));\n\n  const colorLabel = document.createElement('label');\n  colorLabel.className = 'editor-field';\n  colorLabel.textContent = 'Color';\n  const colorInput = document.createElement('input');\n  colorInput.type = 'color';\n  colorInput.className = 'input';\n  colorInput.value = existing?.color || '#ffffff';\n  colorLabel.appendChild(colorInput);\n  form.appendChild(colorLabel);\n  colorInput.addEventListener('input', markDirty);\n\n  const catalog = await loadBlockCatalog({ force: true });\n  const blocks = (catalog.blocks || []).map(block => ({\n    ...block,\n    lectures: (catalog.lectureLists?.[block.blockId] || []).map(lecture => ({ ...lecture }))\n  }));\n  const blockMap = new Map(blocks.map(b => [b.blockId, b]));\n  const blockSet = new Set(Array.isArray(existing?.blocks) ? existing.blocks : []);\n  const manualWeeks = new Set(\n    Array.isArray(existing?.weeks)\n      ? existing.weeks.filter(value => Number.isFinite(Number(value))).map(value => Number(value))\n      : []\n  );\n  const lectSet = new Set();\n  const lectureBlockCounts = new Map();\n\n  function incrementBlockCount(blockId) {\n    if (!blockId) return;\n    const key = String(blockId);\n    const next = (lectureBlockCounts.get(key) || 0) + 1;\n    lectureBlockCounts.set(key, next);\n  }\n\n  function decrementBlockCount(blockId) {\n    if (!blockId) return;\n    const key = String(blockId);\n    const prev = lectureBlockCounts.get(key) || 0;\n    if (prev <= 1) {\n      lectureBlockCounts.delete(key);\n    } else {\n      lectureBlockCounts.set(key, prev - 1);\n    }\n  }\n\n  existing?.lectures?.forEach(l => {\n    if (l.blockId != null && l.id != null) {\n      const key = `${l.blockId}|${l.id}`;\n      lectSet.add(key);\n      incrementBlockCount(l.blockId);\n    }\n  });\n\n  const blockWrap = document.createElement('section');\n  blockWrap.className = 'editor-tags';\n  const blockTitle = document.createElement('div');\n  blockTitle.className = 'editor-tags-title';\n  blockTitle.textContent = 'Curriculum tags';\n  blockWrap.appendChild(blockTitle);\n\n  const blockDescription = document.createElement('p');\n  blockDescription.className = 'editor-tags-description';\n  blockDescription.textContent = 'Pick the lectures that relate to this entry. Block and week tags update automatically as you choose lectures.';\n  blockWrap.appendChild(blockDescription);\n\n  const blockChipRow = document.createElement('div');\n  blockChipRow.className = 'editor-chip-row';\n  blockWrap.appendChild(blockChipRow);\n\n  const manualWeeksBox = document.createElement('div');\n  manualWeeksBox.className = 'editor-manual-weeks';\n  const manualWeeksHeader = document.createElement('div');\n  manualWeeksHeader.className = 'editor-manual-weeks-header';\n  const manualWeeksTitle = document.createElement('span');\n  manualWeeksTitle.textContent = 'Additional week tags';\n  manualWeeksHeader.appendChild(manualWeeksTitle);\n  manualWeeksBox.appendChild(manualWeeksHeader);\n  const manualWeekList = document.createElement('div');\n  manualWeekList.className = 'editor-manual-weeks-list';\n  manualWeeksBox.appendChild(manualWeekList);\n  const blockBrowser = document.createElement('div');\n  blockBrowser.className = 'editor-curriculum-browser';\n  blockWrap.appendChild(blockBrowser);\n\n  const blockColumn = document.createElement('div');\n  blockColumn.className = 'editor-curriculum-column editor-block-column';\n  const blockColumnHeading = document.createElement('h4');\n  blockColumnHeading.className = 'editor-column-heading';\n  blockColumnHeading.textContent = 'Blocks';\n  blockColumn.appendChild(blockColumnHeading);\n  const blockListEl = document.createElement('div');\n  blockListEl.className = 'editor-block-list';\n  blockColumn.appendChild(blockListEl);\n  blockBrowser.appendChild(blockColumn);\n\n  const weekColumn = document.createElement('div');\n  weekColumn.className = 'editor-curriculum-column editor-week-column';\n  const weekHeading = document.createElement('h4');\n  weekHeading.className = 'editor-column-heading';\n  weekHeading.textContent = 'Weeks';\n  weekColumn.appendChild(weekHeading);\n  const weekListEl = document.createElement('div');\n  weekListEl.className = 'editor-week-browser';\n  weekColumn.appendChild(weekListEl);\n  weekColumn.appendChild(manualWeeksBox);\n  blockBrowser.appendChild(weekColumn);\n\n  const lectureColumn = document.createElement('div');\n  lectureColumn.className = 'editor-curriculum-column editor-lecture-column';\n  const lectureHeading = document.createElement('h4');\n  lectureHeading.className = 'editor-column-heading';\n  lectureHeading.textContent = 'Lectures';\n  lectureColumn.appendChild(lectureHeading);\n  const lectureListEl = document.createElement('div');\n  lectureListEl.className = 'editor-lecture-browser';\n  lectureColumn.appendChild(lectureListEl);\n  blockBrowser.appendChild(lectureColumn);\n\n  const UNSCHEDULED_KEY = '__unscheduled';\n\n  function createTagChip(label, variant, active = false) {\n    const chip = document.createElement('button');\n    chip.type = 'button';\n    chip.className = `tag-chip tag-chip-${variant}`;\n    chip.textContent = label;\n    setToggleState(chip, active);\n    return chip;\n  }\n\n  function blockHasSelectedLectures(blockId) {\n    if (!blockId) return false;\n    return lectureBlockCounts.has(String(blockId));\n  }\n\n  function collectSelectedWeekKeys() {\n    const selected = new Set();\n    lectSet.forEach(key => {\n      const [blockId, lectureId] = key.split('|');\n      const lecId = Number(lectureId);\n      if (!blockId || !Number.isFinite(lecId)) return;\n      const block = blockMap.get(blockId);\n      const lecture = block?.lectures?.find(le => le.id === lecId);\n      if (!lecture) return;\n      const weekValue = lecture.week == null || lecture.week === '' ? UNSCHEDULED_KEY : lecture.week;\n      selected.add(`${blockId}|${weekValue}`);\n    });\n    return selected;\n  }\n\n  function collectWeekNumbers() {\n    const numbers = new Set(manualWeeks);\n    lectSet.forEach(key => {\n      const [blockId, lectureId] = key.split('|');\n      const lecId = Number(lectureId);\n      if (!blockId || !Number.isFinite(lecId)) return;\n      const block = blockMap.get(blockId);\n      const lecture = block?.lectures?.find(le => le.id === lecId);\n      if (!lecture) return;\n      const weekValue = Number(lecture.week);\n      if (Number.isFinite(weekValue)) numbers.add(weekValue);\n    });\n    return numbers;\n  }\n\n  function renderManualWeekTags() {\n    manualWeekList.innerHTML = '';\n    if (!manualWeeks.size) {\n      const empty = document.createElement('span');\n      empty.className = 'editor-manual-weeks-empty';\n      empty.textContent = 'No extra week tags yet.';\n      manualWeekList.appendChild(empty);\n      manualWeeksBox.classList.add('empty');\n    } else {\n      manualWeeksBox.classList.remove('empty');\n      Array.from(manualWeeks)\n        .sort((a, b) => a - b)\n        .forEach(weekNum => {\n          const chip = document.createElement('div');\n          chip.className = 'editor-manual-week-chip';\n          const label = document.createElement('span');\n          label.textContent = `Week ${weekNum}`;\n          chip.appendChild(label);\n          const removeBtn = document.createElement('button');\n          removeBtn.type = 'button';\n          removeBtn.className = 'icon-btn ghost';\n          removeBtn.title = 'Remove week tag';\n          removeBtn.setAttribute('aria-label', `Remove week ${weekNum}`);\n          removeBtn.textContent = '\u2715';\n          removeBtn.addEventListener('click', () => {\n            manualWeeks.delete(weekNum);\n            markDirty();\n            renderManualWeekTags();\n            renderWeekList();\n          });\n          chip.appendChild(removeBtn);\n          manualWeekList.appendChild(chip);\n        });\n    }\n  }\n\n  let activeBlockId = null;\n  let activeWeekKey = null;\n\n  function weekGroupsForBlock(block) {\n    if (!block) return [];\n    const weekNumbers = new Set();\n    if (Number.isFinite(block.weeks)) {\n      for (let i = 1; i <= block.weeks; i++) weekNumbers.add(i);\n    }\n    (block.lectures || []).forEach(l => {\n      if (typeof l.week === 'number') weekNumbers.add(l.week);\n    });\n    const sortedWeeks = Array.from(weekNumbers).sort((a, b) => a - b);\n    const groups = sortedWeeks.map(weekNumber => ({\n      key: `${block.blockId}|${weekNumber}`,\n      label: `Week ${weekNumber}`,\n      lectures: (block.lectures || []).filter(l => l.week === weekNumber),\n      weekNumber\n    }));\n    const unscheduledLectures = (block.lectures || []).filter(l => l.week == null || l.week === '');\n    if (unscheduledLectures.length) {\n      groups.push({\n        key: `${block.blockId}|${UNSCHEDULED_KEY}`,\n        label: 'Unscheduled',\n        lectures: unscheduledLectures,\n        unscheduled: true\n      });\n    }\n    return groups;\n  }\n\n  function ensureActiveBlock() {\n    if (activeBlockId && blockMap.has(activeBlockId)) return;\n    for (const key of lectSet) {\n      const [blockId] = key.split('|');\n      if (blockId && blockMap.has(blockId)) {\n        activeBlockId = blockId;\n        return;\n      }\n    }\n    for (const id of blockSet) {\n      if (blockMap.has(id)) {\n        activeBlockId = id;\n        return;\n      }\n    }\n    activeBlockId = blocks[0]?.blockId || null;\n  }\n\n  function ensureActiveWeek() {\n    if (!activeBlockId || !blockMap.has(activeBlockId)) {\n      activeWeekKey = null;\n      return;\n    }\n    const block = blockMap.get(activeBlockId);\n    const groups = weekGroupsForBlock(block);\n    if (activeWeekKey && groups.some(group => group.key === activeWeekKey)) return;\n    const selected = collectSelectedWeekKeys();\n    for (const key of selected) {\n      if (key.startsWith(`${activeBlockId}|`)) {\n        activeWeekKey = key;\n        return;\n      }\n    }\n    activeWeekKey = groups.length ? groups[0].key : null;\n  }\n\n  function renderBlockChips() {\n    blockChipRow.innerHTML = '';\n    const taggedBlocks = Array.from(blockSet).filter(id => blockMap.has(id));\n    if (!taggedBlocks.length) {\n      const hint = document.createElement('div');\n      hint.className = 'editor-tags-empty subtle';\n      hint.textContent = 'Block tags update automatically as you choose lectures.';\n      blockChipRow.appendChild(hint);\n      return;\n    }\n    taggedBlocks.sort((a, b) => {\n      const aTitle = blockMap.get(a)?.title || String(a);\n      const bTitle = blockMap.get(b)?.title || String(b);\n      return aTitle.localeCompare(bTitle);\n    });\n    taggedBlocks.forEach(blockId => {\n      const title = blockMap.get(blockId)?.title || blockId;\n      const chip = createTagChip(title, 'block', true);\n      chip.addEventListener('click', () => {\n        blockSet.delete(blockId);\n        markDirty();\n        renderBlockChips();\n        renderBlockList();\n      });\n      blockChipRow.appendChild(chip);\n    });\n  }\n\n  function renderBlockList() {\n    blockListEl.innerHTML = '';\n    if (!blocks.length) {\n      const empty = document.createElement('div');\n      empty.className = 'editor-tags-empty';\n      empty.textContent = 'No curriculum blocks have been created yet.';\n      blockListEl.appendChild(empty);\n      return;\n    }\n    ensureActiveBlock();\n    ensureActiveWeek();\n    blocks.forEach(block => {\n      if (!block) return;\n      const blockId = block.blockId;\n      const row = document.createElement('div');\n      row.className = 'editor-block-row';\n      if (blockHasSelectedLectures(blockId)) row.classList.add('has-lectures');\n\n      const button = document.createElement('button');\n      button.type = 'button';\n      button.className = 'editor-block-button';\n      setToggleState(button, blockId === activeBlockId);\n\n      const label = document.createElement('span');\n      label.className = 'editor-block-label';\n      label.textContent = block.title || blockId;\n      button.appendChild(label);\n\n      const count = lectureBlockCounts.get(String(blockId)) || 0;\n      if (count) {\n        const badge = document.createElement('span');\n        badge.className = 'editor-block-count';\n        badge.textContent = `${count}`;\n        badge.setAttribute('aria-label', `${count} selected lecture${count === 1 ? '' : 's'}`);\n        button.appendChild(badge);\n      }\n\n      button.addEventListener('click', () => {\n        activeBlockId = blockId;\n        activeWeekKey = null;\n        ensureActiveWeek();\n        renderBlockList();\n        renderWeekList();\n        renderLectureList();\n      });\n\n      row.appendChild(button);\n\n      blockListEl.appendChild(row);\n    });\n  }\n\n  function renderWeekList() {\n    weekListEl.innerHTML = '';\n    if (!blocks.length) {\n      const empty = document.createElement('div');\n      empty.className = 'editor-tags-empty subtle';\n      empty.textContent = 'Add blocks to browse weeks.';\n      weekListEl.appendChild(empty);\n      return;\n    }\n    ensureActiveBlock();\n    if (!activeBlockId || !blockMap.has(activeBlockId)) {\n      const prompt = document.createElement('div');\n      prompt.className = 'editor-tags-empty subtle';\n      prompt.textContent = 'Select a block to view weeks.';\n      weekListEl.appendChild(prompt);\n      return;\n    }\n    const block = blockMap.get(activeBlockId);\n    const groups = weekGroupsForBlock(block);\n    ensureActiveWeek();\n    const selectedWeekKeys = collectSelectedWeekKeys();\n    if (!groups.length) {\n      const empty = document.createElement('div');\n      empty.className = 'editor-tags-empty subtle';\n      empty.textContent = 'Add weeks or lectures to this block to start tagging.';\n      weekListEl.appendChild(empty);\n      return;\n    }\n    groups.forEach(group => {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'editor-week-button';\n      setToggleState(btn, group.key === activeWeekKey);\n      if (selectedWeekKeys.has(group.key)) btn.classList.add('has-selection');\n      if (Number.isFinite(group.weekNumber) && manualWeeks.has(Number(group.weekNumber))) {\n        btn.classList.add('manual');\n      }\n      const label = document.createElement('span');\n      label.className = 'editor-week-label';\n      label.textContent = group.label;\n      btn.appendChild(label);\n      const meta = document.createElement('span');\n      meta.className = 'editor-week-meta';\n      const total = group.lectures?.length || 0;\n      if (total) {\n        meta.textContent = `${total} lecture${total === 1 ? '' : 's'}`;\n      } else if (group.unscheduled) {\n        meta.textContent = 'No unscheduled lectures';\n      } else {\n        meta.textContent = 'No lectures yet';\n      }\n      btn.appendChild(meta);\n      btn.addEventListener('click', () => {\n        activeWeekKey = group.key;\n        renderWeekList();\n        renderLectureList();\n      });\n      weekListEl.appendChild(btn);\n    });\n  }\n\n  function renderLectureList() {\n    lectureListEl.innerHTML = '';\n    if (!blocks.length) {\n      const empty = document.createElement('div');\n      empty.className = 'editor-tags-empty subtle';\n      empty.textContent = 'Add blocks and lectures to start tagging.';\n      lectureListEl.appendChild(empty);\n      return;\n    }\n    ensureActiveBlock();\n    ensureActiveWeek();\n    if (!activeBlockId || !blockMap.has(activeBlockId)) {\n      const prompt = document.createElement('div');\n      prompt.className = 'editor-tags-empty subtle';\n      prompt.textContent = 'Select a block to choose lectures.';\n      lectureListEl.appendChild(prompt);\n      return;\n    }\n    if (!activeWeekKey) {\n      const prompt = document.createElement('div');\n      prompt.className = 'editor-tags-empty subtle';\n      prompt.textContent = 'Pick a week to see its lectures.';\n      lectureListEl.appendChild(prompt);\n      return;\n    }\n    const [blockId] = activeWeekKey.split('|');\n    const block = blockMap.get(blockId);\n    const groups = weekGroupsForBlock(block);\n    const current = groups.find(group => group.key === activeWeekKey);\n    if (!current) {\n      const empty = document.createElement('div');\n      empty.className = 'editor-tags-empty subtle';\n      empty.textContent = 'No lectures available for this week yet.';\n      lectureListEl.appendChild(empty);\n      return;\n    }\n    if (!current.lectures.length) {\n      const empty = document.createElement('div');\n      empty.className = 'editor-tags-empty subtle';\n      empty.textContent = current.unscheduled\n        ? 'No unscheduled lectures yet.'\n        : 'No lectures linked to this week yet.';\n      lectureListEl.appendChild(empty);\n      return;\n    }\n    current.lectures.forEach(lecture => {\n      const key = `${blockId}|${lecture.id}`;\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'editor-lecture-button';\n      btn.textContent = lecture.name || `Lecture ${lecture.id}`;\n      setToggleState(btn, lectSet.has(key));\n      btn.addEventListener('click', () => {\n        if (lectSet.has(key)) {\n          lectSet.delete(key);\n          decrementBlockCount(blockId);\n        } else {\n          lectSet.add(key);\n          incrementBlockCount(blockId);\n        }\n        markDirty();\n        renderBlockChips();\n        renderBlockList();\n        renderWeekList();\n        renderLectureList();\n      });\n      lectureListEl.appendChild(btn);\n    });\n  }\n\n  renderManualWeekTags();\n  renderBlockChips();\n  renderBlockList();\n  renderWeekList();\n  renderLectureList();\n\n  form.appendChild(blockWrap);\n\n  const actionBar = document.createElement('div');\n  actionBar.className = 'editor-actions';\n\n  status = document.createElement('span');\n  status.className = 'editor-status';\n\n  let saveBtn;\n  let headerSaveBtn;\n\n  async function persist(options = {}) {\n    const opts = typeof options === 'boolean' ? { closeAfter: options } : options;\n    const { closeAfter = false, silent = false } = opts;\n    cancelAutoSave();\n    const titleKey = kind === 'concept' ? 'concept' : 'name';\n    const trimmed = nameInput.value.trim();\n    if (!trimmed) {\n      if (!silent) {\n        status.textContent = 'Name is required.';\n      }\n      return false;\n    }\n    if (!silent && status) {\n      status.classList.remove('editor-status-muted');\n      status.textContent = 'Saving\u2026';\n    }\n    const wasNew = !existing;\n    const item = existing || { id: uid(), kind };\n    item[titleKey] = trimmed;\n    fieldMap[kind].forEach(([field]) => {\n      const control = fieldInputs[field];\n      const v = control?.getValue ? control.getValue() : '';\n      item[field] = v;\n    });\n    item.extras = Array.from(extraControls.values()).map(({ id, titleInput, editor }) => ({\n      id,\n      title: titleInput.value.trim(),\n      body: editor.getValue()\n    })).filter(ex => ex.title || ex.body);\n    item.facts = [];\n    const blockTags = new Set(blockSet);\n    lectSet.forEach(key => {\n      const [blockId] = key.split('|');\n      if (blockId) blockTags.add(blockId);\n    });\n    item.blocks = Array.from(blockTags);\n\n    const weekNums = collectWeekNumbers();\n    item.weeks = Array.from(weekNums).sort((a, b) => a - b);\n    const lectures = [];\n    for (const key of lectSet) {\n      const [blockId, lecIdStr] = key.split('|');\n      const lecId = Number(lecIdStr);\n      const blk = blockMap.get(blockId);\n      const l = blk?.lectures.find(le => le.id === lecId);\n      if (l) lectures.push({ blockId, id: l.id, name: l.name, week: l.week });\n    }\n    item.lectures = lectures;\n    item.color = colorInput.value;\n    try {\n      await upsertItem(item);\n    } catch (err) {\n      console.error(err);\n      if (status) {\n        if (statusFadeTimer) {\n          clearTimeout(statusFadeTimer);\n          statusFadeTimer = null;\n        }\n        status.classList.remove('editor-status-muted');\n        status.textContent = silent ? 'Autosave failed' : 'Failed to save.';\n      }\n      throw err;\n    }\n    existing = item;\n    updateTitle();\n    isDirty = false;\n    const shouldNotify = onSave && (!silent || wasNew);\n    if (shouldNotify) onSave();\n    if (closeAfter) {\n      win.close('saved');\n    } else {\n      if (statusFadeTimer) {\n        clearTimeout(statusFadeTimer);\n        statusFadeTimer = null;\n      }\n      if (status) {\n        if (silent) {\n          status.textContent = 'Autosaved';\n          status.classList.add('editor-status-muted');\n          statusFadeTimer = setTimeout(() => {\n            status.classList.remove('editor-status-muted');\n            statusFadeTimer = null;\n          }, 1800);\n        } else {\n          status.textContent = 'Saved';\n          status.classList.remove('editor-status-muted');\n        }\n      }\n    }\n    return true;\n  }\n\n  function handleSaveRequest() {\n    if (headerSaveBtn) headerSaveBtn.disabled = true;\n    if (saveBtn) saveBtn.disabled = true;\n    persist({ closeAfter: true })\n      .catch(() => {})\n      .finally(() => {\n        if (headerSaveBtn) headerSaveBtn.disabled = false;\n        if (saveBtn) saveBtn.disabled = false;\n      });\n  }\n\n  headerSaveBtn = win.addAction({\n    text: '\u2713',\n    ariaLabel: 'Save entry',\n    title: 'Save and close',\n    className: 'floating-action--confirm',\n    onClick: handleSaveRequest\n  });\n\n  saveBtn = document.createElement('button');\n  saveBtn.type = 'button';\n  saveBtn.className = 'btn';\n  saveBtn.textContent = 'Save & Close';\n  saveBtn.addEventListener('click', handleSaveRequest);\n\n  actionBar.appendChild(saveBtn);\n  actionBar.appendChild(status);\n  form.appendChild(actionBar);\n\n  form.addEventListener('submit', (e) => {\n    e.preventDefault();\n    handleSaveRequest();\n  });\n\n  win.setContent(form);\n\n  const updateTitle = () => {\n    const base = `${existing ? 'Edit' : 'Add'} ${titleMap[kind] || kind}`;\n    const name = nameInput.value.trim();\n    if (name) {\n      win.setTitle(`${base}: ${name}`);\n    } else {\n      win.setTitle(base);\n    }\n  };\n  nameInput.addEventListener('input', updateTitle);\n  updateTitle();\n\n  win.focus();\n  nameInput.focus();\n}", "import { listItemsByKind, upsertItem } from '../../storage/storage.js';\n\n// Modal for linking items together\nexport async function openLinker(item, onSave) {\n  const overlay = document.createElement('div');\n  overlay.className = 'modal';\n\n  const card = document.createElement('div');\n  card.className = 'card';\n\n  const title = document.createElement('h2');\n  title.textContent = `Links for ${item.name || item.concept || ''}`;\n  card.appendChild(title);\n\n  const all = [\n    ...(await listItemsByKind('disease')),\n    ...(await listItemsByKind('drug')),\n    ...(await listItemsByKind('concept'))\n  ];\n  const idMap = new Map(all.map(i => [i.id, i]));\n  const links = new Set((item.links || []).map(l => l.id));\n\n  const list = document.createElement('div');\n  list.className = 'link-list';\n  card.appendChild(list);\n\n  function renderList() {\n    list.innerHTML = '';\n    links.forEach(id => {\n      const row = document.createElement('div');\n      row.className = 'row';\n      const label = document.createElement('span');\n      const it = idMap.get(id);\n      label.textContent = it ? (it.name || it.concept || id) : id;\n      row.appendChild(label);\n      const btn = document.createElement('button');\n      btn.className = 'btn';\n      btn.textContent = 'Remove';\n      btn.addEventListener('click', () => { links.delete(id); renderList(); });\n      row.appendChild(btn);\n      list.appendChild(row);\n    });\n  }\n  renderList();\n\n  const input = document.createElement('input');\n  input.className = 'input';\n  input.placeholder = 'Search items...';\n  card.appendChild(input);\n\n  const sug = document.createElement('ul');\n  sug.className = 'quiz-suggestions';\n  card.appendChild(sug);\n\n  input.addEventListener('input', () => {\n    const v = input.value.toLowerCase();\n    sug.innerHTML = '';\n    if (!v) return;\n    all.filter(it => it.id !== item.id && (it.name || it.concept || '').toLowerCase().includes(v))\n      .slice(0,5)\n      .forEach(it => {\n        const li = document.createElement('li');\n        li.textContent = it.name || it.concept || '';\n        li.addEventListener('mousedown', () => {\n          links.add(it.id);\n          input.value = '';\n          sug.innerHTML = '';\n          renderList();\n        });\n        sug.appendChild(li);\n      });\n  });\n\n  const actions = document.createElement('div');\n  actions.className = 'modal-actions';\n  const cancel = document.createElement('button');\n  cancel.type = 'button';\n  cancel.className = 'btn';\n  cancel.textContent = 'Close';\n  cancel.addEventListener('click', () => document.body.removeChild(overlay));\n  const save = document.createElement('button');\n  save.type = 'button';\n  save.className = 'btn';\n  save.textContent = 'Save';\n  save.addEventListener('click', async () => {\n    const newLinks = new Set(links);\n    const oldLinks = new Set((item.links || []).map(l => l.id));\n\n    item.links = Array.from(newLinks).map(id => ({ id, type: 'assoc' }));\n    await upsertItem(item);\n\n    const affected = new Set([...oldLinks, ...newLinks]);\n    for (const id of affected) {\n      const other = idMap.get(id);\n      if (!other) continue;\n      other.links = other.links || [];\n      const has = other.links.some(l => l.id === item.id);\n      const should = newLinks.has(id);\n      if (should && !has) other.links.push({ id: item.id, type: 'assoc' });\n      if (!should && has) other.links = other.links.filter(l => l.id !== item.id);\n      await upsertItem(other);\n    }\n\n    document.body.removeChild(overlay);\n    onSave && onSave();\n  });\n  actions.appendChild(cancel);\n  actions.appendChild(save);\n  card.appendChild(actions);\n\n  overlay.appendChild(card);\n  overlay.addEventListener('click', e => { if (e.target === overlay) document.body.removeChild(overlay); });\n  document.body.appendChild(overlay);\n  input.focus();\n}\n\n", "import { upsertItem, deleteItem } from '../../storage/storage.js';\nimport { loadBlockCatalog } from '../../storage/block-catalog.js';\nimport { state, setEntryLayout, setFilters } from '../../state.js';\nimport { setToggleState } from '../../utils.js';\nimport { openEditor } from './editor.js';\nimport { confirmModal } from './confirm.js';\nimport { openLinker } from './linker.js';\nimport { renderRichText } from './rich-text.js';\n\nconst kindColors = { disease: 'var(--purple)', drug: 'var(--green)', concept: 'var(--blue)' };\nconst fieldDefs = {\n  disease: [\n    ['etiology','Etiology','\uD83E\uDDEC'],\n    ['pathophys','Pathophys','\u2699\uFE0F'],\n    ['clinical','Clinical','\uD83E\uDE7A'],\n    ['diagnosis','Diagnosis','\uD83D\uDD0E'],\n    ['treatment','Treatment','\uD83D\uDC8A'],\n    ['complications','Complications','\u26A0\uFE0F'],\n    ['mnemonic','Mnemonic','\uD83E\uDDE0']\n  ],\n  drug: [\n    ['class','Class','\uD83C\uDFF7\uFE0F'],\n    ['source','Source','\uD83C\uDF31'],\n    ['moa','MOA','\u2699\uFE0F'],\n    ['uses','Uses','\uD83D\uDC8A'],\n    ['sideEffects','Side Effects','\u26A0\uFE0F'],\n    ['contraindications','Contraindications','\uD83D\uDEAB'],\n    ['mnemonic','Mnemonic','\uD83E\uDDE0']\n  ],\n  concept: [\n    ['type','Type','\uD83C\uDFF7\uFE0F'],\n    ['definition','Definition','\uD83D\uDCD6'],\n    ['mechanism','Mechanism','\u2699\uFE0F'],\n    ['clinicalRelevance','Clinical Relevance','\uD83E\uDE7A'],\n    ['example','Example','\uD83D\uDCDD'],\n    ['mnemonic','Mnemonic','\uD83E\uDDE0']\n  ]\n};\n\nfunction escapeHtml(str = '') {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction ensureExtras(item) {\n  if (Array.isArray(item.extras) && item.extras.length) {\n    return item.extras;\n  }\n  if (item.facts && item.facts.length) {\n    return [{\n      id: 'legacy-facts',\n      title: 'Highlights',\n      body: `<ul>${item.facts.map(f => `<li>${escapeHtml(f)}</li>`).join('')}</ul>`\n    }];\n  }\n  return [];\n}\n\nconst expanded = new Set();\nconst collapsedBlocks = new Set();\nconst collapsedWeeks = new Set();\nlet activeBlockKey = null;\n\nexport function createItemCard(item, onChange){\n  const card = document.createElement('div');\n  card.className = `item-card card--${item.kind}`;\n  const color = item.color || kindColors[item.kind] || 'var(--gray)';\n  card.style.borderTop = `3px solid ${color}`;\n\n  const header = document.createElement('div');\n  header.className = 'card-header';\n\n  const mainBtn = document.createElement('button');\n  mainBtn.className = 'card-title-btn';\n  mainBtn.textContent = item.name || item.concept || 'Untitled';\n  mainBtn.setAttribute('aria-expanded', expanded.has(item.id));\n  mainBtn.addEventListener('click', () => {\n    if (expanded.has(item.id)) expanded.delete(item.id); else expanded.add(item.id);\n    card.classList.toggle('expanded');\n    mainBtn.setAttribute('aria-expanded', expanded.has(item.id));\n  });\n  header.appendChild(mainBtn);\n\n  const settings = document.createElement('div');\n  settings.className = 'card-settings';\n  const menu = document.createElement('div');\n  menu.className = 'card-menu hidden';\n  menu.setAttribute('role', 'menu');\n  menu.setAttribute('aria-hidden', 'true');\n  const gear = document.createElement('button');\n  gear.type = 'button';\n  gear.className = 'icon-btn card-settings-toggle';\n  gear.title = 'Entry options';\n  gear.setAttribute('aria-haspopup', 'true');\n  gear.setAttribute('aria-expanded', 'false');\n  gear.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869z\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><circle cx=\"12\" cy=\"12\" r=\"2.8\" stroke=\"currentColor\" stroke-width=\"1.6\"/></svg>';\n  settings.append(gear, menu);\n  header.appendChild(settings);\n\n  function closeMenu() {\n    menu.classList.add('hidden');\n    menu.setAttribute('aria-hidden', 'true');\n    settings.classList.remove('open');\n    gear.setAttribute('aria-expanded', 'false');\n    document.removeEventListener('mousedown', handleOutside);\n  }\n\n  function openMenu() {\n    menu.classList.remove('hidden');\n    menu.setAttribute('aria-hidden', 'false');\n    settings.classList.add('open');\n    gear.setAttribute('aria-expanded', 'true');\n    document.addEventListener('mousedown', handleOutside);\n  }\n\n  function handleOutside(e) {\n    if (!settings.contains(e.target)) {\n      closeMenu();\n    }\n  }\n\n  gear.addEventListener('click', e => {\n    e.stopPropagation();\n    if (menu.classList.contains('hidden')) openMenu(); else closeMenu();\n  });\n\n  menu.addEventListener('click', e => e.stopPropagation());\n\n  const fav = document.createElement('button');\n  fav.className = 'icon-btn';\n  fav.textContent = item.favorite ? '\u2605' : '\u2606';\n  fav.title = 'Toggle Favorite';\n  fav.setAttribute('aria-label','Toggle Favorite');\n  fav.addEventListener('click', async e => {\n    e.stopPropagation();\n    closeMenu();\n    item.favorite = !item.favorite;\n    await upsertItem(item);\n    fav.textContent = item.favorite ? '\u2605' : '\u2606';\n    onChange && onChange();\n  });\n  menu.appendChild(fav);\n\n  const link = document.createElement('button');\n  link.className = 'icon-btn';\n  link.textContent = '\uD83E\uDEA2';\n  link.title = 'Links';\n  link.setAttribute('aria-label','Manage links');\n  link.addEventListener('click', e => {\n    e.stopPropagation();\n    closeMenu();\n    openLinker(item, onChange);\n  });\n  menu.appendChild(link);\n\n  const edit = document.createElement('button');\n  edit.className = 'icon-btn';\n  edit.textContent = '\u270F\uFE0F';\n  edit.title = 'Edit';\n  edit.setAttribute('aria-label','Edit');\n  edit.addEventListener('click', e => {\n    e.stopPropagation();\n    closeMenu();\n    openEditor(item.kind, onChange, item);\n  });\n  menu.appendChild(edit);\n\n  const copy = document.createElement('button');\n  copy.className = 'icon-btn';\n  copy.textContent = '\uD83D\uDCCB';\n  copy.title = 'Copy Title';\n  copy.setAttribute('aria-label','Copy Title');\n  copy.addEventListener('click', e => {\n    e.stopPropagation();\n    closeMenu();\n    navigator.clipboard && navigator.clipboard.writeText(item.name || item.concept || '');\n  });\n  menu.appendChild(copy);\n\n  const del = document.createElement('button');\n  del.className = 'icon-btn danger';\n  del.textContent = '\uD83D\uDDD1\uFE0F';\n  del.title = 'Delete';\n  del.setAttribute('aria-label','Delete');\n  del.addEventListener('click', async e => {\n    e.stopPropagation();\n    closeMenu();\n    if (await confirmModal('Delete this item?')) {\n      await deleteItem(item.id);\n      onChange && onChange();\n    }\n  });\n  menu.appendChild(del);\n\n  card.appendChild(header);\n\n  const body = document.createElement('div');\n  body.className = 'card-body';\n  card.appendChild(body);\n\n  function renderBody(){\n    body.innerHTML = '';\n    const identifiers = document.createElement('div');\n    identifiers.className = 'identifiers';\n    (item.blocks || []).forEach(b => {\n      const chip = document.createElement('span');\n      chip.className = 'chip';\n      chip.textContent = b;\n      identifiers.appendChild(chip);\n    });\n    (item.weeks || []).forEach(w => {\n      const chip = document.createElement('span');\n      chip.className = 'chip';\n      chip.textContent = 'W' + w;\n      identifiers.appendChild(chip);\n    });\n    if (item.lectures) {\n      item.lectures.forEach(l => {\n        const chip = document.createElement('span');\n        chip.className = 'chip';\n        chip.textContent = '\uD83D\uDCDA ' + (l.name || l.id);\n        identifiers.appendChild(chip);\n      });\n    }\n    body.appendChild(identifiers);\n\n    const defs = fieldDefs[item.kind] || [];\n    defs.forEach(([f,label,icon]) => {\n      if (!item[f]) return;\n      const sec = document.createElement('div');\n      sec.className = 'section';\n      sec.style.borderLeftColor = color;\n      const tl = document.createElement('div');\n      tl.className = 'section-title';\n      tl.textContent = label;\n      if (icon) tl.prepend(icon + ' ');\n      sec.appendChild(tl);\n      const txt = document.createElement('div');\n      txt.className = 'section-content';\n      renderRichText(txt, item[f]);\n      sec.appendChild(txt);\n      body.appendChild(sec);\n    });\n    const extras = ensureExtras(item);\n    extras.forEach(extra => {\n      if (!extra || !extra.body) return;\n      const sec = document.createElement('div');\n      sec.className = 'section section--extra';\n      const tl = document.createElement('div');\n      tl.className = 'section-title';\n      tl.textContent = extra.title || 'Additional Section';\n      sec.appendChild(tl);\n      const txt = document.createElement('div');\n      txt.className = 'section-content';\n      renderRichText(txt, extra.body);\n      sec.appendChild(txt);\n      body.appendChild(sec);\n    });\n\n    if (item.links && item.links.length) {\n      const lc = document.createElement('span');\n      lc.className = 'chip link-chip';\n      lc.textContent = `\uD83E\uDEA2 ${item.links.length}`;\n      body.appendChild(lc);\n    }\n  }\n\n  renderBody();\n  if (expanded.has(item.id)) card.classList.add('expanded');\n\n  function fit(){\n    const headerH = header.offsetHeight;\n    const maxH = card.clientHeight - headerH - 4;\n    let size = parseFloat(getComputedStyle(body).fontSize);\n    while(body.scrollHeight > maxH && size > 12){\n      size -= 1;\n      body.style.fontSize = size + 'px';\n    }\n  }\n  requestAnimationFrame(fit);\n  return card;\n}\n\nexport async function renderCardList(container, itemSource, kind, onChange){\n  container.innerHTML = '';\n  const { blocks } = await loadBlockCatalog();\n  const blockTitle = id => blocks.find(b => b.blockId === id)?.title || id;\n  const orderMap = new Map(blocks.map((b,i)=>[b.blockId,i]));\n  const blockWeekMap = new Map();\n  const allWeeks = new Set();\n  blocks.forEach(block => {\n    if (!block) return;\n    const weeks = new Set();\n    if (Number.isFinite(block.weeks)) {\n      for (let i = 1; i <= block.weeks; i++) weeks.add(i);\n    }\n    (block.lectures || []).forEach(lecture => {\n      if (typeof lecture.week === 'number') weeks.add(lecture.week);\n    });\n    const sortedWeeks = Array.from(weeks).sort((a, b) => a - b);\n    blockWeekMap.set(block.blockId, sortedWeeks);\n    sortedWeeks.forEach(weekNumber => allWeeks.add(weekNumber));\n  });\n  const sortedAllWeeks = Array.from(allWeeks).sort((a, b) => a - b);\n  const groups = new Map();\n\n  function addItem(it) {\n    if (!it) return;\n    let block = '_';\n    let week = '_';\n    if (Array.isArray(it.lectures) && it.lectures.length) {\n      let bestOrd = Infinity;\n      let bestWeek = -Infinity;\n      let bestLec = -Infinity;\n      it.lectures.forEach(l => {\n        if (!l) return;\n        const ord = orderMap.has(l.blockId) ? orderMap.get(l.blockId) : Infinity;\n        if (\n          ord < bestOrd ||\n          (ord === bestOrd && (l.week > bestWeek || (l.week === bestWeek && l.id > bestLec)))\n        ) {\n          block = l.blockId;\n          week = l.week;\n          bestOrd = ord;\n          bestWeek = l.week;\n          bestLec = l.id;\n        }\n      });\n    } else {\n      let bestOrd = Infinity;\n      (Array.isArray(it.blocks) ? it.blocks : []).forEach(id => {\n        const ord = orderMap.has(id) ? orderMap.get(id) : Infinity;\n        if (ord < bestOrd) {\n          block = id;\n          bestOrd = ord;\n        }\n      });\n      if (Array.isArray(it.weeks) && it.weeks.length) {\n        week = Math.max(...it.weeks);\n      }\n    }\n    if (!groups.has(block)) {\n      groups.set(block, new Map());\n    }\n    const wkMap = groups.get(block);\n    const current = wkMap.get(week) || [];\n    current.push(it);\n    wkMap.set(week, current);\n  }\n\n  if (itemSource) {\n    if (typeof itemSource?.[Symbol.asyncIterator] === 'function') {\n      for await (const batch of itemSource) {\n        if (Array.isArray(batch)) {\n          batch.forEach(addItem);\n        } else if (batch) {\n          addItem(batch);\n        }\n      }\n    } else if (typeof itemSource?.toArray === 'function') {\n      const collected = await itemSource.toArray();\n      collected.forEach(addItem);\n    } else if (Array.isArray(itemSource)) {\n      itemSource.forEach(addItem);\n    }\n  }\n\n  const sortedBlocks = Array.from(groups.keys()).sort((a,b)=>{\n    const ao = orderMap.has(a) ? orderMap.get(a) : Infinity;\n    const bo = orderMap.has(b) ? orderMap.get(b) : Infinity;\n    return ao - bo;\n  });\n  const layoutState = state.entryLayout;\n\n  const toolbar = document.createElement('div');\n  toolbar.className = 'entry-layout-toolbar';\n\n  const rawSort = state.filters?.sort;\n  const sortOptions = ['updated', 'created', 'lecture', 'name'];\n  let currentSortField = 'updated';\n  let currentSortDirection = 'desc';\n  if (typeof rawSort === 'string' && rawSort) {\n    const parts = rawSort.split('-');\n    if (parts.length === 1) {\n      currentSortField = sortOptions.includes(parts[0]) ? parts[0] : 'updated';\n    } else {\n      const [fieldPart, dirPart] = parts;\n      currentSortField = sortOptions.includes(fieldPart) ? fieldPart : 'updated';\n      currentSortDirection = dirPart === 'asc' ? 'asc' : 'desc';\n    }\n  } else if (rawSort && typeof rawSort === 'object') {\n    const mode = rawSort.mode;\n    const dir = rawSort.direction;\n    if (typeof mode === 'string' && sortOptions.includes(mode)) {\n      currentSortField = mode;\n    }\n    if (dir === 'asc' || dir === 'desc') {\n      currentSortDirection = dir;\n    }\n  }\n\n  const filterControls = document.createElement('div');\n  filterControls.className = 'entry-filter-controls';\n\n  const currentBlockFilter = typeof state.filters?.block === 'string' ? state.filters.block : '';\n  const currentWeekFilter = state.filters?.week ?? '';\n\n  const blockFilterLabel = document.createElement('label');\n  blockFilterLabel.className = 'entry-filter-select';\n  blockFilterLabel.textContent = 'Block';\n  const blockFilterSelect = document.createElement('select');\n  blockFilterSelect.className = 'entry-filter-block';\n  blockFilterSelect.setAttribute('aria-label', 'Filter entries by block');\n  const blockOptions = [\n    { value: '', label: 'All blocks' },\n    { value: '__unlabeled', label: 'Unlabeled' }\n  ];\n  blocks.forEach(block => {\n    if (!block) return;\n    blockOptions.push({ value: block.blockId, label: blockTitle(block.blockId) });\n  });\n  blockOptions.forEach(opt => {\n    const option = document.createElement('option');\n    option.value = opt.value;\n    option.textContent = opt.label;\n    blockFilterSelect.appendChild(option);\n  });\n  if (blockOptions.some(opt => opt.value === currentBlockFilter)) {\n    blockFilterSelect.value = currentBlockFilter;\n  } else {\n    blockFilterSelect.value = '';\n  }\n  blockFilterLabel.appendChild(blockFilterSelect);\n  filterControls.appendChild(blockFilterLabel);\n\n  const weekFilterLabel = document.createElement('label');\n  weekFilterLabel.className = 'entry-filter-select';\n  weekFilterLabel.textContent = 'Week';\n  const weekFilterSelect = document.createElement('select');\n  weekFilterSelect.className = 'entry-filter-week';\n  weekFilterSelect.setAttribute('aria-label', 'Filter entries by week');\n  weekFilterLabel.appendChild(weekFilterSelect);\n  filterControls.appendChild(weekFilterLabel);\n\n  function populateWeekFilter() {\n    const selectedBlock = blockFilterSelect.value;\n    weekFilterSelect.innerHTML = '';\n    const defaultOption = document.createElement('option');\n    defaultOption.value = '';\n    defaultOption.textContent = 'All weeks';\n    weekFilterSelect.appendChild(defaultOption);\n    if (selectedBlock === '__unlabeled') {\n      weekFilterSelect.disabled = true;\n      return;\n    }\n    weekFilterSelect.disabled = false;\n    const weeks = selectedBlock && blockWeekMap.has(selectedBlock)\n      ? blockWeekMap.get(selectedBlock)\n      : sortedAllWeeks;\n    if (!weeks.length) {\n      const none = document.createElement('option');\n      none.value = '';\n      none.textContent = selectedBlock ? 'No weeks available' : 'No weeks defined';\n      none.disabled = true;\n      weekFilterSelect.appendChild(none);\n      return;\n    }\n    weeks.forEach(weekNumber => {\n      const option = document.createElement('option');\n      option.value = String(weekNumber);\n      option.textContent = `Week ${weekNumber}`;\n      weekFilterSelect.appendChild(option);\n    });\n  }\n\n  toolbar.appendChild(filterControls);\n  populateWeekFilter();\n  const normalizedWeekFilter = currentWeekFilter === '' || currentWeekFilter == null\n    ? ''\n    : String(currentWeekFilter);\n  if (normalizedWeekFilter && weekFilterSelect.querySelector(`option[value=\"${normalizedWeekFilter}\"]`)) {\n    weekFilterSelect.value = normalizedWeekFilter;\n  } else {\n    weekFilterSelect.value = '';\n  }\n\n  blockFilterSelect.addEventListener('change', () => {\n    populateWeekFilter();\n    weekFilterSelect.value = '';\n    const nextBlock = blockFilterSelect.value || '';\n    const patch = { block: nextBlock, week: '' };\n    const currentBlockValue = state.filters.block || '';\n    const currentWeekValue = state.filters.week || '';\n    if (currentBlockValue !== patch.block || currentWeekValue !== patch.week) {\n      setFilters(patch);\n      onChange && onChange();\n    }\n  });\n\n  weekFilterSelect.addEventListener('change', () => {\n    if (weekFilterSelect.disabled) return;\n    const raw = weekFilterSelect.value;\n    const normalized = raw ? Number(raw) : '';\n    if (normalized !== '' && !Number.isFinite(normalized)) return;\n    const currentValue = state.filters.week ?? '';\n    const normalizedCurrent = currentValue === '' ? '' : Number(currentValue);\n    if (normalized === '' && currentValue === '') return;\n    if (normalized !== '' && String(normalizedCurrent) === String(normalized)) return;\n    setFilters({ week: normalized });\n    onChange && onChange();\n  });\n\n  const sortControls = document.createElement('div');\n  sortControls.className = 'sort-controls';\n\n  const sortLabel = document.createElement('label');\n  sortLabel.className = 'sort-select';\n  sortLabel.textContent = 'Sort by';\n\n  const sortSelect = document.createElement('select');\n  sortSelect.className = 'sort-field';\n  sortSelect.setAttribute('aria-label', 'Sort entries');\n  [\n    { value: 'updated', label: 'Date Modified' },\n    { value: 'created', label: 'Date Added' },\n    { value: 'lecture', label: 'Lecture Added' },\n    { value: 'name', label: 'Alphabetical' }\n  ].forEach(opt => {\n    const option = document.createElement('option');\n    option.value = opt.value;\n    option.textContent = opt.label;\n    sortSelect.appendChild(option);\n  });\n  sortSelect.value = currentSortField;\n  sortLabel.appendChild(sortSelect);\n  sortControls.appendChild(sortLabel);\n\n  const directionBtn = document.createElement('button');\n  directionBtn.type = 'button';\n  directionBtn.className = 'sort-direction-btn';\n  directionBtn.setAttribute('aria-label', 'Toggle sort direction');\n  directionBtn.setAttribute('title', 'Toggle sort direction');\n\n  function updateDirectionButton() {\n    directionBtn.dataset.direction = currentSortDirection;\n    directionBtn.textContent = currentSortDirection === 'asc' ? '\u2191 Asc' : '\u2193 Desc';\n  }\n\n  function applySortChange() {\n    const nextValue = `${currentSortField}-${currentSortDirection}`;\n    if (state.filters.sort === nextValue) return;\n    setFilters({ sort: nextValue });\n    onChange && onChange();\n  }\n\n  updateDirectionButton();\n\n  sortSelect.addEventListener('change', () => {\n    const selected = sortSelect.value;\n    currentSortField = sortOptions.includes(selected) ? selected : 'updated';\n    applySortChange();\n  });\n\n  directionBtn.addEventListener('click', () => {\n    currentSortDirection = currentSortDirection === 'asc' ? 'desc' : 'asc';\n    updateDirectionButton();\n    applySortChange();\n  });\n\n  sortControls.appendChild(directionBtn);\n  toolbar.appendChild(sortControls);\n\n  const viewToggle = document.createElement('div');\n  viewToggle.className = 'layout-toggle';\n\n  const listBtn = document.createElement('button');\n  listBtn.type = 'button';\n  listBtn.className = 'layout-btn';\n  setToggleState(listBtn, layoutState.mode === 'list');\n  listBtn.textContent = 'List';\n  listBtn.addEventListener('click', () => {\n    if (layoutState.mode === 'list') return;\n    setEntryLayout({ mode: 'list' });\n    updateToolbar();\n    applyLayout();\n  });\n\n  const gridBtn = document.createElement('button');\n  gridBtn.type = 'button';\n  gridBtn.className = 'layout-btn';\n  setToggleState(gridBtn, layoutState.mode === 'grid');\n  gridBtn.textContent = 'Grid';\n  gridBtn.addEventListener('click', () => {\n    if (layoutState.mode === 'grid') return;\n    setEntryLayout({ mode: 'grid' });\n    updateToolbar();\n    applyLayout();\n  });\n\n  viewToggle.appendChild(listBtn);\n  viewToggle.appendChild(gridBtn);\n  toolbar.appendChild(viewToggle);\n\n  const controlsToggle = document.createElement('button');\n  controlsToggle.type = 'button';\n  controlsToggle.className = 'layout-advanced-toggle';\n  setToggleState(controlsToggle, layoutState.controlsVisible);\n  controlsToggle.addEventListener('click', () => {\n    setEntryLayout({ controlsVisible: !state.entryLayout.controlsVisible });\n    updateToolbar();\n  });\n  toolbar.appendChild(controlsToggle);\n\n  const controlsWrap = document.createElement('div');\n  controlsWrap.className = 'layout-controls';\n  const controlsId = `layout-controls-${Math.random().toString(36).slice(2, 8)}`;\n  controlsWrap.id = controlsId;\n  controlsToggle.setAttribute('aria-controls', controlsId);\n  toolbar.appendChild(controlsWrap);\n\n  const columnWrap = document.createElement('label');\n  columnWrap.className = 'layout-control';\n  columnWrap.textContent = 'Columns';\n  const columnInput = document.createElement('input');\n  columnInput.type = 'range';\n  columnInput.min = '1';\n  columnInput.max = '6';\n  columnInput.step = '1';\n  columnInput.value = String(layoutState.columns);\n  const columnValue = document.createElement('span');\n  columnValue.className = 'layout-value';\n  columnValue.textContent = String(layoutState.columns);\n  columnInput.addEventListener('input', () => {\n    setEntryLayout({ columns: Number(columnInput.value) });\n    columnValue.textContent = String(state.entryLayout.columns);\n    applyLayout();\n  });\n  columnWrap.appendChild(columnInput);\n  columnWrap.appendChild(columnValue);\n  controlsWrap.appendChild(columnWrap);\n\n  const scaleWrap = document.createElement('label');\n  scaleWrap.className = 'layout-control';\n  scaleWrap.textContent = 'Scale';\n  const scaleInput = document.createElement('input');\n  scaleInput.type = 'range';\n  scaleInput.min = '0.6';\n  scaleInput.max = '1.4';\n  scaleInput.step = '0.05';\n  scaleInput.value = String(layoutState.scale);\n  const scaleValue = document.createElement('span');\n  scaleValue.className = 'layout-value';\n  scaleValue.textContent = `${layoutState.scale.toFixed(2)}x`;\n  scaleInput.addEventListener('input', () => {\n    setEntryLayout({ scale: Number(scaleInput.value) });\n    scaleValue.textContent = `${state.entryLayout.scale.toFixed(2)}x`;\n    applyLayout();\n  });\n  scaleWrap.appendChild(scaleInput);\n  scaleWrap.appendChild(scaleValue);\n  controlsWrap.appendChild(scaleWrap);\n\n  container.appendChild(toolbar);\n\n  function updateToolbar(){\n    const { mode, controlsVisible } = state.entryLayout;\n    setToggleState(listBtn, mode === 'list');\n    setToggleState(gridBtn, mode === 'grid');\n    columnWrap.style.display = mode === 'grid' ? '' : 'none';\n    controlsWrap.style.display = controlsVisible ? '' : 'none';\n    controlsWrap.setAttribute('aria-hidden', controlsVisible ? 'false' : 'true');\n    controlsToggle.textContent = controlsVisible ? 'Hide layout tools' : 'Show layout tools';\n    controlsToggle.setAttribute('aria-expanded', controlsVisible ? 'true' : 'false');\n    setToggleState(controlsToggle, controlsVisible);\n  }\n\n  function applyLayout(){\n    const lists = container.querySelectorAll('.card-list');\n    lists.forEach(list => {\n      list.classList.toggle('grid-layout', state.entryLayout.mode === 'grid');\n      list.style.setProperty('--entry-scale', state.entryLayout.scale);\n      list.style.setProperty('--entry-columns', state.entryLayout.columns);\n    });\n  }\n\n  updateToolbar();\n\n  const blockKeys = sortedBlocks.map(b => String(b));\n  function applyBlockActivation(nextKey) {\n    const candidate = nextKey && blockKeys.includes(nextKey) ? nextKey : null;\n    activeBlockKey = candidate;\n    collapsedBlocks.clear();\n    if (!activeBlockKey) {\n      blockKeys.forEach(key => collapsedBlocks.add(key));\n    } else {\n      blockKeys.forEach(key => {\n        if (key !== activeBlockKey) {\n          collapsedBlocks.add(key);\n        }\n      });\n    }\n  }\n\n  if (blockKeys.length) {\n    const initial = activeBlockKey && blockKeys.includes(activeBlockKey) ? activeBlockKey : blockKeys[0];\n    applyBlockActivation(initial);\n  } else {\n    applyBlockActivation(null);\n  }\n\n  const blockUpdaters = new Map();\n  const refreshBlocks = () => {\n    blockUpdaters.forEach(fn => fn());\n  };\n\n  sortedBlocks.forEach(b => {\n    const blockSec = document.createElement('section');\n    blockSec.className = 'block-section';\n    const blockHeader = document.createElement('button');\n    blockHeader.type = 'button';\n    blockHeader.className = 'block-header';\n    const blockLabel = b === '_' ? 'Unassigned' : blockTitle(b);\n    const blockKey = String(b);\n    const bdef = blocks.find(bl => bl.blockId === b);\n    if (bdef?.color) blockHeader.style.background = bdef.color;\n    function updateBlockState(){\n      const isCollapsed = collapsedBlocks.has(blockKey);\n      blockSec.classList.toggle('collapsed', isCollapsed);\n      blockHeader.textContent = `${isCollapsed ? '\u25B8' : '\u25BE'} ${blockLabel}`;\n      blockHeader.setAttribute('aria-expanded', String(!isCollapsed));\n    }\n    blockUpdaters.set(blockKey, updateBlockState);\n    updateBlockState();\n    blockHeader.addEventListener('click', () => {\n      const isCollapsed = collapsedBlocks.has(blockKey);\n      if (isCollapsed) {\n        applyBlockActivation(blockKey);\n      } else if (activeBlockKey === blockKey) {\n        applyBlockActivation(null);\n      } else {\n        collapsedBlocks.add(blockKey);\n      }\n      refreshBlocks();\n    });\n    blockSec.appendChild(blockHeader);\n    const wkMap = groups.get(b);\n    if (!wkMap) {\n      return;\n    }\n    const sortedWeeks = Array.from(wkMap.keys()).sort((a,b)=>{\n      if (a === '_' && b !== '_') return 1;\n      if (b === '_' && a !== '_') return -1;\n      return Number(b) - Number(a);\n    });\n    sortedWeeks.forEach(w => {\n      const weekSec = document.createElement('div');\n      weekSec.className = 'week-section';\n      const weekHeader = document.createElement('button');\n      weekHeader.type = 'button';\n      weekHeader.className = 'week-header';\n      const weekLabel = w === '_' ? 'Unassigned' : `Week ${w}`;\n      const weekKey = `${blockKey}__${w}`;\n      function updateWeekState(){\n        const isCollapsed = collapsedWeeks.has(weekKey);\n        weekSec.classList.toggle('collapsed', isCollapsed);\n        weekHeader.textContent = `${isCollapsed ? '\u25B8' : '\u25BE'} ${weekLabel}`;\n        weekHeader.setAttribute('aria-expanded', String(!isCollapsed));\n      }\n      updateWeekState();\n      weekHeader.addEventListener('click', () => {\n        if (collapsedWeeks.has(weekKey)) collapsedWeeks.delete(weekKey); else collapsedWeeks.add(weekKey);\n        updateWeekState();\n      });\n      weekSec.appendChild(weekHeader);\n      const list = document.createElement('div');\n      list.className = 'card-list';\n      list.style.setProperty('--entry-scale', state.entryLayout.scale);\n      list.style.setProperty('--entry-columns', state.entryLayout.columns);\n      list.classList.toggle('grid-layout', state.entryLayout.mode === 'grid');\n      const rows = wkMap.get(w) || [];\n      function renderChunk(start = 0) {\n        if (!rows.length) return;\n        const slice = rows.slice(start, start + 200);\n        if (!slice.length) return;\n        const fragment = document.createDocumentFragment();\n        slice.forEach(it => {\n          fragment.appendChild(createItemCard(it, onChange));\n        });\n        list.appendChild(fragment);\n        if (start + 200 < rows.length) requestAnimationFrame(() => renderChunk(start + 200));\n      }\n      renderChunk();\n      weekSec.appendChild(list);\n      blockSec.appendChild(weekSec);\n    });\n    container.appendChild(blockSec);\n  });\n\n  applyLayout();\n}\n", "import { state, setCardsState } from '../../state.js';\nimport { renderRichText } from './rich-text.js';\nimport { openEditor } from './editor.js';\nimport { loadBlockCatalog } from '../../storage/block-catalog.js';\n\nconst UNASSIGNED_BLOCK_KEY = '__unassigned__';\nconst MISC_LECTURE_KEY = '__misc__';\n\nconst KIND_COLORS = {\n  disease: 'var(--pink)',\n  drug: 'var(--blue)',\n  concept: 'var(--green)'\n};\n\nconst KIND_FIELDS = {\n  disease: [\n    ['etiology', 'Etiology', '\uD83E\uDDEC'],\n    ['pathophys', 'Pathophys', '\u2699\uFE0F'],\n    ['clinical', 'Clinical', '\uD83E\uDE7A'],\n    ['diagnosis', 'Diagnosis', '\uD83D\uDD0E'],\n    ['treatment', 'Treatment', '\uD83D\uDC8A'],\n    ['complications', 'Complications', '\u26A0\uFE0F'],\n    ['mnemonic', 'Mnemonic', '\uD83E\uDDE0']\n  ],\n  drug: [\n    ['class', 'Class', '\uD83C\uDFF7\uFE0F'],\n    ['source', 'Source', '\uD83C\uDF31'],\n    ['moa', 'MOA', '\u2699\uFE0F'],\n    ['uses', 'Uses', '\uD83D\uDC8A'],\n    ['sideEffects', 'Side Effects', '\u26A0\uFE0F'],\n    ['contraindications', 'Contraindications', '\uD83D\uDEAB'],\n    ['mnemonic', 'Mnemonic', '\uD83E\uDDE0']\n  ],\n  concept: [\n    ['type', 'Type', '\uD83C\uDFF7\uFE0F'],\n    ['definition', 'Definition', '\uD83D\uDCD6'],\n    ['mechanism', 'Mechanism', '\u2699\uFE0F'],\n    ['clinicalRelevance', 'Clinical Relevance', '\uD83E\uDE7A'],\n    ['example', 'Example', '\uD83D\uDCDD'],\n    ['mnemonic', 'Mnemonic', '\uD83E\uDDE0']\n  ]\n};\n\nfunction formatWeekLabel(value) {\n  if (typeof value === 'number' && Number.isFinite(value)) {\n    return `Week ${value}`;\n  }\n  return 'Unscheduled';\n}\n\nconst TITLE_CACHE = new WeakMap();\n\nfunction titleFromItem(item) {\n  if (item && typeof item === 'object') {\n    if (TITLE_CACHE.has(item)) {\n      return TITLE_CACHE.get(item);\n    }\n    const title = item?.name || item?.concept || 'Untitled Card';\n    TITLE_CACHE.set(item, title);\n    return title;\n  }\n  return item?.name || item?.concept || 'Untitled Card';\n}\n\nfunction compareByCreation(a, b) {\n  const av = typeof a?.createdAt === 'number' ? a.createdAt : 0;\n  const bv = typeof b?.createdAt === 'number' ? b.createdAt : 0;\n  if (av !== bv) return av - bv;\n  const at = titleFromItem(a);\n  const bt = titleFromItem(b);\n  return at.localeCompare(bt);\n}\n\nfunction escapeHtml(str = '') {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction ensureExtras(item) {\n  if (Array.isArray(item?.extras) && item.extras.length) {\n    return item.extras;\n  }\n  if (item?.facts && item.facts.length) {\n    return [{\n      id: 'legacy-facts',\n      title: 'Highlights',\n      body: `<ul>${item.facts.map(f => `<li>${escapeHtml(f)}</li>`).join('')}</ul>`\n    }];\n  }\n  return [];\n}\n\nfunction getItemAccent(item) {\n  if (item?.color) return item.color;\n  if (item?.kind && KIND_COLORS[item.kind]) return KIND_COLORS[item.kind];\n  return 'var(--accent)';\n}\n\nfunction collectLectureColors(cards, limit = 5) {\n  if (!Array.isArray(cards) || !cards.length) {\n    return ['var(--accent)'];\n  }\n  const seen = new Set();\n  const colors = [];\n  for (const card of cards) {\n    const accent = getItemAccent(card);\n    if (!seen.has(accent)) {\n      seen.add(accent);\n      colors.push(accent);\n      if (colors.length >= limit) break;\n    }\n  }\n  if (!colors.length) colors.push('var(--accent)');\n  return colors.slice(0, Math.max(1, limit));\n}\n\nfunction buildGradient(colors) {\n  const palette = colors && colors.length ? colors : ['var(--accent)'];\n  if (palette.length === 1) {\n    const single = palette[0];\n    return `linear-gradient(135deg, ${single} 0%, color-mix(in srgb, ${single} 38%, transparent) 100%)`;\n  }\n  const stops = palette.map((color, idx) => {\n    const pct = palette.length === 1 ? 0 : Math.round((idx / (palette.length - 1)) * 100);\n    return `${color} ${pct}%`;\n  });\n  return `linear-gradient(135deg, ${stops.join(', ')})`;\n}\n\nfunction getLecturePalette(cards) {\n  const colors = collectLectureColors(cards);\n  return {\n    accent: colors[0] || 'var(--accent)',\n    colors,\n    gradient: buildGradient(colors)\n  };\n}\n\nfunction getLectureAccent(cards) {\n  return getLecturePalette(cards).accent;\n}\n\n\n\n/**\n * Render lecture-based decks combining all item types with block/week groupings.\n * @param {HTMLElement} container\n * @param {import('../../types.js').Item[]} items\n * @param {Function} onChange\n */\nexport async function renderCards(container, items, onChange) {\n  container.innerHTML = '';\n  container.classList.add('cards-tab');\n\n  const sortedItems = Array.isArray(items)\n    ? items.slice().sort(compareByCreation)\n    : [];\n\n  const { blocks: blockDefs } = await loadBlockCatalog();\n  const blockLookup = new Map(blockDefs.map(def => [def.blockId, def]));\n  const blockOrder = new Map(blockDefs.map((def, idx) => [def.blockId, idx]));\n\n  const itemLookup = new Map(sortedItems.map(item => [item.id, item]));\n  /** @type {Map<string, Array<{ block: any, week: any, lecture: any }>>} */\n  const deckContextLookup = new Map();\n\n  const cardsState = state.cards || {};\n  const stateInitialized = cardsState?.initialized === true;\n  const hasCollapsedBlockState = stateInitialized && Array.isArray(cardsState.collapsedBlocks);\n  const hasCollapsedWeekState = stateInitialized && Array.isArray(cardsState.collapsedWeeks);\n  const collapsedBlockSet = new Set(hasCollapsedBlockState ? cardsState.collapsedBlocks : []);\n  const collapsedWeekSet = new Set(hasCollapsedWeekState ? cardsState.collapsedWeeks : []);\n  const scheduleFrame = typeof requestAnimationFrame === 'function'\n    ? (cb => requestAnimationFrame(cb))\n    : (cb => setTimeout(cb, 16));\n  let persistHandle = 0;\n\n  function schedulePersist() {\n    if (persistHandle) return;\n    persistHandle = scheduleFrame(() => {\n      persistHandle = 0;\n      setCardsState({\n        collapsedBlocks: Array.from(collapsedBlockSet),\n        collapsedWeeks: Array.from(collapsedWeekSet)\n      });\n    });\n  }\n\n  function setBlockCollapsedState(key, collapsed) {\n    if (!key) return;\n    if (collapsed) {\n      if (!collapsedBlockSet.has(key)) {\n        collapsedBlockSet.add(key);\n        schedulePersist();\n      }\n    } else if (collapsedBlockSet.delete(key)) {\n      schedulePersist();\n    }\n  }\n\n  function setWeekCollapsedState(key, collapsed) {\n    if (!key) return;\n    if (collapsed) {\n      if (!collapsedWeekSet.has(key)) {\n        collapsedWeekSet.add(key);\n        schedulePersist();\n      }\n    } else if (collapsedWeekSet.delete(key)) {\n      schedulePersist();\n    }\n  }\n\n\n  /** @type {Map<string, { key:string, blockId:string|null, title:string, accent?:string|null, order:number, weeks:Map<string, any> }>} */\n  const blockBuckets = new Map();\n\n  function ensureBlock(blockId) {\n    const key = blockId || UNASSIGNED_BLOCK_KEY;\n    if (!blockBuckets.has(key)) {\n      const def = blockLookup.get(blockId);\n      const order = typeof blockId === 'string' ? (blockOrder.get(blockId) ?? 999) : 1200;\n      blockBuckets.set(key, {\n        key,\n        blockId: blockId || null,\n        title: def?.title || (blockId ? blockId : 'Unassigned'),\n        accent: def?.color || null,\n        order,\n        weeks: new Map()\n      });\n    }\n    return blockBuckets.get(key);\n  }\n\n  function ensureWeek(blockBucket, weekValue) {\n    const weekKey = weekValue == null ? 'none' : String(weekValue);\n    if (!blockBucket.weeks.has(weekKey)) {\n      blockBucket.weeks.set(weekKey, {\n        key: weekKey,\n        value: typeof weekValue === 'number' && Number.isFinite(weekValue) ? weekValue : null,\n        label: formatWeekLabel(weekValue),\n        order: typeof weekValue === 'number' && Number.isFinite(weekValue) ? weekValue : 999,\n        lectures: new Map()\n      });\n    }\n    return blockBucket.weeks.get(weekKey);\n  }\n\n  function ensureLecture(weekBucket, lectureKey, lectureName) {\n    if (!weekBucket.lectures.has(lectureKey)) {\n      weekBucket.lectures.set(lectureKey, {\n        key: lectureKey,\n        title: lectureName || 'Lecture',\n        cards: []\n      });\n    }\n    return weekBucket.lectures.get(lectureKey);\n  }\n\n  sortedItems.forEach(item => {\n    const lectureRefs = Array.isArray(item.lectures) ? item.lectures : [];\n    if (lectureRefs.length) {\n      lectureRefs.forEach(ref => {\n        const blockBucket = ensureBlock(ref.blockId);\n        const weekBucket = ensureWeek(blockBucket, ref.week);\n        const lectureKeyParts = [ref.blockId || blockBucket.key];\n        if (ref.id != null) lectureKeyParts.push(`lec-${ref.id}`);\n        if (ref.name) lectureKeyParts.push(ref.name);\n        const lectureKey = lectureKeyParts.join('::') || `${blockBucket.key}-${titleFromItem(item)}`;\n        const lecture = ensureLecture(weekBucket, lectureKey, ref.name || (ref.id != null ? `Lecture ${ref.id}` : 'Lecture'));\n        if (!lecture.cards.includes(item)) {\n          lecture.cards.push(item);\n        }\n      });\n    } else if (Array.isArray(item.blocks) && item.blocks.length) {\n      item.blocks.forEach(blockId => {\n        const blockBucket = ensureBlock(blockId);\n        const weeks = Array.isArray(item.weeks) && item.weeks.length ? item.weeks : [null];\n        weeks.forEach(weekVal => {\n          const weekBucket = ensureWeek(blockBucket, weekVal);\n          const lecture = ensureLecture(weekBucket, `${blockBucket.key}::${MISC_LECTURE_KEY}`, 'Ungrouped Items');\n          lecture.cards.push(item);\n        });\n      });\n    } else {\n      const blockBucket = ensureBlock(null);\n      const weekBucket = ensureWeek(blockBucket, null);\n      const lecture = ensureLecture(weekBucket, `${blockBucket.key}::${MISC_LECTURE_KEY}`, 'Unassigned Items');\n      lecture.cards.push(item);\n    }\n  });\n\n  const blockSections = Array.from(blockBuckets.values())\n    .map(block => {\n      const weeks = Array.from(block.weeks.values())\n        .map(week => {\n          const lectures = Array.from(week.lectures.values())\n            .map(lec => {\n              const cards = lec.cards.slice().sort(compareByCreation);\n              return {\n                ...lec,\n                cards,\n                palette: getLecturePalette(cards)\n              };\n            })\n            .filter(lec => lec.cards.length > 0)\n            .sort((a, b) => a.title.localeCompare(b.title));\n          const totalCards = lectures.reduce((sum, lec) => sum + lec.cards.length, 0);\n          return {\n            ...week,\n            lectures,\n            totalCards,\n            lectureCount: lectures.length\n          };\n        })\n        .filter(week => week.totalCards > 0)\n        .sort((a, b) => {\n          const aValue = Number.isFinite(a.value) ? a.value : -Infinity;\n          const bValue = Number.isFinite(b.value) ? b.value : -Infinity;\n          if (aValue !== bValue) return bValue - aValue;\n          return a.label.localeCompare(b.label);\n        });\n      const totalCards = weeks.reduce((sum, week) => sum + week.totalCards, 0);\n      const lectureCount = weeks.reduce((sum, week) => sum + week.lectureCount, 0);\n      return {\n        ...block,\n        weeks,\n        totalCards,\n        lectureCount\n      };\n    })\n    .filter(block => block.totalCards > 0)\n    .sort((a, b) => (a.order - b.order) || a.title.localeCompare(b.title));\n\n  blockSections.forEach(block => {\n    block.weeks.forEach(week => {\n      week.lectures.forEach(lecture => {\n        lecture.cards.forEach(card => {\n          if (!deckContextLookup.has(card.id)) {\n            deckContextLookup.set(card.id, []);\n          }\n          deckContextLookup.get(card.id).push({ block, week, lecture });\n        });\n      });\n    });\n  });\n\n  if (!hasCollapsedBlockState) {\n    blockSections.forEach(block => {\n      if (block?.key) collapsedBlockSet.add(block.key);\n    });\n    schedulePersist();\n  }\n\n  if (!hasCollapsedWeekState) {\n    blockSections.forEach(block => {\n      block.weeks.forEach(week => {\n        const key = `${block.key}::${week.key}`;\n        collapsedWeekSet.add(key);\n      });\n    });\n    schedulePersist();\n  }\n\n  const gridPayload = new WeakMap();\n  const activeGrids = new Set();\n  let gridPumpHandle = 0;\n  const getTime = typeof performance === 'object' && typeof performance.now === 'function'\n    ? () => performance.now()\n    : () => Date.now();\n\n  const eagerGridQueue = [];\n  const eagerGridSet = new Set();\n  let eagerGridFlushHandle = 0;\n\n  function requestEagerGrid(grid) {\n    if (!grid || eagerGridSet.has(grid)) return;\n    if (eagerGridQueue.length >= 6) return;\n    eagerGridQueue.push(grid);\n    eagerGridSet.add(grid);\n    if (eagerGridFlushHandle) return;\n    eagerGridFlushHandle = scheduleFrame(() => {\n      eagerGridFlushHandle = 0;\n      while (eagerGridQueue.length) {\n        const nextGrid = eagerGridQueue.shift();\n        eagerGridSet.delete(nextGrid);\n        if (!nextGrid || nextGrid.dataset.rendered === 'true') continue;\n        if (!nextGrid.isConnected) continue;\n        ensureGridRendered(nextGrid);\n      }\n    });\n  }\n\n  const deckTileObserver = typeof IntersectionObserver === 'function'\n    ? new IntersectionObserver(entries => {\n      entries.forEach(entry => {\n        if (entry.isIntersecting) {\n          deckTileObserver.unobserve(entry.target);\n          startGridRender(entry.target);\n        }\n      });\n    }, { rootMargin: '200px 0px' })\n    : null;\n\n  function scheduleGridPump() {\n    if (gridPumpHandle) return;\n    gridPumpHandle = requestAnimationFrame(() => {\n      gridPumpHandle = 0;\n      pumpGridRenders();\n    });\n  }\n\n  function startGridRender(grid) {\n    if (!grid || grid.dataset.rendered === 'true') return;\n    activeGrids.add(grid);\n    scheduleGridPump();\n  }\n\n  function renderGridChunk(grid) {\n    const payload = gridPayload.get(grid);\n    if (!payload) {\n      grid.dataset.rendered = 'true';\n      grid.classList.remove('is-loading');\n      return;\n    }\n    const { entries } = payload;\n    let { index = 0 } = payload;\n    const frag = document.createDocumentFragment();\n    const chunkStart = getTime();\n    let elapsed = 0;\n    while (index < entries.length && elapsed < 6) {\n      const { block, week, lecture } = entries[index++];\n      frag.appendChild(createDeckTile(block, week, lecture));\n      elapsed = getTime() - chunkStart;\n    }\n    payload.index = index;\n    grid.appendChild(frag);\n    if (index > 0) {\n      grid.classList.remove('is-loading');\n    }\n    if (index >= entries.length) {\n      grid.dataset.rendered = 'true';\n      grid.classList.remove('is-loading');\n      gridPayload.delete(grid);\n    }\n  }\n\n  function pumpGridRenders() {\n    if (!activeGrids.size) return;\n    const iterator = Array.from(activeGrids);\n    const frameStart = getTime();\n    for (const grid of iterator) {\n      renderGridChunk(grid);\n      if (grid.dataset.rendered === 'true') {\n        activeGrids.delete(grid);\n      }\n      if (getTime() - frameStart > 14) break;\n    }\n    if (activeGrids.size) {\n      scheduleGridPump();\n    }\n  }\n\n  function registerGrid(grid, entries, options = {}) {\n    grid.dataset.rendered = 'false';\n    grid.classList.add('is-loading');\n    gridPayload.set(grid, { entries, index: 0 });\n    const deferInitialRender = Boolean(options?.deferInitialRender);\n    if (!deferInitialRender) {\n      requestEagerGrid(grid);\n    }\n    if (deckTileObserver) {\n      requestAnimationFrame(() => {\n        if (grid.dataset.rendered === 'true') return;\n        deckTileObserver.observe(grid);\n      });\n    } else if (!deferInitialRender) {\n      startGridRender(grid);\n    }\n  }\n\n  function ensureGridRendered(grid) {\n    if (!grid || grid.dataset.rendered === 'true') return;\n    if (deckTileObserver) {\n      deckTileObserver.unobserve(grid);\n    }\n    startGridRender(grid);\n  }\n\n  const catalog = document.createElement('div');\n  catalog.className = 'card-catalog';\n  container.appendChild(catalog);\n\n  const overlay = document.createElement('div');\n  overlay.className = 'deck-overlay';\n  overlay.dataset.active = 'false';\n  overlay.setAttribute('role', 'dialog');\n  overlay.setAttribute('aria-modal', 'true');\n  const viewer = document.createElement('div');\n  viewer.className = 'deck-viewer';\n  overlay.appendChild(viewer);\n  container.appendChild(overlay);\n\n  let activeKeyHandler = null;\n  let persistRelatedVisibility = false;\n  let deckDirty = false;\n\n  function closeDeck() {\n    overlay.dataset.active = 'false';\n    viewer.innerHTML = '';\n    viewer.className = 'deck-viewer';\n    if (activeKeyHandler) {\n      document.removeEventListener('keydown', activeKeyHandler);\n      activeKeyHandler = null;\n    }\n    persistRelatedVisibility = false;\n    if (deckDirty && typeof onChange === 'function') {\n      const result = onChange();\n      if (result && typeof result.catch === 'function') {\n        result.catch(() => {});\n      }\n    }\n    deckDirty = false;\n  }\n\n  overlay.addEventListener('click', evt => {\n    if (evt.target === overlay) closeDeck();\n  });\n\n  function openDeck(context, targetCardId = null) {\n    const { block, week, lecture } = context;\n    overlay.dataset.active = 'true';\n    viewer.innerHTML = '';\n    if (activeKeyHandler) {\n      document.removeEventListener('keydown', activeKeyHandler);\n      activeKeyHandler = null;\n    }\n\n    const baseContext = { block, week, lecture };\n    const slideCache = new WeakMap();\n\n    const handleCardEdited = item => {\n      deckDirty = true;\n      slideCache.delete(item);\n      if (lecture.cards[idx] === item) {\n        renderCard();\n      }\n    };\n\n    function prepareSlideActions(slide, item) {\n      if (!slide) return;\n      const editBtn = slide.querySelector('[data-role=\"deck-edit\"]');\n      if (editBtn) {\n        editBtn.addEventListener('click', () => {\n          openEditor(item.kind, () => handleCardEdited(item), item);\n        });\n      }\n    }\n\n    function acquireSlide(item) {\n      if (!slideCache.has(item)) {\n        slideCache.set(item, () => createDeckSlide(item, baseContext, { allowEdit: true }));\n      }\n      const factory = slideCache.get(item);\n      const slide = factory();\n      slide.classList.add('deck-slide-full');\n      prepareSlideActions(slide, item);\n      return slide;\n    }\n\n    viewer.className = 'deck-viewer deck-viewer-card';\n\n    const closeBtn = document.createElement('button');\n    closeBtn.type = 'button';\n    closeBtn.className = 'deck-close';\n    closeBtn.innerHTML = '<span aria-hidden=\"true\">\u00D7</span><span class=\"sr-only\">Close deck</span>';\n    closeBtn.addEventListener('click', closeDeck);\n    viewer.appendChild(closeBtn);\n\n    const summary = document.createElement('div');\n    summary.className = 'deck-card-summary';\n    const crumb = document.createElement('span');\n    crumb.className = 'deck-card-summary-crumb';\n    const crumbPieces = [];\n    if (block.title) crumbPieces.push(block.title);\n    if (week?.label) crumbPieces.push(week.label);\n    crumb.textContent = crumbPieces.join(' \u2022 ');\n    summary.appendChild(crumb);\n    const title = document.createElement('h2');\n    title.className = 'deck-card-summary-title';\n    title.textContent = lecture.title;\n    summary.appendChild(title);\n    const counter = document.createElement('span');\n    counter.className = 'deck-card-summary-counter';\n    counter.textContent = `Card 1 of ${lecture.cards.length}`;\n    summary.appendChild(counter);\n    viewer.appendChild(summary);\n\n    const stage = document.createElement('div');\n    stage.className = 'deck-card-stage-full';\n\n    const prev = document.createElement('button');\n    prev.type = 'button';\n    prev.className = 'deck-card-nav deck-card-nav-prev';\n    prev.innerHTML = '<span class=\"sr-only\">Previous card</span><svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14 18L8 12L14 6\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>';\n\n    const slideHolder = document.createElement('div');\n    slideHolder.className = 'deck-card-holder';\n\n    const next = document.createElement('button');\n    next.type = 'button';\n    next.className = 'deck-card-nav deck-card-nav-next';\n    next.innerHTML = '<span class=\"sr-only\">Next card</span><svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M10 6L16 12L10 18\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>';\n\n    stage.appendChild(prev);\n    stage.appendChild(slideHolder);\n    stage.appendChild(next);\n    viewer.appendChild(stage);\n\n    const relatedPanel = document.createElement('div');\n    relatedPanel.className = 'deck-related-panel';\n\n    const toggle = document.createElement('button');\n    toggle.type = 'button';\n    toggle.className = 'deck-related-toggle';\n    toggle.dataset.active = 'false';\n    toggle.textContent = 'Show related cards';\n    toggle.setAttribute('aria-expanded', 'false');\n    relatedPanel.appendChild(toggle);\n\n    const relatedWrapId = `deck-related-${Math.random().toString(36).slice(2)}`;\n    const relatedWrap = document.createElement('div');\n    relatedWrap.className = 'deck-related';\n    relatedWrap.dataset.visible = 'false';\n    relatedWrap.id = relatedWrapId;\n    relatedWrap.setAttribute('aria-hidden', 'true');\n    toggle.setAttribute('aria-controls', relatedWrapId);\n    relatedPanel.appendChild(relatedWrap);\n    viewer.appendChild(relatedPanel);\n\n    let idx = 0;\n    if (targetCardId != null) {\n      const initialIdx = lecture.cards.findIndex(card => card.id === targetCardId);\n      if (initialIdx >= 0) idx = initialIdx;\n    }\n\n    let showRelated = persistRelatedVisibility;\n\n\n\n    function updateToggle(current) {\n      const linkCount = Array.isArray(current?.links) ? current.links.length : 0;\n      const hasLinks = linkCount > 0;\n      toggle.disabled = !hasLinks;\n      toggle.dataset.active = showRelated && hasLinks ? 'true' : 'false';\n      toggle.setAttribute('aria-expanded', showRelated && hasLinks ? 'true' : 'false');\n      toggle.textContent = hasLinks\n        ? `${showRelated ? 'Hide' : 'Show'} related (${linkCount})`\n        : 'No related cards';\n    }\n\n    function renderRelated(current) {\n\n      relatedWrap.innerHTML = '';\n      if (!showRelated) {\n        relatedWrap.dataset.visible = 'false';\n        relatedWrap.setAttribute('aria-hidden', 'true');\n        toggle.dataset.active = 'false';\n        toggle.setAttribute('aria-expanded', 'false');\n        return;\n      }\n\n      const links = Array.isArray(current?.links) ? current.links : [];\n      links.forEach(link => {\n        const related = itemLookup.get(link.id);\n        if (related) {\n          relatedWrap.appendChild(createRelatedCard(related, baseContext));\n        }\n      });\n      const visible = relatedWrap.children.length > 0;\n      relatedWrap.dataset.visible = visible ? 'true' : 'false';\n      relatedWrap.setAttribute('aria-hidden', visible ? 'false' : 'true');\n      if (!visible) {\n        toggle.dataset.active = 'false';\n        toggle.setAttribute('aria-expanded', 'false');\n      }\n    }\n\n    function renderCard() {\n\n      const current = lecture.cards[idx];\n      slideHolder.innerHTML = '';\n      const slide = acquireSlide(current);\n      slideHolder.appendChild(slide);\n      const accent = getItemAccent(current);\n      viewer.style.setProperty('--deck-current-accent', accent);\n      counter.textContent = `Card ${idx + 1} of ${lecture.cards.length}`;\n      const multiple = lecture.cards.length > 1;\n      prev.disabled = !multiple;\n      next.disabled = !multiple;\n      updateToggle(current);\n      renderRelated(current);\n\n    }\n\n    prev.addEventListener('click', () => {\n      idx = (idx - 1 + lecture.cards.length) % lecture.cards.length;\n      renderCard();\n    });\n\n    next.addEventListener('click', () => {\n      idx = (idx + 1) % lecture.cards.length;\n      renderCard();\n    });\n\n    toggle.addEventListener('click', () => {\n      if (toggle.disabled) return;\n      showRelated = !showRelated;\n      persistRelatedVisibility = showRelated;\n\n      updateToggle(lecture.cards[idx]);\n      renderRelated(lecture.cards[idx]);\n\n    });\n\n    const keyHandler = event => {\n      if (event.key === 'ArrowLeft') {\n        event.preventDefault();\n        prev.click();\n      } else if (event.key === 'ArrowRight') {\n        event.preventDefault();\n        next.click();\n      } else if (event.key === 'Escape') {\n        event.preventDefault();\n        closeDeck();\n      }\n    };\n\n    document.addEventListener('keydown', keyHandler);\n    activeKeyHandler = keyHandler;\n\n    renderCard();\n    requestAnimationFrame(() => closeBtn.focus());\n\n  }\n\n  function createCollapseIcon() {\n    const icon = document.createElement('span');\n    icon.className = 'card-collapse-icon';\n    icon.innerHTML = '<svg viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M6 8L10 12L14 8\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>';\n    return icon;\n  }\n\n  function createDeckTile(block, week, lecture) {\n    const tile = document.createElement('button');\n    tile.type = 'button';\n    tile.className = 'deck-tile';\n    tile.setAttribute('aria-label', `${lecture.title} (${lecture.cards.length} cards)`);\n\n\n    const palette = lecture.palette || getLecturePalette(lecture.cards);\n    lecture.palette = palette;\n    const accent = palette.accent;\n\n\n    const stack = document.createElement('div');\n    stack.className = 'deck-stack';\n    stack.style.setProperty('--deck-accent', accent);\n    stack.style.setProperty('--deck-gradient', palette.gradient);\n    const preview = lecture.cards.slice(0, 4);\n\n    stack.style.setProperty('--spread', preview.length > 0 ? (preview.length - 1) / 2 : 0);\n    if (!preview.length) {\n      const placeholder = document.createElement('div');\n      placeholder.className = 'stack-card stack-card-empty';\n      placeholder.style.setProperty('--index', '0');\n      placeholder.textContent = 'No cards yet';\n      stack.appendChild(placeholder);\n    } else {\n      preview.forEach((card, idx) => {\n        const mini = document.createElement('div');\n        mini.className = 'stack-card';\n        mini.style.setProperty('--index', String(idx));\n        mini.textContent = titleFromItem(card);\n        stack.appendChild(mini);\n      });\n    }\n    tile.style.setProperty('--deck-accent', accent);\n    tile.style.setProperty('--deck-gradient', palette.gradient);\n    tile.appendChild(stack);\n\n    const info = document.createElement('div');\n    info.className = 'deck-info';\n\n    const count = document.createElement('span');\n    count.className = 'deck-count-pill';\n    count.textContent = `${lecture.cards.length} card${lecture.cards.length === 1 ? '' : 's'}`;\n\n    info.appendChild(count);\n\n    const label = document.createElement('h3');\n    label.className = 'deck-title';\n    label.textContent = lecture.title;\n    info.appendChild(label);\n\n    const meta = document.createElement('div');\n    meta.className = 'deck-meta';\n    const pieces = [];\n    if (block.title) pieces.push(block.title);\n    if (week?.label) pieces.push(week.label);\n    meta.textContent = pieces.join(' \u2022 ');\n    info.appendChild(meta);\n\n    tile.appendChild(info);\n\n    const open = () => openDeck({ block, week, lecture });\n    tile.addEventListener('click', open);\n    tile.addEventListener('keydown', evt => {\n      if (evt.key === 'Enter' || evt.key === ' ') {\n        evt.preventDefault();\n        open();\n      }\n    });\n\n    return tile;\n  }\n\n  function createMetaChip(text, icon) {\n    const chip = document.createElement('span');\n    chip.className = 'deck-chip';\n    if (icon) {\n      const iconEl = document.createElement('span');\n      iconEl.className = 'deck-chip-icon';\n      iconEl.textContent = icon;\n      chip.appendChild(iconEl);\n    }\n    const label = document.createElement('span');\n    label.className = 'deck-chip-label';\n    label.textContent = text;\n    chip.appendChild(label);\n    return chip;\n  }\n\n  function createDeckSlide(item, context, options = {}) {\n    const slide = document.createElement('article');\n    slide.className = 'deck-slide';\n    const accent = getItemAccent(item);\n    slide.style.setProperty('--slide-accent', accent);\n\n    const heading = document.createElement('header');\n    heading.className = 'deck-slide-header';\n\n    const crumb = document.createElement('div');\n    crumb.className = 'deck-slide-crumb';\n    const crumbPieces = [];\n    if (context.block?.title) crumbPieces.push(context.block.title);\n    if (context.week?.label) crumbPieces.push(context.week.label);\n    crumb.textContent = crumbPieces.join(' \u2022 ');\n    heading.appendChild(crumb);\n\n    if (options.allowEdit) {\n      const editBtn = document.createElement('button');\n      editBtn.type = 'button';\n      editBtn.className = 'deck-slide-edit';\n      editBtn.dataset.role = 'deck-edit';\n      editBtn.innerHTML = '<span class=\"deck-slide-edit-icon\">\u270F\uFE0F</span><span>Edit card</span>';\n      heading.appendChild(editBtn);\n    }\n\n    const title = document.createElement('h3');\n    title.className = 'deck-slide-title';\n    title.textContent = titleFromItem(item);\n    heading.appendChild(title);\n\n    const kind = document.createElement('span');\n    kind.className = 'deck-slide-kind';\n    kind.textContent = item.kind ? item.kind.toUpperCase() : 'CARD';\n    heading.appendChild(kind);\n\n    slide.appendChild(heading);\n\n    const meta = document.createElement('div');\n    meta.className = 'deck-slide-meta';\n    const seen = new Set();\n    const addMeta = (text, icon) => {\n      if (!text || seen.has(text)) return;\n      seen.add(text);\n      meta.appendChild(createMetaChip(text, icon));\n    };\n    if (context.block?.title) addMeta(context.block.title, '\uD83E\uDDED');\n    if (context.week?.label) addMeta(context.week.label, '\uD83D\uDCC6');\n    (item.blocks || []).forEach(blockId => {\n      const label = blockLookup.get(blockId)?.title || blockId;\n      addMeta(label, '\uD83E\uDDF1');\n    });\n    (item.weeks || []).forEach(weekValue => addMeta(`Week ${weekValue}`, '\uD83D\uDCC5'));\n    (item.lectures || []).forEach(lec => addMeta(lec.name || (lec.id != null ? `Lecture ${lec.id}` : ''), '\uD83D\uDCDA'));\n    if (meta.children.length) slide.appendChild(meta);\n\n    const sections = document.createElement('div');\n    sections.className = 'deck-slide-sections';\n    const buildContentSection = ({ labelText, iconText = '', bodyHtml = '', extra = false }) => {\n      const section = document.createElement('section');\n      section.className = 'deck-section';\n      if (extra) section.classList.add('deck-section-extra');\n      section.style.setProperty('--section-accent', accent);\n      section.classList.add('is-collapsed');\n\n      const headerBtn = document.createElement('button');\n      headerBtn.type = 'button';\n      headerBtn.className = 'deck-section-header';\n      headerBtn.setAttribute('aria-expanded', 'false');\n\n      const titleWrap = document.createElement('div');\n      titleWrap.className = 'deck-section-title';\n      if (iconText) {\n        const iconEl = document.createElement('span');\n        iconEl.className = 'deck-section-icon';\n        iconEl.textContent = iconText;\n        titleWrap.appendChild(iconEl);\n      }\n      const labelNode = document.createElement('span');\n      labelNode.textContent = labelText;\n      titleWrap.appendChild(labelNode);\n      headerBtn.appendChild(titleWrap);\n      headerBtn.appendChild(createCollapseIcon());\n\n      const bodyWrap = document.createElement('div');\n      bodyWrap.className = 'deck-section-body';\n      const content = document.createElement('div');\n      content.className = 'deck-section-content';\n      renderRichText(content, bodyHtml, { clozeMode: 'interactive' });\n      bodyWrap.appendChild(content);\n\n      section.appendChild(headerBtn);\n      section.appendChild(bodyWrap);\n\n      headerBtn.addEventListener('click', () => {\n        const collapsed = section.classList.toggle('is-collapsed');\n        headerBtn.setAttribute('aria-expanded', collapsed ? 'false' : 'true');\n      });\n\n      return section;\n    };\n\n    const defs = KIND_FIELDS[item.kind] || [];\n    defs.forEach(([field, label, icon]) => {\n      const value = item[field];\n      if (!value) return;\n      sections.appendChild(buildContentSection({ labelText: label, iconText: icon, bodyHtml: value }));\n    });\n\n    ensureExtras(item).forEach(extra => {\n      if (!extra?.body) return;\n      sections.appendChild(\n        buildContentSection({\n          labelText: extra.title || 'Additional Notes',\n          bodyHtml: extra.body,\n          extra: true\n        })\n      );\n    });\n\n    if (!sections.children.length) {\n      const empty = document.createElement('p');\n      empty.className = 'deck-section-empty';\n      empty.textContent = 'No detailed content yet for this card.';\n      sections.appendChild(empty);\n    }\n\n    slide.appendChild(sections);\n\n    return slide;\n  }\n\n  function resolveDeckContext(item, origin) {\n    const contexts = deckContextLookup.get(item.id);\n    if (!contexts || !contexts.length) return null;\n    if (origin?.lecture?.key) {\n      const lectureMatch = contexts.find(ctx => ctx.lecture.key === origin.lecture.key);\n      if (lectureMatch) return lectureMatch;\n    }\n    if (origin?.block?.key) {\n      const blockMatch = contexts.find(ctx => ctx.block.key === origin.block.key);\n      if (blockMatch) return blockMatch;\n    }\n    return contexts[0];\n  }\n\n  function createRelatedCard(item, originContext) {\n    const entry = document.createElement('button');\n    entry.type = 'button';\n    entry.className = 'related-card-chip';\n    const accent = getItemAccent(item);\n    entry.style.setProperty('--related-accent', accent);\n    entry.title = titleFromItem(item);\n\n    const heading = document.createElement('strong');\n    heading.className = 'related-card-title';\n    heading.textContent = titleFromItem(item);\n    entry.appendChild(heading);\n\n    const kind = document.createElement('span');\n    kind.className = 'related-card-kind';\n    kind.textContent = item.kind ? item.kind.toUpperCase() : '';\n    entry.appendChild(kind);\n\n    const target = resolveDeckContext(item, originContext);\n    if (!target) {\n      entry.disabled = true;\n      entry.classList.add('is-disabled');\n    } else {\n      entry.addEventListener('click', () => {\n        openDeck(target, item.id);\n      });\n    }\n\n    return entry;\n  }\n\n  function buildBlockSection(block) {\n    const section = document.createElement('section');\n    section.className = 'card-block-section';\n    const blockKey = block.key;\n    const firstLecture = block.weeks.find(week => week.lectures.length)?.lectures.find(lec => lec.cards.length);\n    const blockAccent = block.accent || getLectureAccent(firstLecture?.cards || []);\n    if (blockAccent) section.style.setProperty('--block-accent', blockAccent);\n\n\n    const header = document.createElement('button');\n    header.type = 'button';\n    header.className = 'card-block-header';\n    const blockInitiallyCollapsed = collapsedBlockSet.has(blockKey);\n    header.setAttribute('aria-expanded', blockInitiallyCollapsed ? 'false' : 'true');\n\n    const heading = document.createElement('div');\n    heading.className = 'card-block-heading';\n\n    const swatch = document.createElement('span');\n    swatch.className = 'card-block-mark';\n    heading.appendChild(swatch);\n\n    const title = document.createElement('span');\n    title.className = 'card-block-title';\n    title.textContent = block.title;\n    heading.appendChild(title);\n\n    header.appendChild(heading);\n\n    const stats = document.createElement('span');\n    stats.className = 'card-block-stats';\n    stats.textContent = `${block.lectureCount} lecture${block.lectureCount === 1 ? '' : 's'} \u2022 ${block.totalCards} card${block.totalCards === 1 ? '' : 's'}`;\n    header.appendChild(stats);\n\n    const icon = createCollapseIcon();\n    header.appendChild(icon);\n\n    section.appendChild(header);\n\n    const body = document.createElement('div');\n    body.className = 'card-block-body';\n    section.appendChild(body);\n\n    if (blockInitiallyCollapsed) {\n      section.classList.add('is-collapsed');\n    }\n\n    let blockWeekGrids = [];\n\n    function populateBody() {\n      if (body.dataset.populated === 'true') return;\n      body.dataset.populated = 'true';\n      const frag = document.createDocumentFragment();\n      const grids = [];\n\n      block.weeks.forEach(week => {\n        const weekSection = document.createElement('div');\n        weekSection.className = 'card-week-section';\n\n        const weekAccent = getLectureAccent(week.lectures.find(lec => lec.cards.length)?.cards || []);\n        if (weekAccent) weekSection.style.setProperty('--week-accent', weekAccent);\n\n        const weekHeader = document.createElement('button');\n        weekHeader.type = 'button';\n        weekHeader.className = 'card-week-header';\n        const weekStateKey = `${blockKey}::${week.key}`;\n        const weekInitiallyCollapsed = collapsedWeekSet.has(weekStateKey) && hasCollapsedWeekState;\n        weekHeader.setAttribute('aria-expanded', weekInitiallyCollapsed ? 'false' : 'true');\n\n        const weekTitle = document.createElement('span');\n        weekTitle.className = 'card-week-title';\n        weekTitle.textContent = week.label;\n        weekHeader.appendChild(weekTitle);\n\n        const weekStats = document.createElement('span');\n        weekStats.className = 'card-week-stats';\n        weekStats.textContent = `${week.lectureCount} lecture${week.lectureCount === 1 ? '' : 's'} \u2022 ${week.totalCards} card${week.totalCards === 1 ? '' : 's'}`;\n        weekHeader.appendChild(weekStats);\n\n        weekHeader.appendChild(createCollapseIcon());\n\n        const deckGrid = document.createElement('div');\n        deckGrid.className = 'deck-grid';\n        registerGrid(deckGrid, week.lectures.map(lecture => ({ block, week, lecture })), {\n          deferInitialRender: weekInitiallyCollapsed\n        });\n\n        if (weekInitiallyCollapsed) {\n          weekSection.classList.add('is-collapsed');\n        }\n\n        grids.push({ grid: deckGrid, section: weekSection });\n\n        weekSection.appendChild(weekHeader);\n        weekSection.appendChild(deckGrid);\n\n        frag.appendChild(weekSection);\n\n        weekHeader.addEventListener('click', () => {\n          const collapsed = weekSection.classList.toggle('is-collapsed');\n          weekHeader.setAttribute('aria-expanded', collapsed ? 'false' : 'true');\n          setWeekCollapsedState(weekStateKey, collapsed);\n          if (!collapsed) {\n            ensureGridRendered(deckGrid);\n          }\n        });\n      });\n\n      blockWeekGrids = grids;\n      body.appendChild(frag);\n    }\n\n    function ensureVisibleWeekGrids() {\n      blockWeekGrids.forEach(({ grid, section: weekSection }) => {\n        if (!weekSection.classList.contains('is-collapsed')) {\n          ensureGridRendered(grid);\n        }\n      });\n    }\n\n    if (!blockInitiallyCollapsed) {\n      populateBody();\n      requestAnimationFrame(ensureVisibleWeekGrids);\n    }\n\n    header.addEventListener('click', () => {\n      const collapsed = section.classList.toggle('is-collapsed');\n      header.setAttribute('aria-expanded', collapsed ? 'false' : 'true');\n      setBlockCollapsedState(blockKey, collapsed);\n      if (!collapsed) {\n        populateBody();\n        ensureVisibleWeekGrids();\n      }\n    });\n\n    return section;\n  }\n\n  if (!blockSections.length) {\n    const empty = document.createElement('div');\n    empty.className = 'cards-empty';\n    const heading = document.createElement('h3');\n    heading.textContent = 'No cards match your filters yet';\n    empty.appendChild(heading);\n    const body = document.createElement('p');\n    body.textContent = 'Assign lectures, blocks, or create new entries to populate this view.';\n    empty.appendChild(body);\n    catalog.appendChild(empty);\n    return;\n  }\n\n  const renderQueue = blockSections.slice();\n\n  function pump() {\n    const start = getTime();\n    const frag = document.createDocumentFragment();\n    let appended = 0;\n    let elapsed = 0;\n    while (renderQueue.length && elapsed < 12) {\n      frag.appendChild(buildBlockSection(renderQueue.shift()));\n      appended += 1;\n      elapsed = getTime() - start;\n    }\n    if (appended) {\n      catalog.appendChild(frag);\n    }\n    if (renderQueue.length) {\n      requestAnimationFrame(pump);\n    }\n  }\n\n  pump();\n\n}\n", "import { state, setStudySessions, setStudySessionEntry, clearStudySessionsState } from '../state.js';\nimport { listStudySessions, saveStudySessionRecord, deleteStudySessionRecord, clearAllStudySessionRecords } from '../storage/storage.js';\nimport { deepClone } from '../utils.js';\n\nlet pendingLoad = null;\n\nfunction clone(value) {\n  if (value === undefined) return null;\n  return deepClone(value);\n}\n\nfunction safeClone(value, fallback = null) {\n  try {\n    const result = clone(value);\n    if (result === null && fallback !== undefined) {\n      return clone(fallback ?? null);\n    }\n    return result;\n  } catch (err) {\n    console.warn('Failed to clone study session value', err);\n    if (fallback === undefined) return null;\n    try {\n      return clone(fallback ?? null);\n    } catch (_) {\n      if (Array.isArray(fallback)) return [];\n      if (fallback && typeof fallback === 'object') return {};\n      return fallback ?? null;\n    }\n  }\n}\n\nfunction sanitizeRatings(map) {\n  if (!map || typeof map !== 'object' || Array.isArray(map)) return {};\n  const next = {};\n  Object.entries(map).forEach(([key, value]) => {\n    if (typeof key !== 'string') return;\n    if (typeof value === 'string') {\n      next[key] = value;\n    }\n  });\n  return next;\n}\n\nfunction sanitizeAnswers(map) {\n  if (!map || typeof map !== 'object' || Array.isArray(map)) return {};\n  const next = {};\n  Object.entries(map).forEach(([key, value]) => {\n    if (typeof key !== 'string' || !value || typeof value !== 'object') return;\n    const entry = {\n      value: typeof value.value === 'string' ? value.value : '',\n      isCorrect: Boolean(value.isCorrect),\n      checked: Boolean(value.checked),\n      revealed: Boolean(value.revealed)\n    };\n    next[key] = entry;\n  });\n  return next;\n}\n\nfunction sanitizePoolEntry(entry) {\n  if (entry === null || entry === undefined) return null;\n  if (typeof entry !== 'object') return entry;\n  return safeClone(entry, {});\n}\n\nfunction sanitizeSession(mode, session) {\n  const source = safeClone(session, {});\n  const next = source && typeof source === 'object' ? source : {};\n  delete next.dict;\n  if (Array.isArray(next.pool)) {\n    next.pool = next.pool.map(item => sanitizePoolEntry(item)).filter(item => item !== null && item !== undefined);\n  } else {\n    next.pool = [];\n  }\n  if (typeof next.idx !== 'number' || Number.isNaN(next.idx)) {\n    next.idx = 0;\n  }\n  next.idx = next.pool.length ? Math.max(0, Math.min(Math.floor(next.idx), next.pool.length - 1)) : 0;\n  if (next.answers && typeof next.answers === 'object' && !Array.isArray(next.answers)) {\n    next.answers = sanitizeAnswers(next.answers);\n  } else if (next.answers !== undefined) {\n    next.answers = {};\n  }\n  if (next.ratings && typeof next.ratings === 'object' && !Array.isArray(next.ratings)) {\n    next.ratings = sanitizeRatings(next.ratings);\n  } else {\n    next.ratings = {};\n  }\n  if (mode === 'review') {\n    next.mode = 'review';\n  } else if (typeof next.mode !== 'string' || next.mode !== 'review') {\n    next.mode = 'study';\n  }\n  return next;\n}\n\nfunction sanitizeCohort(list) {\n  const cloned = safeClone(list, []);\n  if (!Array.isArray(cloned)) return [];\n  return cloned.map(item => sanitizePoolEntry(item)).filter(item => item !== null && item !== undefined);\n}\n\nfunction sanitizeMetadata(meta) {\n  const cloned = safeClone(meta, {});\n  return cloned && typeof cloned === 'object' && !Array.isArray(cloned) ? cloned : {};\n}\n\nexport async function hydrateStudySessions(force = false) {\n  if (!force && state.studySessionsLoaded) {\n    return state.studySessions || {};\n  }\n  if (!pendingLoad) {\n    pendingLoad = listStudySessions().then(entries => {\n      const map = {};\n      entries.forEach(entry => {\n        if (entry && entry.mode) {\n          map[entry.mode] = {\n            mode: entry.mode,\n            updatedAt: entry.updatedAt || Date.now(),\n            session: sanitizeSession(entry.mode, entry.session),\n            cohort: sanitizeCohort(entry.cohort),\n            metadata: sanitizeMetadata(entry.metadata)\n          };\n        }\n      });\n      setStudySessions(map);\n      return state.studySessions;\n    }).catch(err => {\n      console.error('Failed to load study sessions', err);\n      clearStudySessionsState();\n      setStudySessions({});\n      return state.studySessions;\n    }).finally(() => {\n      pendingLoad = null;\n    });\n  }\n  return pendingLoad;\n}\n\nexport function getStudySessionEntry(mode) {\n  return (state.studySessions && state.studySessions[mode]) || null;\n}\n\nexport async function persistStudySession(mode, payload) {\n  if (!mode) throw new Error('Mode is required to save study session');\n  const entry = {\n    mode,\n    updatedAt: Date.now(),\n    session: sanitizeSession(mode, payload?.session ?? {}),\n    cohort: sanitizeCohort(payload?.cohort ?? []),\n    metadata: sanitizeMetadata(payload?.metadata ?? {})\n  };\n  await saveStudySessionRecord(entry);\n  setStudySessionEntry(mode, entry);\n  return entry;\n}\n\nexport async function removeStudySession(mode) {\n  if (!mode) return;\n  await deleteStudySessionRecord(mode);\n  setStudySessionEntry(mode, null);\n}\n\nexport async function removeAllStudySessions() {\n  await clearAllStudySessionRecords();\n  setStudySessions({});\n}\n", "const SECTION_DEFS = {\n  disease: [\n    { key: 'etiology', label: 'Etiology' },\n    { key: 'pathophys', label: 'Pathophys' },\n    { key: 'clinical', label: 'Clinical Presentation' },\n    { key: 'diagnosis', label: 'Diagnosis' },\n    { key: 'treatment', label: 'Treatment' },\n    { key: 'complications', label: 'Complications' },\n    { key: 'mnemonic', label: 'Mnemonic' }\n  ],\n  drug: [\n    { key: 'moa', label: 'Mechanism' },\n    { key: 'uses', label: 'Uses' },\n    { key: 'sideEffects', label: 'Side Effects' },\n    { key: 'contraindications', label: 'Contraindications' },\n    { key: 'mnemonic', label: 'Mnemonic' }\n  ],\n  concept: [\n    { key: 'definition', label: 'Definition' },\n    { key: 'mechanism', label: 'Mechanism' },\n    { key: 'clinicalRelevance', label: 'Clinical Relevance' },\n    { key: 'example', label: 'Example' },\n    { key: 'mnemonic', label: 'Mnemonic' }\n  ]\n};\n\nexport function sectionDefsForKind(kind) {\n  return SECTION_DEFS[kind] || [];\n}\n\nexport function allSectionDefs() {\n  return SECTION_DEFS;\n}\n", "import { sectionDefsForKind } from './sections.js';\nimport { hasRichTextContent } from './rich-text.js';\n\nexport const EXTRA_SECTION_PREFIX = 'extra:';\n\nfunction escapeHtml(str = '') {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction rawExtras(item) {\n  if (Array.isArray(item?.extras) && item.extras.length) {\n    return item.extras;\n  }\n  if (Array.isArray(item?.facts) && item.facts.length) {\n    return [{\n      id: 'legacy-facts',\n      title: 'Highlights',\n      body: `<ul>${item.facts.map(f => `<li>${escapeHtml(f)}</li>`).join('')}</ul>`\n    }];\n  }\n  return [];\n}\n\nfunction normalizeExtras(item) {\n  const extras = rawExtras(item);\n  const seenKeys = new Set();\n  return extras.map((extra, index) => {\n    const source = extra && typeof extra === 'object' ? extra : {};\n    const title = typeof source.title === 'string' ? source.title.trim() : '';\n    const body = typeof source.body === 'string' ? source.body : '';\n    let keyId = source.id != null && `${source.id}`.trim() ? `${source.id}`.trim() : `idx-${index}`;\n    let key = `${EXTRA_SECTION_PREFIX}${keyId}`;\n    let attempt = 0;\n    while (seenKeys.has(key)) {\n      attempt += 1;\n      key = `${EXTRA_SECTION_PREFIX}${keyId}-${attempt}`;\n    }\n    seenKeys.add(key);\n    return {\n      key,\n      id: source.id ?? null,\n      title,\n      body,\n      index,\n      source\n    };\n  });\n}\n\nfunction findExtraByKey(item, key) {\n  if (!key || !key.startsWith(EXTRA_SECTION_PREFIX)) return null;\n  return normalizeExtras(item).find(entry => entry.key === key) || null;\n}\n\nfunction hasRichContent(value) {\n  if (typeof document === 'undefined') {\n    if (value == null) return false;\n    const text = String(value)\n      .replace(/<[^>]*>/g, ' ')\n      .replace(/&nbsp;/g, ' ')\n      .trim();\n    return text.length > 0;\n  }\n  return hasRichTextContent(value);\n}\n\nexport function hasSectionContent(item, key) {\n  if (!item || !key) return false;\n  if (key.startsWith(EXTRA_SECTION_PREFIX)) {\n    const extra = findExtraByKey(item, key);\n    return extra ? hasRichContent(extra.body) : false;\n  }\n  const defs = sectionDefsForKind(item.kind);\n  if (!defs.some(def => def.key === key)) return false;\n  const raw = item[key];\n  if (raw === null || raw === undefined) return false;\n  return hasRichContent(raw);\n}\n\nexport function sectionsForItem(item, allowedKeys = null) {\n  const defs = sectionDefsForKind(item.kind);\n  const allowSet = allowedKeys ? new Set(allowedKeys) : null;\n  const sections = defs\n    .filter(def => (!allowSet || allowSet.has(def.key)) && hasSectionContent(item, def.key))\n    .map(def => ({ key: def.key, label: def.label, content: item?.[def.key] || '' }));\n\n  normalizeExtras(item).forEach(extra => {\n    if (!hasRichContent(extra.body)) return;\n    sections.push({\n      key: extra.key,\n      label: extra.title || 'Additional Notes',\n      content: extra.body,\n      extra: true,\n      extraId: extra.id\n    });\n  });\n\n  return sections;\n}\n\nexport function getSectionLabel(item, key) {\n  if (key && key.startsWith(EXTRA_SECTION_PREFIX)) {\n    const extra = findExtraByKey(item, key);\n    return extra ? (extra.title || 'Additional Notes') : key;\n  }\n  const defs = sectionDefsForKind(item.kind);\n  const def = defs.find(entry => entry.key === key);\n  return def ? def.label : key;\n}\n\nexport function getSectionContent(item, key) {\n  if (key && key.startsWith(EXTRA_SECTION_PREFIX)) {\n    const extra = findExtraByKey(item, key);\n    return extra ? extra.body || '' : '';\n  }\n  return item?.[key] || '';\n}\n", "import { getSettings } from '../storage/storage.js';\nimport { sectionsForItem, hasSectionContent, getSectionContent } from '../ui/components/section-utils.js';\nimport { DEFAULT_REVIEW_STEPS, REVIEW_RATINGS, RETIRE_RATING } from './constants.js';\nimport { normalizeReviewSteps } from './settings.js';\nimport { SR_VERSION, defaultSectionState, normalizeSectionRecord, normalizeSrRecord } from './sr-data.js';\n\nconst UNASSIGNED_LECTURE_TOKEN = '__unassigned|__none';\n\nfunction digestContent(value) {\n  if (value == null) return null;\n  const str = typeof value === 'string' ? value : JSON.stringify(value);\n  if (!str) return null;\n  let hash = 0;\n  for (let i = 0; i < str.length; i += 1) {\n    hash = (hash * 31 + str.charCodeAt(i)) >>> 0; // eslint-disable-line no-bitwise\n  }\n  return hash.toString(16);\n}\n\nfunction normalizeLectureScope(scope) {\n  if (!Array.isArray(scope) || !scope.length) return [];\n  const normalized = scope\n    .map(entry => (typeof entry === 'string' ? entry.trim() : ''))\n    .filter(Boolean);\n  return Array.from(new Set(normalized)).sort();\n}\n\nfunction computeLectureScope(item) {\n  if (!item || !Array.isArray(item.lectures) || !item.lectures.length) {\n    return [UNASSIGNED_LECTURE_TOKEN];\n  }\n  const tokens = item.lectures.map(lecture => {\n    if (!lecture || typeof lecture !== 'object') return '';\n    const blockId = lecture.blockId == null ? '' : String(lecture.blockId);\n    const id = lecture.id == null ? '' : String(lecture.id);\n    return `${blockId}|${id}`.trim();\n  });\n  return normalizeLectureScope(tokens);\n}\n\nfunction computeSectionDigest(item, key) {\n  if (!item || !key) return null;\n  const raw = getSectionContent(item, key);\n  return digestContent(raw);\n}\n\nlet cachedDurations = null;\n\nexport async function getReviewDurations() {\n  if (cachedDurations) return cachedDurations;\n  try {\n    const settings = await getSettings();\n    cachedDurations = normalizeReviewSteps(settings?.reviewSteps);\n  } catch (err) {\n    console.warn('Failed to load review settings, using defaults', err);\n    cachedDurations = { ...DEFAULT_REVIEW_STEPS };\n  }\n  return cachedDurations;\n}\n\nexport function invalidateReviewDurationsCache() {\n  cachedDurations = null;\n}\n\nexport function ensureItemSr(item) {\n  if (!item || typeof item !== 'object') return { version: SR_VERSION, sections: {} };\n  const sr = item.sr && typeof item.sr === 'object' ? item.sr : { version: SR_VERSION, sections: {} };\n  if (sr.version !== SR_VERSION || typeof sr.sections !== 'object' || !sr.sections) {\n    item.sr = normalizeSrRecord(sr);\n    return item.sr;\n  }\n  item.sr.sections = item.sr.sections || {};\n  return item.sr;\n}\n\nexport function ensureSectionState(item, key) {\n  const sr = ensureItemSr(item);\n  if (!sr.sections[key] || typeof sr.sections[key] !== 'object') {\n    sr.sections[key] = defaultSectionState();\n  } else {\n    sr.sections[key] = normalizeSectionRecord(sr.sections[key]);\n  }\n  return sr.sections[key];\n}\n\nexport function getSectionStateSnapshot(item, key) {\n  const sr = item?.sr;\n  if (!sr || typeof sr !== 'object') return null;\n  const entry = sr.sections && typeof sr.sections === 'object' ? sr.sections[key] : null;\n  if (!entry || typeof entry !== 'object') return null;\n  const normalized = normalizeSectionRecord(entry);\n  const digest = computeSectionDigest(item, key);\n  const scope = computeLectureScope(item);\n  const storedDigest = normalized.contentDigest;\n  const storedScope = normalizeLectureScope(normalized.lectureScope);\n  const removedLectures = storedScope.length ? storedScope.some(token => !scope.includes(token)) : false;\n  const contentChanged = storedDigest != null && digest != null && storedDigest !== digest;\n  if (contentChanged || removedLectures) {\n    const nowTs = Date.now();\n    normalized.streak = 0;\n    normalized.lastRating = null;\n    normalized.last = nowTs;\n    normalized.due = nowTs;\n    normalized.retired = false;\n  }\n  normalized.contentDigest = digest;\n  normalized.lectureScope = scope;\n  sr.sections[key] = normalized;\n  return normalized;\n}\n\nexport function rateSection(item, key, rating, durations, now = Date.now()) {\n  if (!item || !key) return null;\n  const steps = normalizeReviewSteps(durations);\n  if (rating === RETIRE_RATING) {\n    const section = ensureSectionState(item, key);\n    section.streak = 0;\n    section.lastRating = RETIRE_RATING;\n    section.last = now;\n    section.due = Number.MAX_SAFE_INTEGER;\n    section.retired = true;\n    section.contentDigest = computeSectionDigest(item, key);\n    section.lectureScope = computeLectureScope(item);\n    return section;\n  }\n  const normalizedRating = REVIEW_RATINGS.includes(rating) ? rating : 'good';\n  const section = ensureSectionState(item, key);\n  section.contentDigest = computeSectionDigest(item, key);\n  section.lectureScope = computeLectureScope(item);\n  let streak = Number.isFinite(section.streak) ? section.streak : 0;\n  switch (normalizedRating) {\n    case 'again':\n      streak = 0;\n      break;\n    case 'hard':\n      streak = Math.max(1, streak || 0);\n      break;\n    case 'good':\n      streak = (streak || 0) + 1;\n      break;\n    case 'easy':\n      streak = (streak || 0) + 2;\n      break;\n    default:\n      streak = (streak || 0) + 1;\n      break;\n  }\n  const baseMinutes = steps[normalizedRating] ?? DEFAULT_REVIEW_STEPS[normalizedRating];\n  const multiplier = normalizedRating === 'again' ? 1 : Math.max(1, streak || 1);\n  const intervalMinutes = baseMinutes * multiplier;\n  section.streak = streak;\n  section.lastRating = normalizedRating;\n  section.last = now;\n  section.retired = false;\n  section.due = now + Math.round(intervalMinutes * 60 * 1000);\n  return section;\n}\n\nexport function hasContentForSection(item, key) {\n  return hasSectionContent(item, key);\n}\n\nfunction collectReviewEntries(items, { now = Date.now(), predicate } = {}) {\n  const results = [];\n  if (!Array.isArray(items) || !items.length) return results;\n  for (const item of items) {\n    const sections = sectionsForItem(item);\n    for (const section of sections) {\n      const snapshot = getSectionStateSnapshot(item, section.key);\n      if (!snapshot || snapshot.retired) continue;\n      if (typeof predicate === 'function' && !predicate(snapshot, now, item, section)) continue;\n      results.push({\n        item,\n        itemId: item.id,\n        sectionKey: section.key,\n        sectionLabel: section.label,\n        due: snapshot.due\n      });\n    }\n  }\n  results.sort((a, b) => a.due - b.due);\n  return results;\n}\n\nexport function collectDueSections(items, { now = Date.now() } = {}) {\n  return collectReviewEntries(items, {\n    now,\n    predicate: (snapshot, currentNow) => Boolean(snapshot.last) && snapshot.due <= currentNow\n  });\n}\n\nexport function collectUpcomingSections(items, { now = Date.now(), limit = 50 } = {}) {\n  const entries = collectReviewEntries(items, {\n    now,\n    predicate: (snapshot, currentNow) => {\n      if (!snapshot.last) return false;\n      const due = snapshot.due;\n      if (!Number.isFinite(due)) return false;\n      if (due === Number.MAX_SAFE_INTEGER) return false;\n      return due > currentNow;\n    }\n  });\n  if (Number.isFinite(limit) && limit > 0) {\n    return entries.slice(0, limit);\n  }\n  return entries;\n}\n", "import { state } from '../state.js';\nimport { listItemsByKind } from '../storage/storage.js';\n\nconst DEFAULT_KINDS = ['disease', 'drug', 'concept'];\n\nexport async function loadReviewSourceItems() {\n  const existingCohort = Array.isArray(state.cohort) && state.cohort.length ? state.cohort : null;\n  if (existingCohort) {\n    return existingCohort;\n  }\n\n  const kinds = Array.isArray(state.builder?.types) && state.builder.types.length\n    ? state.builder.types\n    : DEFAULT_KINDS;\n\n  const seenIds = new Set();\n  const items = [];\n\n  for (const kind of kinds) {\n    try {\n      const entries = await listItemsByKind(kind);\n      if (!Array.isArray(entries)) continue;\n      for (const item of entries) {\n        if (!item) continue;\n        const id = item.id || `${kind}::${items.length}`;\n        if (seenIds.has(id)) continue;\n        seenIds.add(id);\n        items.push(item);\n      }\n    } catch (err) {\n      console.warn('Failed to load review items for kind', kind, err);\n    }\n  }\n\n  return items;\n}\n", "import { state, setBuilder, setCohort, resetBlockMode, setBlockMode, setSubtab, setFlashSession, setQuizSession, setStudySelectedMode, setTab } from '../../state.js';\nimport { listItemsByKind } from '../../storage/storage.js';\nimport { loadBlockCatalog } from '../../storage/block-catalog.js';\nimport { setToggleState } from '../../utils.js';\nimport { hydrateStudySessions, getStudySessionEntry, removeAllStudySessions, removeStudySession } from '../../study/study-sessions.js';\n\nimport { collectDueSections } from '../../review/scheduler.js';\nimport { loadReviewSourceItems } from '../../review/pool.js';\n\n\nconst MODE_KEY = {\n  Flashcards: 'flashcards',\n  Quiz: 'quiz',\n  Blocks: 'blocks'\n};\n\n\nlet lectureSource = {};\nlet builderBlockOrder = [];\nlet builderWeekMap = new Map();\n\nlet pendingCohortUpdate = null;\nlet lastAppliedSelectionSignature = null;\n\nfunction snapshotSelection() {\n  const types = Array.isArray(state.builder.types) ? [...state.builder.types] : [];\n  const blocks = Array.isArray(state.builder.blocks) ? [...state.builder.blocks] : [];\n  const lectures = Array.isArray(state.builder.lectures) ? [...state.builder.lectures] : [];\n  return {\n    types,\n    blocks,\n    lectures,\n    onlyFav: Boolean(state.builder.onlyFav)\n  };\n}\n\nfunction selectionSignature(selection) {\n  if (!selection || typeof selection !== 'object') return '';\n  const types = Array.isArray(selection.types) ? [...selection.types].sort() : [];\n  const blocks = Array.isArray(selection.blocks) ? [...selection.blocks].sort() : [];\n  const lectures = Array.isArray(selection.lectures) ? [...selection.lectures].sort() : [];\n  const onlyFav = selection.onlyFav ? 1 : 0;\n  return JSON.stringify({ types, blocks, lectures, onlyFav });\n}\n\nfunction ensureCohortSync({ force = false } = {}) {\n  const selection = snapshotSelection();\n  const signature = selectionSignature(selection);\n  if (!force && signature === lastAppliedSelectionSignature && Array.isArray(state.cohort)) {\n    return Promise.resolve(state.cohort);\n  }\n  if (pendingCohortUpdate && pendingCohortUpdate.signature === signature) {\n    return pendingCohortUpdate.promise;\n  }\n  const promise = gatherItems(selection)\n    .then(items => {\n      const currentSignature = selectionSignature(snapshotSelection());\n      if (currentSignature !== signature) {\n        return ensureCohortSync({ force: true });\n      }\n      setCohort(items);\n      resetBlockMode();\n      lastAppliedSelectionSignature = signature;\n      return items;\n    })\n    .catch(err => {\n      console.warn('Failed to assemble study cohort', err);\n      throw err;\n    })\n    .finally(() => {\n      if (pendingCohortUpdate && pendingCohortUpdate.signature === signature) {\n        pendingCohortUpdate = null;\n      }\n    });\n  pendingCohortUpdate = { promise, signature };\n  return promise;\n}\n\nfunction setLectureSource(map) {\n  lectureSource = {};\n  for (const [blockId, list] of Object.entries(map || {})) {\n    lectureSource[blockId] = Array.isArray(list)\n      ? list.map(lecture => ({ ...lecture }))\n      : [];\n  }\n}\n\nfunction lectureListFor(blockId, options = {}) {\n  const list = lectureSource[blockId];\n  if (!Array.isArray(list)) return [];\n  if (options.clone === false) return list;\n  return list.map(lecture => ({ ...lecture }));\n}\n\n\nfunction collectReviewCount(items) {\n  try {\n    return collectDueSections(items, { now: Date.now() }).length;\n  } catch (err) {\n    console.warn('Failed to calculate review queue size', err);\n    return 0;\n  }\n}\n\n\nfunction notifyBuilderChanged({ selectionChanged = false } = {}) {\n  removeAllStudySessions().catch(err => console.warn('Failed to clear saved sessions', err));\n  if (selectionChanged) {\n    Promise.resolve()\n      .then(() => ensureCohortSync({ force: true }))\n      .catch(err => console.warn('Failed to refresh study selection', err));\n  }\n}\n\nexport async function renderBuilder(root, redraw) {\n  const [blocks] = await Promise.all([\n    loadBlocks(),\n    hydrateStudySessions().catch(err => {\n      console.error('Unable to load study sessions', err);\n      return null;\n    })\n  ]);\n  root.innerHTML = '';\n  const wrap = document.createElement('div');\n  wrap.className = 'builder';\n  root.appendChild(wrap);\n  drawBuilder(wrap, blocks, redraw);\n}\n\nasync function loadBlocks() {\n  const catalog = await loadBlockCatalog();\n  const lectureLists = { ...catalog.lectureLists };\n  catalog.blocks.forEach(block => {\n    if (!Array.isArray(lectureLists[block.blockId])) {\n      lectureLists[block.blockId] = [];\n    }\n  });\n  lectureLists.__unlabeled = [];\n  setLectureSource(lectureLists);\n  const blocks = catalog.blocks.map(block => ({ ...block }));\n  blocks.push({ blockId: '__unlabeled', title: 'Unlabeled', weeks: 0 });\n  return blocks;\n}\n\nfunction drawBuilder(container, blocks, redraw) {\n  container.innerHTML = '';\n  if (state.builder.weeks.length) {\n    setBuilder({ weeks: [] });\n  }\n  const rerender = () => drawBuilder(container, blocks, redraw);\n\n  const contexts = blocks.map(block => {\n    const blockId = block.blockId;\n    const lectures = lectureListFor(blockId);\n    lectures.sort((a, b) => {\n      const weekDiff = (a.week ?? 0) - (b.week ?? 0);\n      if (weekDiff !== 0) return weekDiff;\n      return (a.name || '').localeCompare(b.name || '');\n    });\n    const weeks = groupByWeek(lectures);\n    return { block, lectures, weeks };\n  });\n\n  builderBlockOrder = contexts.map(ctx => ctx.block.blockId);\n  builderWeekMap = new Map();\n  contexts.forEach(ctx => {\n    const blockId = ctx.block.blockId;\n    const entries = ctx.weeks.map(({ week }) => ({\n      key: weekKeyFor(blockId, week),\n      week\n    }));\n    builderWeekMap.set(blockId, entries);\n  });\n\n  const activeBlockId = ensureActiveBlock(contexts);\n  ensureWeekForBlock(activeBlockId);\n\n  const layout = document.createElement('div');\n  layout.className = 'builder-layout';\n  container.appendChild(layout);\n\n  const blockColumn = document.createElement('div');\n  blockColumn.className = 'builder-blocks';\n  layout.appendChild(blockColumn);\n  contexts.forEach(context => {\n    blockColumn.appendChild(renderBlockPanel(context, rerender));\n  });\n\n  const controls = renderControls(rerender, redraw);\n  layout.appendChild(controls);\n}\n\nfunction ensureActiveBlock(contexts) {\n  if (!Array.isArray(contexts) || !contexts.length) {\n    if (\n      state.builder.activeBlockId ||\n      (state.builder.collapsedBlocks && state.builder.collapsedBlocks.length) ||\n      state.builder.activeWeekKey ||\n      (state.builder.collapsedWeeks && state.builder.collapsedWeeks.length)\n    ) {\n      setBuilder({ activeBlockId: '', collapsedBlocks: [], activeWeekKey: '', collapsedWeeks: [] });\n    }\n    return '';\n  }\n  const blockIds = builderBlockOrder;\n  let activeBlockId = state.builder.activeBlockId;\n  if (!activeBlockId || !blockIds.includes(activeBlockId)) {\n    activeBlockId = chooseDefaultBlock(contexts);\n  }\n  if (!activeBlockId && blockIds.length) {\n    activeBlockId = blockIds[0];\n  }\n  setActiveBlock(activeBlockId);\n  return activeBlockId;\n}\n\nfunction chooseDefaultBlock(contexts) {\n  const lectureSelections = Array.isArray(state.builder.lectures) ? state.builder.lectures : [];\n  if (lectureSelections.length) {\n    const last = lectureSelections[lectureSelections.length - 1];\n    const [blockId] = last.split('|');\n    if (blockId && builderBlockOrder.includes(blockId)) return blockId;\n  }\n  const selectedBlocks = Array.isArray(state.builder.blocks) ? state.builder.blocks : [];\n  const blockMatch = selectedBlocks.find(id => builderBlockOrder.includes(id));\n  if (blockMatch) return blockMatch;\n  const withLectures = contexts.find(ctx => ctx.block.blockId !== '__unlabeled' && ctx.lectures.length);\n  if (withLectures) return withLectures.block.blockId;\n  return contexts[0]?.block.blockId || '';\n}\n\nfunction ensureWeekForBlock(blockId) {\n  if (!blockId) {\n    return;\n  }\n  const entries = builderWeekMap.get(blockId) || [];\n  if (!entries.length) {\n    clearActiveWeek(blockId);\n    return;\n  }\n  const currentKey = state.builder.activeWeekKey;\n  if (currentKey && currentKey.startsWith(`${blockId}|`)) {\n    const hasCurrent = entries.some(entry => entry.key === currentKey);\n    if (hasCurrent) {\n      applyWeekSelection(blockId, currentKey, entries);\n      return;\n    }\n  }\n  applyWeekSelection(blockId, entries[0].key, entries);\n}\n\nfunction setActiveBlock(blockId) {\n  if (!blockId || !builderBlockOrder.includes(blockId)) return;\n  const collapsed = builderBlockOrder.filter(id => id !== blockId);\n  const patch = {};\n  if (!arraysEqual(collapsed, state.builder.collapsedBlocks || [])) {\n    patch.collapsedBlocks = collapsed;\n  }\n  if (state.builder.activeBlockId !== blockId) {\n    patch.activeBlockId = blockId;\n  }\n  if (patch.activeBlockId && state.builder.activeWeekKey && !state.builder.activeWeekKey.startsWith(`${blockId}|`)) {\n    patch.activeWeekKey = '';\n  }\n  if (Object.keys(patch).length) {\n    setBuilder(patch);\n  }\n}\n\nfunction setActiveWeek(blockId, week) {\n  if (!blockId) return;\n  const entries = builderWeekMap.get(blockId) || [];\n  if (!entries.length) {\n    clearActiveWeek(blockId);\n    return;\n  }\n  const normalizedWeek = week != null ? week : -1;\n  const target = entries.find(entry => entry.week === normalizedWeek) || entries[0];\n  applyWeekSelection(blockId, target.key, entries);\n}\n\nfunction applyWeekSelection(blockId, key, entries) {\n  if (!key || !Array.isArray(entries)) return;\n  const collapsed = new Set(state.builder.collapsedWeeks || []);\n  const validKeys = entries.map(entry => entry.key);\n  for (const value of Array.from(collapsed)) {\n    if (value.startsWith(`${blockId}|`) && !validKeys.includes(value) && value !== key) {\n      collapsed.delete(value);\n    }\n  }\n  entries.forEach(entry => {\n    if (entry.key === key) {\n      collapsed.delete(entry.key);\n    } else {\n      collapsed.add(entry.key);\n    }\n  });\n  const patch = {};\n  const collapsedArr = Array.from(collapsed);\n  if (!arraysEqual(collapsedArr, state.builder.collapsedWeeks || [])) {\n    patch.collapsedWeeks = collapsedArr;\n  }\n  if (state.builder.activeWeekKey !== key) {\n    patch.activeWeekKey = key;\n  }\n  if (Object.keys(patch).length) {\n    setBuilder(patch);\n  }\n}\n\nfunction clearActiveWeek(blockId) {\n  if (!blockId) return;\n  const prefix = `${blockId}|`;\n  const nextCollapsed = (state.builder.collapsedWeeks || []).filter(key => !key.startsWith(prefix));\n  const patch = {};\n  if (!arraysEqual(nextCollapsed, state.builder.collapsedWeeks || [])) {\n    patch.collapsedWeeks = nextCollapsed;\n  }\n  if (state.builder.activeWeekKey && state.builder.activeWeekKey.startsWith(prefix)) {\n    patch.activeWeekKey = '';\n  }\n  if (Object.keys(patch).length) {\n    setBuilder(patch);\n  }\n}\n\nfunction findNextBlock(currentId) {\n  if (!builderBlockOrder.length) return null;\n  const index = builderBlockOrder.indexOf(currentId);\n  if (index === -1) return builderBlockOrder[0] || null;\n  for (let offset = 1; offset < builderBlockOrder.length; offset += 1) {\n    const candidate = builderBlockOrder[(index + offset) % builderBlockOrder.length];\n    if (candidate) return candidate;\n  }\n  return currentId || null;\n}\n\nfunction arraysEqual(a = [], b = []) {\n  if (a.length !== b.length) return false;\n  for (let i = 0; i < a.length; i += 1) {\n    if (a[i] !== b[i]) return false;\n  }\n  return true;\n}\n\nfunction renderBlockPanel(context, rerender) {\n  const { block, lectures, weeks } = context;\n  const blockId = block.blockId;\n  const hasLectureSelection = hasAnyLectureSelected(blockId, lectures);\n  const blockFullySelected = isBlockFullySelected(block, lectures);\n  const blockCollapsed = isBlockCollapsed(blockId);\n\n  const card = document.createElement('div');\n  card.className = 'card builder-block-card';\n  if (blockFullySelected) card.classList.add('active');\n  if (blockCollapsed) card.classList.add('is-collapsed');\n\n  const header = document.createElement('div');\n  header.className = 'builder-block-header';\n\n  const blockCollapseBtn = createCollapseToggle({\n    collapsed: blockCollapsed,\n    label: blockCollapsed ? 'Show weeks' : 'Hide weeks',\n    onToggle: () => {\n      toggleBlockCollapsed(blockId);\n      rerender();\n    },\n    variant: 'block'\n  });\n  header.appendChild(blockCollapseBtn);\n\n  const title = document.createElement('h3');\n  title.textContent = block.title || blockId;\n  header.appendChild(title);\n\n  const meta = document.createElement('span');\n  meta.className = 'builder-block-meta';\n  const weekCount = weeks.length;\n  const lectureCount = lectures.length;\n  const metaParts = [];\n  if (weekCount) metaParts.push(`${weekCount} week${weekCount === 1 ? '' : 's'}`);\n  if (lectureCount) metaParts.push(`${lectureCount} lecture${lectureCount === 1 ? '' : 's'}`);\n  meta.textContent = metaParts.join(' \u2022 ') || 'No lectures linked yet';\n  header.appendChild(meta);\n\n  const actions = document.createElement('div');\n  actions.className = 'builder-block-actions';\n\n  if (lectures.length || blockId === '__unlabeled') {\n    const label = blockId === '__unlabeled' ? 'Include unlabeled cards' : 'Select all lectures';\n    const allBtn = createAction(label, () => {\n      selectEntireBlock(block);\n      rerender();\n    });\n    if (lectures.length && areAllLecturesSelected(blockId, lectures)) {\n      allBtn.disabled = true;\n    }\n    actions.appendChild(allBtn);\n  }\n\n  if (hasLectureSelection || blockFullySelected) {\n    const clearBtn = createAction('Clear block', () => {\n      clearBlock(blockId);\n      rerender();\n    }, 'danger');\n    actions.appendChild(clearBtn);\n  }\n\n  header.appendChild(actions);\n  card.appendChild(header);\n\n  if (blockId === '__unlabeled') {\n    const note = document.createElement('div');\n    note.className = 'builder-unlabeled-note';\n    note.textContent = 'Include to study cards without block or lecture tags.';\n    card.appendChild(note);\n    return card;\n  }\n\n  const weekList = document.createElement('div');\n  weekList.className = 'builder-week-list';\n  weekList.hidden = blockCollapsed;\n  if (!weeks.length) {\n    const empty = document.createElement('div');\n    empty.className = 'builder-empty';\n    empty.textContent = 'No lectures added yet.';\n    weekList.appendChild(empty);\n  } else {\n    weeks.forEach(({ week, items }) => {\n      weekList.appendChild(renderWeek(block, week, items, rerender));\n    });\n  }\n  card.appendChild(weekList);\n  return card;\n}\n\nfunction renderWeek(block, week, lectures, rerender) {\n  const blockId = block.blockId;\n  const weekCollapsed = isWeekCollapsed(blockId, week);\n  const row = document.createElement('div');\n  row.className = 'builder-week-card';\n  if (hasAnyLectureSelected(blockId, lectures)) row.classList.add('is-active');\n  if (weekCollapsed) row.classList.add('is-collapsed');\n\n  const header = document.createElement('div');\n  header.className = 'builder-week-header';\n\n  const weekCollapseBtn = createCollapseToggle({\n    collapsed: weekCollapsed,\n    label: weekCollapsed ? 'Show lectures' : 'Hide lectures',\n    onToggle: () => {\n      toggleWeekCollapsed(blockId, week);\n      rerender();\n    }\n  });\n  header.appendChild(weekCollapseBtn);\n\n  const label = document.createElement('span');\n  label.className = 'builder-week-title';\n  label.textContent = formatWeekLabel(week);\n  header.appendChild(label);\n\n  const meta = document.createElement('span');\n  meta.className = 'builder-week-meta';\n  meta.textContent = `${lectures.length} lecture${lectures.length === 1 ? '' : 's'}`;\n  header.appendChild(meta);\n\n  const actions = document.createElement('div');\n  actions.className = 'builder-week-actions';\n  const allBtn = createAction('Select all', () => {\n    selectWeek(block, week);\n    rerender();\n  });\n  const clearBtn = createAction('Clear', () => {\n    clearWeek(block, week);\n    rerender();\n  }, 'danger');\n\n  if (areAllLecturesSelected(blockId, lectures)) {\n    allBtn.disabled = true;\n  }\n  if (!hasAnyLectureSelected(blockId, lectures)) {\n    clearBtn.disabled = true;\n  }\n\n  actions.appendChild(allBtn);\n  actions.appendChild(clearBtn);\n  header.appendChild(actions);\n\n  row.appendChild(header);\n\n  const lectureList = document.createElement('div');\n  lectureList.className = 'builder-lecture-list';\n  lectureList.hidden = weekCollapsed;\n  lectures.forEach(lecture => {\n    lectureList.appendChild(renderLecture(block, lecture, rerender));\n  });\n  row.appendChild(lectureList);\n\n  return row;\n}\n\nfunction renderLecture(block, lecture, rerender) {\n  const blockId = block.blockId;\n  const lectureKey = lectureKeyFor(blockId, lecture.id);\n  const active = state.builder.lectures.includes(lectureKey);\n  const pill = createPill(active, lecture.name || `Lecture ${lecture.id}`, () => {\n    toggleLecture(block, lecture);\n    rerender();\n  }, 'lecture');\n  return pill;\n}\n\nfunction renderControls(rerender, redraw) {\n  const aside = document.createElement('aside');\n  aside.className = 'builder-controls';\n\n  aside.appendChild(renderFilterCard(rerender));\n  aside.appendChild(renderModeCard(rerender, redraw));\n  aside.appendChild(renderReviewCard(redraw));\n\n  return aside;\n}\n\nfunction renderFilterCard(rerender) {\n  const card = document.createElement('div');\n  card.className = 'card builder-filter-card';\n\n  const title = document.createElement('h3');\n  title.textContent = 'Filters';\n  card.appendChild(title);\n\n  const typeLabel = document.createElement('div');\n  typeLabel.className = 'builder-section-title';\n  typeLabel.textContent = 'Card types';\n  card.appendChild(typeLabel);\n\n  const pillRow = document.createElement('div');\n  pillRow.className = 'builder-pill-row';\n  const typeMap = { disease: 'Disease', drug: 'Drug', concept: 'Concept' };\n  Object.entries(typeMap).forEach(([value, label]) => {\n    const active = state.builder.types.includes(value);\n    const pill = createPill(active, label, () => {\n      toggleType(value);\n      rerender();\n    }, 'small');\n    pillRow.appendChild(pill);\n  });\n  card.appendChild(pillRow);\n\n  const favToggle = createPill(state.builder.onlyFav, 'Only favorites', () => {\n    setBuilder({ onlyFav: !state.builder.onlyFav });\n    notifyBuilderChanged({ selectionChanged: true });\n    rerender();\n  }, 'small outline');\n  card.appendChild(favToggle);\n\n  const selectionMeta = document.createElement('div');\n  selectionMeta.className = 'builder-selection-meta';\n  const blockCount = countSelectedBlocks();\n  const lectureCount = state.builder.lectures.length;\n  selectionMeta.innerHTML = `\n    <span>Blocks: ${blockCount}</span>\n    <span>Lectures: ${lectureCount}</span>\n  `;\n  card.appendChild(selectionMeta);\n\n  const actions = document.createElement('div');\n  actions.className = 'builder-filter-actions';\n\n  const clearBtn = document.createElement('button');\n  clearBtn.type = 'button';\n  clearBtn.className = 'btn secondary builder-clear-btn';\n  clearBtn.textContent = 'Clear selection';\n  clearBtn.disabled = !hasAnySelection();\n  clearBtn.addEventListener('click', () => {\n    setBuilder({ blocks: [], weeks: [], lectures: [] });\n    notifyBuilderChanged({ selectionChanged: true });\n    rerender();\n  });\n  actions.appendChild(clearBtn);\n\n  card.appendChild(actions);\n\n  return card;\n}\n\nfunction renderModeCard(rerender, redraw) {\n  const card = document.createElement('div');\n  card.className = 'card builder-mode-card';\n\n  const title = document.createElement('h3');\n  title.textContent = 'Modes';\n  card.appendChild(title);\n\n  const layout = document.createElement('div');\n  layout.className = 'builder-mode-layout';\n  card.appendChild(layout);\n\n  const modeColumn = document.createElement('div');\n  modeColumn.className = 'builder-mode-option-column';\n  layout.appendChild(modeColumn);\n\n  const controls = document.createElement('div');\n  controls.className = 'builder-mode-controls';\n  layout.appendChild(controls);\n\n  const modeLabel = document.createElement('div');\n  modeLabel.className = 'builder-mode-options-title';\n  modeLabel.textContent = 'Choose a mode';\n  modeColumn.appendChild(modeLabel);\n\n  const modeRow = document.createElement('div');\n  modeRow.className = 'builder-mode-options';\n  modeColumn.appendChild(modeRow);\n\n  const status = document.createElement('div');\n  status.className = 'builder-mode-status';\n  controls.appendChild(status);\n\n  const countInfo = document.createElement('div');\n  countInfo.className = 'builder-mode-count';\n  controls.appendChild(countInfo);\n\n  const actions = document.createElement('div');\n  actions.className = 'builder-mode-actions';\n  controls.appendChild(actions);\n\n  const startBtn = document.createElement('button');\n  startBtn.type = 'button';\n  startBtn.className = 'btn builder-start-btn';\n  startBtn.textContent = 'Start';\n  actions.appendChild(startBtn);\n\n  const resumeBtn = document.createElement('button');\n  resumeBtn.type = 'button';\n  resumeBtn.className = 'btn builder-resume-btn';\n  resumeBtn.textContent = 'Resume';\n  actions.appendChild(resumeBtn);\n\n  const modes = ['Flashcards', 'Quiz', 'Blocks'];\n  const selected = state.study?.selectedMode || 'Flashcards';\n  modes.forEach(mode => {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'builder-mode-toggle';\n    btn.dataset.mode = mode.toLowerCase();\n    const isActive = mode === selected;\n    if (isActive) btn.classList.add('is-active');\n    btn.dataset.active = isActive ? 'true' : 'false';\n    btn.setAttribute('aria-pressed', isActive ? 'true' : 'false');\n    btn.textContent = mode;\n    btn.addEventListener('click', () => {\n      setStudySelectedMode(mode);\n      rerender();\n    });\n    modeRow.appendChild(btn);\n  });\n\n  const storageKey = MODE_KEY[selected] || null;\n  const savedEntry = storageKey ? getStudySessionEntry(storageKey) : null;\n  const hasSaved = !!(savedEntry && savedEntry.session);\n  const savedCount = hasSaved && Array.isArray(savedEntry.cohort) ? savedEntry.cohort.length : 0;\n  resumeBtn.disabled = !hasSaved;\n  resumeBtn.classList.toggle('is-ready', hasSaved);\n\n  const labelTitle = selected.toLowerCase();\n  const handleError = (err) => console.warn('Failed to update study session state', err);\n\n  let latestCount = Array.isArray(state.cohort) ? state.cohort.length : 0;\n\n  const updateStatus = (count = latestCount, { error = false } = {}) => {\n    status.classList.remove('is-error', 'is-warning');\n    if (error) {\n      status.classList.add('is-error');\n      status.textContent = 'Unable to load selected cards.';\n      return;\n    }\n    if (hasSaved) {\n      status.textContent = `Saved ${labelTitle} session${savedCount ? ` \u2022 ${savedCount} cards` : ''}`;\n      return;\n    }\n    if (!count) {\n      status.textContent = selected === 'Blocks'\n        ? 'Select study cards to open Blocks mode.'\n        : 'Choose lectures or filters to add study cards.';\n      return;\n    }\n    status.textContent = `Ready to start ${labelTitle}.`;\n  };\n\n  const updateCountDisplay = (count, { pending = false, error = false } = {}) => {\n    latestCount = count;\n    countInfo.classList.remove('is-error', 'is-loading');\n    if (error) {\n      countInfo.classList.add('is-error');\n      countInfo.textContent = 'Unable to load selected cards';\n      startBtn.disabled = true;\n      startBtn.classList.remove('is-ready');\n      updateStatus(count, { error: true });\n      return;\n    }\n    if (pending) {\n      countInfo.classList.add('is-loading');\n      countInfo.textContent = 'Updating selection\u2026';\n      startBtn.disabled = true;\n      startBtn.classList.remove('is-ready');\n      if (!hasSaved) {\n        status.textContent = 'Updating selection\u2026';\n        status.classList.remove('is-error', 'is-warning');\n      }\n      return;\n    }\n    const ready = count > 0;\n    countInfo.textContent = ready ? `${count} card${count === 1 ? '' : 's'} selected` : 'No cards selected';\n    startBtn.disabled = !ready;\n    startBtn.classList.toggle('is-ready', ready);\n    updateStatus(count);\n  };\n\n  const selection = snapshotSelection();\n  const signature = selectionSignature(selection);\n  const needsSync = signature !== lastAppliedSelectionSignature;\n  if (!latestCount && needsSync) {\n    updateCountDisplay(latestCount, { pending: true });\n  } else {\n    updateCountDisplay(latestCount);\n  }\n\n  ensureCohortSync({ force: needsSync })\n    .then(items => {\n      const currentSignature = selectionSignature(snapshotSelection());\n      if (currentSignature === signature) {\n        const count = Array.isArray(items) ? items.length : 0;\n        updateCountDisplay(count);\n      } else {\n        const currentCount = Array.isArray(state.cohort) ? state.cohort.length : 0;\n        updateCountDisplay(currentCount);\n      }\n    })\n    .catch(() => {\n      const fallbackCount = Array.isArray(state.cohort) ? state.cohort.length : 0;\n      updateCountDisplay(fallbackCount, { error: true });\n    });\n\n  startBtn.addEventListener('click', async () => {\n    if (startBtn.disabled) return;\n    const original = startBtn.textContent;\n    startBtn.disabled = true;\n    startBtn.textContent = 'Preparing\u2026';\n    status.classList.remove('is-error', 'is-warning');\n    status.textContent = `Preparing ${labelTitle}\u2026`;\n    try {\n      const pool = await ensureCohortSync({ force: true });\n      const cohortItems = Array.isArray(pool) ? pool : (Array.isArray(state.cohort) ? state.cohort : []);\n      if (!cohortItems.length) {\n        updateCountDisplay(0);\n        status.classList.add('is-warning');\n        status.textContent = 'No cards selected. Adjust the filters above to add cards.';\n        return;\n      }\n      setStudySelectedMode(selected);\n      const key = MODE_KEY[selected];\n      if (selected === 'Blocks') {\n        if (key) {\n          await removeStudySession(key).catch(handleError);\n        }\n        resetBlockMode();\n        setSubtab('Study', 'Blocks');\n        setTab('Block Board');\n        redraw();\n        return;\n      }\n      if (!key) return;\n      await removeStudySession(key).catch(handleError);\n      if (selected === 'Flashcards') {\n        setFlashSession({ idx: 0, pool: cohortItems, ratings: {}, mode: 'study' });\n      } else if (selected === 'Quiz') {\n        setQuizSession({ idx: 0, score: 0, pool: cohortItems });\n      }\n      setSubtab('Study', 'Builder');\n      setTab('Study');\n      redraw();\n    } catch (err) {\n      handleError(err);\n      status.classList.add('is-error');\n      status.textContent = 'Unable to start. Please try again.';\n    } finally {\n      startBtn.textContent = original;\n      const hasCards = Array.isArray(state.cohort) && state.cohort.length > 0;\n      startBtn.disabled = !hasCards;\n      startBtn.classList.toggle('is-ready', hasCards);\n    }\n  });\n\n  resumeBtn.addEventListener('click', async () => {\n    if (!hasSaved || !storageKey || !savedEntry) return;\n    setStudySelectedMode(selected);\n    await removeStudySession(storageKey).catch(handleError);\n    const restoredCohort = Array.isArray(savedEntry.cohort) ? savedEntry.cohort : [];\n    setCohort(restoredCohort);\n    if (selected === 'Blocks') {\n      resetBlockMode();\n      if (savedEntry.session && typeof savedEntry.session === 'object') {\n        setBlockMode(savedEntry.session);\n      }\n      setSubtab('Study', 'Blocks');\n      setTab('Block Board');\n      redraw();\n      return;\n    }\n    if (selected === 'Flashcards') {\n      setFlashSession(savedEntry.session);\n    } else if (selected === 'Quiz') {\n      setQuizSession(savedEntry.session);\n    }\n    setSubtab('Study', 'Builder');\n    setTab('Study');\n    redraw();\n  });\n\n  return card;\n}\n\n\nfunction renderReviewCard(redraw) {\n  const card = document.createElement('div');\n  card.className = 'card builder-review-card';\n\n  const title = document.createElement('h3');\n  title.textContent = 'Review';\n  card.appendChild(title);\n\n  const status = document.createElement('div');\n  status.className = 'builder-review-status';\n  status.textContent = 'Loading review queue\u2026';\n  card.appendChild(status);\n\n  const actions = document.createElement('div');\n  actions.className = 'builder-review-actions';\n\n  const openBtn = document.createElement('button');\n  openBtn.type = 'button';\n  openBtn.className = 'btn secondary';\n  openBtn.textContent = 'Open review';\n\n  openBtn.disabled = false;\n\n  openBtn.addEventListener('click', () => {\n    setSubtab('Study', 'Review');\n    redraw();\n  });\n  actions.appendChild(openBtn);\n\n  const saved = getStudySessionEntry('review');\n  if (saved?.session) {\n    const resumeBtn = document.createElement('button');\n    resumeBtn.type = 'button';\n    resumeBtn.className = 'btn builder-review-resume';\n    resumeBtn.textContent = 'Resume review';\n    resumeBtn.addEventListener('click', async () => {\n      await removeStudySession('review').catch(err => console.warn('Failed to clear review session stub', err));\n      const restored = Array.isArray(saved.cohort) ? saved.cohort : null;\n      if (restored) {\n        setCohort(restored);\n      }\n      setFlashSession(saved.session);\n      setSubtab('Study', 'Review');\n      redraw();\n    });\n    actions.appendChild(resumeBtn);\n  }\n\n  card.appendChild(actions);\n  updateReviewSummary(saved);\n  return card;\n\n  async function updateReviewSummary(savedEntry = null) {\n    try {\n      const items = await loadReviewSourceItems();\n      const dueCount = collectReviewCount(items);\n      if (items.length) {\n        const base = dueCount ? `${dueCount} card${dueCount === 1 ? '' : 's'} due` : 'All caught up!';\n        if (savedEntry?.session) {\n          const savedLabel = savedEntry.metadata?.label ? savedEntry.metadata.label : 'Saved review session ready';\n          status.textContent = `${base} \u2022 ${savedLabel}`;\n        } else {\n          status.textContent = base;\n        }\n\n      } else {\n        status.textContent = 'Review queue ready \u2014 no cards due yet.';\n\n      }\n    } catch (err) {\n      console.warn('Failed to summarize review queue', err);\n      status.textContent = 'Unable to load review queue.';\n    }\n  }\n}\n\n\nasync function gatherItems(selection = snapshotSelection()) {\n  const types = Array.isArray(selection.types) && selection.types.length ? selection.types : [];\n  if (!types.length) return [];\n  const results = await Promise.all(types.map(async kind => {\n    try {\n      const list = await listItemsByKind(kind);\n      return Array.isArray(list) ? list : [];\n    } catch (err) {\n      console.warn('Failed to load cards for kind', kind, err);\n      return [];\n    }\n  }));\n  const combined = results.flat();\n  const blockSet = new Set(Array.isArray(selection.blocks) ? selection.blocks : []);\n  const lectureSet = new Set(Array.isArray(selection.lectures) ? selection.lectures : []);\n  const wantUnlabeled = blockSet.has('__unlabeled');\n  return combined.filter(item => {\n    if (selection.onlyFav && !item.favorite) return false;\n    if (blockSet.size) {\n      const blocks = Array.isArray(item.blocks) ? item.blocks : [];\n      const hasBlockMatch = blocks.some(b => blockSet.has(b));\n      if (!hasBlockMatch) {\n        const isUnlabeled = !blocks.length;\n        if (!(wantUnlabeled && isUnlabeled)) return false;\n      }\n    }\n    if (lectureSet.size) {\n      const lectures = Array.isArray(item.lectures) ? item.lectures : [];\n      const ok = lectures.some(lecture => {\n        const blockId = lecture?.blockId;\n        const lectureId = lecture?.id ?? lecture?.lectureId;\n        if (blockId == null || lectureId == null) return false;\n        const key = lectureKeyFor(blockId, lectureId);\n        return lectureSet.has(key);\n      });\n      if (!ok) return false;\n    }\n    return true;\n  });\n}\n\nfunction selectEntireBlock(block) {\n  const blockId = block.blockId;\n  const blockSet = new Set(state.builder.blocks);\n  const lectureSet = new Set(state.builder.lectures);\n\n  const lectures = lectureListFor(blockId, { clone: false });\n  if (lectures.length) {\n    lectures.forEach(lecture => {\n      lectureSet.add(lectureKeyFor(blockId, lecture.id));\n    });\n    syncBlockWithLectureSelection(blockSet, lectureSet, block);\n  } else {\n    blockSet.add(blockId);\n  }\n\n  setActiveBlock(blockId);\n  ensureWeekForBlock(blockId);\n  setBuilder({\n    blocks: Array.from(blockSet),\n    lectures: Array.from(lectureSet),\n    weeks: []\n  });\n  notifyBuilderChanged({ selectionChanged: true });\n}\n\nfunction clearBlock(blockId) {\n  const lectureSet = new Set(state.builder.lectures);\n  const blockSet = new Set(state.builder.blocks);\n  for (const key of Array.from(lectureSet)) {\n    if (key.startsWith(`${blockId}|`)) lectureSet.delete(key);\n  }\n  blockSet.delete(blockId);\n  setActiveBlock(blockId);\n  ensureWeekForBlock(blockId);\n  setBuilder({\n    blocks: Array.from(blockSet),\n    lectures: Array.from(lectureSet),\n    weeks: []\n  });\n  notifyBuilderChanged({ selectionChanged: true });\n}\n\nfunction selectWeek(block, week) {\n  const blockId = block.blockId;\n  const lectureSet = new Set(state.builder.lectures);\n  const blockSet = new Set(state.builder.blocks);\n  const lectures = lectureListFor(blockId, { clone: false });\n  lectures.forEach(lecture => {\n    if (lecture.week === week) {\n      lectureSet.add(lectureKeyFor(blockId, lecture.id));\n    }\n  });\n  syncBlockWithLectureSelection(blockSet, lectureSet, block);\n  setActiveBlock(blockId);\n  setActiveWeek(blockId, week);\n  setBuilder({\n    lectures: Array.from(lectureSet),\n    blocks: Array.from(blockSet),\n    weeks: []\n  });\n  notifyBuilderChanged({ selectionChanged: true });\n}\n\nfunction clearWeek(block, week) {\n  const blockId = block.blockId;\n  const lectureSet = new Set(state.builder.lectures);\n  const blockSet = new Set(state.builder.blocks);\n  const lectures = lectureListFor(blockId, { clone: false });\n  lectures.forEach(lecture => {\n    if (lecture.week === week) {\n      lectureSet.delete(lectureKeyFor(blockId, lecture.id));\n    }\n  });\n  syncBlockWithLectureSelection(blockSet, lectureSet, block);\n  setActiveBlock(blockId);\n  setActiveWeek(blockId, week);\n  setBuilder({\n    lectures: Array.from(lectureSet),\n    blocks: Array.from(blockSet),\n    weeks: []\n  });\n  notifyBuilderChanged({ selectionChanged: true });\n}\n\nfunction toggleLecture(block, lecture) {\n  const key = lectureKeyFor(block.blockId, lecture.id);\n  const lectureSet = new Set(state.builder.lectures);\n  const blockSet = new Set(state.builder.blocks);\n  if (lectureSet.has(key)) {\n    lectureSet.delete(key);\n  } else {\n    lectureSet.add(key);\n  }\n  syncBlockWithLectureSelection(blockSet, lectureSet, block);\n  setActiveBlock(block.blockId);\n  setActiveWeek(block.blockId, lecture.week != null ? lecture.week : -1);\n  setBuilder({\n    lectures: Array.from(lectureSet),\n    blocks: Array.from(blockSet),\n    weeks: []\n  });\n  notifyBuilderChanged({ selectionChanged: true });\n}\n\nfunction toggleType(type) {\n  const types = new Set(state.builder.types);\n  if (types.has(type)) types.delete(type); else types.add(type);\n  setBuilder({ types: Array.from(types) });\n  notifyBuilderChanged({ selectionChanged: true });\n}\n\nfunction isBlockCollapsed(blockId) {\n  if (state.builder.activeBlockId) {\n    return state.builder.activeBlockId !== blockId;\n  }\n  return (state.builder.collapsedBlocks || []).includes(blockId);\n}\n\nfunction toggleBlockCollapsed(blockId) {\n  if (!blockId) return;\n  if (isBlockCollapsed(blockId)) {\n    setActiveBlock(blockId);\n    ensureWeekForBlock(blockId);\n    return;\n  }\n  const fallback = findNextBlock(blockId);\n  if (!fallback || fallback === blockId) {\n    return;\n  }\n  setActiveBlock(fallback);\n  ensureWeekForBlock(fallback);\n}\n\nfunction isWeekCollapsed(blockId, week) {\n  const activeBlockId = state.builder.activeBlockId;\n  if (!activeBlockId) {\n    return (state.builder.collapsedWeeks || []).includes(weekKeyFor(blockId, week));\n  }\n  if (blockId !== activeBlockId) return true;\n  const activeWeekKey = state.builder.activeWeekKey;\n  const entries = builderWeekMap.get(blockId) || [];\n  if (!entries.length) return true;\n  const key = weekKeyFor(blockId, week);\n  if (!activeWeekKey) {\n    return key !== entries[0].key;\n  }\n  return activeWeekKey !== key;\n}\n\nfunction toggleWeekCollapsed(blockId, week) {\n  const normalizedWeek = week;\n  if (isWeekCollapsed(blockId, normalizedWeek)) {\n    setActiveBlock(blockId);\n    setActiveWeek(blockId, normalizedWeek);\n    ensureWeekForBlock(blockId);\n    return;\n  }\n  const entries = builderWeekMap.get(blockId) || [];\n  const currentKey = weekKeyFor(blockId, normalizedWeek);\n  const fallback = entries.find(entry => entry.key !== currentKey);\n  if (!fallback) return;\n  setActiveWeek(blockId, fallback.week);\n}\n\nfunction isBlockFullySelected(block, lectures) {\n  if (!block) return false;\n  const blockId = block.blockId;\n  if (!state.builder.blocks.includes(blockId)) return false;\n  if (!lectures?.length) return true;\n  return areAllLecturesSelected(blockId, lectures);\n}\n\nfunction hasAnySelection() {\n  return state.builder.blocks.length || state.builder.lectures.length;\n}\n\nfunction countSelectedBlocks() {\n  const blockSet = new Set(state.builder.blocks);\n  for (const key of state.builder.lectures) {\n    const [blockId] = key.split('|');\n    if (blockId) blockSet.add(blockId);\n  }\n  return blockSet.size;\n}\n\nfunction groupByWeek(lectures) {\n  const map = new Map();\n  lectures.forEach(lecture => {\n    const week = lecture.week != null ? lecture.week : -1;\n    if (!map.has(week)) map.set(week, []);\n    map.get(week).push(lecture);\n  });\n  return Array.from(map.entries())\n    .sort((a, b) => {\n      const [weekA, weekB] = [a[0], b[0]];\n      const specialA = weekA == null || weekA < 0;\n      const specialB = weekB == null || weekB < 0;\n      if (specialA && specialB) return 0;\n      if (specialA) return 1;\n      if (specialB) return -1;\n      return weekB - weekA;\n    })\n    .map(([week, items]) => ({ week, items }));\n}\n\nfunction weekKeyFor(blockId, week) {\n  return `${blockId}|${week}`;\n}\n\nfunction lectureKeyFor(blockId, lectureId) {\n  return `${blockId}|${lectureId}`;\n}\n\nfunction formatWeekLabel(week) {\n  if (week == null || week < 0) return 'No week';\n  return `Week ${week}`;\n}\n\nfunction hasAnyLectureSelected(blockId, lectures) {\n  if (!lectures?.length) return false;\n  const lectureSet = new Set(state.builder.lectures);\n  return lectures.some(lecture => lectureSet.has(lectureKeyFor(blockId, lecture.id)));\n}\n\nfunction areAllLecturesSelected(blockId, lectures) {\n  if (!lectures?.length) return false;\n  const lectureSet = new Set(state.builder.lectures);\n  return lectures.every(lecture => lectureSet.has(lectureKeyFor(blockId, lecture.id)));\n}\n\nfunction syncBlockWithLectureSelection(blockSet, lectureSet, block) {\n  if (!block) return;\n  const blockId = block.blockId;\n  const prefix = `${blockId}|`;\n  let hasLecture = false;\n  for (const key of lectureSet) {\n    if (key.startsWith(prefix)) {\n      hasLecture = true;\n      break;\n    }\n  }\n  if (!hasLecture) {\n    blockSet.delete(blockId);\n    return;\n  }\n  const blockLectures = lectureListFor(blockId, { clone: false });\n  if (!blockLectures.length) {\n    blockSet.add(blockId);\n    return;\n  }\n  const allSelected = blockLectures.every(lecture => lectureSet.has(lectureKeyFor(blockId, lecture.id)));\n  if (allSelected) {\n    blockSet.add(blockId);\n  } else {\n    blockSet.delete(blockId);\n  }\n}\n\nfunction createPill(active, label, onClick, variant = '') {\n  const btn = document.createElement('button');\n  btn.type = 'button';\n  btn.className = 'builder-pill';\n  if (variant) {\n    const variants = Array.isArray(variant) ? variant : variant.split(' ');\n    variants.filter(Boolean).forEach(name => btn.classList.add(`builder-pill-${name}`));\n  }\n  setToggleState(btn, active);\n  btn.textContent = label;\n  btn.addEventListener('click', onClick);\n  return btn;\n}\n\nfunction createAction(label, onClick, variant = '') {\n  const btn = document.createElement('button');\n  btn.type = 'button';\n  btn.className = 'builder-action';\n  if (variant) {\n    const variants = Array.isArray(variant) ? variant : variant.split(' ');\n    variants.filter(Boolean).forEach(name => btn.classList.add(`builder-action-${name}`));\n  }\n  btn.textContent = label;\n  btn.addEventListener('click', onClick);\n  return btn;\n}\n\nfunction createCollapseToggle({ collapsed, label, onToggle, variant = 'week' }) {\n  const btn = document.createElement('button');\n  btn.type = 'button';\n  btn.className = 'builder-collapse-toggle';\n  if (variant === 'block') btn.classList.add('builder-collapse-toggle-block');\n  btn.setAttribute('aria-expanded', String(!collapsed));\n  btn.setAttribute('aria-label', label);\n  btn.textContent = collapsed ? '\u25B8' : '\u25BE';\n  btn.addEventListener('click', onToggle);\n  return btn;\n}\n", "import { openDB } from './idb.js';\nimport {\n  saveLecture,\n  deleteLecture,\n  deleteBlock,\n  upsertBlock,\n  listLecturesByBlock,\n  lectureKey,\n  DEFAULT_LECTURE_STATUS,\n  upsertItem,\n  getMapConfig,\n  saveMapConfig\n} from './storage.js';\nimport { buildTokens, buildSearchMeta } from '../search.js';\nimport { cleanItem } from '../validators.js';\nimport { uid, deepClone } from '../utils.js';\n\nconst TRANSFER_VERSION = 1;\n\nfunction prom(req) {\n  return new Promise((resolve, reject) => {\n    req.onsuccess = () => resolve(req.result);\n    req.onerror = () => reject(req.error);\n  });\n}\n\nfunction sanitizeBlock(block) {\n  if (!block || typeof block !== 'object') return null;\n  const copy = deepClone(block);\n  return {\n    blockId: copy.blockId,\n    title: copy.title || '',\n    color: copy.color || null,\n    weeks: Number.isFinite(copy.weeks) ? copy.weeks : null,\n    startDate: null,\n    endDate: null\n  };\n}\n\nfunction sanitizeLecture(lecture) {\n  if (!lecture || typeof lecture !== 'object') return null;\n  const copy = deepClone(lecture);\n  return {\n    blockId: copy.blockId,\n    id: copy.id,\n    name: copy.name || '',\n    week: copy.week ?? null,\n    tags: Array.isArray(copy.tags) ? copy.tags.slice() : [],\n    passPlan: copy.passPlan ? deepClone(copy.passPlan) : null,\n    plannerDefaults: copy.plannerDefaults ? deepClone(copy.plannerDefaults) : null,\n    notes: typeof copy.notes === 'string' ? copy.notes : '',\n    position: Number.isFinite(copy.position) ? copy.position : null\n  };\n}\n\nfunction buildLectureKey(blockId, lectureId) {\n  if (blockId == null || lectureId == null) return null;\n  return `${blockId}|${lectureId}`;\n}\n\nfunction collectLectureKeys(lectures) {\n  const keys = new Set();\n  lectures.forEach(lecture => {\n    const key = buildLectureKey(lecture.blockId, lecture.id);\n    if (key) keys.add(key);\n  });\n  return keys;\n}\n\nfunction matchItemToScope(item, { blockId, week, lectureKeys, includeLooseBlockItems = false }) {\n  if (!item) return false;\n  const itemLectures = Array.isArray(item.lectures) ? item.lectures : [];\n  for (const ref of itemLectures) {\n    const key = buildLectureKey(ref?.blockId, ref?.id);\n    if (key && lectureKeys.has(key)) {\n      return true;\n    }\n    if (week != null && ref && ref.blockId === blockId) {\n      const refWeek = ref.week == null ? null : ref.week;\n      if (refWeek === week) return true;\n    }\n  }\n  if (includeLooseBlockItems) {\n    const itemBlocks = Array.isArray(item.blocks) ? item.blocks : [];\n    if (itemBlocks.some(id => id === blockId)) {\n      if (week == null) return true;\n      const weeks = Array.isArray(item.weeks) ? item.weeks : [];\n      if (weeks.some(w => w === week)) return true;\n    }\n  }\n  return false;\n}\n\nasync function fetchBlockRecord(blockId) {\n  if (!blockId) return null;\n  const db = await openDB();\n  const tx = db.transaction('blocks');\n  const store = tx.objectStore('blocks');\n  const record = await prom(store.get(blockId));\n  if (!record) return null;\n  const { lectures, ...rest } = record;\n  return rest;\n}\n\nasync function fetchLectures(blockId) {\n  const db = await openDB();\n  const tx = db.transaction('lectures');\n  const store = tx.objectStore('lectures');\n  if (!blockId) {\n    const all = await prom(store.getAll());\n    return Array.isArray(all) ? all : [];\n  }\n  const index = typeof store.index === 'function' ? store.index('by_block') : null;\n  if (index && typeof index.getAll === 'function') {\n    return await prom(index.getAll(blockId));\n  }\n  const all = await prom(store.getAll());\n  return (Array.isArray(all) ? all : []).filter(lecture => lecture?.blockId === blockId);\n}\n\nasync function fetchAllItems() {\n  const db = await openDB();\n  const tx = db.transaction('items');\n  const store = tx.objectStore('items');\n  const all = await prom(store.getAll());\n  return Array.isArray(all) ? all : [];\n}\n\nfunction extractMapData(mapConfig, itemIds) {\n  if (!mapConfig || !Array.isArray(mapConfig.tabs)) return { tabs: [] };\n  const idSet = new Set(itemIds);\n  const tabs = mapConfig.tabs\n    .map(tab => {\n      const layoutEntries = Object.entries(tab.layout || {})\n        .filter(([id]) => idSet.has(id))\n        .map(([id, pos]) => [id, { x: Number(pos?.x) || 0, y: Number(pos?.y) || 0 }]);\n      const manualIds = Array.isArray(tab.manualIds)\n        ? tab.manualIds.filter(id => idSet.has(id))\n        : [];\n      if (!layoutEntries.length && !manualIds.length) return null;\n      return {\n        name: tab.name || 'Imported map',\n        includeLinked: tab.includeLinked !== false,\n        manualMode: Boolean(tab.manualMode),\n        manualIds,\n        layout: Object.fromEntries(layoutEntries),\n        layoutSeeded: tab.layoutSeeded === true,\n        filter: tab.filter ? { ...tab.filter } : { blockId: '', week: '', lectureKey: '' }\n      };\n    })\n    .filter(Boolean);\n  return { tabs };\n}\n\nfunction sanitizeItems(items) {\n  return items.map(item => {\n    const copy = deepClone(item);\n    delete copy.tokens;\n    delete copy.searchMeta;\n    return copy;\n  });\n}\n\nfunction buildBundle({ scope, block, lectures, items, map }) {\n  return {\n    version: TRANSFER_VERSION,\n    scope,\n    exportedAt: Date.now(),\n    block: block ? sanitizeBlock(block) : null,\n    lectures: Array.isArray(lectures) ? lectures.map(sanitizeLecture).filter(Boolean) : [],\n    items: sanitizeItems(items || []),\n    map: map || { tabs: [] }\n  };\n}\nasync function readMapConfig() {\n  try {\n    const raw = await getMapConfig();\n    return deepClone(raw);\n  } catch (err) {\n    console.warn('Failed to read map config for transfer', err);\n    return { tabs: [] };\n  }\n}\n\nasync function exportBundleForLectures(lectures, options = {}) {\n  if (!Array.isArray(lectures) || !lectures.length) {\n    throw new Error('No lectures to export');\n  }\n  const blockId = lectures[0].blockId;\n  const block = blockId ? await fetchBlockRecord(blockId) : null;\n  const lectureKeys = collectLectureKeys(lectures);\n  const allItems = await fetchAllItems();\n  const items = allItems.filter(item =>\n    matchItemToScope(item, {\n      blockId,\n      week: options.week ?? null,\n      lectureKeys,\n      includeLooseBlockItems: options.includeLooseBlockItems === true\n    })\n  );\n  const mapConfig = await readMapConfig();\n  const map = extractMapData(mapConfig, items.map(item => item.id));\n  return buildBundle({ scope: options.scope || 'lecture', block, lectures, items, map });\n}\n\nexport async function exportLectureTransfer(blockId, lectureId) {\n  if (blockId == null || lectureId == null) {\n    throw new Error('Missing lecture identity');\n  }\n  const lectures = await fetchLectures(blockId);\n  const numericId = Number(lectureId);\n  const match = lectures.find(lecture => {\n    const id = Number(lecture?.id);\n    if (Number.isFinite(id) && Number.isFinite(numericId)) return id === numericId;\n    return lecture?.id === lectureId;\n  });\n  if (!match) {\n    throw new Error('Lecture not found');\n  }\n  return exportBundleForLectures([match], { scope: 'lecture', week: match.week ?? null });\n}\n\nexport async function exportWeekTransfer(blockId, week) {\n  if (blockId == null) {\n    throw new Error('Missing block identity');\n  }\n  const lectures = await fetchLectures(blockId);\n  const normalizedWeek = week == null || week === '' ? null : week;\n  const filtered = lectures.filter(lecture => {\n    const lectureWeek = lecture.week == null ? null : lecture.week;\n    if (normalizedWeek == null) {\n      return lectureWeek == null;\n    }\n    return lectureWeek === normalizedWeek;\n  });\n  if (!filtered.length) {\n    throw new Error('No lectures found for week');\n  }\n  return exportBundleForLectures(filtered, { scope: 'week', week: normalizedWeek });\n}\n\nexport async function exportBlockTransfer(blockId) {\n  if (!blockId) {\n    throw new Error('Missing block identity');\n  }\n  const lectures = await fetchLectures(blockId);\n  if (!lectures.length) {\n    throw new Error('No lectures found for block');\n  }\n  return exportBundleForLectures(lectures, { scope: 'block', includeLooseBlockItems: true });\n}\n\nfunction ensureLectureDefaults(lecture) {\n  const base = sanitizeLecture(lecture) || {};\n  base.passes = [];\n  base.passPlan = base.passPlan || null;\n  base.plannerDefaults = base.plannerDefaults || null;\n  base.status = { ...DEFAULT_LECTURE_STATUS, state: 'unscheduled', completedPasses: 0, lastCompletedAt: null };\n  base.nextDueAt = null;\n  base.startAt = null;\n  return base;\n}\n\nfunction normalizeTransferPayload(bundle) {\n  if (!bundle || typeof bundle !== 'object') {\n    throw new Error('Invalid transfer payload');\n  }\n  if (bundle.version !== TRANSFER_VERSION) {\n    throw new Error('Unsupported transfer version');\n  }\n  const scope = bundle.scope === 'block' || bundle.scope === 'week' ? bundle.scope : 'lecture';\n  const block = sanitizeBlock(bundle.block || {});\n  const lectures = Array.isArray(bundle.lectures) ? bundle.lectures.map(ensureLectureDefaults).filter(Boolean) : [];\n  const items = Array.isArray(bundle.items)\n    ? bundle.items.map(item => {\n        const cleaned = cleanItem({ ...deepClone(item) });\n        delete cleaned.tokens;\n        delete cleaned.searchMeta;\n        return cleaned;\n      })\n    : [];\n  const map = bundle.map && typeof bundle.map === 'object' && Array.isArray(bundle.map.tabs)\n    ? {\n        tabs: bundle.map.tabs.map(tab => ({\n          name: tab.name || 'Imported map',\n          includeLinked: tab.includeLinked !== false,\n          manualMode: Boolean(tab.manualMode),\n          manualIds: Array.isArray(tab.manualIds) ? tab.manualIds.filter(Boolean) : [],\n          layout: tab.layout && typeof tab.layout === 'object' ? { ...tab.layout } : {},\n          layoutSeeded: tab.layoutSeeded === true,\n          filter: tab.filter && typeof tab.filter === 'object'\n            ? { ...tab.filter }\n            : { blockId: '', week: '', lectureKey: '' }\n        }))\n      }\n    : { tabs: [] };\n  return { scope, block, lectures, items, map };\n}\n\nasync function deleteExisting(scope, blockId, lectures, strategy) {\n  if (strategy !== 'replace') return;\n  if (!blockId) return;\n  if (scope === 'block') {\n    await deleteBlock(blockId);\n    return;\n  }\n  if (scope === 'week') {\n    const targetWeek = lectures[0]?.week ?? null;\n    const existing = await listLecturesByBlock(blockId);\n    const matches = existing.filter(lecture => {\n      const lectureWeek = lecture.week == null ? null : lecture.week;\n      if (targetWeek == null) {\n        return lectureWeek == null;\n      }\n      return lectureWeek === targetWeek;\n    });\n    for (const lecture of matches) {\n      await deleteLecture(blockId, lecture.id);\n    }\n    return;\n  }\n  if (scope === 'lecture') {\n    const lecture = lectures[0];\n    if (!lecture) return;\n    await deleteLecture(blockId, lecture.id);\n  }\n}\n\nfunction remapLectureIds(blockId, lectures, existingLectures, strategy) {\n  const remapped = [];\n  const lectureIdMap = new Map();\n  let maxId = existingLectures.reduce((max, lecture) => {\n    const num = Number(lecture?.id);\n    if (Number.isFinite(num) && num > max) return num;\n    return max;\n  }, 0);\n  const existingIds = new Set(existingLectures.map(lecture => lecture.id));\n  lectures.forEach(lecture => {\n    const normalized = ensureLectureDefaults(lecture);\n    normalized.blockId = blockId;\n    const desired = Number.isFinite(Number(lecture.id)) ? Number(lecture.id) : lecture.id;\n    let finalId = desired;\n    if (strategy === 'merge' && existingIds.has(desired)) {\n      maxId += 1;\n      finalId = maxId;\n    }\n    normalized.id = finalId;\n    existingIds.add(finalId);\n    const key = buildLectureKey(blockId, lecture.id);\n    if (key) {\n      lectureIdMap.set(key, {\n        blockId,\n        lectureId: finalId,\n        name: normalized.name,\n        week: normalized.week ?? null\n      });\n    }\n    remapped.push(normalized);\n  });\n  return { lectures: remapped, lectureIdMap };\n}\n\nfunction remapLectureRefs(refs, lectureIdMap) {\n  if (!Array.isArray(refs)) return [];\n  return refs.map(ref => {\n    if (!ref || typeof ref !== 'object') return ref;\n    const key = buildLectureKey(ref.blockId, ref.id);\n    if (key && lectureIdMap.has(key)) {\n      const mapping = lectureIdMap.get(key);\n      return {\n        blockId: mapping.blockId,\n        id: mapping.lectureId,\n        name: mapping.name || ref.name || '',\n        week: mapping.week ?? ref.week ?? null\n      };\n    }\n    return ref;\n  });\n}\n\nfunction remapLinks(links, itemIdMap) {\n  if (!Array.isArray(links)) return [];\n  return links.map(link => {\n    if (!link || typeof link !== 'object') return link;\n    const mappedId = itemIdMap.get(link.id);\n    if (mappedId) {\n      return { ...link, id: mappedId };\n    }\n    return link;\n  });\n}\n\nasync function persistLectures(blockId, lectures, lectureIdMap) {\n  for (const lecture of lectures) {\n    const payload = {\n      blockId,\n      id: lecture.id,\n      name: lecture.name,\n      week: lecture.week,\n      passPlan: lecture.passPlan || null,\n      startAt: Date.now(),\n      tags: Array.isArray(lecture.tags) ? lecture.tags.slice() : [],\n      plannerDefaults: lecture.plannerDefaults || null,\n      position: lecture.position\n    };\n    await saveLecture(payload);\n    const db = await openDB();\n    const tx = db.transaction('lectures', 'readwrite');\n    const store = tx.objectStore('lectures');\n    const key = lectureKey(blockId, lecture.id);\n    const record = await prom(store.get(key));\n    if (record) {\n      record.passes = [];\n      record.status = { ...DEFAULT_LECTURE_STATUS, state: 'unscheduled', completedPasses: 0, lastCompletedAt: null };\n      record.nextDueAt = null;\n      record.startAt = null;\n      record.plannerDefaults = lecture.plannerDefaults || null;\n      record.updatedAt = Date.now();\n      await prom(store.put(record));\n    }\n    await new Promise((resolve, reject) => {\n      tx.oncomplete = resolve;\n      tx.onerror = () => reject(tx.error);\n    });\n    const keyStr = buildLectureKey(blockId, lecture.id);\n    if (keyStr) {\n      lectureIdMap.set(keyStr, {\n        blockId,\n        lectureId: lecture.id,\n        name: lecture.name,\n        week: lecture.week ?? null\n      });\n    }\n  }\n}\n\nasync function persistItems(items, lectureIdMap, strategy) {\n  const existingIds = new Set();\n  const allExisting = await fetchAllItems();\n  allExisting.forEach(item => {\n    if (item?.id) existingIds.add(item.id);\n  });\n  const plans = [];\n  const itemIdMap = new Map();\n  for (const rawItem of items) {\n    const originalId = rawItem?.id || null;\n    let finalId = originalId;\n    if (!originalId) {\n      finalId = uid();\n    } else if (!existingIds.has(originalId)) {\n      finalId = originalId;\n    } else if (strategy === 'replace') {\n      finalId = originalId;\n    } else {\n      let candidate = `${originalId}-${uid().slice(0, 6)}`;\n      while (existingIds.has(candidate)) {\n        candidate = `${originalId}-${uid().slice(0, 6)}`;\n      }\n      finalId = candidate;\n      itemIdMap.set(originalId, finalId);\n    }\n    existingIds.add(finalId);\n    plans.push({ raw: rawItem, finalId });\n  }\n\n  for (const plan of plans) {\n    const item = cleanItem({ ...plan.raw });\n    item.id = plan.finalId;\n    item.lectures = remapLectureRefs(item.lectures, lectureIdMap);\n    item.links = remapLinks(item.links, itemIdMap);\n    delete item.tokens;\n    delete item.searchMeta;\n    item.tokens = buildTokens(item);\n    item.searchMeta = buildSearchMeta(item);\n    await upsertItem(item);\n  }\n  return itemIdMap;\n}\n\nfunction remapMapTabs(map, lectureIdMap, itemIdMap) {\n  if (!map || !Array.isArray(map.tabs)) return [];\n  return map.tabs.map(tab => {\n    const layout = {};\n    Object.entries(tab.layout || {}).forEach(([id, pos]) => {\n      const mapped = itemIdMap.get(id) || id;\n      layout[mapped] = {\n        x: Number(pos?.x) || 0,\n        y: Number(pos?.y) || 0\n      };\n    });\n    const manualIds = Array.isArray(tab.manualIds)\n      ? tab.manualIds.map(id => itemIdMap.get(id) || id)\n      : [];\n    let lectureKeyFilter = tab.filter?.lectureKey || '';\n    if (lectureKeyFilter) {\n      const mapping = lectureIdMap.get(lectureKeyFilter);\n      if (mapping) {\n        lectureKeyFilter = lectureKey(mapping.blockId, mapping.lectureId);\n      }\n    }\n    return {\n      id: uid(),\n      name: tab.name || 'Imported map',\n      includeLinked: tab.includeLinked !== false,\n      manualMode: Boolean(tab.manualMode),\n      manualIds,\n      layout,\n      layoutSeeded: tab.layoutSeeded === true,\n      filter: {\n        blockId: tab.filter?.blockId || '',\n        week: tab.filter?.week ?? '',\n        lectureKey: lectureKeyFilter\n      }\n    };\n  });\n}\n\nasync function mergeMapConfig(map, lectureIdMap, itemIdMap) {\n  if (!map || !Array.isArray(map.tabs) || !map.tabs.length) return;\n  const config = await getMapConfig();\n  const copy = deepClone(config);\n  const appended = remapMapTabs(map, lectureIdMap, itemIdMap);\n  appended.forEach(tab => {\n    let name = tab.name;\n    const existingNames = new Set(copy.tabs.map(existing => existing.name));\n    while (existingNames.has(name)) {\n      name = `${tab.name} (import)`;\n      tab.name = name;\n    }\n    copy.tabs.push(tab);\n  });\n  await saveMapConfig(copy);\n}\n\nexport async function importLectureTransfer(bundle, options = {}) {\n  const { scope, block, lectures, items, map } = normalizeTransferPayload(bundle);\n  if (!block || !block.blockId) {\n    throw new Error('Transfer missing block information');\n  }\n  const strategy = options.strategy === 'replace' ? 'replace' : 'merge';\n  const blockId = block.blockId;\n\n  await deleteExisting(scope, blockId, lectures, strategy);\n\n  const existingBlock = await fetchBlockRecord(blockId);\n  if (!existingBlock) {\n    await upsertBlock({\n      blockId,\n      title: block.title,\n      color: block.color,\n      weeks: block.weeks,\n      startDate: null,\n      endDate: null,\n      lectures: []\n    });\n  }\n\n  const existingLectures = await listLecturesByBlock(blockId);\n  const { lectures: normalizedLectures, lectureIdMap } = remapLectureIds(blockId, lectures, existingLectures, strategy);\n  await persistLectures(blockId, normalizedLectures, lectureIdMap);\n  const itemIdMap = await persistItems(items, lectureIdMap, strategy);\n  await mergeMapConfig(map, lectureIdMap, itemIdMap);\n}\n", "import { state, setLecturesState } from '../../state.js';\nimport { loadBlockCatalog, invalidateBlockCatalog } from '../../storage/block-catalog.js';\nimport { saveLecture, deleteLecture, getSettings } from '../../storage/storage.js';\nimport {\n  exportLectureTransfer,\n  exportWeekTransfer,\n  exportBlockTransfer,\n  importLectureTransfer\n} from '../../storage/transfers.js';\nimport { confirmModal } from './confirm.js';\nimport { debounce, findActiveBlockId } from '../../utils.js';\nimport {\n  DEFAULT_PASS_PLAN,\n  clonePassPlan,\n  plannerDefaultsToPassPlan,\n  deriveLectureStatus,\n  calculateNextDue\n} from '../../lectures/scheduler.js';\nimport { LECTURE_PASS_ACTIONS } from '../../lectures/actions.js';\nimport { passColorForOrder, setPassColorPalette } from './pass-colors.js';\n\nfunction findLectureScrollContainer(element) {\n  if (element && typeof element.closest === 'function') {\n    const main = element.closest('main');\n    if (main && typeof main.scrollTop === 'number') {\n      return main;\n    }\n  }\n  const doc = document.scrollingElement || document.documentElement || document.body;\n  return doc;\n}\n\nfunction ensureLectureState() {\n  if (!state.lectures) {\n    setLecturesState({});\n  }\n  return state.lectures;\n}\n\nfunction captureLectureViewState() {\n  const container = document.querySelector('.lectures-view');\n  if (!container) {\n    return;\n  }\n  const openBlocks = Array.from(\n    container.querySelectorAll('.lectures-block-group')\n  )\n    .filter(details => {\n      if (!details) return false;\n      if (typeof details.open === 'boolean') return details.open;\n      return details.hasAttribute('open');\n    })\n    .map(details => String(details.dataset.blockKey ?? ''));\n  const openWeeks = Array.from(container.querySelectorAll('.lectures-week-group'))\n    .filter(details => {\n      if (!details) return false;\n      if (typeof details.open === 'boolean') return details.open;\n      return details.hasAttribute('open');\n    })\n    .map(details => {\n      const blockEl = details.closest('.lectures-block-group');\n      const blockKey = blockEl?.dataset?.blockKey ?? '';\n      const weekValue = details.dataset?.weekValue ?? '';\n      return `${String(blockKey)}::${String(weekValue)}`;\n    });\n  setLecturesState({\n    openBlocks,\n    openWeeks,\n    openSnapshot: Date.now(),\n    scrollTop: findLectureScrollContainer(container)?.scrollTop ?? window.scrollY\n  });\n}\n\nfunction collectLectures(catalog) {\n  const lists = catalog?.lectureLists || {};\n  const result = [];\n  for (const list of Object.values(lists)) {\n    if (!Array.isArray(list)) continue;\n    list.forEach(entry => {\n      if (entry && typeof entry === 'object') {\n        result.push({ ...entry });\n      }\n    });\n  }\n  return result;\n}\n\nfunction buildBlockOrderMap(blocks) {\n  const order = new Map();\n  blocks.forEach((block, index) => {\n    if (!block || !block.blockId) return;\n    order.set(block.blockId, index);\n    order.set(String(block.blockId), index);\n  });\n  return order;\n}\n\nfunction slugify(value, fallback = 'export') {\n  if (value == null) return fallback;\n  const text = String(value).toLowerCase();\n  const slug = text\n    .replace(/[^a-z0-9]+/g, '-')\n    .replace(/^-+|-+$/g, '')\n    .slice(0, 50);\n  return slug || fallback;\n}\n\nfunction downloadJson(data, filename) {\n  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n\nfunction describeWeekValue(value) {\n  if (value == null || value === '') return 'No week assigned';\n  const numeric = Number(value);\n  if (Number.isFinite(numeric)) {\n    return `Week ${numeric}`;\n  }\n  return `Week ${value}`;\n}\n\nfunction detectImportConflicts(bundle, catalog) {\n  if (!bundle || typeof bundle !== 'object') {\n    return { hasConflicts: false };\n  }\n  const scopeRaw = typeof bundle.scope === 'string' ? bundle.scope.toLowerCase() : 'lecture';\n  const scope = scopeRaw === 'block' || scopeRaw === 'week' ? scopeRaw : 'lecture';\n  const blockId = bundle.block && bundle.block.blockId != null ? String(bundle.block.blockId) : '';\n  const blocks = Array.isArray(catalog?.blocks) ? catalog.blocks : [];\n  const lectureLists = catalog?.lectureLists || {};\n  const lectureIndex = catalog?.lectureIndex || {};\n  const blockInfo = blocks.find(block => String(block?.blockId) === blockId) || null;\n  const blockTitle = blockInfo?.title || bundle?.block?.title || blockId || 'Block';\n  const blockExists = Boolean(blockInfo);\n  const conflicts = {\n    scope,\n    blockId,\n    blockTitle,\n    blockExists: scope === 'block' && blockExists,\n    weeks: [],\n    lectures: []\n  };\n  const existingLectures = lectureIndex[blockId] || {};\n  const weekSet = new Set();\n  if (Array.isArray(bundle?.lectures)) {\n    bundle.lectures.forEach(lecture => {\n      const lectureId = lecture?.id;\n      const hasLectureConflict = Object.values(existingLectures).some(existing => {\n        if (!existing) return false;\n        const existingId = existing.id;\n        if (Number.isFinite(Number(existingId)) && Number.isFinite(Number(lectureId))) {\n          return Number(existingId) === Number(lectureId);\n        }\n        return String(existingId) === String(lectureId);\n      });\n      if (hasLectureConflict) {\n        conflicts.lectures.push({\n          id: lectureId,\n          name: lecture?.name || `Lecture ${lectureId}`\n        });\n      }\n      if (scope !== 'lecture') {\n        const weekValue = lecture?.week == null ? null : lecture.week;\n        if (!weekSet.has(weekValue)) {\n          const existingWeek = (lectureLists[blockId] || []).some(entry => {\n            const entryWeek = entry?.week == null ? null : entry.week;\n            return entryWeek === weekValue;\n          });\n          if (existingWeek) {\n            conflicts.weeks.push(weekValue);\n          }\n          weekSet.add(weekValue);\n        }\n      }\n    });\n  }\n  conflicts.hasConflicts = conflicts.blockExists || conflicts.weeks.length > 0 || conflicts.lectures.length > 0;\n  return conflicts;\n}\n\nfunction promptImportStrategy(conflicts) {\n  return new Promise(resolve => {\n    const overlay = document.createElement('div');\n    overlay.className = 'modal import-conflict-modal';\n\n    const card = document.createElement('div');\n    card.className = 'card import-conflict-card';\n\n    const title = document.createElement('h3');\n    title.textContent = 'Content already exists';\n    card.appendChild(title);\n\n    const message = document.createElement('p');\n    message.textContent = 'Choose whether to replace the existing content or merge the new material.';\n    card.appendChild(message);\n\n    const list = document.createElement('ul');\n    list.className = 'import-conflict-list';\n\n    if (conflicts.blockExists) {\n      const item = document.createElement('li');\n      item.textContent = `Block \"${conflicts.blockTitle}\" already exists.`;\n      list.appendChild(item);\n    }\n    if (Array.isArray(conflicts.weeks) && conflicts.weeks.length) {\n      const item = document.createElement('li');\n      const labels = conflicts.weeks.map(describeWeekValue).join(', ');\n      item.textContent = `Week assignments already exist: ${labels}.`;\n      list.appendChild(item);\n    }\n    if (Array.isArray(conflicts.lectures) && conflicts.lectures.length) {\n      const item = document.createElement('li');\n      const names = conflicts.lectures.map(entry => entry.name || `Lecture ${entry.id}`).join(', ');\n      item.textContent = `Lectures already exist: ${names}.`;\n      list.appendChild(item);\n    }\n\n    if (list.childElementCount) {\n      card.appendChild(list);\n    }\n\n    const actions = document.createElement('div');\n    actions.className = 'row import-conflict-actions';\n\n    function cleanup(result) {\n      if (document.body.contains(overlay)) {\n        document.body.removeChild(overlay);\n      }\n      resolve(result);\n    }\n\n    const replaceBtn = document.createElement('button');\n    replaceBtn.type = 'button';\n    replaceBtn.className = 'btn';\n    replaceBtn.textContent = 'Replace';\n    replaceBtn.addEventListener('click', () => cleanup('replace'));\n\n    const mergeBtn = document.createElement('button');\n    mergeBtn.type = 'button';\n    mergeBtn.className = 'btn secondary';\n    mergeBtn.textContent = 'Merge';\n    mergeBtn.addEventListener('click', () => cleanup('merge'));\n\n    const cancelBtn = document.createElement('button');\n    cancelBtn.type = 'button';\n    cancelBtn.className = 'btn secondary';\n    cancelBtn.textContent = 'Cancel';\n    cancelBtn.addEventListener('click', () => cleanup(null));\n\n    actions.appendChild(replaceBtn);\n    actions.appendChild(mergeBtn);\n    actions.appendChild(cancelBtn);\n    card.appendChild(actions);\n\n    overlay.appendChild(card);\n    overlay.addEventListener('click', event => {\n      if (event.target === overlay) {\n        cleanup(null);\n      }\n    });\n\n    document.body.appendChild(overlay);\n    replaceBtn.focus();\n  });\n}\n\nfunction normalizeWeekValue(value) {\n  if (value == null || value === '') return '';\n  return String(value);\n}\n\nfunction formatWeekLabel(week) {\n  if (week == null || week === '') return '\u2014';\n  const num = Number(week);\n  if (!Number.isFinite(num)) return String(week);\n  return `Week ${num}`;\n}\n\nfunction collectBlockWeekOptions(blockId, blocks = [], lectureLists = {}) {\n  if (!blockId) return [];\n  const normalizedId = String(blockId);\n  const blockInfo = blocks.find(block => String(block?.blockId) === normalizedId) || null;\n  const result = new Set();\n  const weeksValue = Number(blockInfo?.weeks);\n  if (Number.isFinite(weeksValue) && weeksValue > 0) {\n    const total = Math.max(1, Math.round(weeksValue));\n    for (let i = 1; i <= total; i += 1) {\n      result.add(i);\n    }\n  }\n  const list = Array.isArray(lectureLists?.[normalizedId]) ? lectureLists[normalizedId] : [];\n  list.forEach(entry => {\n    const weekNum = Number(entry?.week);\n    if (Number.isFinite(weekNum) && weekNum >= 0) {\n      result.add(weekNum);\n    }\n  });\n  return Array.from(result).sort((a, b) => a - b);\n}\n\nfunction populateWeekSelect(select, blockId, blocks, lectureLists, options = {}) {\n  if (!select) return;\n  const {\n    selectedValue = '',\n    includeBlank = true,\n    blankLabel = 'No week'\n  } = options;\n  const normalizedValue = normalizeWeekValue(selectedValue);\n  select.innerHTML = '';\n  if (includeBlank) {\n    const blank = document.createElement('option');\n    blank.value = '';\n    blank.textContent = blankLabel;\n    select.appendChild(blank);\n  }\n  const weeks = collectBlockWeekOptions(blockId, blocks, lectureLists);\n  weeks.forEach(week => {\n    const option = document.createElement('option');\n    option.value = String(week);\n    option.textContent = formatWeekLabel(week);\n    select.appendChild(option);\n  });\n  if (normalizedValue && !weeks.some(week => String(week) === normalizedValue)) {\n    const custom = document.createElement('option');\n    custom.value = normalizedValue;\n    custom.textContent = formatWeekLabel(normalizedValue);\n    select.appendChild(custom);\n  }\n  select.value = normalizedValue;\n}\n\nfunction formatOffset(minutes) {\n  if (!Number.isFinite(minutes)) return '0m';\n  const abs = Math.abs(minutes);\n  if (abs < 60) return `${Math.round(minutes)}m`;\n  const hours = minutes / 60;\n  if (Math.abs(hours) < 24) return `${Math.round(hours)}h`;\n  const days = minutes / (60 * 24);\n  if (Math.abs(days) < 7) return `${Math.round(days)}d`;\n  const weeks = minutes / (60 * 24 * 7);\n  if (Math.abs(weeks) < 4) return `${Math.round(weeks)}w`;\n  const months = minutes / (60 * 24 * 30);\n  return `${Math.round(months)}mo`;\n}\n\nconst OFFSET_UNITS = [\n  { id: 'minutes', label: 'minutes', minutes: 1 },\n  { id: 'hours', label: 'hours', minutes: 60 },\n  { id: 'days', label: 'days', minutes: 60 * 24 },\n  { id: 'weeks', label: 'weeks', minutes: 60 * 24 * 7 }\n];\n\nfunction normalizeOffsetUnit(id) {\n  const fallback = OFFSET_UNITS[2];\n  if (typeof id !== 'string') return fallback.id;\n  const match = OFFSET_UNITS.find(option => option.id === id);\n  return match ? match.id : fallback.id;\n}\n\nfunction splitOffsetMinutes(minutes) {\n  const value = Number.isFinite(minutes) ? Math.max(0, Math.round(minutes)) : 0;\n  if (value === 0) {\n    return { value: 0, unit: 'days' };\n  }\n  const preferred = [...OFFSET_UNITS].reverse().find(option => value % option.minutes === 0);\n  if (preferred) {\n    return { value: Math.round(value / preferred.minutes), unit: preferred.id };\n  }\n  if (value < 60) {\n    return { value, unit: 'minutes' };\n  }\n  if (value < 60 * 24) {\n    return { value: Math.round(value / 60), unit: 'hours' };\n  }\n  return { value: Math.round(value / (60 * 24)), unit: 'days' };\n}\n\nfunction combineOffsetValueUnit(value, unitId) {\n  const normalizedUnit = normalizeOffsetUnit(unitId);\n  const option = OFFSET_UNITS.find(entry => entry.id === normalizedUnit) || OFFSET_UNITS[2];\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric) || numeric <= 0) {\n    return 0;\n  }\n  return Math.max(0, Math.round(numeric * option.minutes));\n}\n\nconst PASS_DUE_FORMAT = new Intl.DateTimeFormat(undefined, {\n  month: 'short',\n  day: 'numeric'\n});\n\nconst PASS_TIME_FORMAT = new Intl.DateTimeFormat(undefined, {\n  hour: 'numeric',\n  minute: '2-digit'\n});\n\nfunction formatDateForInput(timestamp = Date.now()) {\n  if (!Number.isFinite(timestamp)) return '';\n  const date = new Date(timestamp);\n  const year = date.getFullYear();\n  const month = String(date.getMonth() + 1).padStart(2, '0');\n  const day = String(date.getDate()).padStart(2, '0');\n  return `${year}-${month}-${day}`;\n}\n\nfunction parseDateInputValue(value) {\n  if (typeof value !== 'string' || !value) return null;\n  const [yearStr, monthStr, dayStr] = value.split('-');\n  const year = Number(yearStr);\n  const month = Number(monthStr) - 1;\n  const day = Number(dayStr);\n  if (!Number.isFinite(year) || !Number.isFinite(month) || !Number.isFinite(day)) {\n    return null;\n  }\n  const date = new Date(year, month, day, 0, 0, 0, 0);\n  if (Number.isNaN(date.getTime())) return null;\n  return date.getTime();\n}\n\nfunction passAccent(order = 1) {\n  return passColorForOrder(order);\n}\n\nfunction formatPassDueTimestamp(due) {\n  if (!Number.isFinite(due)) return '';\n  const date = new Date(due);\n  return `${PASS_DUE_FORMAT.format(date)} \u2022 ${PASS_TIME_FORMAT.format(date)}`;\n}\n\nfunction describePassCountdown(due, now = Date.now()) {\n  if (!Number.isFinite(due)) return 'Unscheduled';\n  const diffMs = due - now;\n  const dayMs = 24 * 60 * 60 * 1000;\n  if (Math.abs(diffMs) < dayMs) {\n    return diffMs >= 0 ? 'Due today' : 'Overdue today';\n  }\n  if (diffMs > 0) {\n    const days = Math.ceil(diffMs / dayMs);\n    return days === 1 ? 'In 1 day' : `In ${days} days`;\n  }\n  const overdueDays = Math.ceil(Math.abs(diffMs) / dayMs);\n  return overdueDays === 1 ? '1 day overdue' : `${overdueDays} days overdue`;\n}\n\nfunction buildPassDisplayList(lecture) {\n  const scheduleList = Array.isArray(lecture?.passPlan?.schedule)\n    ? lecture.passPlan.schedule\n    : [];\n  const scheduleByOrder = new Map();\n  scheduleList.forEach((step, index) => {\n    const order = Number.isFinite(step?.order) ? step.order : index + 1;\n    scheduleByOrder.set(order, { ...step, order });\n  });\n  const passes = Array.isArray(lecture?.passes) ? lecture.passes : [];\n  const passByOrder = new Map();\n  passes.forEach(pass => {\n    const order = Number(pass?.order);\n    if (Number.isFinite(order)) {\n      passByOrder.set(order, pass);\n    }\n  });\n  const orders = new Set([\n    ...scheduleByOrder.keys(),\n    ...passByOrder.keys()\n  ]);\n  if (!orders.size) {\n    const planLength = scheduleList.length;\n    for (let i = 1; i <= planLength; i += 1) {\n      orders.add(i);\n    }\n  }\n  return Array.from(orders)\n    .filter(order => Number.isFinite(order))\n    .sort((a, b) => a - b)\n    .map(order => {\n      const schedule = scheduleByOrder.get(order) || {};\n      const pass = passByOrder.get(order) || {};\n      return {\n        order,\n        label: schedule.label || pass.label || `Pass ${order}`,\n        action: schedule.action || pass.action || '',\n        due: Number.isFinite(pass?.due) ? pass.due : null,\n        completedAt: Number.isFinite(pass?.completedAt) ? pass.completedAt : null,\n        offsetMinutes: Number.isFinite(schedule?.offsetMinutes) ? schedule.offsetMinutes : null,\n        anchor: schedule.anchor || pass.anchor || null\n      };\n    });\n}\n\nfunction createPassChipDisplay(info, now = Date.now(), options = {}) {\n  const { onOpen, onToggle } = options || {};\n  const chip = document.createElement('div');\n  chip.className = 'lecture-pass-chip';\n  chip.style.setProperty('--chip-accent', passAccent(info?.order));\n  chip.dataset.passOrder = String(info?.order ?? '');\n  chip.setAttribute('role', 'button');\n  chip.tabIndex = 0;\n\n  const passTitle = info?.action || info?.label || `Pass ${info?.order ?? ''}`;\n  const statusWrap = document.createElement('div');\n  statusWrap.className = 'lecture-pass-chip-status';\n\n  const toggleButton = document.createElement('button');\n  toggleButton.type = 'button';\n  toggleButton.className = 'lecture-pass-chip-toggle';\n  toggleButton.setAttribute('aria-label', `Mark ${passTitle} as complete`);\n  toggleButton.setAttribute('aria-pressed', 'false');\n\n  const toggleIcon = document.createElement('span');\n  toggleIcon.className = 'lecture-pass-chip-toggle-icon';\n  toggleIcon.setAttribute('aria-hidden', 'true');\n  toggleIcon.textContent = '\u2713';\n\n  toggleButton.append(toggleIcon);\n  statusWrap.appendChild(toggleButton);\n  chip.appendChild(statusWrap);\n\n  const body = document.createElement('div');\n  body.className = 'lecture-pass-chip-body';\n  chip.appendChild(body);\n\n  const header = document.createElement('div');\n  header.className = 'lecture-pass-chip-header';\n  const badge = document.createElement('span');\n  badge.className = 'lecture-pass-chip-order';\n  badge.textContent = `P${info?.order ?? ''}`;\n  header.appendChild(badge);\n\n  const defaultLabel = `Pass ${info?.order ?? ''}`.trim();\n  const primaryText = (info?.action || '').trim();\n  const fallbackText = (info?.label || '').trim();\n  const functionText = primaryText || (fallbackText && fallbackText !== defaultLabel ? fallbackText : '');\n  if (functionText) {\n    const functionEl = document.createElement('span');\n    functionEl.className = 'lecture-pass-chip-function';\n    functionEl.textContent = functionText;\n    header.appendChild(functionEl);\n  }\n  body.appendChild(header);\n\n  const timing = document.createElement('div');\n  timing.className = 'lecture-pass-chip-due';\n  timing.textContent = Number.isFinite(info?.due)\n    ? formatPassDueTimestamp(info.due)\n    : 'No scheduled date';\n  body.appendChild(timing);\n\n  const countdown = document.createElement('div');\n  countdown.className = 'lecture-pass-chip-countdown';\n  countdown.textContent = describePassCountdown(info?.due, now);\n  body.appendChild(countdown);\n\n  const isInitiallyComplete = Number.isFinite(info?.completedAt);\n  const dueTimestamp = Number.isFinite(info?.due) ? info.due : null;\n\n  function applyCompletionState(complete) {\n    chip.classList.toggle('is-complete', complete);\n    const overdue = !complete && Number.isFinite(dueTimestamp) && dueTimestamp < now;\n    chip.classList.toggle('is-overdue', overdue);\n    toggleButton.classList.toggle('is-active', complete);\n    toggleButton.setAttribute('aria-pressed', complete ? 'true' : 'false');\n    toggleButton.setAttribute(\n      'aria-label',\n      complete ? `Mark ${passTitle} as incomplete` : `Mark ${passTitle} as complete`\n    );\n  }\n\n  applyCompletionState(isInitiallyComplete);\n\n  let busy = false;\n  toggleButton.addEventListener('click', async () => {\n    if (typeof onToggle !== 'function') return;\n    if (busy) return;\n    const desired = !toggleButton.classList.contains('is-active');\n    busy = true;\n    chip.classList.add('is-pending');\n    toggleButton.disabled = true;\n    try {\n      await onToggle(desired);\n      applyCompletionState(desired);\n    } catch (err) {\n      console.error(err);\n    }\n    chip.classList.remove('is-pending');\n    toggleButton.disabled = false;\n    busy = false;\n  });\n\n  chip.addEventListener('click', event => {\n    if (event.target instanceof Element && event.target.closest('.lecture-pass-chip-toggle')) {\n      return;\n    }\n    if (typeof onOpen === 'function') {\n      onOpen();\n    }\n  });\n\n  chip.addEventListener('keydown', event => {\n    if (event.target !== chip) return;\n    if (event.key === 'Enter' || event.key === ' ') {\n      event.preventDefault();\n      if (typeof onOpen === 'function') onOpen();\n    }\n  });\n\n  return chip;\n}\n\nconst MAX_PASS_COUNT = 20;\nconst DAY_MINUTES = 24 * 60;\n\nfunction defaultActionForIndex(index) {\n  if (!Array.isArray(LECTURE_PASS_ACTIONS) || !LECTURE_PASS_ACTIONS.length) return '';\n  const normalized = index % LECTURE_PASS_ACTIONS.length;\n  return LECTURE_PASS_ACTIONS[Math.max(0, normalized)];\n}\n\nfunction baseSchedule(plan) {\n  if (plan && Array.isArray(plan.schedule)) {\n    return plan.schedule;\n  }\n  return DEFAULT_PASS_PLAN.schedule;\n}\n\nfunction computeDefaultGap(schedule) {\n  if (!Array.isArray(schedule) || schedule.length < 2) return DAY_MINUTES;\n  const deltas = [];\n  for (let i = 1; i < schedule.length; i += 1) {\n    const prev = Number(schedule[i - 1]?.offsetMinutes);\n    const current = Number(schedule[i]?.offsetMinutes);\n    if (Number.isFinite(prev) && Number.isFinite(current)) {\n      const delta = current - prev;\n      if (delta > 0) deltas.push(delta);\n    }\n  }\n  return deltas.length ? deltas[deltas.length - 1] : DAY_MINUTES;\n}\n\nfunction fallbackAnchor(index) {\n  if (index === 0) return 'today';\n  if (index === 1) return 'tomorrow';\n  return 'upcoming';\n}\n\nfunction buildScheduleTemplate(plan, count) {\n  const template = baseSchedule(plan);\n  const numericCount = Number(count);\n  const safeCount = Math.max(0, Number.isFinite(numericCount) ? Math.round(numericCount) : 0);\n  const defaultGap = computeDefaultGap(template);\n  const schedule = [];\n  for (let i = 0; i < safeCount; i += 1) {\n    const source = template[i] || {};\n    const previous = schedule[i - 1] || null;\n    const order = i + 1;\n    const offset = Number.isFinite(source.offsetMinutes)\n      ? source.offsetMinutes\n      : previous\n        ? previous.offsetMinutes + defaultGap\n        : i === 0\n          ? 0\n          : defaultGap * i;\n    const anchor = typeof source.anchor === 'string' && source.anchor.trim()\n      ? source.anchor.trim()\n      : previous?.anchor || fallbackAnchor(i);\n    const label = typeof source.label === 'string' && source.label.trim()\n      ? source.label.trim()\n      : `Pass ${order}`;\n    const action = typeof source.action === 'string' && source.action.trim()\n      ? source.action.trim()\n      : defaultActionForIndex(i);\n    schedule.push({\n      order,\n      offsetMinutes: offset,\n      anchor,\n      label,\n      action\n    });\n  }\n  return schedule;\n}\n\nfunction adjustPassConfigs(current, count, plan) {\n  const template = buildScheduleTemplate(plan || { schedule: current }, count);\n  const byOrder = new Map();\n  (Array.isArray(current) ? current : []).forEach(entry => {\n    const order = Number(entry?.order);\n    if (Number.isFinite(order) && !byOrder.has(order)) {\n      byOrder.set(order, entry);\n    }\n  });\n  return template.map((step, index) => {\n    const existing = byOrder.get(step.order) || current[index] || {};\n    const action = typeof existing?.action === 'string' && existing.action.trim()\n      ? existing.action.trim()\n      : step.action;\n    const offsetMinutes = Number.isFinite(existing?.offsetMinutes)\n      ? Math.max(0, Math.round(existing.offsetMinutes))\n      : step.offsetMinutes;\n    const anchor = typeof existing?.anchor === 'string' && existing.anchor.trim()\n      ? existing.anchor.trim()\n      : step.anchor;\n    const label = typeof existing?.label === 'string' && existing.label.trim()\n      ? existing.label.trim()\n      : step.label;\n    return { ...step, action, offsetMinutes, anchor, label };\n  });\n}\n\nfunction clampPassCount(value) {\n  const parsed = Number(value);\n  if (!Number.isFinite(parsed)) return 0;\n  return Math.min(MAX_PASS_COUNT, Math.max(0, Math.round(parsed)));\n}\n\nfunction buildPassPlanPayload(passConfigs, existingPlan) {\n  const planId = existingPlan && typeof existingPlan.id === 'string' && existingPlan.id.trim()\n    ? existingPlan.id.trim()\n    : 'custom';\n  return {\n    id: planId,\n    schedule: passConfigs.map((config, index) => {\n      const order = index + 1;\n      const label = typeof config.label === 'string' && config.label.trim()\n        ? config.label.trim()\n        : `Pass ${order}`;\n      const offset = Number.isFinite(config.offsetMinutes)\n        ? Math.max(0, Math.round(config.offsetMinutes))\n        : index === 0\n          ? 0\n          : (passConfigs[index - 1]?.offsetMinutes ?? 0) + DAY_MINUTES;\n      const anchor = typeof config.anchor === 'string' && config.anchor.trim()\n        ? config.anchor.trim()\n        : fallbackAnchor(index);\n      const action = typeof config.action === 'string' && config.action.trim()\n        ? config.action.trim()\n        : defaultActionForIndex(index);\n      return {\n        order,\n        label,\n        offsetMinutes: offset,\n        anchor,\n        action\n      };\n    })\n  };\n}\n\nfunction formatPassPlan(plan) {\n  if (!plan || !Array.isArray(plan.schedule) || !plan.schedule.length) {\n    return 'No passes scheduled';\n  }\n  const steps = plan.schedule\n    .slice()\n    .sort((a, b) => (a?.order ?? 0) - (b?.order ?? 0))\n    .map(step => {\n      const action = typeof step?.action === 'string' && step.action.trim()\n        ? step.action.trim()\n        : `Pass ${step?.order ?? ''}`;\n      const offset = formatOffset(step?.offsetMinutes ?? 0);\n      return `${action} \u2022 ${offset}`;\n    });\n  return `Plan: ${steps.join(', ')}`;\n}\n\nfunction formatOverdue(due, now) {\n  const diffMs = Math.max(0, now - due);\n  if (diffMs < 60 * 1000) return 'due now';\n  const minutes = Math.round(diffMs / (60 * 1000));\n  if (minutes < 60) return `${minutes} min overdue`;\n  const hours = Math.round(minutes / 60);\n  if (hours < 24) return `${hours} hr overdue`;\n  const days = Math.round(hours / 24);\n  return `${days} day${days === 1 ? '' : 's'} overdue`;\n}\n\nfunction formatTimeUntil(due, now) {\n  const diffMs = Math.max(0, due - now);\n  if (diffMs < 60 * 1000) return 'due in under a minute';\n  const minutes = Math.round(diffMs / (60 * 1000));\n  if (minutes < 60) return `due in ${minutes} min`;\n  const hours = Math.round(minutes / 60);\n  if (hours < 24) return `due in ${hours} hr`;\n  const days = Math.round(hours / 24);\n  return `due in ${days} day${days === 1 ? '' : 's'}`;\n}\n\nfunction formatNextDue(nextDueAt, now = Date.now()) {\n  if (nextDueAt == null) return 'Not scheduled';\n  if (!Number.isFinite(nextDueAt)) return '\u2014';\n  if (nextDueAt <= now) return formatOverdue(nextDueAt, now);\n  return formatTimeUntil(nextDueAt, now);\n}\n\nfunction formatNextDueDescriptor(nextDueAt, now = Date.now()) {\n  if (nextDueAt == null || !Number.isFinite(nextDueAt)) return 'Not scheduled';\n  const date = new Date(nextDueAt);\n  const dateLabel = new Intl.DateTimeFormat(undefined, {\n    month: 'short',\n    day: 'numeric',\n    hour: 'numeric',\n    minute: '2-digit'\n  }).format(date);\n  const relative = nextDueAt <= now ? formatOverdue(nextDueAt, now) : formatTimeUntil(nextDueAt, now);\n  return `${dateLabel} \u2022 ${relative}`;\n}\n\nfunction formatPassSummary(lecture) {\n  const total = Array.isArray(lecture?.passes)\n    ? lecture.passes.length\n    : Array.isArray(lecture?.passPlan?.schedule)\n      ? lecture.passPlan.schedule.length\n      : 0;\n  const completed = Array.isArray(lecture?.passes)\n    ? lecture.passes.filter(pass => Number.isFinite(pass?.completedAt)).length\n    : lecture?.status?.completedPasses ?? 0;\n  const stateLabel = lecture?.status?.state ? lecture.status.state : 'pending';\n  return `${completed}/${total} passes \u2022 ${stateLabel}`;\n}\n\nfunction renderEmptyState() {\n  const empty = document.createElement('div');\n  empty.className = 'lectures-empty';\n  empty.textContent = 'No lectures found. Use \u201CAdd Lecture\u201D to create one.';\n  return empty;\n}\n\n\nfunction computeLecturePassStats(lecture) {\n  const passes = Array.isArray(lecture?.passes) ? lecture.passes : [];\n  const scheduled = Array.isArray(lecture?.passPlan?.schedule) ? lecture.passPlan.schedule.length : 0;\n  const statusTotal = Number.isFinite(lecture?.status?.totalPasses) ? lecture.status.totalPasses : 0;\n  let planned = Math.max(scheduled, passes.length, statusTotal);\n  const completedFromPasses = passes.filter(pass => Number.isFinite(pass?.completedAt)).length;\n  const completedFromStatus = Number.isFinite(lecture?.status?.completedPasses)\n    ? lecture.status.completedPasses\n    : 0;\n  const completed = Math.max(completedFromPasses, completedFromStatus);\n  planned = Math.max(planned, completed);\n  const remaining = Math.max(0, planned - completed);\n  return { planned, completed, remaining };\n}\n\nfunction summarizeLectures(lectures) {\n  return (Array.isArray(lectures) ? lectures : []).reduce(\n    (acc, lecture) => {\n      const stats = computeLecturePassStats(lecture);\n      acc.totalPasses += stats.planned;\n      acc.completed += stats.completed;\n      return acc;\n    },\n    { totalPasses: 0, completed: 0 }\n  );\n}\n\nfunction formatPassTotals(summary) {\n  if (!summary || summary.totalPasses === 0) return '0 passes planned';\n  return `${summary.completed}/${summary.totalPasses} passes complete`;\n}\n\nfunction labelForWeekKey(weekKey) {\n  if (weekKey === '__no-week') return 'No week assigned';\n  return formatWeekLabel(weekKey);\n}\n\nconst LECTURE_SORT_FIELDS = ['position', 'created', 'nextDue'];\nconst DEFAULT_LECTURE_SORT = { field: 'position', direction: 'asc' };\n\nfunction normalizeLectureSort(value) {\n  if (!value) return { ...DEFAULT_LECTURE_SORT };\n  let field = DEFAULT_LECTURE_SORT.field;\n  let direction = DEFAULT_LECTURE_SORT.direction;\n  if (typeof value === 'string') {\n    const parts = value.split('-');\n    if (parts.length === 1) {\n      field = parts[0];\n    } else if (parts.length >= 2) {\n      [field, direction] = parts;\n    }\n  } else if (typeof value === 'object') {\n    if (typeof value.field === 'string') field = value.field;\n    if (value.direction === 'asc' || value.direction === 'desc') direction = value.direction;\n  }\n  if (!LECTURE_SORT_FIELDS.includes(field)) {\n    field = DEFAULT_LECTURE_SORT.field;\n  }\n  direction = direction === 'desc' ? 'desc' : 'asc';\n  return { field, direction };\n}\n\nfunction formatLectureSortValue(sort) {\n  const normalized = normalizeLectureSort(sort);\n  return `${normalized.field}-${normalized.direction}`;\n}\n\nfunction describeSortDirectionLabel(field, direction) {\n  if (field === 'created') {\n    return direction === 'desc' ? 'Newest first' : 'Oldest first';\n  }\n  if (field === 'nextDue') {\n    return direction === 'asc' ? 'Soonest due' : 'Latest due';\n  }\n  return direction === 'desc' ? 'High \u2192 Low' : 'Low \u2192 High';\n}\n\nfunction describeSortDirectionAria(field, direction) {\n  if (field === 'created') {\n    return `Toggle sort order (currently ${direction === 'desc' ? 'newest first' : 'oldest first'})`;\n  }\n  if (field === 'nextDue') {\n    return `Toggle sort order (currently ${direction === 'asc' ? 'soonest due first' : 'latest due first'})`;\n  }\n  return `Toggle sort order (currently ${direction === 'asc' ? 'ascending' : 'descending'})`;\n}\n\nfunction sortLecturesForDisplay(lectures, sort) {\n  const { field, direction } = normalizeLectureSort(sort);\n  const multiplier = direction === 'desc' ? -1 : 1;\n  const list = Array.isArray(lectures) ? lectures.slice() : [];\n  return list.sort((a, b) => {\n    let comparison = 0;\n    if (field === 'created') {\n      const aValue = Number(a?.createdAt);\n      const bValue = Number(b?.createdAt);\n      const aRank = Number.isFinite(aValue)\n        ? aValue\n        : direction === 'desc' ? Number.NEGATIVE_INFINITY : Number.POSITIVE_INFINITY;\n      const bRank = Number.isFinite(bValue)\n        ? bValue\n        : direction === 'desc' ? Number.NEGATIVE_INFINITY : Number.POSITIVE_INFINITY;\n      if (aRank !== bRank) {\n        comparison = aRank < bRank ? -1 : 1;\n      }\n    } else if (field === 'nextDue') {\n      const aDue = resolveNextDueAt(a);\n      const bDue = resolveNextDueAt(b);\n      const aRank = Number.isFinite(aDue)\n        ? aDue\n        : direction === 'desc' ? Number.NEGATIVE_INFINITY : Number.POSITIVE_INFINITY;\n      const bRank = Number.isFinite(bDue)\n        ? bDue\n        : direction === 'desc' ? Number.NEGATIVE_INFINITY : Number.POSITIVE_INFINITY;\n      if (aRank !== bRank) {\n        comparison = aRank < bRank ? -1 : 1;\n      }\n    } else {\n      const posA = Number(a?.position);\n      const posB = Number(b?.position);\n      const posAValid = Number.isFinite(posA);\n      const posBValid = Number.isFinite(posB);\n      if (posAValid && posBValid && posA !== posB) {\n        comparison = posA < posB ? -1 : 1;\n      } else if (posAValid && !posBValid) {\n        comparison = -1;\n      } else if (!posAValid && posBValid) {\n        comparison = 1;\n      }\n    }\n\n    if (comparison !== 0) {\n      return comparison * multiplier;\n    }\n\n    const nameA = (a?.name || '').toLowerCase();\n    const nameB = (b?.name || '').toLowerCase();\n    if (nameA && nameB && nameA !== nameB) return nameA.localeCompare(nameB);\n    const idA = Number(a?.id);\n    const idB = Number(b?.id);\n    if (Number.isFinite(idA) && Number.isFinite(idB) && idA !== idB) return idA - idB;\n    return 0;\n  });\n}\n\nfunction resolveNextDueAt(lecture) {\n  if (Number.isFinite(lecture?.nextDueAt)) return lecture.nextDueAt;\n  const passes = Array.isArray(lecture?.passes) ? lecture.passes : [];\n  for (const pass of passes) {\n    if (!pass || Number.isFinite(pass?.completedAt)) continue;\n    if (Number.isFinite(pass?.due)) return pass.due;\n  }\n  return null;\n}\n\nfunction getLectureState(lecture, stats) {\n  if (lecture?.status?.state) return lecture.status.state;\n  const counts = stats || computeLecturePassStats(lecture);\n  if (!counts.planned) return 'unscheduled';\n  if (counts.completed >= counts.planned) return 'complete';\n  if (counts.completed > 0) return 'in-progress';\n  return 'pending';\n}\n\nfunction renderLectureWeekRow(lecture, onEdit, onDelete, onEditPass, onTogglePass, onExport, now = Date.now()) {\n  const row = document.createElement('div');\n  row.className = 'lecture-row';\n  row.dataset.lectureRow = 'true';\n  row.dataset.lectureId = String(lecture.id);\n  row.dataset.blockId = String(lecture.blockId ?? '');\n\n  const stats = computeLecturePassStats(lecture);\n  const stateLabel = getLectureState(lecture, stats);\n\n  const overviewCell = document.createElement('div');\n  overviewCell.className = 'lecture-col lecture-overview lecture-col-lecture';\n\n  const header = document.createElement('div');\n  header.className = 'lecture-overview-header';\n\n  const name = document.createElement('span');\n  name.className = 'lecture-name';\n  name.textContent = lecture.name || `Lecture ${lecture.id}`;\n  header.appendChild(name);\n\n  const status = document.createElement('span');\n  status.className = 'lecture-status-pill';\n  status.dataset.status = stateLabel;\n  status.textContent = stateLabel;\n  header.appendChild(status);\n\n  overviewCell.appendChild(header);\n\n  const nextDueLine = document.createElement('div');\n  nextDueLine.className = 'lecture-next-indicator';\n  nextDueLine.textContent = formatNextDueDescriptor(resolveNextDueAt(lecture), now);\n  overviewCell.appendChild(nextDueLine);\n\n  if (lecture.position != null) {\n    const position = document.createElement('div');\n    position.className = 'lecture-overview-position';\n    position.textContent = `Position: ${lecture.position}`;\n    overviewCell.appendChild(position);\n  }\n\n  const tags = Array.isArray(lecture.tags) ? lecture.tags.filter(Boolean) : [];\n  if (tags.length) {\n    const tagList = document.createElement('div');\n    tagList.className = 'lecture-tags';\n    tags.forEach(tag => {\n      const chip = document.createElement('span');\n      chip.className = 'lecture-tag';\n      chip.textContent = tag;\n      tagList.appendChild(chip);\n    });\n    overviewCell.appendChild(tagList);\n  }\n\n  const metrics = document.createElement('div');\n  metrics.className = 'lecture-overview-metrics';\n\n  const completedMetric = document.createElement('span');\n  completedMetric.className = 'lecture-metric lecture-metric-complete';\n  completedMetric.textContent = `${stats.completed} complete`;\n  metrics.appendChild(completedMetric);\n\n  const remainingMetric = document.createElement('span');\n  remainingMetric.className = 'lecture-metric lecture-metric-remaining';\n  remainingMetric.textContent = `${stats.remaining} remaining`;\n  metrics.appendChild(remainingMetric);\n\n  overviewCell.appendChild(metrics);\n\n  row.appendChild(overviewCell);\n\n  const passesCell = document.createElement('div');\n  passesCell.className = 'lecture-col lecture-passes-cell lecture-col-passes';\n  const passScroller = document.createElement('div');\n  passScroller.className = 'lecture-pass-scroller';\n  const passList = buildPassDisplayList(lecture);\n  if (!passList.length) {\n    const empty = document.createElement('div');\n    empty.className = 'lecture-pass-empty';\n    empty.textContent = 'No passes planned';\n    passScroller.appendChild(empty);\n  } else {\n    passList.forEach(info => {\n      const chip = createPassChipDisplay(info, now, {\n        onOpen: () => onEditPass(lecture, info),\n        onToggle: checked => onTogglePass?.(lecture, info, checked)\n      });\n      passScroller.appendChild(chip);\n    });\n  }\n  passesCell.appendChild(passScroller);\n  row.appendChild(passesCell);\n\n  const actions = document.createElement('div');\n  actions.className = 'lecture-col lecture-actions lecture-col-actions';\n\n  const editBtn = document.createElement('button');\n  editBtn.type = 'button';\n  editBtn.className = 'btn secondary';\n  editBtn.dataset.action = 'edit-lecture';\n  editBtn.textContent = 'Edit';\n  editBtn.addEventListener('click', () => onEdit(lecture));\n  actions.appendChild(editBtn);\n\n  const deleteBtn = document.createElement('button');\n  deleteBtn.type = 'button';\n  deleteBtn.className = 'btn secondary';\n  deleteBtn.dataset.action = 'delete-lecture';\n  deleteBtn.textContent = 'Delete';\n  deleteBtn.addEventListener('click', () => onDelete(lecture));\n  actions.appendChild(deleteBtn);\n\n  if (typeof onExport === 'function') {\n    const exportBtn = document.createElement('button');\n    exportBtn.type = 'button';\n    exportBtn.className = 'btn secondary';\n    exportBtn.dataset.action = 'export-lecture';\n    exportBtn.textContent = 'Export';\n    exportBtn.addEventListener('click', event => {\n      event.stopPropagation();\n      onExport(lecture);\n    });\n    actions.appendChild(exportBtn);\n  }\n\n  row.appendChild(actions);\n\n  return row;\n}\n\nfunction renderLectureTable(\n  blocks,\n  lectures,\n  filters,\n  onEdit,\n  onDelete,\n  onEditPass,\n  onTogglePass,\n  onExportLecture,\n  onExportWeek,\n  onExportBlock\n) {\n  const card = document.createElement('section');\n  card.className = 'card lectures-card';\n\n  const title = document.createElement('h2');\n  title.textContent = 'Lectures';\n  card.appendChild(title);\n\n  if (!lectures.length) {\n    card.appendChild(renderEmptyState());\n    return card;\n  }\n\n  const blockMap = new Map();\n  blocks.forEach(block => {\n    if (!block || block.blockId == null) return;\n    blockMap.set(String(block.blockId), block);\n  });\n  const orderMap = buildBlockOrderMap(blocks);\n  const blockFilter = String(filters?.blockId || '').trim();\n  const weekFilter = String(filters?.week || '').trim();\n  const now = Date.now();\n  const sortConfig = normalizeLectureSort(filters?.sort);\n  const openSnapshot = Number(filters?.openSnapshot) || 0;\n  const storedBlockKeys = new Set(\n    Array.isArray(filters?.openBlocks)\n      ? filters.openBlocks.map(value => String(value ?? ''))\n      : []\n  );\n  const storedWeekKeys = new Set(\n    Array.isArray(filters?.openWeeks)\n      ? filters.openWeeks.map(value => String(value ?? ''))\n      : []\n  );\n  const useStoredExpansion = openSnapshot > 0;\n\n  function composeWeekKey(blockKey, weekValue) {\n    return `${String(blockKey)}::${String(weekValue)}`;\n  }\n\n  function recordBlockOpen(blockKey, isOpen) {\n    const key = String(blockKey ?? '');\n    const lectureState = ensureLectureState();\n    const openBlocks = new Set(\n      Array.isArray(lectureState.openBlocks)\n        ? lectureState.openBlocks.map(value => String(value ?? ''))\n        : []\n    );\n    const openWeeks = new Set(\n      Array.isArray(lectureState.openWeeks)\n        ? lectureState.openWeeks.map(value => String(value ?? ''))\n        : []\n    );\n    if (isOpen) {\n      openBlocks.add(key);\n    } else {\n      openBlocks.delete(key);\n      Array.from(openWeeks).forEach(entry => {\n        if (entry.startsWith(`${key}::`)) {\n          openWeeks.delete(entry);\n        }\n      });\n    }\n    setLecturesState({\n      openBlocks: Array.from(openBlocks),\n      openWeeks: Array.from(openWeeks),\n      openSnapshot: Date.now()\n    });\n  }\n\n  function recordWeekOpen(blockKey, weekValue, isOpen) {\n    const composite = composeWeekKey(blockKey, weekValue);\n    const lectureState = ensureLectureState();\n    const openWeeks = new Set(\n      Array.isArray(lectureState.openWeeks)\n        ? lectureState.openWeeks.map(value => String(value ?? ''))\n        : []\n    );\n    if (isOpen) {\n      openWeeks.add(composite);\n    } else {\n      openWeeks.delete(composite);\n    }\n    setLecturesState({\n      openWeeks: Array.from(openWeeks),\n      openSnapshot: Date.now()\n    });\n  }\n\n  const blockGroups = new Map();\n\n  lectures.forEach(lecture => {\n    if (!lecture) return;\n    const rawBlockId = lecture.blockId == null || lecture.blockId === '' ? '' : lecture.blockId;\n    const key = rawBlockId === '' ? '__no-block' : String(rawBlockId);\n    if (!blockGroups.has(key)) {\n      const blockInfo = blockMap.get(String(rawBlockId));\n      const fallbackTitle = rawBlockId === '' ? 'No block assigned' : `Block ${rawBlockId}`;\n      blockGroups.set(key, {\n        key,\n        blockId: rawBlockId,\n        block: blockInfo || { blockId: rawBlockId, title: blockInfo?.title || fallbackTitle, color: blockInfo?.color || null },\n        lectures: [],\n        weeks: new Map()\n      });\n    }\n    const group = blockGroups.get(key);\n    group.lectures.push(lecture);\n    const weekKey = lecture.week == null || lecture.week === '' ? '__no-week' : String(lecture.week);\n    if (!group.weeks.has(weekKey)) {\n      group.weeks.set(weekKey, []);\n    }\n    group.weeks.get(weekKey).push(lecture);\n  });\n\n  const groupsContainer = document.createElement('div');\n  groupsContainer.className = 'lectures-groups';\n\n  const sortedGroups = Array.from(blockGroups.values()).sort((a, b) => {\n    const ao = orderMap.has(a.blockId) ? orderMap.get(a.blockId) : orderMap.get(String(a.blockId)) ?? Number.POSITIVE_INFINITY;\n    const bo = orderMap.has(b.blockId) ? orderMap.get(b.blockId) : orderMap.get(String(b.blockId)) ?? Number.POSITIVE_INFINITY;\n    if (ao !== bo) return ao - bo;\n    const nameA = (a.block?.title || a.block?.name || String(a.blockId || '') || '').toLowerCase();\n    const nameB = (b.block?.title || b.block?.name || String(b.blockId || '') || '').toLowerCase();\n    return nameA.localeCompare(nameB);\n  });\n\n  const activeBlockId = findActiveBlockId(blocks);\n  const defaultBlockId = (() => {\n    if (blockFilter) return blockFilter;\n    if (activeBlockId) return activeBlockId;\n    const firstWithId = sortedGroups.find(group => {\n      const id = String(group.blockId ?? '');\n      return id !== '';\n    });\n    if (firstWithId) return String(firstWithId.blockId ?? '');\n    return String(sortedGroups[0]?.blockId ?? '');\n  })();\n\n  sortedGroups.forEach(group => {\n    const blockDetails = document.createElement('details');\n    blockDetails.className = 'lectures-block-group';\n    const normalizedGroupId = String(group.blockId ?? '');\n    const blockKey = String(group.key ?? normalizedGroupId);\n    blockDetails.dataset.blockId = normalizedGroupId;\n    blockDetails.dataset.blockKey = blockKey;\n    const blockInfo = group.block || {};\n    if (blockInfo.color) {\n      blockDetails.style.setProperty('--block-accent', blockInfo.color);\n      blockDetails.classList.add('has-accent');\n    }\n\n    const blockSummary = document.createElement('summary');\n    blockSummary.className = 'lectures-block-summary';\n\n    const blockTitle = document.createElement('span');\n    blockTitle.className = 'lectures-block-name';\n    blockTitle.textContent = blockInfo.title || blockInfo.name || (group.blockId ? `Block ${group.blockId}` : 'No block assigned');\n    blockSummary.appendChild(blockTitle);\n\n    const blockStats = summarizeLectures(group.lectures);\n    const blockCounts = document.createElement('span');\n    blockCounts.className = 'lectures-block-counts';\n    const lectureCount = group.lectures.length;\n    const lectureLabel = `${lectureCount} lecture${lectureCount === 1 ? '' : 's'}`;\n    blockCounts.textContent = `${lectureLabel} \u2022 ${formatPassTotals(blockStats)}`;\n    blockSummary.appendChild(blockCounts);\n\n    if (typeof onExportBlock === 'function') {\n      const blockExportBtn = document.createElement('button');\n      blockExportBtn.type = 'button';\n      blockExportBtn.className = 'btn secondary lectures-block-export';\n      blockExportBtn.textContent = 'Export block';\n      blockExportBtn.addEventListener('click', event => {\n        event.stopPropagation();\n        onExportBlock(group.block);\n      });\n      blockSummary.appendChild(blockExportBtn);\n    }\n\n    blockDetails.appendChild(blockSummary);\n\n    const weekWrapper = document.createElement('div');\n    weekWrapper.className = 'lectures-week-groups';\n\n    const sortedWeeks = Array.from(group.weeks.entries()).sort((aEntry, bEntry) => {\n      const [aKey] = aEntry;\n      const [bKey] = bEntry;\n      if (aKey === '__no-week' && bKey === '__no-week') return 0;\n      if (aKey === '__no-week') return 1;\n      if (bKey === '__no-week') return -1;\n      const aNum = Number(aKey);\n      const bNum = Number(bKey);\n      if (Number.isFinite(aNum) && Number.isFinite(bNum) && aNum !== bNum) return bNum - aNum;\n      if (Number.isFinite(aNum) && !Number.isFinite(bNum)) return -1;\n      if (!Number.isFinite(aNum) && Number.isFinite(bNum)) return 1;\n      return String(bKey).localeCompare(String(aKey));\n    });\n\n    const matchesWeekFilter = weekFilter\n      ? sortedWeeks.some(([weekKey]) => {\n          const normalized = weekKey === '__no-week' ? '' : String(weekKey);\n          return normalized === weekFilter;\n        })\n      : false;\n\n    let shouldOpenBlock;\n    if (blockFilter) {\n      shouldOpenBlock = blockFilter === normalizedGroupId;\n    } else if (matchesWeekFilter) {\n      shouldOpenBlock = true;\n    } else if (useStoredExpansion) {\n      shouldOpenBlock = storedBlockKeys.has(blockKey);\n    } else {\n      shouldOpenBlock = defaultBlockId === normalizedGroupId;\n    }\n    blockDetails.open = shouldOpenBlock;\n    blockDetails.addEventListener('toggle', () => {\n      recordBlockOpen(blockKey, blockDetails.open);\n    });\n\n    sortedWeeks.forEach(([weekKey, weekLectures], index) => {\n      const weekDetails = document.createElement('details');\n      weekDetails.className = 'lectures-week-group';\n      const normalizedWeek = weekKey === '__no-week' ? '' : String(weekKey);\n      weekDetails.dataset.week = normalizedWeek;\n      weekDetails.dataset.weekValue = normalizedWeek;\n      weekDetails.dataset.weekKey = String(weekKey ?? '');\n      const compositeKey = composeWeekKey(blockKey, normalizedWeek);\n      let shouldOpenWeek;\n      if (weekFilter) {\n        shouldOpenWeek = weekFilter === normalizedWeek;\n      } else if (useStoredExpansion) {\n        shouldOpenWeek = storedWeekKeys.has(compositeKey);\n      } else {\n        shouldOpenWeek = blockDetails.open && index === 0;\n      }\n      weekDetails.open = blockDetails.open && shouldOpenWeek;\n      weekDetails.addEventListener('toggle', () => {\n        recordWeekOpen(blockKey, normalizedWeek, weekDetails.open);\n      });\n\n      const weekSummary = document.createElement('summary');\n      weekSummary.className = 'lectures-week-summary';\n\n      const weekTitle = document.createElement('span');\n      weekTitle.className = 'lectures-week-title';\n      weekTitle.textContent = labelForWeekKey(weekKey);\n      weekSummary.appendChild(weekTitle);\n\n      const weekStats = summarizeLectures(weekLectures);\n      const weekCounts = document.createElement('span');\n      weekCounts.className = 'lectures-week-counts';\n      const weekLectureCount = weekLectures.length;\n      const weekLectureLabel = `${weekLectureCount} lecture${weekLectureCount === 1 ? '' : 's'}`;\n      weekCounts.textContent = `${weekLectureLabel} \u2022 ${formatPassTotals(weekStats)}`;\n      weekSummary.appendChild(weekCounts);\n\n      if (typeof onExportWeek === 'function') {\n        const weekExportBtn = document.createElement('button');\n        weekExportBtn.type = 'button';\n        weekExportBtn.className = 'btn secondary lectures-week-export';\n        weekExportBtn.textContent = 'Export week';\n        weekExportBtn.addEventListener('click', event => {\n          event.stopPropagation();\n          const targetWeek = weekLectures[0]?.week == null ? null : weekLectures[0].week;\n          onExportWeek(group.block, targetWeek);\n        });\n        weekSummary.appendChild(weekExportBtn);\n      }\n\n      weekDetails.appendChild(weekSummary);\n\n      const weekBody = document.createElement('div');\n      weekBody.className = 'lectures-week-body';\n\n      const list = document.createElement('div');\n      list.className = 'lectures-week-list';\n\n      const headerRow = document.createElement('div');\n      headerRow.className = 'lecture-row lecture-row-header';\n      [\n        { label: 'Lecture', className: 'lecture-col-lecture' },\n        { label: 'Passes', className: 'lecture-col-passes' },\n        { label: 'Actions', className: 'lecture-col-actions' }\n      ].forEach(column => {\n        const cell = document.createElement('div');\n        cell.className = `lecture-col ${column.className}`;\n        cell.textContent = column.label;\n        headerRow.appendChild(cell);\n      });\n      list.appendChild(headerRow);\n\n      sortLecturesForDisplay(weekLectures, sortConfig).forEach(entry => {\n        const row = renderLectureWeekRow(\n          entry,\n          onEdit,\n          onDelete,\n          onEditPass,\n          onTogglePass,\n          lecture => onExportLecture?.(lecture, group.block),\n          now\n        );\n        list.appendChild(row);\n      });\n\n      weekBody.appendChild(list);\n      weekDetails.appendChild(weekBody);\n      weekWrapper.appendChild(weekDetails);\n    });\n\n    blockDetails.appendChild(weekWrapper);\n    groupsContainer.appendChild(blockDetails);\n  });\n\n  card.appendChild(groupsContainer);\n  return card;\n}\n\nfunction uniqueStatusValues(lectures) {\n  const set = new Set();\n  lectures.forEach(lecture => {\n    const state = lecture?.status?.state;\n    if (state) set.add(state);\n  });\n  return Array.from(set);\n}\n\nfunction uniqueWeeks(lectures) {\n  const set = new Set();\n  lectures.forEach(lecture => {\n    if (lecture.week == null) {\n      set.add('');\n    } else {\n      set.add(String(lecture.week));\n    }\n  });\n  return Array.from(set)\n    .filter(value => value !== '')\n    .map(value => Number(value))\n    .filter(value => Number.isFinite(value))\n    .sort((a, b) => a - b);\n}\n\nfunction applyFilters(lectures, filters) {\n  const query = (filters.query || '').trim().toLowerCase();\n  const blockId = (filters.blockId || '').trim();\n  const weekFilter = (filters.week || '').trim();\n  const statusFilter = (filters.status || '').trim();\n  const tagFilter = (filters.tag || '').trim().toLowerCase();\n\n  return lectures.filter(lecture => {\n    if (blockId && String(lecture.blockId) !== blockId) return false;\n    if (weekFilter) {\n      const week = lecture.week == null ? '' : String(lecture.week);\n      if (week !== weekFilter) return false;\n    }\n    if (statusFilter && statusFilter !== 'all') {\n      const statusState = lecture?.status?.state || '';\n      if (statusState !== statusFilter) return false;\n    }\n    if (query) {\n      const actionTerms = Array.isArray(lecture?.passPlan?.schedule)\n        ? lecture.passPlan.schedule.map(step => step?.action || '')\n        : [];\n      const haystacks = [lecture.name, lecture.id != null ? String(lecture.id) : '', lecture.blockId, ...actionTerms];\n      if (!haystacks.some(value => String(value || '').toLowerCase().includes(query))) {\n        return false;\n      }\n    }\n    if (tagFilter) {\n      const tags = Array.isArray(lecture.tags) ? lecture.tags : [];\n      if (!tags.some(tag => String(tag).toLowerCase().includes(tagFilter))) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\nfunction buildToolbar(blocks, lectures, lectureLists, redraw, defaultPassPlan, onImport) {\n  const filters = ensureLectureState();\n  const toolbar = document.createElement('div');\n  toolbar.className = 'lectures-toolbar';\n  toolbar.setAttribute('role', 'toolbar');\n  toolbar.setAttribute('aria-label', 'Lecture filters');\n\n  const filterGroup = document.createElement('div');\n  filterGroup.className = 'lectures-toolbar-filters';\n  toolbar.appendChild(filterGroup);\n\n  const actionsGroup = document.createElement('div');\n  actionsGroup.className = 'lectures-toolbar-actions';\n  toolbar.appendChild(actionsGroup);\n\n  if (typeof onImport === 'function') {\n    const importInput = document.createElement('input');\n    importInput.type = 'file';\n    importInput.accept = 'application/json';\n    importInput.style.display = 'none';\n\n    const importBtn = document.createElement('button');\n    importBtn.type = 'button';\n    importBtn.className = 'btn secondary lectures-import-btn';\n    importBtn.textContent = 'Import bundle';\n    importBtn.addEventListener('click', () => importInput.click());\n    importInput.addEventListener('change', async () => {\n      const file = importInput.files[0];\n      if (!file) return;\n      try {\n        const text = await file.text();\n        const json = JSON.parse(text);\n        await onImport(json);\n      } catch (err) {\n        console.error('Failed to import lecture bundle', err);\n        alert('Import failed.');\n      } finally {\n        importInput.value = '';\n      }\n    });\n\n    actionsGroup.appendChild(importBtn);\n    toolbar.appendChild(importInput);\n  }\n\n  const search = document.createElement('input');\n  search.type = 'search';\n  search.className = 'input lectures-search';\n  search.placeholder = 'Search lectures';\n  search.value = filters.query || '';\n  const debouncedSearch = debounce(value => {\n    setLecturesState({ query: value });\n    redraw();\n  }, 150);\n  search.addEventListener('input', e => {\n    debouncedSearch(e.target.value);\n  });\n  filterGroup.appendChild(search);\n\n  const sortState = normalizeLectureSort(filters.sort);\n  const sortControls = document.createElement('div');\n  sortControls.className = 'lectures-sort-controls';\n\n  const sortSelect = document.createElement('select');\n  sortSelect.className = 'input lectures-sort-field';\n  sortSelect.setAttribute('aria-label', 'Sort lectures');\n  [\n    { value: 'position', label: 'Manual order' },\n    { value: 'created', label: 'Date added' },\n    { value: 'nextDue', label: 'Next pass due' }\n  ].forEach(option => {\n    const opt = document.createElement('option');\n    opt.value = option.value;\n    opt.textContent = option.label;\n    sortSelect.appendChild(opt);\n  });\n  sortSelect.value = sortState.field;\n  sortSelect.addEventListener('change', () => {\n    sortState.field = sortSelect.value;\n    syncDirectionControl();\n    setLecturesState({ sort: formatLectureSortValue(sortState) });\n    redraw();\n  });\n  sortControls.appendChild(sortSelect);\n\n  const directionBtn = document.createElement('button');\n  directionBtn.type = 'button';\n  directionBtn.className = 'btn secondary lectures-sort-direction';\n  directionBtn.addEventListener('click', () => {\n    sortState.direction = sortState.direction === 'asc' ? 'desc' : 'asc';\n    syncDirectionControl();\n    setLecturesState({ sort: formatLectureSortValue(sortState) });\n    redraw();\n  });\n\n  function syncDirectionControl() {\n    directionBtn.dataset.direction = sortState.direction;\n    directionBtn.textContent = describeSortDirectionLabel(sortState.field, sortState.direction);\n    directionBtn.setAttribute('aria-label', describeSortDirectionAria(sortState.field, sortState.direction));\n  }\n\n  syncDirectionControl();\n  sortControls.appendChild(directionBtn);\n  filterGroup.appendChild(sortControls);\n\n  const blockSelect = document.createElement('select');\n  blockSelect.className = 'input lectures-filter';\n  blockSelect.setAttribute('aria-label', 'Filter by block');\n  const allBlocksOption = document.createElement('option');\n  allBlocksOption.value = '';\n  allBlocksOption.textContent = 'All blocks';\n  blockSelect.appendChild(allBlocksOption);\n  blocks.forEach(block => {\n    if (!block || !block.blockId) return;\n    const option = document.createElement('option');\n    option.value = block.blockId;\n    option.textContent = block.title || block.blockId;\n    blockSelect.appendChild(option);\n  });\n  blockSelect.value = filters.blockId || '';\n  blockSelect.addEventListener('change', () => {\n    setLecturesState({ blockId: blockSelect.value });\n    redraw();\n  });\n  filterGroup.appendChild(blockSelect);\n\n  const weekSelect = document.createElement('select');\n  weekSelect.className = 'input lectures-filter';\n  weekSelect.setAttribute('aria-label', 'Filter by week');\n  const allWeeksOption = document.createElement('option');\n  allWeeksOption.value = '';\n  allWeeksOption.textContent = 'All weeks';\n  weekSelect.appendChild(allWeeksOption);\n  uniqueWeeks(lectures).forEach(week => {\n    const option = document.createElement('option');\n    option.value = String(week);\n    option.textContent = `Week ${week}`;\n    weekSelect.appendChild(option);\n  });\n  weekSelect.value = normalizeWeekValue(filters.week);\n  weekSelect.addEventListener('change', () => {\n    setLecturesState({ week: weekSelect.value });\n    redraw();\n  });\n  filterGroup.appendChild(weekSelect);\n\n  const statuses = uniqueStatusValues(lectures);\n  if (statuses.length) {\n    const statusSelect = document.createElement('select');\n    statusSelect.className = 'input lectures-filter';\n    statusSelect.setAttribute('aria-label', 'Filter by status');\n    const allStatusOption = document.createElement('option');\n    allStatusOption.value = 'all';\n    allStatusOption.textContent = 'All statuses';\n    statusSelect.appendChild(allStatusOption);\n    statuses.sort().forEach(status => {\n      const option = document.createElement('option');\n      option.value = status;\n      option.textContent = status.charAt(0).toUpperCase() + status.slice(1);\n      statusSelect.appendChild(option);\n    });\n    statusSelect.value = filters.status || 'all';\n    statusSelect.addEventListener('change', () => {\n      setLecturesState({ status: statusSelect.value });\n      redraw();\n    });\n    filterGroup.appendChild(statusSelect);\n  }\n\n  const tagSearch = document.createElement('input');\n  tagSearch.type = 'search';\n  tagSearch.className = 'input lectures-tag-search';\n  tagSearch.placeholder = 'Filter tags';\n  tagSearch.value = filters.tag || '';\n  const debouncedTag = debounce(value => {\n    setLecturesState({ tag: value });\n    redraw();\n  }, 150);\n  tagSearch.addEventListener('input', e => {\n    debouncedTag(e.target.value);\n  });\n  filterGroup.appendChild(tagSearch);\n\n  const addBlockSelect = document.createElement('select');\n  addBlockSelect.className = 'input lectures-add-select';\n  addBlockSelect.setAttribute('aria-label', 'Select block for new lecture');\n  const addBlockPlaceholder = document.createElement('option');\n  addBlockPlaceholder.value = '';\n  addBlockPlaceholder.textContent = 'Select block';\n  addBlockSelect.appendChild(addBlockPlaceholder);\n  blocks.forEach(block => {\n    if (!block || !block.blockId) return;\n    const option = document.createElement('option');\n    option.value = block.blockId;\n    option.textContent = block.title || block.blockId;\n    addBlockSelect.appendChild(option);\n  });\n  const defaultAddBlock = blocks.find(block => block.blockId === filters.blockId)?.blockId\n    || (blocks[0]?.blockId ?? '');\n  if (defaultAddBlock) {\n    addBlockSelect.value = defaultAddBlock;\n  }\n  actionsGroup.appendChild(addBlockSelect);\n\n  const addWeekSelect = document.createElement('select');\n  addWeekSelect.className = 'input lectures-add-select';\n  addWeekSelect.setAttribute('aria-label', 'Select week for new lecture');\n  actionsGroup.appendChild(addWeekSelect);\n\n  let addWeekValue = normalizeWeekValue(filters.week);\n  const updateAddWeekSelect = () => {\n    const blockId = addBlockSelect.value;\n    const blankLabel = blockId ? 'No week' : 'Select block first';\n    populateWeekSelect(addWeekSelect, blockId, blocks, lectureLists, {\n      selectedValue: addWeekValue,\n      blankLabel\n    });\n    addWeekSelect.disabled = !blockId;\n    addWeekValue = addWeekSelect.value;\n  };\n\n  updateAddWeekSelect();\n\n  addBlockSelect.addEventListener('change', () => {\n    if (filters.blockId && filters.blockId === addBlockSelect.value) {\n      addWeekValue = normalizeWeekValue(filters.week);\n    } else {\n      addWeekValue = '';\n    }\n    updateAddWeekSelect();\n    syncAddButtonState();\n  });\n\n  addWeekSelect.addEventListener('change', () => {\n    addWeekValue = addWeekSelect.value;\n  });\n\n  const addBtn = document.createElement('button');\n  addBtn.type = 'button';\n  addBtn.className = 'btn primary add-lecture-btn';\n  addBtn.dataset.action = 'add-lecture';\n  const addIcon = document.createElement('span');\n  addIcon.className = 'add-lecture-btn-icon';\n  addIcon.setAttribute('aria-hidden', 'true');\n  addIcon.innerHTML = '<svg viewBox=\"0 0 16 16\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" focusable=\"false\" aria-hidden=\"true\"><path d=\"M8 3v10M3 8h10\"/></svg>';\n  const addLabel = document.createElement('span');\n  addLabel.className = 'add-lecture-btn-label';\n  addLabel.textContent = 'Add lecture';\n  addBtn.append(addIcon, addLabel);\n  actionsGroup.appendChild(addBtn);\n\n  const syncAddButtonState = () => {\n    addBtn.disabled = !blocks.length || !addBlockSelect.value;\n  };\n\n  syncAddButtonState();\n\n  addBtn.addEventListener('click', () => {\n    const selectedBlockId = addBlockSelect.value || (blocks[0]?.blockId || '');\n    if (!selectedBlockId) return;\n    const passPlanTemplate = clonePassPlan(\n      defaultPassPlan && Array.isArray(defaultPassPlan.schedule) ? defaultPassPlan : undefined\n    );\n    const rawWeek = addWeekSelect.disabled ? '' : addWeekSelect.value;\n    const numericWeek = rawWeek === '' ? '' : Number(rawWeek);\n    const selectedWeek = rawWeek === '' || Number.isNaN(numericWeek) ? '' : numericWeek;\n    openLectureDialog({\n      mode: 'create',\n      blocks,\n      lectureLists,\n      defaults: {\n        blockId: selectedBlockId,\n        name: '',\n        week: selectedWeek === '' ? '' : selectedWeek,\n        passPlan: passPlanTemplate,\n        startAt: Date.now()\n      },\n      onSubmit: async payload => {\n        await saveLecture(payload);\n        await invalidateBlockCatalog();\n        await redraw();\n      }\n    });\n  });\n\n  return toolbar;\n}\n\nfunction openLectureDialog(options) {\n  const { mode, blocks, defaults = {}, lectureLists = {}, onSubmit } = options;\n  const overlay = document.createElement('div');\n  overlay.className = 'modal lecture-dialog';\n  const card = document.createElement('div');\n  card.className = 'card';\n\n  const title = document.createElement('h2');\n  title.textContent = mode === 'edit' ? 'Edit lecture' : 'Add lecture';\n  card.appendChild(title);\n\n  const form = document.createElement('form');\n  form.className = 'lecture-form';\n\n  const basicsSection = document.createElement('section');\n  basicsSection.className = 'lecture-form-section';\n  const basicsTitle = document.createElement('h3');\n  basicsTitle.className = 'lecture-form-section-title';\n  basicsTitle.textContent = 'Lecture details';\n  basicsSection.appendChild(basicsTitle);\n  const basicsGrid = document.createElement('div');\n  basicsGrid.className = 'lecture-form-grid';\n  basicsSection.appendChild(basicsGrid);\n\n  const blockField = document.createElement('label');\n  blockField.className = 'lecture-form-field';\n  blockField.textContent = 'Block';\n  const blockSelect = document.createElement('select');\n  blockSelect.className = 'input';\n  blockSelect.dataset.field = 'blockId';\n  blocks.forEach(block => {\n    if (!block || !block.blockId) return;\n    const option = document.createElement('option');\n    option.value = block.blockId;\n    option.textContent = block.title || block.blockId;\n    blockSelect.appendChild(option);\n  });\n  blockSelect.value = defaults.blockId || (blocks[0]?.blockId || '');\n  if (mode === 'edit') {\n    blockSelect.disabled = true;\n  }\n  blockField.appendChild(blockSelect);\n  basicsGrid.appendChild(blockField);\n\n  const nameField = document.createElement('label');\n  nameField.className = 'lecture-form-field';\n  nameField.dataset.span = 'full';\n  nameField.textContent = 'Name';\n  const nameInput = document.createElement('input');\n  nameInput.type = 'text';\n  nameInput.required = true;\n  nameInput.placeholder = 'Lecture name';\n  nameInput.className = 'input';\n  nameInput.dataset.field = 'name';\n  nameInput.value = defaults.name ?? '';\n  nameField.appendChild(nameInput);\n  basicsGrid.appendChild(nameField);\n\n  const weekField = document.createElement('label');\n  weekField.className = 'lecture-form-field';\n  weekField.textContent = 'Week';\n  const weekSelect = document.createElement('select');\n  weekSelect.className = 'input';\n  weekSelect.dataset.field = 'week';\n  weekField.appendChild(weekSelect);\n  basicsGrid.appendChild(weekField);\n\n  const defaultStartAt = Number.isFinite(defaults.startAt) ? defaults.startAt : Date.now();\n  const startField = document.createElement('label');\n  startField.className = 'lecture-form-field';\n  startField.textContent = 'First pass date';\n  const startInput = document.createElement('input');\n  startInput.type = 'date';\n  startInput.required = true;\n  startInput.className = 'input';\n  const startValue = formatDateForInput(defaultStartAt);\n  startInput.value = startValue || formatDateForInput(Date.now());\n  startField.appendChild(startInput);\n  const startHint = document.createElement('span');\n  startHint.className = 'lecture-field-hint';\n  startHint.textContent = 'Controls when pass 1 begins.';\n  startField.appendChild(startHint);\n  basicsGrid.appendChild(startField);\n\n  form.appendChild(basicsSection);\n\n  let dialogWeekValue = normalizeWeekValue(defaults.week);\n  const updateDialogWeekOptions = () => {\n    const blockId = blockSelect.value;\n    populateWeekSelect(weekSelect, blockId, blocks, lectureLists, {\n      selectedValue: dialogWeekValue,\n      blankLabel: 'No week'\n    });\n    dialogWeekValue = weekSelect.value;\n  };\n\n  updateDialogWeekOptions();\n\n  weekSelect.addEventListener('change', () => {\n    dialogWeekValue = weekSelect.value;\n  });\n\n  const planTemplate = defaults.passPlan && Array.isArray(defaults.passPlan.schedule)\n    ? defaults.passPlan\n    : clonePassPlan();\n  const initialSchedule = Array.isArray(planTemplate.schedule) ? planTemplate.schedule : [];\n  const defaultFallbackCount = Array.isArray(DEFAULT_PASS_PLAN.schedule)\n    ? DEFAULT_PASS_PLAN.schedule.length\n    : 0;\n  const initialCount = clampPassCount(\n    initialSchedule.length > 0\n      ? initialSchedule.length\n      : defaults.passPlan\n        ? 0\n        : defaultFallbackCount\n  );\n  let passConfigs = adjustPassConfigs(initialSchedule, initialCount, planTemplate);\n\n  const planningSection = document.createElement('section');\n  planningSection.className = 'lecture-form-section';\n  const planningTitle = document.createElement('h3');\n  planningTitle.className = 'lecture-form-section-title';\n  planningTitle.textContent = 'Pass planning';\n  planningSection.appendChild(planningTitle);\n\n  const passCountField = document.createElement('label');\n  passCountField.className = 'lecture-pass-count';\n  passCountField.textContent = 'Planned passes';\n  const passCountInput = document.createElement('input');\n  passCountInput.type = 'number';\n  passCountInput.min = '0';\n  passCountInput.max = String(MAX_PASS_COUNT);\n  passCountInput.className = 'input';\n  passCountInput.value = String(passConfigs.length);\n  passCountField.appendChild(passCountInput);\n  const passHelp = document.createElement('span');\n  passHelp.className = 'lecture-pass-help';\n  passHelp.textContent = 'Set how many times you want to revisit this lecture.';\n  passCountField.appendChild(passHelp);\n  planningSection.appendChild(passCountField);\n\n  const passSummary = document.createElement('div');\n  passSummary.className = 'lecture-pass-summary-line';\n  planningSection.appendChild(passSummary);\n\n  const advanced = document.createElement('details');\n  advanced.className = 'lecture-pass-advanced';\n  if (mode === 'edit') {\n    advanced.open = true;\n  }\n  const advancedSummary = document.createElement('summary');\n  advancedSummary.textContent = `Advanced pass settings (${passConfigs.length})`;\n  advanced.appendChild(advancedSummary);\n\n  const advancedHint = document.createElement('p');\n  advancedHint.className = 'lecture-pass-advanced-hint';\n  advancedHint.textContent = 'Tune the pass function and timing for each pass.';\n  advanced.appendChild(advancedHint);\n\n  const passList = document.createElement('div');\n  passList.className = 'lecture-pass-editor';\n  advanced.appendChild(passList);\n  planningSection.appendChild(advanced);\n  form.appendChild(planningSection);\n\n  function updatePassSummary() {\n    if (!passConfigs.length) {\n      passSummary.textContent = 'No passes scheduled for this lecture.';\n    } else {\n      const planPreview = buildPassPlanPayload(passConfigs, planTemplate);\n      const previewText = formatPassPlan(planPreview);\n      const cleaned = previewText.startsWith('Plan: ')\n        ? previewText.slice(6)\n        : previewText;\n      passSummary.textContent = `${passConfigs.length} pass${passConfigs.length === 1 ? '' : 'es'} \u2022 ${cleaned}`;\n    }\n    advancedSummary.textContent = `Advanced pass settings (${passConfigs.length})`;\n  }\n\n  function renderPassEditor() {\n    passList.innerHTML = '';\n    if (!passConfigs.length) {\n      const empty = document.createElement('div');\n      empty.className = 'lecture-pass-empty';\n      empty.textContent = 'No passes planned. Increase the pass count to build a schedule.';\n      passList.appendChild(empty);\n      updatePassSummary();\n      return;\n    }\n    passConfigs.forEach((config, index) => {\n      const row = document.createElement('div');\n      row.className = 'lecture-pass-row';\n\n      const label = document.createElement('div');\n      label.className = 'lecture-pass-label';\n      label.textContent = `Pass ${index + 1}`;\n      row.appendChild(label);\n\n      const controls = document.createElement('div');\n      controls.className = 'lecture-pass-controls';\n\n      const actionField = document.createElement('div');\n      actionField.className = 'lecture-pass-field';\n      const actionLabel = document.createElement('span');\n      actionLabel.className = 'lecture-pass-field-label';\n      actionLabel.textContent = 'Pass function';\n      actionField.appendChild(actionLabel);\n      const select = document.createElement('select');\n      select.className = 'input lecture-pass-action';\n      LECTURE_PASS_ACTIONS.forEach(action => {\n        const option = document.createElement('option');\n        option.value = action;\n        option.textContent = action;\n        select.appendChild(option);\n      });\n      if (config.action && !LECTURE_PASS_ACTIONS.includes(config.action)) {\n        const custom = document.createElement('option');\n        custom.value = config.action;\n        custom.textContent = config.action;\n        select.appendChild(custom);\n      }\n      select.value = config.action || '';\n      select.addEventListener('change', event => {\n        const value = event.target.value;\n        passConfigs[index] = { ...passConfigs[index], action: value };\n        updatePassSummary();\n      });\n      actionField.appendChild(select);\n      controls.appendChild(actionField);\n\n      const offsetField = document.createElement('div');\n      offsetField.className = 'lecture-pass-field lecture-pass-offset-field';\n      const offsetLabel = document.createElement('span');\n      offsetLabel.className = 'lecture-pass-field-label';\n      offsetLabel.textContent = 'Timing';\n      offsetField.appendChild(offsetLabel);\n\n      const offsetInputs = document.createElement('div');\n      offsetInputs.className = 'lecture-pass-offset-inputs';\n      const split = splitOffsetMinutes(config.offsetMinutes ?? 0);\n      const offsetInput = document.createElement('input');\n      offsetInput.type = 'number';\n      offsetInput.min = '0';\n      offsetInput.step = '1';\n      offsetInput.className = 'input lecture-pass-offset-value';\n      offsetInput.value = String(split.value);\n      const unitSelect = document.createElement('select');\n      unitSelect.className = 'input lecture-pass-offset-unit';\n      OFFSET_UNITS.forEach(option => {\n        const opt = document.createElement('option');\n        opt.value = option.id;\n        opt.textContent = option.label;\n        unitSelect.appendChild(opt);\n      });\n      unitSelect.value = split.unit;\n      offsetInputs.appendChild(offsetInput);\n      offsetInputs.appendChild(unitSelect);\n      offsetField.appendChild(offsetInputs);\n\n      const preview = document.createElement('span');\n      preview.className = 'lecture-pass-offset-preview';\n      preview.textContent = formatOffset(config.offsetMinutes ?? 0);\n      offsetField.appendChild(preview);\n\n      function commitOffset() {\n        const minutes = combineOffsetValueUnit(offsetInput.value, unitSelect.value);\n        passConfigs[index] = {\n          ...passConfigs[index],\n          offsetMinutes: minutes\n        };\n        preview.textContent = formatOffset(passConfigs[index].offsetMinutes ?? 0);\n        updatePassSummary();\n      }\n\n      offsetInput.addEventListener('change', () => {\n        const numeric = Number(offsetInput.value);\n        if (!Number.isFinite(numeric) || numeric < 0) {\n          offsetInput.value = '0';\n        }\n        commitOffset();\n      });\n      offsetInput.addEventListener('blur', () => {\n        const numeric = Math.max(0, Math.round(Number(offsetInput.value) || 0));\n        offsetInput.value = String(numeric);\n        commitOffset();\n      });\n      unitSelect.addEventListener('change', commitOffset);\n\n      controls.appendChild(offsetField);\n      row.appendChild(controls);\n      passList.appendChild(row);\n    });\n\n    updatePassSummary();\n  }\n\n  renderPassEditor();\n\n  passCountInput.addEventListener('change', () => {\n    const next = clampPassCount(passCountInput.value);\n    passCountInput.value = String(next);\n    passConfigs = adjustPassConfigs(passConfigs, next, planTemplate);\n    renderPassEditor();\n  });\n\n  if (mode !== 'edit') {\n    blockSelect.addEventListener('change', () => {\n      dialogWeekValue = '';\n      updateDialogWeekOptions();\n    });\n  }\n\n  const actions = document.createElement('div');\n  actions.className = 'row lecture-dialog-actions';\n  const submitBtn = document.createElement('button');\n  submitBtn.type = 'submit';\n  submitBtn.className = 'btn';\n  submitBtn.textContent = mode === 'edit' ? 'Save changes' : 'Add lecture';\n  actions.appendChild(submitBtn);\n  const cancelBtn = document.createElement('button');\n  cancelBtn.type = 'button';\n  cancelBtn.className = 'btn secondary';\n  cancelBtn.textContent = 'Cancel';\n  cancelBtn.addEventListener('click', () => {\n    document.body.removeChild(overlay);\n  });\n  actions.appendChild(cancelBtn);\n  form.appendChild(actions);\n\n  form.addEventListener('submit', async event => {\n    event.preventDefault();\n    const blockId = blockSelect.value.trim();\n    const name = nameInput.value.trim();\n    const weekValue = weekSelect.value;\n    const week = weekValue === '' ? null : Number(weekValue);\n    let startAt = parseDateInputValue(startInput.value);\n    if (!Number.isFinite(startAt)) {\n      startAt = Date.now();\n    }\n    if (!blockId || !name || (weekValue !== '' && Number.isNaN(week))) {\n      return;\n    }\n    const passPlan = buildPassPlanPayload(passConfigs, defaults.passPlan);\n    const payload = {\n      blockId,\n      name,\n      week,\n      passPlan,\n      startAt\n    };\n    if (mode === 'edit') {\n      payload.id = defaults.id;\n    }\n    await onSubmit(payload);\n    if (document.body.contains(overlay)) {\n      document.body.removeChild(overlay);\n    }\n  });\n\n  card.appendChild(form);\n  overlay.appendChild(card);\n  overlay.addEventListener('click', event => {\n    if (event.target === overlay) {\n      document.body.removeChild(overlay);\n    }\n  });\n  document.body.appendChild(overlay);\n  nameInput.focus();\n}\n\nfunction handleEdit(lecture, blocks, lectureLists, redraw) {\n  openLectureDialog({\n    mode: 'edit',\n    blocks,\n    lectureLists,\n    defaults: {\n      blockId: lecture.blockId,\n      id: lecture.id,\n      name: lecture.name || '',\n      week: lecture.week ?? '',\n      passPlan: lecture.passPlan,\n      startAt: lecture.startAt\n    },\n    onSubmit: async payload => {\n      await saveLecture({\n        blockId: lecture.blockId,\n        id: lecture.id,\n        name: payload.name,\n        week: payload.week,\n        passPlan: payload.passPlan,\n        startAt: payload.startAt\n      });\n      await invalidateBlockCatalog();\n      await redraw();\n    }\n  });\n}\n\nfunction handleDelete(lecture, redraw) {\n  (async () => {\n    if (!(await confirmModal('Delete lecture?'))) return;\n    await deleteLecture(lecture.blockId, lecture.id);\n    await invalidateBlockCatalog();\n    await redraw();\n  })();\n}\n\nfunction passScopeModal(mode) {\n  return new Promise(resolve => {\n    const overlay = document.createElement('div');\n    overlay.className = 'modal lecture-pass-scope-modal';\n\n    const card = document.createElement('div');\n    card.className = 'card lecture-pass-scope-card';\n\n    const title = document.createElement('h3');\n    title.textContent = mode === 'push'\n      ? 'Push pass timing'\n      : 'Pull pass timing';\n    card.appendChild(title);\n\n    const message = document.createElement('p');\n    message.textContent = mode === 'push'\n      ? 'Choose how far the push should ripple.'\n      : 'Choose how far the pull should ripple.';\n    card.appendChild(message);\n\n    const buttons = document.createElement('div');\n    buttons.className = 'row lecture-pass-scope-buttons';\n\n    const single = document.createElement('button');\n    single.className = 'btn secondary';\n    single.textContent = 'Only this pass';\n    single.addEventListener('click', () => {\n      cleanup('single');\n    });\n\n    const cascade = document.createElement('button');\n    cascade.className = 'btn';\n    cascade.textContent = mode === 'push' ? 'This & following' : 'This & preceding';\n    cascade.addEventListener('click', () => {\n      cleanup(mode === 'push' ? 'chain-after' : 'chain-before');\n    });\n\n    const cancel = document.createElement('button');\n    cancel.className = 'btn secondary';\n    cancel.textContent = 'Cancel';\n    cancel.addEventListener('click', () => {\n      cleanup(null);\n    });\n\n    buttons.appendChild(single);\n    buttons.appendChild(cascade);\n    buttons.appendChild(cancel);\n    card.appendChild(buttons);\n\n    overlay.appendChild(card);\n\n    function cleanup(result) {\n      if (document.body.contains(overlay)) {\n        document.body.removeChild(overlay);\n      }\n      resolve(result);\n    }\n\n    overlay.addEventListener('click', event => {\n      if (event.target === overlay) {\n        cleanup(null);\n      }\n    });\n\n    document.body.appendChild(overlay);\n    single.focus();\n  });\n}\n\nfunction clampOffsetMinutes(value) {\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric)) return 0;\n  return Math.max(0, Math.round(numeric));\n}\n\nfunction cloneLecturePasses(lecture) {\n  return Array.isArray(lecture?.passes)\n    ? lecture.passes.map(pass => ({ ...pass }))\n    : [];\n}\n\nasync function togglePassCompletion(lecture, order, completed, redraw) {\n  if (!lecture || lecture.blockId == null || lecture.id == null) return;\n  const targetOrder = Number(order);\n  if (!Number.isFinite(targetOrder)) return;\n  const passes = cloneLecturePasses(lecture);\n  const index = passes.findIndex(pass => Number(pass?.order) === targetOrder);\n  if (index < 0) return;\n  const next = { ...passes[index] };\n  if (completed) {\n    next.completedAt = Number.isFinite(next.completedAt) ? next.completedAt : Date.now();\n  } else {\n    next.completedAt = null;\n  }\n  passes[index] = next;\n  const status = deriveLectureStatus(passes, lecture.status);\n  const nextDueAt = calculateNextDue(passes);\n  await saveLecture({\n    blockId: lecture.blockId,\n    id: lecture.id,\n    passes,\n    status,\n    nextDueAt\n  });\n  await invalidateBlockCatalog();\n  await redraw();\n}\n\nfunction normalizeSchedule(plan) {\n  return Array.isArray(plan?.schedule)\n    ? plan.schedule.map(step => ({ ...step }))\n    : [];\n}\n\nasync function updatePassFunction(lecture, order, action, redraw) {\n  if (!lecture || lecture.blockId == null || lecture.id == null) return;\n  const plan = clonePassPlan(lecture.passPlan || {});\n  const schedule = normalizeSchedule(plan);\n  const step = schedule.find(entry => Number(entry?.order) === Number(order));\n  if (!step) return;\n  step.action = action;\n  const passes = cloneLecturePasses(lecture);\n  const pass = passes.find(entry => Number(entry?.order) === Number(order));\n  if (pass) {\n    pass.action = action;\n  }\n  plan.schedule = schedule;\n  await saveLecture({\n    blockId: lecture.blockId,\n    id: lecture.id,\n    passPlan: plan,\n    passes\n  });\n  await invalidateBlockCatalog();\n  await redraw();\n}\n\nasync function shiftPassTiming(lecture, order, deltaMinutes, scope, redraw) {\n  if (!lecture || lecture.blockId == null || lecture.id == null) return;\n  if (!Number.isFinite(deltaMinutes) || deltaMinutes === 0) return;\n  const plan = clonePassPlan(lecture.passPlan || {});\n  const schedule = normalizeSchedule(plan);\n  if (!schedule.length) return;\n\n  const targetOrder = Number(order);\n  if (!Number.isFinite(targetOrder)) return;\n\n  const affectedOrders = new Set();\n  schedule.forEach(step => {\n    const currentOrder = Number(step?.order);\n    if (!Number.isFinite(currentOrder)) return;\n    if (scope === 'chain-after' && currentOrder >= targetOrder) {\n      affectedOrders.add(currentOrder);\n    } else if (scope === 'chain-before' && currentOrder <= targetOrder) {\n      affectedOrders.add(currentOrder);\n    } else if (!scope || scope === 'single') {\n      if (currentOrder === targetOrder) affectedOrders.add(currentOrder);\n    }\n  });\n  if (!affectedOrders.size) affectedOrders.add(targetOrder);\n\n  schedule.forEach(step => {\n    const currentOrder = Number(step?.order);\n    if (!Number.isFinite(currentOrder)) return;\n    const offset = clampOffsetMinutes(step.offsetMinutes);\n    if (affectedOrders.has(currentOrder)) {\n      step.offsetMinutes = Math.max(0, offset + deltaMinutes);\n    } else {\n      step.offsetMinutes = offset;\n    }\n  });\n\n  const minuteMs = 60 * 1000;\n  const passMap = new Map();\n  cloneLecturePasses(lecture).forEach(pass => {\n    const orderKey = Number(pass?.order);\n    if (Number.isFinite(orderKey) && !passMap.has(orderKey)) {\n      passMap.set(orderKey, { ...pass });\n    }\n  });\n\n  affectedOrders.forEach(orderKey => {\n    const pass = passMap.get(orderKey);\n    if (pass && Number.isFinite(pass.due)) {\n      const nextDue = Math.max(0, Math.round(pass.due + deltaMinutes * minuteMs));\n      pass.due = nextDue;\n      passMap.set(orderKey, pass);\n    }\n  });\n\n  const decorated = schedule.map((step, index) => ({\n    ...step,\n    originalOrder: Number(step?.order) || index + 1,\n    offsetMinutes: clampOffsetMinutes(step.offsetMinutes)\n  }));\n\n  decorated.sort((a, b) => {\n    if (a.offsetMinutes !== b.offsetMinutes) return a.offsetMinutes - b.offsetMinutes;\n    return a.originalOrder - b.originalOrder;\n  });\n\n  const newSchedule = [];\n  const reassignedPasses = [];\n  decorated.forEach((entry, index) => {\n    const newOrder = index + 1;\n    const base = { ...entry };\n    delete base.originalOrder;\n    base.order = newOrder;\n    newSchedule.push(base);\n    const pass = passMap.get(entry.originalOrder);\n    if (pass) {\n      pass.order = newOrder;\n      reassignedPasses.push(pass);\n      passMap.delete(entry.originalOrder);\n    }\n  });\n\n  passMap.forEach(pass => {\n    reassignedPasses.push(pass);\n  });\n\n  reassignedPasses.sort((a, b) => {\n    const ao = Number(a?.order) || 0;\n    const bo = Number(b?.order) || 0;\n    return ao - bo;\n  });\n\n  plan.schedule = newSchedule;\n\n  await saveLecture({\n    blockId: lecture.blockId,\n    id: lecture.id,\n    passPlan: plan,\n    passes: reassignedPasses\n  });\n  await invalidateBlockCatalog();\n  await redraw();\n}\n\nfunction openPassEditDialog({ lecture, passInfo, onUpdateAction, onShift }) {\n  const overlay = document.createElement('div');\n  overlay.className = 'modal lecture-pass-modal';\n\n  const card = document.createElement('div');\n  card.className = 'card lecture-pass-card';\n\n  const title = document.createElement('h2');\n  const passLabel = passInfo?.label || `Pass ${passInfo?.order ?? ''}`;\n  title.textContent = `Edit ${passLabel}`;\n  card.appendChild(title);\n\n  const meta = document.createElement('div');\n  meta.className = 'lecture-pass-meta';\n\n  const dateLine = document.createElement('div');\n  dateLine.className = 'lecture-pass-meta-line';\n  dateLine.textContent = Number.isFinite(passInfo?.due)\n    ? formatPassDueTimestamp(passInfo.due)\n    : 'No scheduled date';\n  meta.appendChild(dateLine);\n\n  const countdownLine = document.createElement('div');\n  countdownLine.className = 'lecture-pass-meta-line';\n  countdownLine.textContent = describePassCountdown(passInfo?.due);\n  meta.appendChild(countdownLine);\n\n  card.appendChild(meta);\n\n  const actionField = document.createElement('label');\n  actionField.className = 'lecture-pass-modal-field';\n  actionField.textContent = 'Pass function';\n  const actionInput = document.createElement('input');\n  actionInput.type = 'text';\n  actionInput.className = 'input';\n  actionInput.value = passInfo?.action || passInfo?.label || '';\n  const actionListId = `pass-action-${lecture.blockId}-${lecture.id}-${passInfo?.order}`\n    .replace(/[^a-zA-Z0-9_-]/g, '-');\n  const actionDatalist = document.createElement('datalist');\n  actionDatalist.id = actionListId;\n  LECTURE_PASS_ACTIONS.forEach(action => {\n    const option = document.createElement('option');\n    option.value = action;\n    actionDatalist.appendChild(option);\n  });\n  actionInput.setAttribute('list', actionListId);\n  actionField.appendChild(actionInput);\n  actionField.appendChild(actionDatalist);\n  card.appendChild(actionField);\n\n  const adjustSection = document.createElement('section');\n  adjustSection.className = 'lecture-pass-adjust';\n\n  const adjustTitle = document.createElement('h3');\n  adjustTitle.textContent = 'Adjust timing';\n  adjustSection.appendChild(adjustTitle);\n\n  const adjustControls = document.createElement('div');\n  adjustControls.className = 'lecture-pass-adjust-controls';\n\n  const amountInput = document.createElement('input');\n  amountInput.type = 'number';\n  amountInput.className = 'input lecture-pass-adjust-value';\n  amountInput.min = '0';\n  amountInput.step = '1';\n  amountInput.value = '1';\n\n  const unitSelect = document.createElement('select');\n  unitSelect.className = 'input lecture-pass-adjust-unit';\n  OFFSET_UNITS.forEach(option => {\n    const opt = document.createElement('option');\n    opt.value = option.id;\n    opt.textContent = option.label;\n    unitSelect.appendChild(opt);\n  });\n  unitSelect.value = 'days';\n\n  adjustControls.appendChild(amountInput);\n  adjustControls.appendChild(unitSelect);\n  adjustSection.appendChild(adjustControls);\n\n  const adjustButtons = document.createElement('div');\n  adjustButtons.className = 'lecture-pass-adjust-buttons';\n\n  const pushBtn = document.createElement('button');\n  pushBtn.type = 'button';\n  pushBtn.className = 'btn';\n  pushBtn.textContent = 'Push later';\n\n  const pullBtn = document.createElement('button');\n  pullBtn.type = 'button';\n  pullBtn.className = 'btn secondary';\n  pullBtn.textContent = 'Pull earlier';\n\n  adjustButtons.appendChild(pushBtn);\n  adjustButtons.appendChild(pullBtn);\n  adjustSection.appendChild(adjustButtons);\n\n  card.appendChild(adjustSection);\n\n  const feedback = document.createElement('div');\n  feedback.className = 'lecture-pass-feedback';\n  card.appendChild(feedback);\n\n  const actions = document.createElement('div');\n  actions.className = 'row lecture-pass-actions';\n\n  const saveBtn = document.createElement('button');\n  saveBtn.type = 'button';\n  saveBtn.className = 'btn';\n  saveBtn.textContent = 'Save function';\n\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'btn secondary';\n  closeBtn.textContent = 'Close';\n\n  actions.appendChild(saveBtn);\n  actions.appendChild(closeBtn);\n  card.appendChild(actions);\n\n  overlay.appendChild(card);\n\n  function showMessage(message) {\n    feedback.textContent = message || '';\n    if (message) {\n      feedback.classList.add('is-visible');\n    } else {\n      feedback.classList.remove('is-visible');\n    }\n  }\n\n  let busy = false;\n\n  function setBusy(value) {\n    busy = Boolean(value);\n    saveBtn.disabled = busy;\n    pushBtn.disabled = busy;\n    pullBtn.disabled = busy;\n  }\n\n  function close() {\n    if (document.body.contains(overlay)) {\n      document.body.removeChild(overlay);\n    }\n  }\n\n  async function handleSave() {\n    if (busy) return;\n    const value = actionInput.value.trim();\n    if (!value) {\n      showMessage('Enter a function for this pass.');\n      return;\n    }\n    setBusy(true);\n    try {\n      await onUpdateAction(value);\n      close();\n    } catch (err) {\n      console.error(err);\n      showMessage('Failed to update pass. Please try again.');\n      setBusy(false);\n    }\n  }\n\n  async function handleShift(mode) {\n    if (busy) return;\n    const amount = Number(amountInput.value);\n    if (!Number.isFinite(amount) || amount <= 0) {\n      showMessage('Enter how much to adjust the pass by.');\n      return;\n    }\n    const minutes = combineOffsetValueUnit(amount, unitSelect.value);\n    if (!Number.isFinite(minutes) || minutes <= 0) {\n      showMessage('Pick a timing greater than zero.');\n      return;\n    }\n    const scope = await passScopeModal(mode);\n    if (!scope) return;\n    const delta = mode === 'push' ? minutes : -minutes;\n    setBusy(true);\n    try {\n      await onShift(delta, scope);\n      close();\n    } catch (err) {\n      console.error(err);\n      showMessage('Failed to adjust timing. Please try again.');\n      setBusy(false);\n    }\n  }\n\n  saveBtn.addEventListener('click', handleSave);\n  pushBtn.addEventListener('click', () => handleShift('push'));\n  pullBtn.addEventListener('click', () => handleShift('pull'));\n  closeBtn.addEventListener('click', close);\n\n  overlay.addEventListener('click', event => {\n    if (event.target === overlay) {\n      close();\n    }\n  });\n\n  document.body.appendChild(overlay);\n  actionInput.focus();\n}\n\nfunction handlePassEdit(lecture, passInfo, redraw) {\n  if (!lecture || !passInfo) return;\n  openPassEditDialog({\n    lecture,\n    passInfo,\n    onUpdateAction: action => updatePassFunction(lecture, passInfo.order, action, redraw),\n    onShift: (delta, scope) => shiftPassTiming(lecture, passInfo.order, delta, scope, redraw)\n  });\n}\n\nasync function handlePassToggle(lecture, passInfo, checked, redraw) {\n  if (!lecture || !passInfo) return;\n  await togglePassCompletion(lecture, passInfo.order, checked, redraw);\n}\n\nexport async function renderLectures(root, redraw) {\n  const [catalog, settings] = await Promise.all([\n    loadBlockCatalog(),\n    getSettings()\n  ]);\n  setPassColorPalette(settings?.plannerDefaults?.passColors);\n  const filters = ensureLectureState();\n  const blocks = (catalog.blocks || []).map(block => ({ ...block }));\n  const allLectures = collectLectures(catalog);\n  const lectureLists = catalog.lectureLists || {};\n  const filtered = applyFilters(allLectures, filters);\n  const defaultPassPlan = plannerDefaultsToPassPlan(settings?.plannerDefaults);\n  const requestRedraw = () => {\n    captureLectureViewState();\n    return redraw();\n  };\n\n  const resolveBlockLabel = blockInfo => {\n    if (!blockInfo) return 'block';\n    return blockInfo.title || blockInfo.name || blockInfo.blockId || 'block';\n  };\n\n  async function handleExportLectureBundle(lecture, blockInfo) {\n    if (!lecture || lecture.id == null) {\n      alert('Lecture information is incomplete.');\n      return;\n    }\n    const normalizedBlockId = String(lecture.blockId ?? '').trim();\n    if (!normalizedBlockId) {\n      alert('Assign this lecture to a block before exporting.');\n      return;\n    }\n    try {\n      const bundle = await exportLectureTransfer(normalizedBlockId, lecture.id);\n      const blockLabel = resolveBlockLabel(blockInfo) || lecture.blockId || 'block';\n      const lectureLabel = lecture.name || `lecture-${lecture.id}`;\n      const filename = `lecture-${slugify(blockLabel)}-${slugify(lectureLabel)}.json`;\n      downloadJson(bundle, filename);\n    } catch (err) {\n      console.error('Failed to export lecture bundle', err);\n      alert('Failed to export lecture.');\n    }\n  }\n\n  async function handleExportWeekBundle(blockInfo, weekValue) {\n    const blockId = blockInfo?.blockId;\n    if (!blockId) {\n      alert('Assign the lectures to a block before exporting a week.');\n      return;\n    }\n    try {\n      const bundle = await exportWeekTransfer(blockId, weekValue == null ? null : weekValue);\n      const blockLabel = resolveBlockLabel(blockInfo);\n      const weekSlug = weekValue == null ? 'no-week' : `week-${weekValue}`;\n      const filename = `week-${slugify(blockLabel)}-${slugify(weekSlug)}.json`;\n      downloadJson(bundle, filename);\n    } catch (err) {\n      console.error('Failed to export week bundle', err);\n      alert('Failed to export week.');\n    }\n  }\n\n  async function handleExportBlockBundle(blockInfo) {\n    const blockId = blockInfo?.blockId;\n    if (!blockId) {\n      alert('Select a block to export.');\n      return;\n    }\n    try {\n      const bundle = await exportBlockTransfer(blockId);\n      const filename = `block-${slugify(resolveBlockLabel(blockInfo))}.json`;\n      downloadJson(bundle, filename);\n    } catch (err) {\n      console.error('Failed to export block bundle', err);\n      alert('Failed to export block.');\n    }\n  }\n\n  async function handleImportBundle(payload) {\n    try {\n      const conflicts = detectImportConflicts(payload, catalog);\n      let strategy = 'merge';\n      if (conflicts.hasConflicts) {\n        const choice = await promptImportStrategy(conflicts);\n        if (!choice) {\n          return;\n      }\n      strategy = choice;\n    }\n    await importLectureTransfer(payload, { strategy });\n    await invalidateBlockCatalog();\n    await requestRedraw();\n    alert('Import complete.');\n  } catch (err) {\n    console.error('Failed to import lecture bundle', err);\n    alert('Import failed.');\n  }\n  }\n\n  root.innerHTML = '';\n  const layout = document.createElement('div');\n  layout.className = 'lectures-view';\n  root.appendChild(layout);\n\n  const toolbar = buildToolbar(\n    blocks,\n    allLectures,\n    lectureLists,\n    requestRedraw,\n    defaultPassPlan,\n    handleImportBundle\n  );\n  layout.appendChild(toolbar);\n\n  const table = renderLectureTable(\n    blocks,\n    filtered,\n    filters,\n    lecture => handleEdit(lecture, blocks, lectureLists, requestRedraw),\n    lecture => handleDelete(lecture, requestRedraw),\n    (lecture, pass) => handlePassEdit(lecture, pass, requestRedraw),\n    (lecture, pass, checked) => handlePassToggle(lecture, pass, checked, requestRedraw),\n    (lecture, blockInfo) => handleExportLectureBundle(lecture, blockInfo || blocks.find(block => block.blockId === lecture.blockId)),\n    (blockInfo, weekValue) => handleExportWeekBundle(blockInfo, weekValue),\n    blockInfo => handleExportBlockBundle(blockInfo)\n  );\n  layout.appendChild(table);\n\n  const scroller = findLectureScrollContainer(root);\n  requestAnimationFrame(() => {\n    const target = Number(filters?.scrollTop);\n    if (Number.isFinite(target) && target > 0) {\n      if (scroller && typeof scroller.scrollTo === 'function') {\n        scroller.scrollTo({ top: target, left: 0, behavior: 'auto' });\n      } else if (scroller && 'scrollTop' in scroller) {\n        scroller.scrollTop = target;\n      } else {\n        window.scrollTo({ top: target, left: 0, behavior: 'auto' });\n      }\n    }\n  });\n}\n", "import { state, setFlashSession, setSubtab, setStudySelectedMode } from '../../state.js';\nimport { setToggleState } from '../../utils.js';\nimport { renderRichText } from './rich-text.js';\nimport { sectionsForItem } from './section-utils.js';\nimport { openEditor } from './editor.js';\nimport { REVIEW_RATINGS, DEFAULT_REVIEW_STEPS } from '../../review/constants.js';\nimport { getReviewDurations, rateSection, getSectionStateSnapshot } from '../../review/scheduler.js';\nimport { upsertItem } from '../../storage/storage.js';\nimport { persistStudySession, removeStudySession } from '../../study/study-sessions.js';\n\n\nconst KIND_ACCENTS = {\n  disease: 'var(--pink)',\n  drug: 'var(--blue)',\n  concept: 'var(--green)'\n};\n\n\nconst RATING_LABELS = {\n  again: 'Again',\n  hard: 'Hard',\n  good: 'Good',\n  easy: 'Easy'\n};\n\nconst RATING_CLASS = {\n  again: 'danger',\n  hard: 'secondary',\n  good: '',\n  easy: ''\n};\n\n\nfunction getFlashcardAccent(item) {\n  if (item?.color) return item.color;\n  if (item?.kind && KIND_ACCENTS[item.kind]) return KIND_ACCENTS[item.kind];\n  return 'var(--accent)';\n}\n\n\nfunction queueStatusLabel(snapshot) {\n  if (!snapshot || snapshot.retired) return 'Already in review queue';\n  const rating = snapshot.lastRating;\n  if (rating && RATING_LABELS[rating]) {\n    return `In review (${RATING_LABELS[rating]})`;\n  }\n  return 'Already in review queue';\n}\n\nfunction ratingKey(item, sectionKey) {\n  const id = item?.id || 'item';\n  return `${id}::${sectionKey}`;\n}\n\nfunction sessionEntryAt(session, idx) {\n  const pool = Array.isArray(session.pool) ? session.pool : [];\n  return pool[idx] || null;\n}\n\nfunction normalizeFlashSession(session, fallbackPool, defaultMode = 'study') {\n  const source = session && typeof session === 'object' ? session : {};\n  const next = { ...source };\n  let changed = !session || typeof session !== 'object';\n  const fallback = Array.isArray(fallbackPool) ? fallbackPool : [];\n  const pool = Array.isArray(source.pool) && source.pool.length ? source.pool : fallback;\n  if (source.pool !== pool) {\n    next.pool = pool;\n    changed = true;\n  }\n  const ratings = source.ratings && typeof source.ratings === 'object' ? source.ratings : {};\n  if (source.ratings !== ratings) {\n    next.ratings = ratings;\n    changed = true;\n  }\n  let idx = typeof source.idx === 'number' && Number.isFinite(source.idx) ? Math.floor(source.idx) : 0;\n  if (idx < 0) idx = 0;\n  const maxIdx = pool.length ? pool.length - 1 : 0;\n  if (idx > maxIdx) idx = maxIdx;\n  if (idx !== source.idx) {\n    next.idx = idx;\n    changed = true;\n  }\n  const mode = source.mode === 'review' ? 'review' : defaultMode;\n  if (source.mode !== mode) {\n    next.mode = mode;\n    changed = true;\n  }\n  return changed ? next : session;\n}\n\nexport function renderFlashcards(root, redraw) {\n  const fallbackPool = Array.isArray(state.cohort) ? state.cohort : [];\n  let active = state.flashSession;\n  if (active) {\n    const normalized = normalizeFlashSession(active, fallbackPool, active.mode === 'review' ? 'review' : 'study');\n    if (normalized !== active) {\n      setFlashSession(normalized);\n      active = normalized;\n    }\n  } else {\n    active = normalizeFlashSession({ idx: 0, pool: fallbackPool, ratings: {}, mode: 'study' }, fallbackPool, 'study');\n  }\n  active.ratings = active.ratings || {};\n  const items = Array.isArray(active.pool) && active.pool.length ? active.pool : fallbackPool;\n\n\n  const resolvePool = () => (Array.isArray(active.pool) && active.pool.length ? active.pool : items);\n  const commitSession = (patch = {}) => {\n    const pool = resolvePool();\n    const next = { ...active, pool, ...patch };\n    if (patch.ratings) {\n      next.ratings = { ...patch.ratings };\n    } else {\n      next.ratings = { ...active.ratings };\n    }\n    active = next;\n    setFlashSession(next);\n  };\n\n  const isReview = active.mode === 'review';\n\n  root.innerHTML = '';\n\n  if (!items.length) {\n    const msg = document.createElement('div');\n    msg.textContent = 'No cards selected. Adjust the filters above to add cards.';\n    root.appendChild(msg);\n    return;\n  }\n\n  if (active.idx >= items.length) {\n\n    setFlashSession(null);\n    setStudySelectedMode('Flashcards');\n    setSubtab('Study', isReview ? 'Review' : 'Builder');\n    if (isReview) {\n      removeStudySession('review').catch(err => console.warn('Failed to clear review session', err));\n    } else {\n      removeStudySession('flashcards').catch(err => console.warn('Failed to clear flashcard session', err));\n    }\n    redraw();\n    return;\n  }\n\n  const entry = sessionEntryAt(active, active.idx);\n  const item = entry && entry.item ? entry.item : entry;\n  if (!item) {\n    setFlashSession(null);\n    redraw();\n    return;\n  }\n\n  const allowedSections = entry && entry.sections ? entry.sections : null;\n  const sections = sectionsForItem(item, allowedSections);\n\n  const card = document.createElement('section');\n  card.className = 'card flashcard';\n  card.tabIndex = 0;\n\n  const header = document.createElement('div');\n  header.className = 'flashcard-header';\n\n  const title = document.createElement('h2');\n  title.className = 'flashcard-title';\n  title.textContent = item.name || item.concept || '';\n  header.appendChild(title);\n\n  const editBtn = document.createElement('button');\n  editBtn.type = 'button';\n  editBtn.className = 'icon-btn flashcard-edit-btn';\n  editBtn.innerHTML = '\u270F\uFE0F';\n  editBtn.title = 'Edit card';\n  editBtn.setAttribute('aria-label', 'Edit card');\n  editBtn.addEventListener('click', event => {\n    event.stopPropagation();\n    const onSave = typeof redraw === 'function' ? () => redraw() : undefined;\n    openEditor(item.kind, onSave, item);\n  });\n  header.appendChild(editBtn);\n\n  card.appendChild(header);\n\n  const durationsPromise = getReviewDurations().catch(() => ({ ...DEFAULT_REVIEW_STEPS }));\n  const sectionBlocks = sections.length ? sections : [];\n  const sectionRequirements = new Map();\n  if (!sectionBlocks.length) {\n    const empty = document.createElement('div');\n    empty.className = 'flash-empty';\n    empty.textContent = 'No content available for this card.';\n    card.appendChild(empty);\n  }\n\n  sectionBlocks.forEach(({ key, label, content, extra }) => {\n    const ratingId = ratingKey(item, key);\n    const previousRating = active.ratings[ratingId] || null;\n    const snapshot = getSectionStateSnapshot(item, key);\n    const lockedByQueue = !isReview && Boolean(snapshot && snapshot.last && !snapshot.retired);\n    const alreadyQueued = !isReview && Boolean(snapshot && snapshot.last && !snapshot.retired);\n    const requiresRating = isReview || !alreadyQueued;\n    sectionRequirements.set(key, requiresRating);\n    const sec = document.createElement('div');\n    sec.className = 'flash-section';\n    if (extra) sec.classList.add('flash-section-extra');\n    sec.setAttribute('role', 'button');\n    sec.tabIndex = 0;\n\n    const head = document.createElement('div');\n    head.className = 'flash-heading';\n    head.textContent = label;\n\n    const body = document.createElement('div');\n    body.className = 'flash-body';\n    renderRichText(body, content || '', { clozeMode: 'interactive' });\n\n    const ratingRow = document.createElement('div');\n    ratingRow.className = 'flash-rating';\n\n    const ratingButtons = document.createElement('div');\n    ratingButtons.className = 'flash-rating-options';\n\n    const status = document.createElement('span');\n    status.className = 'flash-rating-status';\n\n    let ratingLocked = lockedByQueue;\n\n    const selectRating = (value) => {\n      active.ratings[ratingId] = value;\n      Array.from(ratingButtons.querySelectorAll('button')).forEach(btn => {\n        const btnValue = btn.dataset.value;\n        const isSelected = btnValue === value;\n        btn.classList.toggle('is-selected', isSelected);\n\n        if (isSelected) {\n          ratingButtons.dataset.selected = value;\n        } else if (ratingButtons.dataset.selected === btnValue) {\n          delete ratingButtons.dataset.selected;\n        }\n\n        btn.setAttribute('aria-pressed', isSelected ? 'true' : 'false');\n      });\n      status.classList.remove('is-error');\n      commitSession({ ratings: { ...active.ratings } });\n\n    };\n\n    const handleRating = async (value) => {\n      if (ratingLocked) return;\n\n      const durations = await durationsPromise;\n      setToggleState(sec, true, 'revealed');\n      ratingRow.classList.add('is-saving');\n      status.textContent = 'Saving\u2026';\n      status.classList.remove('is-error');\n      try {\n        rateSection(item, key, value, durations, Date.now());\n        await upsertItem(item);\n        selectRating(value);\n        status.textContent = 'Saved';\n        status.classList.remove('is-error');\n      } catch (err) {\n        console.error('Failed to record rating', err);\n        status.textContent = 'Save failed';\n        status.classList.add('is-error');\n      } finally {\n        ratingRow.classList.remove('is-saving');\n      }\n    };\n\n    REVIEW_RATINGS.forEach(value => {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.dataset.value = value;\n      btn.dataset.rating = value;\n      btn.className = 'flash-rating-btn';\n      const variant = RATING_CLASS[value];\n      if (variant) btn.classList.add(variant);\n      btn.textContent = RATING_LABELS[value];\n      btn.setAttribute('aria-pressed', 'false');\n      btn.addEventListener('click', (event) => {\n        event.stopPropagation();\n        handleRating(value);\n      });\n      btn.addEventListener('keydown', (event) => {\n        event.stopPropagation();\n        if (event.key === 'Enter' || event.key === ' ') {\n          event.preventDefault();\n          handleRating(value);\n        }\n      });\n      ratingButtons.appendChild(btn);\n    });\n\n    const unlockRating = () => {\n      if (!ratingLocked) return;\n      ratingLocked = false;\n      ratingRow.classList.remove('is-locked');\n      ratingButtons.hidden = false;\n      status.classList.remove('flash-rating-status-action');\n      status.removeAttribute('role');\n      status.removeAttribute('tabindex');\n      status.textContent = previousRating ? 'Update rating' : 'Select a rating (optional)';\n    };\n\n    if (lockedByQueue) {\n      ratingLocked = true;\n      ratingRow.classList.add('is-locked');\n      ratingButtons.hidden = true;\n      const label = queueStatusLabel(snapshot);\n      status.textContent = `${label} \u2014 click to adjust`;\n      status.classList.add('flash-rating-status-action');\n      status.setAttribute('role', 'button');\n      status.setAttribute('tabindex', '0');\n      status.setAttribute('aria-label', 'Update review rating');\n      status.addEventListener('click', (event) => {\n        event.stopPropagation();\n        unlockRating();\n      });\n      status.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter' || event.key === ' ') {\n          event.preventDefault();\n          unlockRating();\n        }\n      });\n    } else if (previousRating) {\n      status.textContent = 'Saved';\n    } else {\n      status.textContent = 'Select a rating (optional)';\n    }\n\n    if (previousRating) {\n      selectRating(previousRating);\n\n    }\n\n    ratingRow.appendChild(ratingButtons);\n    ratingRow.appendChild(status);\n\n    setToggleState(sec, false, 'revealed');\n    const toggleReveal = () => {\n      if (sec.classList.contains('flash-section-disabled')) return;\n      if (sec.contains(document.activeElement) && document.activeElement?.tagName === 'BUTTON') return;\n      const next = sec.dataset.active !== 'true';\n      setToggleState(sec, next, 'revealed');\n    };\n    sec.addEventListener('click', (event) => {\n      if (event.target instanceof HTMLElement) {\n        if (event.target.closest('.flash-rating')) return;\n        if (event.target.closest('[data-cloze]')) return;\n      }\n      toggleReveal();\n    });\n    sec.addEventListener('keydown', (e) => {\n      if (e.target instanceof HTMLElement && e.target.closest('.flash-rating')) return;\n      if (e.key === 'Enter' || e.key === ' ') {\n        e.preventDefault();\n        toggleReveal();\n      }\n    });\n\n    sec.appendChild(head);\n    sec.appendChild(body);\n    sec.appendChild(ratingRow);\n    card.appendChild(sec);\n  });\n\n  const controls = document.createElement('div');\n  controls.className = 'row flash-controls';\n\n  const prev = document.createElement('button');\n  prev.className = 'btn';\n  prev.textContent = 'Prev';\n  prev.disabled = active.idx === 0;\n  prev.addEventListener('click', () => {\n    if (active.idx > 0) {\n\n      commitSession({ idx: active.idx - 1 });\n\n      redraw();\n    }\n  });\n  controls.appendChild(prev);\n\n  const next = document.createElement('button');\n  next.className = 'btn';\n  const isLast = active.idx >= items.length - 1;\n\n  next.textContent = isLast ? (isReview ? 'Finish review' : 'Finish') : 'Next';\n\n  next.addEventListener('click', () => {\n    const pool = Array.isArray(active.pool) ? active.pool : items;\n    const idx = active.idx + 1;\n    if (idx >= items.length) {\n      setFlashSession(null);\n    } else {\n\n      commitSession({ idx });\n\n    }\n    redraw();\n  });\n  controls.appendChild(next);\n\n  if (!isReview) {\n    const saveExit = document.createElement('button');\n    saveExit.className = 'btn secondary';\n    saveExit.textContent = 'Save & close';\n    saveExit.addEventListener('click', async () => {\n      const original = saveExit.textContent;\n      saveExit.disabled = true;\n      saveExit.textContent = 'Saving\u2026';\n      try {\n        const pool = resolvePool();\n        await persistStudySession('flashcards', {\n          session: { ...active, idx: active.idx, pool, ratings: { ...(active.ratings || {}) } },\n\n          cohort: pool\n        });\n        setFlashSession(null);\n        setStudySelectedMode('Flashcards');\n        setSubtab('Study', 'Builder');\n        redraw();\n      } catch (err) {\n        console.error('Failed to save flashcard progress', err);\n        saveExit.textContent = 'Save failed';\n        setTimeout(() => { saveExit.textContent = original; }, 2000);\n      } finally {\n        saveExit.disabled = false;\n      }\n    });\n    controls.appendChild(saveExit);\n  } else {\n\n    const saveExit = document.createElement('button');\n    saveExit.className = 'btn secondary';\n    saveExit.textContent = 'Pause & save';\n    saveExit.addEventListener('click', async () => {\n      const original = saveExit.textContent;\n      saveExit.disabled = true;\n      saveExit.textContent = 'Saving\u2026';\n      try {\n\n        const pool = resolvePool();\n        await persistStudySession('review', {\n          session: { ...active, idx: active.idx, pool, ratings: { ...(active.ratings || {}) } },\n\n          cohort: state.cohort,\n          metadata: active.metadata || { label: 'Review session' }\n        });\n        setFlashSession(null);\n        setSubtab('Study', 'Review');\n        redraw();\n      } catch (err) {\n        console.error('Failed to save review session', err);\n        saveExit.textContent = 'Save failed';\n        setTimeout(() => { saveExit.textContent = original; }, 2000);\n      } finally {\n        saveExit.disabled = false;\n      }\n    });\n    controls.appendChild(saveExit);\n  }\n\n\n  card.appendChild(controls);\n  root.appendChild(card);\n\n  card.focus();\n  card.addEventListener('keydown', (e) => {\n    if (e.key === 'ArrowRight') {\n      next.click();\n    } else if (e.key === 'ArrowLeft') {\n      prev.click();\n    }\n  });\n\n\n  const accent = getFlashcardAccent(item);\n  card.style.setProperty('--flash-accent', accent);\n  card.style.setProperty('--flash-accent-soft', `color-mix(in srgb, ${accent} 16%, transparent)`);\n  card.style.setProperty('--flash-accent-strong', `color-mix(in srgb, ${accent} 32%, rgba(15, 23, 42, 0.08))`);\n  card.style.setProperty('--flash-accent-border', `color-mix(in srgb, ${accent} 42%, transparent)`);\n\n}\n", "\nimport { setFlashSession, setSubtab, setCohort } from '../../state.js';\nimport { collectDueSections, collectUpcomingSections } from '../../review/scheduler.js';\nimport { loadBlockCatalog } from '../../storage/block-catalog.js';\nimport { getSectionLabel } from './section-utils.js';\nimport { hydrateStudySessions, getStudySessionEntry, removeStudySession } from '../../study/study-sessions.js';\nimport { loadReviewSourceItems } from '../../review/pool.js';\n\n\nconst REVIEW_SCOPES = ['all', 'blocks', 'lectures'];\nlet activeScope = 'all';\nlet blockTitleCache = null;\n\nfunction ensureBlockTitleMap(blocks) {\n  if (blockTitleCache) return blockTitleCache;\n  const map = new Map();\n  blocks.forEach(block => {\n    if (!block || !block.blockId) return;\n    map.set(block.blockId, block.title || block.blockId);\n\n  });\n  blockTitleCache = map;\n  return map;\n}\n\nfunction titleOf(item) {\n  return item?.name || item?.concept || 'Untitled';\n}\n\nfunction formatOverdue(due, now) {\n  const diffMs = Math.max(0, now - due);\n  if (diffMs < 60 * 1000) return 'due now';\n  const minutes = Math.round(diffMs / (60 * 1000));\n  if (minutes < 60) return `${minutes} min overdue`;\n  const hours = Math.round(minutes / 60);\n  if (hours < 24) return `${hours} hr overdue`;\n  const days = Math.round(hours / 24);\n  return `${days} day${days === 1 ? '' : 's'} overdue`;\n}\n\nfunction formatTimeUntil(due, now) {\n  const diffMs = Math.max(0, due - now);\n  if (diffMs < 60 * 1000) return 'due in under a minute';\n  const minutes = Math.round(diffMs / (60 * 1000));\n  if (minutes < 60) return `due in ${minutes} min`;\n  const hours = Math.round(minutes / 60);\n  if (hours < 24) return `due in ${hours} hr`;\n  const days = Math.round(hours / 24);\n  return `due in ${days} day${days === 1 ? '' : 's'}`;\n}\n\nfunction groupByBlock(entries, blockTitles) {\n  const groups = new Map();\n  entries.forEach(entry => {\n    const blocks = Array.isArray(entry.item.blocks) && entry.item.blocks.length\n      ? entry.item.blocks\n      : ['__unassigned'];\n    blocks.forEach(blockId => {\n      const group = groups.get(blockId) || { id: blockId, entries: [] };\n      group.entries.push(entry);\n      groups.set(blockId, group);\n    });\n  });\n  return Array.from(groups.values()).map(group => ({\n    id: group.id,\n    title: group.id === '__unassigned' ? 'Unassigned' : (blockTitles.get(group.id) || group.id),\n    entries: group.entries\n  })).sort((a, b) => b.entries.length - a.entries.length);\n}\n\nfunction groupByLecture(entries, blockTitles) {\n  const groups = new Map();\n  entries.forEach(entry => {\n    const lectures = Array.isArray(entry.item.lectures) && entry.item.lectures.length\n      ? entry.item.lectures\n      : [{ blockId: '__unassigned', id: '__none', name: 'Unassigned lecture' }];\n    lectures.forEach(lec => {\n      const key = `${lec.blockId || '__unassigned'}::${lec.id}`;\n      const blockTitle = blockTitles.get(lec.blockId) || lec.blockId || 'Unassigned';\n      const title = lec.name ? `${blockTitle} \u2013 ${lec.name}` : `${blockTitle} \u2013 Lecture ${lec.id}`;\n      const group = groups.get(key) || { id: key, title, entries: [] };\n      group.entries.push(entry);\n      groups.set(key, group);\n    });\n  });\n  return Array.from(groups.values()).sort((a, b) => b.entries.length - a.entries.length);\n}\n\nfunction buildSessionPayload(entries) {\n  return entries.map(entry => ({ item: entry.item, sections: [entry.sectionKey] }));\n}\n\nfunction renderEmptyState(container) {\n  const empty = document.createElement('div');\n  empty.className = 'review-empty';\n  empty.textContent = 'No cards are due right now. Nice work!';\n  container.appendChild(empty);\n}\n\nfunction renderAllView(container, dueEntries, upcomingEntries, now, start) {\n  const actionRow = document.createElement('div');\n  actionRow.className = 'review-actions';\n  const startBtn = document.createElement('button');\n  startBtn.className = 'btn';\n  startBtn.textContent = `Start review (${dueEntries.length})`;\n  startBtn.disabled = dueEntries.length === 0;\n  startBtn.addEventListener('click', () => {\n    if (!dueEntries.length) return;\n    start(buildSessionPayload(dueEntries), { scope: 'all', label: 'All due cards' });\n  });\n  actionRow.appendChild(startBtn);\n\n  if (upcomingEntries.length) {\n    const upcomingBtn = document.createElement('button');\n    upcomingBtn.className = 'btn secondary';\n    upcomingBtn.textContent = `Review upcoming (${upcomingEntries.length})`;\n    upcomingBtn.addEventListener('click', () => {\n      if (!upcomingEntries.length) return;\n      start(buildSessionPayload(upcomingEntries), { scope: 'upcoming', label: 'Upcoming cards' });\n    });\n    actionRow.appendChild(upcomingBtn);\n  }\n  container.appendChild(actionRow);\n\n  if (!dueEntries.length && !upcomingEntries.length) {\n    renderEmptyState(container);\n    return;\n  }\n\n  if (!dueEntries.length) {\n    const info = document.createElement('div');\n    info.className = 'review-empty';\n    info.textContent = 'No cards are due right now. Upcoming cards are listed below.';\n    container.appendChild(info);\n  } else {\n    const list = document.createElement('ul');\n    list.className = 'review-entry-list';\n    dueEntries.forEach(entry => {\n      const item = document.createElement('li');\n      item.className = 'review-entry';\n      item.classList.add('is-clickable');\n      item.tabIndex = 0;\n      item.setAttribute('role', 'button');\n      item.setAttribute('aria-label', `Review ${titleOf(entry.item)} immediately`);\n      const title = document.createElement('div');\n      title.className = 'review-entry-title';\n      title.textContent = titleOf(entry.item);\n      const meta = document.createElement('div');\n      meta.className = 'review-entry-meta';\n      meta.textContent = `${getSectionLabel(entry.item, entry.sectionKey)} \u2022 ${formatOverdue(entry.due, now)}`;\n      item.appendChild(title);\n      item.appendChild(meta);\n      const launch = () => {\n        start(buildSessionPayload([entry]), { scope: 'single', label: `Focused review \u2013 ${titleOf(entry.item)}` });\n      };\n      item.addEventListener('click', launch);\n      item.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter' || event.key === ' ') {\n          event.preventDefault();\n          launch();\n        }\n      });\n      list.appendChild(item);\n    });\n    container.appendChild(list);\n  }\n\n  if (upcomingEntries.length) {\n    const upcomingSection = document.createElement('div');\n    upcomingSection.className = 'review-upcoming-section';\n\n    const heading = document.createElement('div');\n    heading.className = 'review-upcoming-title';\n    heading.textContent = 'Upcoming cards';\n    upcomingSection.appendChild(heading);\n\n    const note = document.createElement('div');\n    note.className = 'review-upcoming-note';\n    note.textContent = `Next ${upcomingEntries.length} card${upcomingEntries.length === 1 ? '' : 's'} in the queue`;\n    upcomingSection.appendChild(note);\n\n    const list = document.createElement('ul');\n    list.className = 'review-entry-list';\n    upcomingEntries.forEach(entry => {\n      const item = document.createElement('li');\n      item.className = 'review-entry is-upcoming';\n      item.classList.add('is-clickable');\n      item.tabIndex = 0;\n      item.setAttribute('role', 'button');\n      item.setAttribute('aria-label', `Review ${titleOf(entry.item)} early`);\n      const title = document.createElement('div');\n      title.className = 'review-entry-title';\n      title.textContent = titleOf(entry.item);\n      const meta = document.createElement('div');\n      meta.className = 'review-entry-meta';\n      meta.textContent = `${getSectionLabel(entry.item, entry.sectionKey)} \u2022 ${formatTimeUntil(entry.due, now)}`;\n      item.appendChild(title);\n      item.appendChild(meta);\n      const launch = () => {\n        start(buildSessionPayload([entry]), { scope: 'single', label: `Focused review \u2013 ${titleOf(entry.item)}` });\n      };\n      item.addEventListener('click', launch);\n      item.addEventListener('keydown', (event) => {\n        if (event.key === 'Enter' || event.key === ' ') {\n          event.preventDefault();\n          launch();\n        }\n      });\n      list.appendChild(item);\n    });\n    upcomingSection.appendChild(list);\n    container.appendChild(upcomingSection);\n  }\n}\n\n\nfunction renderGroupView(container, groups, label, start, metaBuilder = null) {\n\n  if (!groups.length) {\n    renderEmptyState(container);\n    return;\n  }\n  const list = document.createElement('div');\n  list.className = 'review-group-list';\n  groups.forEach(group => {\n    const card = document.createElement('div');\n    card.className = 'review-group-card';\n    const heading = document.createElement('div');\n    heading.className = 'review-group-heading';\n    const title = document.createElement('div');\n    title.className = 'review-group-title';\n    title.textContent = group.title;\n    const count = document.createElement('span');\n    count.className = 'review-group-count';\n    count.textContent = `${group.entries.length} card${group.entries.length === 1 ? '' : 's'}`;\n    heading.appendChild(title);\n    heading.appendChild(count);\n    card.appendChild(heading);\n\n\n    const actions = document.createElement('div');\n    actions.className = 'review-group-actions';\n    const startBtn = document.createElement('button');\n    startBtn.className = 'btn';\n    startBtn.textContent = `Start ${label}`;\n    startBtn.addEventListener('click', () => {\n      const metadata = typeof metaBuilder === 'function' ? metaBuilder(group) : { label };\n      start(buildSessionPayload(group.entries), metadata);\n    });\n    actions.appendChild(startBtn);\n    card.appendChild(actions);\n\n    list.appendChild(card);\n\n  });\n  container.appendChild(list);\n}\n\nexport async function renderReview(root, redraw) {\n  root.innerHTML = '';\n  await hydrateStudySessions().catch(err => console.error('Failed to load saved sessions', err));\n\n  const cohort = await loadReviewSourceItems();\n  if (!Array.isArray(cohort) || !cohort.length) {\n    const empty = document.createElement('div');\n    empty.className = 'review-empty';\n    empty.textContent = 'Add study cards to start building a review queue.';\n    root.appendChild(empty);\n    return;\n  }\n  setCohort(cohort);\n\n  const now = Date.now();\n  const dueEntries = collectDueSections(cohort, { now });\n  const upcomingEntries = collectUpcomingSections(cohort, { now, limit: 50 });\n  const { blocks } = await loadBlockCatalog();\n  const blockTitles = ensureBlockTitleMap(blocks);\n\n  const savedEntry = getStudySessionEntry('review');\n\n\n  const wrapper = document.createElement('section');\n  wrapper.className = 'card review-panel';\n\n  const backRow = document.createElement('div');\n  backRow.className = 'review-back-row';\n  const backBtn = document.createElement('button');\n  backBtn.type = 'button';\n  backBtn.className = 'btn secondary';\n  backBtn.textContent = 'Back to study';\n  backBtn.addEventListener('click', () => {\n    setSubtab('Study', 'Builder');\n    redraw();\n\n  });\n  backRow.appendChild(backBtn);\n  wrapper.appendChild(backRow);\n\n  const heading = document.createElement('h2');\n  heading.textContent = 'Review queue';\n  wrapper.appendChild(heading);\n\n  const summary = document.createElement('div');\n  summary.className = 'review-summary';\n  summary.textContent = `Cards due: ${dueEntries.length} \u2022 Upcoming: ${upcomingEntries.length}`;\n  wrapper.appendChild(summary);\n\n  if (savedEntry?.session) {\n    const resumeRow = document.createElement('div');\n    resumeRow.className = 'review-resume-row';\n    const resumeLabel = document.createElement('div');\n    resumeLabel.className = 'review-resume-label';\n    resumeLabel.textContent = savedEntry.metadata?.label || 'Saved review session available';\n    resumeRow.appendChild(resumeLabel);\n    const resumeBtn = document.createElement('button');\n    resumeBtn.type = 'button';\n    resumeBtn.className = 'btn';\n    resumeBtn.textContent = 'Resume';\n    resumeBtn.addEventListener('click', async () => {\n      await removeStudySession('review').catch(err => console.warn('Failed to clear saved review entry', err));\n      const restored = Array.isArray(savedEntry.cohort) ? savedEntry.cohort : null;\n      if (restored) {\n        setCohort(restored);\n      }\n      setFlashSession(savedEntry.session);\n      redraw();\n    });\n    resumeRow.appendChild(resumeBtn);\n    wrapper.appendChild(resumeRow);\n  }\n\n  const tabs = document.createElement('div');\n  tabs.className = 'review-tabs';\n  REVIEW_SCOPES.forEach(scope => {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'tab';\n    const label = scope === 'all' ? 'All' : scope === 'blocks' ? 'By block' : 'By lecture';\n    if (activeScope === scope) btn.classList.add('active');\n    btn.textContent = label;\n    btn.addEventListener('click', () => {\n      if (activeScope === scope) return;\n      activeScope = scope;\n      renderReview(root, redraw);\n    });\n    tabs.appendChild(btn);\n  });\n\n  wrapper.appendChild(tabs);\n\n  const body = document.createElement('div');\n  body.className = 'review-body';\n  wrapper.appendChild(body);\n\n\n  const startSession = async (pool, metadata = {}) => {\n    if (!pool.length) return;\n    await removeStudySession('review').catch(err => console.warn('Failed to discard existing review save', err));\n    setFlashSession({ idx: 0, pool, ratings: {}, mode: 'review', metadata });\n\n    redraw();\n  };\n\n  if (activeScope === 'all') {\n    renderAllView(body, dueEntries, upcomingEntries, now, startSession);\n  } else if (activeScope === 'blocks') {\n    const groups = groupByBlock(dueEntries, blockTitles);\n\n    renderGroupView(body, groups, 'block review', startSession, (group) => ({\n      scope: 'block',\n      label: `Block \u2013 ${group.title}`,\n      blockId: group.id\n    }));\n  } else {\n    const groups = groupByLecture(dueEntries, blockTitles);\n    renderGroupView(body, groups, 'lecture review', startSession, (group) => ({\n      scope: 'lecture',\n      label: `Lecture \u2013 ${group.title}`,\n      lectureId: group.id\n    }));\n\n  }\n\n  root.appendChild(wrapper);\n}\n", "import { state, setQuizSession, setSubtab, setStudySelectedMode } from '../../state.js';\nimport { renderRichText } from './rich-text.js';\nimport { persistStudySession, removeStudySession } from '../../study/study-sessions.js';\nimport { sectionsForItem } from './section-utils.js';\nimport { REVIEW_RATINGS, DEFAULT_REVIEW_STEPS } from '../../review/constants.js';\nimport { getReviewDurations, rateSection } from '../../review/scheduler.js';\nimport { upsertItem } from '../../storage/storage.js';\nimport { openEditor } from './editor.js';\n\n\nconst RATING_LABELS = {\n  again: 'Again',\n  hard: 'Hard',\n  good: 'Good',\n  easy: 'Easy'\n};\n\nconst RATING_CLASS = {\n  again: 'danger',\n  hard: 'secondary',\n  good: '',\n  easy: ''\n};\n\nfunction titleOf(item) {\n  return item?.name || item?.concept || '';\n}\n\nfunction ratingKey(item, sectionKey) {\n  const id = item?.id || 'item';\n  return `${id}::${sectionKey}`;\n}\n\nfunction ensureSessionDefaults(session) {\n  if (!session) return;\n  if (!Array.isArray(session.pool)) session.pool = [];\n  session.dict = session.pool.map(it => ({\n    id: it.id,\n    title: titleOf(it),\n    lower: titleOf(it).toLowerCase()\n  }));\n  if (!session.answers || typeof session.answers !== 'object') {\n    session.answers = {};\n  }\n  if (!session.ratings || typeof session.ratings !== 'object') {\n    session.ratings = {};\n  }\n  if (typeof session.idx !== 'number' || Number.isNaN(session.idx)) {\n    session.idx = 0;\n  }\n  session.idx = Math.max(0, Math.min(Math.floor(session.idx), session.pool.length ? session.pool.length - 1 : 0));\n  if (typeof session.score !== 'number' || Number.isNaN(session.score)) {\n    session.score = computeScore(session.answers);\n  }\n}\n\nfunction computeScore(answers) {\n  if (!answers) return 0;\n  return Object.values(answers).filter(entry => entry && entry.isCorrect).length;\n}\n\nfunction renderCompletion(root, session, redraw) {\n  removeStudySession('quiz').catch(err => console.warn('Failed to clear quiz session', err));\n  const wrap = document.createElement('section');\n  wrap.className = 'card quiz-summary';\n\n  const heading = document.createElement('h2');\n  heading.textContent = 'Quiz complete';\n  wrap.appendChild(heading);\n\n  const score = document.createElement('p');\n  const total = Array.isArray(session.pool) ? session.pool.length : 0;\n  score.textContent = `Score ${session.score}/${total}`;\n  wrap.appendChild(score);\n\n  const btn = document.createElement('button');\n  btn.className = 'btn';\n  btn.textContent = 'Back to builder';\n  btn.addEventListener('click', () => {\n    setQuizSession(null);\n    setStudySelectedMode('Quiz');\n    setSubtab('Study', 'Builder');\n    redraw();\n  });\n  wrap.appendChild(btn);\n\n  root.appendChild(wrap);\n}\n\nexport function renderQuiz(root, redraw) {\n  const session = state.quizSession;\n  if (!session) {\n    if (root?.dataset) delete root.dataset.questionIdx;\n    return;\n  }\n  ensureSessionDefaults(session);\n\n  const hasWindow = typeof window !== 'undefined';\n  const docScroller = typeof document !== 'undefined' ? (document.scrollingElement || document.documentElement) : null;\n  const previousIdxRaw = root?.dataset?.questionIdx;\n  const previousIdx = previousIdxRaw !== undefined && previousIdxRaw !== '' && !Number.isNaN(Number(previousIdxRaw))\n    ? Number(previousIdxRaw)\n    : null;\n  const prevScrollY = hasWindow ? window.scrollY : docScroller ? docScroller.scrollTop : 0;\n\n  const pool = Array.isArray(session.pool) ? session.pool : [];\n  root.innerHTML = '';\n  if (root?.dataset) delete root.dataset.questionIdx;\n\n  if (!pool.length) {\n    const empty = document.createElement('div');\n    empty.textContent = 'No questions available. Select study cards to begin.';\n    root.appendChild(empty);\n    return;\n  }\n\n\n  if (session.idx >= pool.length) {\n    renderCompletion(root, session, redraw);\n\n    return;\n  }\n\n  const item = pool[session.idx];\n  if (!item) {\n    renderCompletion(root, session, redraw);\n    return;\n  }\n\n  const answer = session.answers[session.idx] || { value: '', isCorrect: false, checked: false, revealed: false };\n  const hasResult = Boolean(answer.checked);\n  const wasCorrect = hasResult && answer.isCorrect;\n  const wasRevealed = hasResult && answer.revealed;\n  const isSolved = wasCorrect || wasRevealed;\n\n  const card = document.createElement('section');\n  card.className = 'card quiz-card';\n  root.appendChild(card);\n\n  const header = document.createElement('div');\n  header.className = 'quiz-header';\n\n  const headerInfo = document.createElement('div');\n  headerInfo.className = 'quiz-header-info';\n\n  const progress = document.createElement('div');\n  progress.className = 'quiz-progress';\n  progress.textContent = `Question ${session.idx + 1} of ${pool.length}`;\n  headerInfo.appendChild(progress);\n\n  const tally = document.createElement('div');\n  tally.className = 'quiz-score';\n  tally.textContent = `Score: ${session.score}`;\n  headerInfo.appendChild(tally);\n\n  header.appendChild(headerInfo);\n\n  const editBtn = document.createElement('button');\n  editBtn.type = 'button';\n  editBtn.className = 'icon-btn quiz-edit-btn';\n  editBtn.innerHTML = '\u270F\uFE0F';\n  editBtn.title = 'Edit card';\n  editBtn.setAttribute('aria-label', 'Edit card');\n  editBtn.addEventListener('click', event => {\n    event.stopPropagation();\n    const onSave = typeof redraw === 'function' ? () => redraw() : undefined;\n    openEditor(item.kind, onSave, item);\n  });\n  header.appendChild(editBtn);\n\n  card.appendChild(header);\n\n  const prompt = document.createElement('p');\n  prompt.className = 'quiz-prompt';\n  prompt.textContent = 'Identify the term based on the details below.';\n  card.appendChild(prompt);\n\n  const details = document.createElement('div');\n  details.className = 'quiz-details';\n\n  const sections = sectionsForItem(item);\n  if (!sections.length) {\n    const emptySection = document.createElement('div');\n    emptySection.className = 'quiz-empty';\n    emptySection.textContent = 'No card content available for this entry.';\n    details.appendChild(emptySection);\n  } else {\n    sections.forEach(({ key, label, content, extra }) => {\n      const block = document.createElement('div');\n      block.className = 'quiz-section';\n      if (extra) block.classList.add('quiz-section-extra');\n\n      const head = document.createElement('div');\n      head.className = 'quiz-section-title';\n      head.textContent = label;\n      block.appendChild(head);\n\n      const body = document.createElement('div');\n      body.className = 'quiz-section-body';\n      renderRichText(body, content || '', { clozeMode: 'interactive' });\n      block.appendChild(body);\n\n      details.appendChild(block);\n    });\n  }\n\n  card.appendChild(details);\n\n  const form = document.createElement('form');\n  form.className = 'quiz-answer';\n\n  const input = document.createElement('input');\n  input.type = 'text';\n  input.autocomplete = 'off';\n  input.spellcheck = false;\n  input.placeholder = 'Type your answer';\n  input.value = answer.value || '';\n  form.appendChild(input);\n\n  const suggestions = document.createElement('ul');\n  suggestions.className = 'quiz-suggestions';\n  const suggestionId = `quiz-suggestions-${session.idx}`;\n  suggestions.id = suggestionId;\n  suggestions.setAttribute('role', 'listbox');\n  form.appendChild(suggestions);\n  input.setAttribute('aria-controls', suggestionId);\n  input.setAttribute('aria-autocomplete', 'list');\n  input.setAttribute('aria-expanded', 'false');\n\n  const actions = document.createElement('div');\n  actions.className = 'quiz-answer-actions';\n\n  const checkBtn = document.createElement('button');\n  checkBtn.type = 'button';\n  checkBtn.className = 'btn quiz-check-btn';\n  checkBtn.textContent = 'Check';\n  checkBtn.disabled = !input.value.trim();\n  checkBtn.addEventListener('click', () => gradeAnswer());\n  actions.appendChild(checkBtn);\n\n  const revealBtn = document.createElement('button');\n  revealBtn.type = 'button';\n  revealBtn.className = 'btn secondary quiz-reveal-btn';\n  revealBtn.textContent = 'Show answer';\n  revealBtn.hidden = !(hasResult && !wasCorrect && !wasRevealed);\n  actions.appendChild(revealBtn);\n\n  form.appendChild(actions);\n\n  const feedback = document.createElement('div');\n  feedback.className = 'quiz-feedback';\n  if (wasCorrect) {\n    feedback.textContent = 'Correct!';\n    feedback.classList.add('is-correct');\n  } else if (wasRevealed) {\n    feedback.textContent = `Answer: ${titleOf(item)}`;\n    feedback.classList.add('is-incorrect');\n  } else if (hasResult) {\n    feedback.textContent = 'Incorrect. Try again or reveal the answer.';\n    feedback.classList.add('is-incorrect');\n  }\n  form.appendChild(feedback);\n\n  card.appendChild(form);\n\n  const suggestionButtons = [];\n\n  const setActiveSuggestion = (target = null) => {\n    suggestionButtons.forEach(btn => {\n      btn.setAttribute('aria-selected', btn === target ? 'true' : 'false');\n    });\n  };\n\n  const clearSuggestions = () => {\n    suggestionButtons.splice(0, suggestionButtons.length);\n    suggestions.innerHTML = '';\n    input.setAttribute('aria-expanded', 'false');\n    setActiveSuggestion(null);\n  };\n\n  const commitSuggestion = (value) => {\n    input.value = value;\n    clearSuggestions();\n    checkBtn.disabled = !input.value.trim();\n    input.focus();\n  };\n\n  const focusSuggestion = (index) => {\n    const target = suggestionButtons[index];\n    if (target) {\n      target.focus();\n      setActiveSuggestion(target);\n    }\n  };\n\n  const renderSuggestions = (matches) => {\n    clearSuggestions();\n    if (!matches.length) return;\n    const fragment = document.createDocumentFragment();\n    matches.forEach((entry, idx) => {\n      const li = document.createElement('li');\n      li.setAttribute('role', 'presentation');\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'quiz-suggestion-btn';\n      btn.textContent = entry.title;\n      btn.dataset.index = String(idx);\n      btn.setAttribute('role', 'option');\n      btn.setAttribute('aria-selected', 'false');\n      btn.addEventListener('pointerdown', (event) => {\n        event.preventDefault();\n        commitSuggestion(entry.title);\n      });\n      btn.addEventListener('keydown', (event) => {\n        if (event.key === 'ArrowDown') {\n          event.preventDefault();\n          focusSuggestion(Math.min(suggestionButtons.length - 1, idx + 1));\n        } else if (event.key === 'ArrowUp') {\n          event.preventDefault();\n          if (idx === 0) {\n            input.focus();\n          } else {\n            focusSuggestion(Math.max(0, idx - 1));\n          }\n        } else if (event.key === 'Enter' || event.key === ' ') {\n          event.preventDefault();\n          commitSuggestion(entry.title);\n        }\n      });\n      btn.addEventListener('focus', () => {\n        setActiveSuggestion(btn);\n      });\n      btn.addEventListener('blur', () => {\n        if (typeof document !== 'undefined') {\n          const active = document.activeElement;\n          if (active instanceof HTMLElement && suggestionButtons.includes(active) && active.closest(`#${suggestionId}`)) {\n            return;\n          }\n        }\n        setActiveSuggestion(null);\n      });\n      li.appendChild(btn);\n      fragment.appendChild(li);\n      suggestionButtons.push(btn);\n    });\n    suggestions.appendChild(fragment);\n    input.setAttribute('aria-expanded', 'true');\n  };\n\n  const updateSuggestions = () => {\n    checkBtn.disabled = !input.value.trim();\n    const v = input.value.toLowerCase();\n    const existing = session.answers[session.idx];\n    if (existing && existing.checked) {\n      const answers = { ...session.answers };\n      delete answers[session.idx];\n      session.answers = answers;\n      session.score = computeScore(answers);\n      setQuizSession({ ...session });\n      feedback.textContent = '';\n      feedback.classList.remove('is-correct', 'is-incorrect');\n      revealBtn.hidden = true;\n      revealBtn.disabled = false;\n      tally.textContent = `Score: ${session.score}`;\n      updateNavState();\n    }\n    if (!v) {\n      clearSuggestions();\n      return;\n    }\n    const seen = new Set();\n    const orderedMatches = [];\n    const consider = (entry) => {\n      if (!entry || seen.has(entry.id || entry.title)) return;\n      seen.add(entry.id || entry.title);\n      orderedMatches.push(entry);\n    };\n    session.dict.filter(d => d.lower.startsWith(v)).forEach(consider);\n    session.dict.filter(d => !d.lower.startsWith(v) && d.lower.includes(v)).forEach(consider);\n    renderSuggestions(orderedMatches.slice(0, 5));\n  };\n\n  input.addEventListener('input', updateSuggestions);\n  input.addEventListener('keydown', (event) => {\n    if (event.key === 'ArrowDown' && suggestionButtons.length) {\n      event.preventDefault();\n      focusSuggestion(0);\n    }\n  });\n  input.addEventListener('blur', () => {\n    setTimeout(() => {\n      if (typeof document !== 'undefined') {\n        const active = document.activeElement;\n        if (active instanceof HTMLElement && active.closest(`#${suggestionId}`)) return;\n      }\n      clearSuggestions();\n    }, 0);\n  });\n\n  revealBtn.addEventListener('click', () => {\n    const revealValue = titleOf(item);\n    const answers = { ...session.answers, [session.idx]: { value: revealValue, isCorrect: false, checked: true, revealed: true } };\n    session.answers = answers;\n    session.score = computeScore(answers);\n    setQuizSession({ ...session });\n    input.value = revealValue;\n    feedback.textContent = `Answer: ${titleOf(item)}`;\n    feedback.classList.remove('is-correct');\n    feedback.classList.add('is-incorrect');\n    revealBtn.hidden = true;\n    clearSuggestions();\n    tally.textContent = `Score: ${session.score}`;\n    updateNavState();\n  });\n\n  form.addEventListener('submit', (event) => {\n    event.preventDefault();\n    gradeAnswer();\n  });\n\n  const durationsPromise = getReviewDurations().catch(() => ({ ...DEFAULT_REVIEW_STEPS }));\n  const ratingPanel = document.createElement('div');\n  ratingPanel.className = 'quiz-rating-panel';\n  card.appendChild(ratingPanel);\n\n  const ratingRow = document.createElement('div');\n  ratingRow.className = 'quiz-rating-row';\n  ratingPanel.appendChild(ratingRow);\n\n  const options = document.createElement('div');\n  options.className = 'quiz-rating-options';\n  ratingRow.appendChild(options);\n\n  const status = document.createElement('span');\n  status.className = 'quiz-rating-status';\n  status.textContent = 'Optional: rate your confidence after answering.';\n  ratingRow.appendChild(status);\n\n  const ratingId = ratingKey(item, '__overall__');\n  let selectedRating = session.ratings[ratingId] || null;\n\n  const updateSelection = (value) => {\n    selectedRating = value;\n    session.ratings[ratingId] = value;\n    setQuizSession({ ...session });\n    Array.from(options.querySelectorAll('button')).forEach(btn => {\n      const btnValue = btn.dataset.value;\n      const isSelected = btnValue === value;\n      btn.classList.toggle('is-selected', isSelected);\n      btn.setAttribute('aria-pressed', isSelected ? 'true' : 'false');\n    });\n    status.classList.remove('is-error');\n    updateNavState();\n  };\n\n  const handleRating = async (value) => {\n    const current = session.answers[session.idx];\n    if (!(current && current.checked && (current.isCorrect || current.revealed))) return;\n    status.textContent = 'Saving\u2026';\n    status.classList.remove('is-error');\n    try {\n      const durations = await durationsPromise;\n      const timestamp = Date.now();\n      if (sections.length) {\n        sections.forEach(({ key }) => rateSection(item, key, value, durations, timestamp));\n        await upsertItem(item);\n      }\n      session.ratings[ratingId] = value;\n      updateSelection(value);\n      status.textContent = 'Saved';\n    } catch (err) {\n      console.error('Failed to record quiz rating', err);\n      status.textContent = 'Save failed';\n      status.classList.add('is-error');\n    }\n  };\n\n  REVIEW_RATINGS.forEach(value => {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.dataset.value = value;\n    btn.className = 'btn quiz-rating-btn';\n    const variant = RATING_CLASS[value];\n    if (variant) btn.classList.add(variant);\n    btn.textContent = RATING_LABELS[value];\n    btn.disabled = !isSolved;\n    btn.setAttribute('aria-pressed', 'false');\n    btn.addEventListener('click', () => handleRating(value));\n    options.appendChild(btn);\n  });\n\n  if (selectedRating) {\n    updateSelection(selectedRating);\n    status.textContent = 'Saved';\n  }\n\n  if (!sections.length) {\n    const note = document.createElement('div');\n    note.className = 'quiz-rating-note';\n    note.textContent = 'This card has no reviewable sections.';\n    ratingPanel.appendChild(note);\n  }\n\n  const controls = document.createElement('div');\n  controls.className = 'quiz-controls';\n\n  const backBtn = document.createElement('button');\n  backBtn.type = 'button';\n  backBtn.className = 'btn secondary';\n  backBtn.textContent = 'Back';\n  backBtn.disabled = session.idx === 0;\n  backBtn.addEventListener('click', () => {\n    setQuizSession({ ...session, idx: Math.max(0, session.idx - 1) });\n    redraw();\n  });\n  controls.appendChild(backBtn);\n\n  const nextBtn = document.createElement('button');\n  nextBtn.type = 'button';\n  nextBtn.className = 'btn';\n  nextBtn.textContent = session.idx === pool.length - 1 ? 'Finish' : 'Next';\n  nextBtn.disabled = true;\n  nextBtn.addEventListener('click', () => {\n    setQuizSession({ ...session, idx: session.idx + 1 });\n    redraw();\n  });\n  controls.appendChild(nextBtn);\n\n  card.appendChild(controls);\n\n  const footer = document.createElement('div');\n  footer.className = 'quiz-footer';\n\n\n  const saveExit = document.createElement('button');\n  saveExit.type = 'button';\n  saveExit.className = 'btn secondary';\n  saveExit.textContent = 'Save & close';\n  saveExit.addEventListener('click', async () => {\n    const original = saveExit.textContent;\n    saveExit.disabled = true;\n    saveExit.textContent = 'Saving\u2026';\n    try {\n      await persistStudySession('quiz', {\n\n        session: {\n          ...session,\n          idx: session.idx,\n          pool,\n          answers: session.answers,\n          ratings: session.ratings\n        },\n        cohort: pool\n\n      });\n      setQuizSession(null);\n      setStudySelectedMode('Quiz');\n      setSubtab('Study', 'Builder');\n      redraw();\n    } catch (err) {\n      console.error('Failed to save quiz progress', err);\n      saveExit.textContent = 'Save failed';\n      setTimeout(() => { saveExit.textContent = original; }, 2000);\n    } finally {\n      saveExit.disabled = false;\n    }\n  });\n\n  footer.appendChild(saveExit);\n\n  card.appendChild(footer);\n\n  updateNavState();\n\n  if (root?.dataset) root.dataset.questionIdx = String(session.idx);\n  const shouldRestore = previousIdx === session.idx;\n  const targetY = shouldRestore ? prevScrollY : 0;\n  const canRestore = hasWindow || docScroller;\n  if (canRestore) {\n    const applyScroll = () => {\n      if (hasWindow && typeof window.scrollTo === 'function') {\n        window.scrollTo({ left: 0, top: targetY, behavior: 'auto' });\n      } else if (docScroller) {\n        docScroller.scrollTop = targetY;\n      }\n    };\n    if (hasWindow && typeof window.requestAnimationFrame === 'function') {\n      window.requestAnimationFrame(applyScroll);\n    } else if (typeof setTimeout === 'function') {\n      setTimeout(applyScroll, 0);\n    } else {\n      applyScroll();\n    }\n  }\n\n  function gradeAnswer() {\n    const guess = input.value.trim();\n    if (!guess) return;\n    const normalized = guess.toLowerCase();\n    const correct = titleOf(item).toLowerCase();\n    const isCorrect = normalized === correct;\n    const answers = {\n      ...session.answers,\n      [session.idx]: { value: guess, isCorrect, checked: true, revealed: false }\n    };\n    const nextScore = computeScore(answers);\n    session.answers = answers;\n    session.score = nextScore;\n    setQuizSession({ ...session });\n    tally.textContent = `Score: ${session.score}`;\n    feedback.textContent = isCorrect ? 'Correct!' : 'Incorrect. Try again or reveal the answer.';\n    feedback.classList.remove('is-correct', 'is-incorrect');\n    feedback.classList.add(isCorrect ? 'is-correct' : 'is-incorrect');\n    clearSuggestions();\n    revealBtn.hidden = isCorrect;\n    if (!isCorrect) {\n      revealBtn.disabled = false;\n      revealBtn.focus();\n    }\n    updateNavState();\n  }\n\n  function updateNavState() {\n    const currentAnswer = session.answers[session.idx];\n    const solved = Boolean(currentAnswer && currentAnswer.checked && (currentAnswer.isCorrect || currentAnswer.revealed));\n    nextBtn.disabled = !solved;\n    Array.from(options.querySelectorAll('button')).forEach(btn => {\n      btn.disabled = !solved;\n    });\n    if (!solved) {\n      status.classList.remove('is-error');\n      status.textContent = 'Optional: rate your confidence after answering.';\n    } else {\n      revealBtn.hidden = true;\n    }\n  }\n}\n", "import { state, setBlockMode, setSubtab, setStudySelectedMode, resetBlockMode } from '../../state.js';\nimport { sanitizeHtml } from './rich-text.js';\nimport { sectionDefsForKind } from './sections.js';\nimport { persistStudySession, removeStudySession } from '../../study/study-sessions.js';\nimport { deepClone } from '../../utils.js';\n\nexport function renderBlockMode(root, redraw) {\n  const shell = document.createElement('section');\n  shell.className = 'block-mode-shell';\n  root.appendChild(shell);\n  drawBlockMode(shell, redraw);\n}\n\nfunction drawBlockMode(shell, globalRedraw) {\n  shell.innerHTML = '';\n  const redraw = () => drawBlockMode(shell, globalRedraw);\n  const items = state.cohort || [];\n\n  if (!items.length) {\n    shell.appendChild(messageCard('Select study cards to unlock Blocks mode. Use the filters above to assemble a cohort.'));\n    return;\n  }\n\n  const sections = collectSections(items);\n  if (!sections.length) {\n    shell.appendChild(messageCard('The selected cards do not have structured sections yet. Add cards with rich content to practice in Blocks mode.'));\n    return;\n  }\n\n  let activeKey = state.blockMode.section;\n  if (!activeKey || !sections.some(sec => sec.key === activeKey)) {\n    activeKey = sections[0].key;\n    if (activeKey !== state.blockMode.section) {\n      setBlockMode({ section: activeKey });\n    }\n  }\n  const sectionData = sections.find(sec => sec.key === activeKey) || sections[0];\n\n  const entryMap = new Map();\n  sectionData.items.forEach(info => {\n    entryMap.set(entryIdFor(info.itemId, sectionData.key), info);\n  });\n\n  const validAssignments = sanitizeAssignments(sectionData.key, entryMap);\n  const assignedSet = new Set(Object.values(validAssignments));\n  const reveal = !!(state.blockMode.reveal && state.blockMode.reveal[sectionData.key]);\n\n  const bankEntries = Array.from(entryMap.entries())\n    .filter(([id]) => !assignedSet.has(id))\n    .map(([entryId, info]) => ({ entryId, value: info.value, itemId: info.itemId }));\n\n  const orderedBank = orderEntries(sectionData.key, bankEntries);\n\n  const results = sectionData.items.map(info => {\n    const entryId = entryIdFor(info.itemId, sectionData.key);\n    const assignedId = validAssignments[info.itemId];\n    const assignedInfo = assignedId ? entryMap.get(assignedId) : null;\n    const assignedValue = assignedInfo ? assignedInfo.value : '';\n    const correct = assignedValue && normalized(assignedValue) === normalized(info.value);\n    return { ...info, entryId, assignedId, assignedValue, correct };\n  });\n\n  const filledCount = results.filter(r => r.assignedValue).length;\n  const correctCount = results.filter(r => r.correct).length;\n\n  shell.appendChild(renderHeader({\n    sections,\n    activeKey: sectionData.key,\n    filledCount,\n    correctCount,\n    total: results.length,\n    bankRemaining: orderedBank.length,\n    reveal,\n    onSectionChange: key => {\n      const nextReveal = { ...(state.blockMode.reveal || {}) };\n      delete nextReveal[key];\n      setBlockMode({ section: key, reveal: nextReveal });\n      redraw();\n    },\n    onCheck: () => {\n      const nextReveal = { ...(state.blockMode.reveal || {}) };\n      nextReveal[sectionData.key] = true;\n      setBlockMode({ reveal: nextReveal });\n      redraw();\n    },\n    onReset: () => {\n      const assignments = { ...(state.blockMode.assignments || {}) };\n      assignments[sectionData.key] = {};\n      const revealMap = { ...(state.blockMode.reveal || {}) };\n      delete revealMap[sectionData.key];\n      setBlockMode({ assignments, reveal: revealMap });\n      redraw();\n    }\n  }));\n\n  const board = document.createElement('div');\n  board.className = 'block-mode-board';\n  results.forEach(result => {\n    board.appendChild(renderBlockCard({\n      sectionLabel: sectionData.label,\n      reveal,\n      result,\n      onRemove: () => {\n        const assignments = { ...(state.blockMode.assignments || {}) };\n        const nextSectionAssignments = { ...(assignments[sectionData.key] || {}) };\n        delete nextSectionAssignments[result.itemId];\n        assignments[sectionData.key] = nextSectionAssignments;\n        const revealMap = { ...(state.blockMode.reveal || {}) };\n        delete revealMap[sectionData.key];\n        setBlockMode({ assignments, reveal: revealMap });\n        redraw();\n      },\n      onDrop: entryId => {\n        const info = entryMap.get(entryId);\n        if (!info) return;\n        const assignments = { ...(state.blockMode.assignments || {}) };\n        const nextSectionAssignments = { ...(assignments[sectionData.key] || {}) };\n        for (const [itemId, assigned] of Object.entries(nextSectionAssignments)) {\n          if (assigned === entryId) delete nextSectionAssignments[itemId];\n        }\n        nextSectionAssignments[result.itemId] = entryId;\n        assignments[sectionData.key] = nextSectionAssignments;\n        const revealMap = { ...(state.blockMode.reveal || {}) };\n        delete revealMap[sectionData.key];\n        setBlockMode({ assignments, reveal: revealMap });\n        redraw();\n      }\n    }));\n  });\n  shell.appendChild(board);\n\n  shell.appendChild(renderBank({\n    label: sectionData.label,\n    entries: orderedBank\n  }));\n\n  shell.appendChild(renderFooter({\n    globalRedraw,\n    sectionLabel: sectionData.label,\n    filledCount,\n    total: results.length\n  }));\n}\n\nfunction snapshotBlockState() {\n  const source = state.blockMode || {};\n  const clone = (value) => deepClone(value ?? {});\n  return {\n    section: source.section || '',\n    assignments: clone(source.assignments),\n    reveal: clone(source.reveal),\n    order: clone(source.order)\n  };\n}\n\nfunction renderFooter({ globalRedraw, sectionLabel, filledCount, total }) {\n  const card = document.createElement('div');\n  card.className = 'card block-mode-footer';\n\n  const status = document.createElement('div');\n  status.className = 'block-mode-footer-status';\n  if (total > 0) {\n    status.textContent = filledCount ? `Progress saved for ${filledCount}/${total} prompts` : 'No assignments yet';\n  } else {\n    status.textContent = 'No prompts in this section yet.';\n  }\n  card.appendChild(status);\n\n  const actions = document.createElement('div');\n  actions.className = 'block-mode-footer-actions';\n\n  const saveBtn = document.createElement('button');\n  saveBtn.type = 'button';\n  saveBtn.className = 'btn';\n  saveBtn.textContent = 'Save & exit';\n  saveBtn.addEventListener('click', async () => {\n    const original = saveBtn.textContent;\n    saveBtn.disabled = true;\n    saveBtn.textContent = 'Saving\u2026';\n    try {\n      const snapshot = snapshotBlockState();\n      await persistStudySession('blocks', {\n        session: snapshot,\n        cohort: state.cohort,\n        metadata: {\n          label: sectionLabel ? `Blocks \u2013 ${sectionLabel}` : 'Blocks session'\n        }\n      });\n      resetBlockMode();\n      setStudySelectedMode('Blocks');\n      setSubtab('Study', 'Builder');\n      if (typeof globalRedraw === 'function') {\n        globalRedraw();\n      }\n    } catch (err) {\n      console.error('Failed to save blocks progress', err);\n      saveBtn.textContent = 'Save failed';\n      setTimeout(() => { saveBtn.textContent = original; }, 2000);\n    } finally {\n      saveBtn.disabled = false;\n    }\n  });\n  actions.appendChild(saveBtn);\n\n  const exitBtn = document.createElement('button');\n  exitBtn.type = 'button';\n  exitBtn.className = 'btn secondary';\n  exitBtn.textContent = 'Exit without saving';\n  exitBtn.addEventListener('click', async () => {\n    exitBtn.disabled = true;\n    try {\n      await removeStudySession('blocks').catch(err => console.warn('Failed to discard blocks session', err));\n    } finally {\n      resetBlockMode();\n      setStudySelectedMode('Blocks');\n      setSubtab('Study', 'Builder');\n      if (typeof globalRedraw === 'function') {\n        globalRedraw();\n      }\n    }\n  });\n  actions.appendChild(exitBtn);\n\n  card.appendChild(actions);\n\n  return card;\n}\n\nfunction renderHeader({ sections, activeKey, filledCount, correctCount, total, bankRemaining, reveal, onSectionChange, onCheck, onReset }) {\n  const card = document.createElement('div');\n  card.className = 'card block-mode-header';\n\n  const titleRow = document.createElement('div');\n  titleRow.className = 'block-mode-header-row';\n  const title = document.createElement('h2');\n  title.textContent = 'Blocks Mode';\n  titleRow.appendChild(title);\n\n  const selectWrap = document.createElement('label');\n  selectWrap.className = 'block-mode-select';\n  const selectLabel = document.createElement('span');\n  selectLabel.textContent = 'Section';\n  selectWrap.appendChild(selectLabel);\n  const select = document.createElement('select');\n  sections.forEach(sec => {\n    const opt = document.createElement('option');\n    opt.value = sec.key;\n    opt.textContent = sec.label;\n    if (sec.key === activeKey) opt.selected = true;\n    select.appendChild(opt);\n  });\n  select.addEventListener('change', () => onSectionChange(select.value));\n  selectWrap.appendChild(select);\n  titleRow.appendChild(selectWrap);\n  card.appendChild(titleRow);\n\n  const meta = document.createElement('div');\n  meta.className = 'block-mode-meta-row';\n  const placed = document.createElement('span');\n  placed.textContent = `Placed: ${filledCount}/${total}`;\n  meta.appendChild(placed);\n  if (reveal) {\n    const score = document.createElement('span');\n    score.textContent = `Correct: ${correctCount}/${total}`;\n    meta.appendChild(score);\n  }\n  const bankInfo = document.createElement('span');\n  bankInfo.textContent = `In bank: ${bankRemaining}`;\n  meta.appendChild(bankInfo);\n  card.appendChild(meta);\n\n  const actions = document.createElement('div');\n  actions.className = 'block-mode-actions';\n  const checkBtn = document.createElement('button');\n  checkBtn.type = 'button';\n  checkBtn.className = 'btn';\n  checkBtn.textContent = 'Check answers';\n  checkBtn.disabled = !filledCount;\n  checkBtn.addEventListener('click', onCheck);\n  actions.appendChild(checkBtn);\n\n  const resetBtn = document.createElement('button');\n  resetBtn.type = 'button';\n  resetBtn.className = 'btn secondary';\n  resetBtn.textContent = 'Reset section';\n  resetBtn.disabled = !filledCount;\n  resetBtn.addEventListener('click', onReset);\n  actions.appendChild(resetBtn);\n  card.appendChild(actions);\n\n  return card;\n}\n\nfunction renderBlockCard({ sectionLabel, reveal, result, onRemove, onDrop }) {\n  const card = document.createElement('div');\n  card.className = 'card block-mode-card';\n\n  const title = document.createElement('div');\n  title.className = 'block-mode-card-title';\n  title.textContent = itemTitle(result.item);\n  card.appendChild(title);\n\n  const subtitle = document.createElement('div');\n  subtitle.className = 'block-mode-card-subtitle';\n  subtitle.textContent = formatItemContext(result.item);\n  if (subtitle.textContent) card.appendChild(subtitle);\n\n  const slot = document.createElement('div');\n  slot.className = 'block-mode-slot';\n  slot.dataset.itemId = result.itemId;\n  slot.dataset.section = sectionLabel;\n\n  slot.addEventListener('dragover', event => {\n    event.preventDefault();\n    slot.classList.add('drag-over');\n  });\n  slot.addEventListener('dragenter', event => {\n    event.preventDefault();\n    slot.classList.add('drag-over');\n  });\n  slot.addEventListener('dragleave', () => {\n    slot.classList.remove('drag-over');\n  });\n  slot.addEventListener('drop', event => {\n    event.preventDefault();\n    slot.classList.remove('drag-over');\n    const entryId = event.dataTransfer.getData('text/plain');\n    if (entryId) onDrop(entryId);\n  });\n\n  if (result.assignedValue) {\n    slot.classList.add('filled');\n    const chip = document.createElement('div');\n    chip.className = 'block-chip assigned';\n    const text = document.createElement('div');\n    text.className = 'block-chip-text';\n    text.textContent = result.assignedValue;\n    chip.appendChild(text);\n    const removeBtn = document.createElement('button');\n    removeBtn.type = 'button';\n    removeBtn.className = 'chip-remove';\n    removeBtn.textContent = '\u00D7';\n    removeBtn.addEventListener('click', onRemove);\n    chip.appendChild(removeBtn);\n    slot.appendChild(chip);\n  } else {\n    const placeholder = document.createElement('div');\n    placeholder.className = 'block-slot-placeholder';\n    placeholder.textContent = `Drop ${sectionLabel.toLowerCase()} here`;\n    slot.appendChild(placeholder);\n  }\n\n  card.appendChild(slot);\n\n  if (reveal) {\n    slot.classList.add(result.correct ? 'correct' : (result.assignedValue ? 'incorrect' : 'missing'));\n    if (!result.correct) {\n      const answer = document.createElement('div');\n      answer.className = 'block-mode-answer';\n      const label = document.createElement('span');\n      label.textContent = 'Answer';\n      const body = document.createElement('div');\n      body.textContent = result.value;\n      answer.appendChild(label);\n      answer.appendChild(body);\n      card.appendChild(answer);\n    }\n  }\n  return card;\n}\n\nfunction renderBank({ label, entries, onPick }) {\n  const card = document.createElement('div');\n  card.className = 'card block-mode-bank';\n  const title = document.createElement('div');\n  title.className = 'block-mode-bank-title';\n  title.textContent = `${label} bank`;\n  card.appendChild(title);\n\n  const list = document.createElement('div');\n  list.className = 'block-mode-bank-items';\n  if (!entries.length) {\n    const empty = document.createElement('div');\n    empty.className = 'block-mode-bank-empty';\n    empty.textContent = 'All matches placed!';\n    list.appendChild(empty);\n  } else {\n    entries.forEach(entry => {\n      const chip = document.createElement('div');\n      chip.className = 'block-chip';\n      chip.textContent = entry.value;\n      chip.draggable = true;\n      chip.addEventListener('dragstart', event => {\n        event.dataTransfer.effectAllowed = 'move';\n        event.dataTransfer.setData('text/plain', entry.entryId);\n        chip.classList.add('dragging');\n      });\n      chip.addEventListener('dragend', () => chip.classList.remove('dragging'));\n      if (onPick) {\n        chip.addEventListener('click', () => onPick(entry.entryId));\n      }\n      list.appendChild(chip);\n    });\n  }\n  card.appendChild(list);\n  return card;\n}\n\nfunction collectSections(items) {\n  const map = new Map();\n  items.forEach((item, index) => {\n    const itemId = resolveItemId(item, index);\n    sectionDefsForKind(item.kind).forEach(def => {\n      const value = sectionValue(item[def.key]);\n      if (!value) return;\n      let section = map.get(def.key);\n      if (!section) {\n        section = { key: def.key, label: def.label, items: [] };\n        map.set(def.key, section);\n      }\n      section.items.push({ item, itemId, value });\n    });\n  });\n  return Array.from(map.values()).sort((a, b) => a.label.localeCompare(b.label));\n}\n\nfunction sanitizeAssignments(sectionKey, entryMap) {\n  const current = (state.blockMode.assignments && state.blockMode.assignments[sectionKey]) || {};\n  let changed = false;\n  const valid = {};\n  for (const [itemId, entryId] of Object.entries(current)) {\n    if (entryMap.has(entryId)) {\n      valid[itemId] = entryId;\n    } else {\n      changed = true;\n    }\n  }\n  if (changed) {\n    const assignments = { ...(state.blockMode.assignments || {}) };\n    assignments[sectionKey] = valid;\n    setBlockMode({ assignments });\n  }\n  return valid;\n}\n\nfunction orderEntries(sectionKey, entries) {\n  const ids = entries.map(entry => entry.entryId);\n  const existing = (state.blockMode.order && state.blockMode.order[sectionKey]) || [];\n  const filtered = existing.filter(id => ids.includes(id));\n  const missing = ids.filter(id => !filtered.includes(id));\n  const next = filtered.concat(missing);\n  if (!arraysEqual(existing, next)) {\n    const order = { ...(state.blockMode.order || {}) };\n    order[sectionKey] = next;\n    setBlockMode({ order });\n  }\n  const byId = new Map(entries.map(entry => [entry.entryId, entry]));\n  return next.map(id => byId.get(id)).filter(Boolean);\n}\n\nfunction entryIdFor(itemId, sectionKey) {\n  return `${itemId}::${sectionKey}`;\n}\n\nfunction sectionValue(raw) {\n  if (raw == null) return '';\n  const text = typeof raw === 'string' ? raw : String(raw);\n  const sanitized = sanitizeHtml(text);\n  const template = document.createElement('template');\n  template.innerHTML = sanitized;\n  return template.content.textContent?.trim() || '';\n}\n\nfunction normalized(text) {\n  return sectionValue(text).replace(/\\s+/g, ' ').toLowerCase();\n}\n\nfunction resolveItemId(item, index) {\n  return item.id || item.uid || item.slug || item.key || `${item.kind || 'item'}-${index}`;\n}\n\nfunction itemTitle(item) {\n  return item.name || item.concept || item.title || 'Card';\n}\n\nfunction formatItemContext(item) {\n  const parts = [];\n  if (item.kind) parts.push(capitalize(item.kind));\n  if (Array.isArray(item.lectures) && item.lectures.length) {\n    const lectureNames = item.lectures.map(l => l.name).filter(Boolean);\n    if (lectureNames.length) parts.push(lectureNames.join(', '));\n  }\n  return parts.join(' \u2022 ');\n}\n\nfunction capitalize(text) {\n  if (!text) return '';\n  return text.charAt(0).toUpperCase() + text.slice(1);\n}\n\nfunction arraysEqual(a, b) {\n  if (a.length !== b.length) return false;\n  return a.every((val, idx) => val === b[idx]);\n}\n\nfunction messageCard(text) {\n  const card = document.createElement('div');\n  card.className = 'card block-mode-empty';\n  card.textContent = text;\n  return card;\n}\n", "import { state, setBlockBoardState } from '../../state.js';\nimport { loadBlockCatalog } from '../../storage/block-catalog.js';\nimport { getSettings, listAllLectures, saveLecture } from '../../storage/storage.js';\nimport {\n  groupLectureQueues,\n  markPassCompleted,\n  deriveLectureStatus,\n  calculateNextDue\n} from '../../lectures/scheduler.js';\nimport { passColorForOrder, setPassColorPalette } from './pass-colors.js';\n\nlet loadCatalog = loadBlockCatalog;\nlet fetchLectures = listAllLectures;\nlet persistLecture = saveLecture;\nlet fetchSettings = getSettings;\n\nexport function __setBlockBoardDeps({ loadBlockCatalog: loadFn, listAllLectures: listFn, saveLecture: saveFn, getSettings: settingsFn } = {}) {\n  loadCatalog = typeof loadFn === 'function' ? loadFn : loadBlockCatalog;\n  fetchLectures = typeof listFn === 'function' ? listFn : listAllLectures;\n  persistLecture = typeof saveFn === 'function' ? saveFn : saveLecture;\n  fetchSettings = typeof settingsFn === 'function' ? settingsFn : getSettings;\n}\n\nconst DAY_MS = 24 * 60 * 60 * 1000;\nconst DEFAULT_BOARD_DAYS = 14;\nconst SHIFT_OFFSET_UNITS = [\n  { id: 'minutes', label: 'minutes', minutes: 1 },\n  { id: 'hours', label: 'hours', minutes: 60 },\n  { id: 'days', label: 'days', minutes: 60 * 24 },\n  { id: 'weeks', label: 'weeks', minutes: 60 * 24 * 7 }\n];\nconst TIMELINE_BASE_UNIT_HEIGHT = 20;\nconst TIMELINE_MAX_BAR_HEIGHT = 200;\nconst TIMELINE_MIN_SEGMENT_HEIGHT = 12;\n\nconst BLOCK_RANGE_FORMAT = new Intl.DateTimeFormat(undefined, {\n  month: 'short',\n  day: 'numeric',\n  year: 'numeric'\n});\n\nconst PASS_DUE_FORMAT = new Intl.DateTimeFormat(undefined, {\n  month: 'short',\n  day: 'numeric'\n});\n\nconst PASS_TIME_FORMAT = new Intl.DateTimeFormat(undefined, {\n  hour: 'numeric',\n  minute: '2-digit'\n});\n\nfunction ensureBoardState() {\n  if (!state.blockBoard) {\n    state.blockBoard = {\n      collapsedBlocks: [],\n      hiddenTimelines: [],\n      autoCollapsed: [],\n      autoHidden: [],\n      manualExpanded: [],\n      manualTimeline: []\n    };\n  }\n  if (!Array.isArray(state.blockBoard.collapsedBlocks)) {\n    state.blockBoard.collapsedBlocks = [];\n  }\n  if (!Array.isArray(state.blockBoard.hiddenTimelines)) {\n    state.blockBoard.hiddenTimelines = [];\n    if (state.blockBoard.showDensity === false && !state.blockBoard.hiddenTimelines.includes('__all__')) {\n      state.blockBoard.hiddenTimelines.push('__all__');\n    }\n  }\n  if (!Array.isArray(state.blockBoard.autoCollapsed)) {\n    state.blockBoard.autoCollapsed = [];\n  }\n  if (!Array.isArray(state.blockBoard.autoHidden)) {\n    state.blockBoard.autoHidden = [];\n  }\n  if (!Array.isArray(state.blockBoard.manualExpanded)) {\n    state.blockBoard.manualExpanded = [];\n  }\n  if (!Array.isArray(state.blockBoard.manualTimeline)) {\n    state.blockBoard.manualTimeline = [];\n  }\n  return state.blockBoard;\n}\n\nfunction passColor(order = 1) {\n  return passColorForOrder(order);\n}\n\nfunction startOfDay(timestamp) {\n  const date = new Date(timestamp);\n  date.setHours(0, 0, 0, 0);\n  return date.getTime();\n}\n\nfunction formatDay(timestamp) {\n  const date = new Date(Number(timestamp));\n  const formatter = new Intl.DateTimeFormat(undefined, { weekday: 'short', month: 'short', day: 'numeric' });\n  return formatter.format(date);\n}\n\nfunction parseBlockDate(value) {\n  if (!value) return null;\n  const date = new Date(value);\n  if (Number.isNaN(date.getTime())) return null;\n  return date;\n}\n\nfunction formatBlockDate(value) {\n  const date = parseBlockDate(value);\n  if (!date) return null;\n  return BLOCK_RANGE_FORMAT.format(date);\n}\n\nfunction blockRangeLabel(block) {\n  const start = formatBlockDate(block?.startDate);\n  const end = formatBlockDate(block?.endDate);\n  if (start && end) return `${start} \u2192 ${end}`;\n  if (start) return `Starts ${start}`;\n  if (end) return `Ends ${end}`;\n  return null;\n}\n\nfunction blockSpanDays(block) {\n  const start = parseBlockDate(block?.startDate);\n  const end = parseBlockDate(block?.endDate);\n  if (!start || !end) return null;\n  const diff = end.getTime() - start.getTime();\n  if (diff < 0) return null;\n  return Math.round(diff / DAY_MS) + 1;\n}\n\nfunction normalizeShiftUnit(id) {\n  if (typeof id !== 'string') return 'days';\n  const normalized = SHIFT_OFFSET_UNITS.find(option => option.id === id);\n  return normalized ? normalized.id : 'days';\n}\n\nfunction combineShiftValueUnit(value, unitId) {\n  const numeric = Number(value);\n  if (!Number.isFinite(numeric) || numeric <= 0) {\n    return 0;\n  }\n  const unit = SHIFT_OFFSET_UNITS.find(option => option.id === normalizeShiftUnit(unitId)) || SHIFT_OFFSET_UNITS[2];\n  return Math.max(0, Math.round(numeric * unit.minutes));\n}\n\nfunction resolveLatestBlockId(blocks = []) {\n  if (!Array.isArray(blocks) || !blocks.length) return null;\n  let latestId = null;\n  let latestScore = -Infinity;\n  let fallbackId = null;\n  const total = blocks.length;\n  blocks.forEach((block, index) => {\n    if (!block || block.blockId == null) return;\n    const blockId = String(block.blockId);\n    if (!fallbackId) fallbackId = blockId;\n    const orderScore = Number(block?.order);\n    const createdScore = Number(block?.createdAt);\n    const start = parseBlockDate(block?.startDate);\n    const end = parseBlockDate(block?.endDate);\n    const startScore = start instanceof Date ? start.getTime() : null;\n    const endScore = end instanceof Date ? end.getTime() : null;\n    let score;\n    if (Number.isFinite(orderScore)) {\n      score = orderScore;\n    } else if (Number.isFinite(createdScore)) {\n      score = createdScore;\n    } else if (Number.isFinite(startScore)) {\n      score = startScore;\n    } else if (Number.isFinite(endScore)) {\n      score = endScore;\n    } else {\n      score = total - index;\n    }\n    if (latestId == null || score > latestScore) {\n      latestId = blockId;\n      latestScore = score;\n    }\n  });\n  return latestId ?? fallbackId;\n}\n\nfunction buildScopeOptions(mode) {\n  if (mode === 'pull') {\n    return [\n      { id: 'single', label: 'Only this pass' },\n      { id: 'chain-before', label: 'This & preceding passes' }\n    ];\n  }\n  return [\n    { id: 'single', label: 'Only this pass' },\n    { id: 'chain-after', label: 'This & following passes' }\n  ];\n}\n\nfunction openShiftDialog(mode, { title, description, defaultValue = 1, defaultUnit = 'days' } = {}) {\n  return new Promise(resolve => {\n    const overlay = document.createElement('div');\n    overlay.className = 'modal block-board-shift-modal';\n\n    const card = document.createElement('div');\n    card.className = 'card block-board-shift-card';\n\n    const heading = document.createElement('h3');\n    heading.textContent = title || (mode === 'push' ? 'Push later' : 'Pull earlier');\n    card.appendChild(heading);\n\n    if (description) {\n      const desc = document.createElement('p');\n      desc.className = 'block-board-shift-description';\n      desc.textContent = description;\n      card.appendChild(desc);\n    }\n\n    const fields = document.createElement('div');\n    fields.className = 'block-board-shift-fields';\n\n    const amountField = document.createElement('label');\n    amountField.className = 'block-board-shift-field';\n    amountField.textContent = 'Amount';\n    const amountInput = document.createElement('input');\n    amountInput.type = 'number';\n    amountInput.className = 'input block-board-shift-input';\n    amountInput.min = '0';\n    amountInput.step = '1';\n    amountInput.value = String(defaultValue);\n    amountField.appendChild(amountInput);\n    fields.appendChild(amountField);\n\n    const unitField = document.createElement('label');\n    unitField.className = 'block-board-shift-field';\n    unitField.textContent = 'Unit';\n    const unitSelect = document.createElement('select');\n    unitSelect.className = 'input block-board-shift-unit';\n    SHIFT_OFFSET_UNITS.forEach(option => {\n      const opt = document.createElement('option');\n      opt.value = option.id;\n      opt.textContent = option.label;\n      unitSelect.appendChild(opt);\n    });\n    unitSelect.value = normalizeShiftUnit(defaultUnit);\n    unitField.appendChild(unitSelect);\n    fields.appendChild(unitField);\n\n    card.appendChild(fields);\n\n    const scopeGroup = document.createElement('fieldset');\n    scopeGroup.className = 'block-board-shift-scope';\n    const legend = document.createElement('legend');\n    legend.textContent = 'Scope';\n    scopeGroup.appendChild(legend);\n    const scopeInputs = [];\n    buildScopeOptions(mode).forEach((option, index) => {\n      const wrapper = document.createElement('label');\n      wrapper.className = 'block-board-shift-scope-option';\n      const input = document.createElement('input');\n      input.type = 'radio';\n      input.name = 'block-board-shift-scope';\n      input.value = option.id;\n      if (index === 0) input.checked = true;\n      const span = document.createElement('span');\n      span.textContent = option.label;\n      wrapper.appendChild(input);\n      wrapper.appendChild(span);\n      scopeGroup.appendChild(wrapper);\n      scopeInputs.push(input);\n    });\n    card.appendChild(scopeGroup);\n\n    const feedback = document.createElement('div');\n    feedback.className = 'block-board-shift-error';\n    card.appendChild(feedback);\n\n    const actions = document.createElement('div');\n    actions.className = 'block-board-shift-actions';\n    const confirm = document.createElement('button');\n    confirm.type = 'button';\n    confirm.className = 'btn';\n    confirm.textContent = mode === 'push' ? 'Push later' : 'Pull earlier';\n    const cancel = document.createElement('button');\n    cancel.type = 'button';\n    cancel.className = 'btn secondary';\n    cancel.textContent = 'Cancel';\n    actions.appendChild(confirm);\n    actions.appendChild(cancel);\n    card.appendChild(actions);\n\n    function cleanup(result) {\n      if (document.body.contains(overlay)) {\n        document.body.removeChild(overlay);\n      }\n      resolve(result);\n    }\n\n    confirm.addEventListener('click', () => {\n      const minutes = combineShiftValueUnit(amountInput.value, unitSelect.value);\n      if (!Number.isFinite(minutes) || minutes <= 0) {\n        feedback.textContent = 'Enter a value greater than zero.';\n        feedback.classList.add('is-visible');\n        amountInput.focus();\n        return;\n      }\n      const selectedScope = scopeInputs.find(input => input.checked)?.value || 'single';\n      cleanup({ minutes, scope: selectedScope });\n    });\n\n    cancel.addEventListener('click', () => cleanup(null));\n    overlay.addEventListener('click', event => {\n      if (event.target === overlay) {\n        cleanup(null);\n      }\n    });\n\n    overlay.appendChild(card);\n    document.body.appendChild(overlay);\n    amountInput.focus({ preventScroll: true });\n  });\n}\n\nfunction shiftPassesForScope(lecture, passOrder, deltaMinutes, scope) {\n  if (!lecture || typeof lecture !== 'object') return lecture;\n  const targetOrder = Number(passOrder);\n  if (!Number.isFinite(targetOrder)) return lecture;\n  const delta = Number(deltaMinutes);\n  if (!Number.isFinite(delta) || delta === 0) return lecture;\n  const passes = Array.isArray(lecture.passes) ? lecture.passes.map(pass => ({ ...pass })) : [];\n  if (!passes.length) return lecture;\n  const shiftMs = Math.round(delta * 60 * 1000);\n  const normalizedScope = scope === 'chain-after' || scope === 'chain-before' ? scope : 'single';\n  passes.forEach(pass => {\n    const order = Number(pass?.order);\n    if (!Number.isFinite(order)) return;\n    const inScope = normalizedScope === 'chain-after'\n      ? order >= targetOrder\n      : normalizedScope === 'chain-before'\n        ? order <= targetOrder\n        : order === targetOrder;\n    if (!inScope) return;\n    if (!Number.isFinite(pass?.due)) return;\n    if (Number.isFinite(pass?.completedAt)) return;\n    const nextDue = Math.max(0, Math.round(pass.due + shiftMs));\n    pass.due = nextDue;\n  });\n  const status = deriveLectureStatus(passes, lecture.status);\n  const nextDueAt = calculateNextDue(passes);\n  return {\n    ...lecture,\n    passes,\n    status,\n    nextDueAt\n  };\n}\n\nfunction collectTimelineSegments(blockLectures, days) {\n  const dayMap = new Map(days.map(day => [day, []]));\n  blockLectures.forEach(lecture => {\n    const passes = Array.isArray(lecture?.passes) ? lecture.passes : [];\n    passes.forEach(pass => {\n      if (!pass) return;\n      const due = Number(pass?.due);\n      if (!Number.isFinite(due)) return;\n      const dayKey = startOfDay(due);\n      if (!dayMap.has(dayKey)) return;\n      dayMap.get(dayKey).push({\n        lecture,\n        pass,\n        order: Number(pass?.order),\n        completed: Number.isFinite(pass?.completedAt)\n      });\n    });\n  });\n  return days.map(day => {\n    const entries = (dayMap.get(day) || []).slice().sort((a, b) => {\n      if (a.completed !== b.completed) return a.completed ? 1 : -1;\n      const orderA = Number.isFinite(a.order) ? a.order : Number.POSITIVE_INFINITY;\n      const orderB = Number.isFinite(b.order) ? b.order : Number.POSITIVE_INFINITY;\n      if (orderA !== orderB) return orderA - orderB;\n      const nameA = a.lecture?.name || '';\n      const nameB = b.lecture?.name || '';\n      return nameA.localeCompare(nameB);\n    });\n    return { day, entries };\n  });\n}\n\nfunction formatDueTime(due) {\n  if (!Number.isFinite(due)) return 'Unscheduled';\n  const formatter = new Intl.DateTimeFormat(undefined, { hour: 'numeric', minute: '2-digit' });\n  return formatter.format(new Date(due));\n}\n\nfunction formatPassDueLabel(due) {\n  if (!Number.isFinite(due)) return '';\n  const date = new Date(due);\n  const datePart = PASS_DUE_FORMAT.format(date);\n  const timePart = PASS_TIME_FORMAT.format(date);\n  return `${datePart} \u2022 ${timePart}`;\n}\n\nfunction collectDefaultBoardDays(now = Date.now()) {\n  const today = startOfDay(now);\n  const start = today - 2 * DAY_MS;\n  return Array.from({ length: DEFAULT_BOARD_DAYS }, (_, idx) => start + idx * DAY_MS);\n}\n\nfunction collectLectureDueRange(lectures) {\n  let start = null;\n  let end = null;\n  if (!Array.isArray(lectures)) return { start, end };\n  lectures.forEach(lecture => {\n    const passes = Array.isArray(lecture?.passes) ? lecture.passes : [];\n    passes.forEach(pass => {\n      const due = Number(pass?.due);\n      if (!Number.isFinite(due)) return;\n      const day = startOfDay(due);\n      if (start == null || day < start) start = day;\n      if (end == null || day > end) end = day;\n    });\n  });\n  return { start, end };\n}\n\nfunction collectDaysForBlock(block, lectures = [], now = Date.now()) {\n  const startDate = parseBlockDate(block?.startDate);\n  const endDate = parseBlockDate(block?.endDate);\n  const dueRange = collectLectureDueRange(lectures);\n  const weeks = Number(block?.weeks);\n\n  let startDay = startDate ? startOfDay(startDate.getTime()) : null;\n  let endDay = endDate ? startOfDay(endDate.getTime()) : null;\n\n  if (Number.isFinite(weeks) && weeks > 0) {\n    const totalDays = Math.max(1, Math.round(weeks * 7));\n    if (startDay != null && endDay == null) {\n      endDay = startDay + (totalDays - 1) * DAY_MS;\n    } else if (endDay != null && startDay == null) {\n      startDay = endDay - (totalDays - 1) * DAY_MS;\n    }\n  }\n\n  if (dueRange.start != null) {\n    startDay = startDay == null ? dueRange.start : Math.min(startDay, dueRange.start);\n  }\n  if (dueRange.end != null) {\n    endDay = endDay == null ? dueRange.end : Math.max(endDay, dueRange.end);\n  }\n\n  if (startDay != null && endDay != null && endDay >= startDay) {\n    const spanDays = Math.floor((endDay - startDay) / DAY_MS) + 1;\n    if (spanDays < 3) {\n      const deficit = 3 - spanDays;\n      const padBefore = Math.ceil(deficit / 2);\n      const padAfter = deficit - padBefore;\n      startDay -= padBefore * DAY_MS;\n      endDay += padAfter * DAY_MS;\n    }\n    const days = [];\n    for (let ts = startDay; ts <= endDay; ts += DAY_MS) {\n      days.push(ts);\n    }\n    return days;\n  }\n\n  if (Number.isFinite(weeks) && weeks > 0) {\n    const totalDays = Math.max(1, Math.round(weeks * 7));\n    const anchor = dueRange.start != null ? dueRange.start : startOfDay(now);\n    return Array.from({ length: totalDays }, (_, idx) => anchor + idx * DAY_MS);\n  }\n\n  if (dueRange.start != null && dueRange.end != null && dueRange.end >= dueRange.start) {\n    const days = [];\n    for (let ts = dueRange.start; ts <= dueRange.end; ts += DAY_MS) {\n      days.push(ts);\n    }\n    return days;\n  }\n\n  if (startDate) {\n    const start = startOfDay(startDate.getTime());\n    return Array.from({ length: 7 }, (_, idx) => start + idx * DAY_MS);\n  }\n\n  return [];\n}\n\nfunction buildPassElement(entry, onComplete, onShift) {\n  const chip = document.createElement('div');\n  chip.className = 'block-board-pass-chip';\n  chip.style.setProperty('--chip-accent', passColor(entry?.pass?.order));\n  const chipComplete = Number.isFinite(entry?.pass?.completedAt);\n  chip.classList.toggle('is-complete', chipComplete);\n  chip.classList.toggle('is-pending', !chipComplete);\n  chip.dataset.passOrder = String(entry?.pass?.order ?? '');\n  const title = document.createElement('div');\n  title.className = 'block-board-pass-title';\n  title.textContent = entry?.lecture?.name || `Lecture ${entry?.lecture?.id}`;\n  chip.appendChild(title);\n\n  const meta = document.createElement('div');\n  meta.className = 'block-board-pass-meta';\n  const label = entry?.pass?.label || `Pass ${entry?.pass?.order ?? ''}`;\n  const action = entry?.pass?.action ? entry.pass.action : '';\n  const dueLabel = Number.isFinite(entry?.pass?.due)\n    ? formatPassDueLabel(entry.pass.due)\n    : 'Unscheduled';\n  const parts = [label];\n  if (action) parts.push(action);\n  if (dueLabel) parts.push(dueLabel);\n  meta.textContent = parts.join(' \u2022 ');\n  chip.appendChild(meta);\n\n  const actions = document.createElement('div');\n  actions.className = 'block-board-pass-actions';\n  const done = document.createElement('button');\n  done.type = 'button';\n  done.className = 'btn tertiary';\n  done.textContent = 'Mark done';\n  done.addEventListener('click', () => {\n    chip.classList.add('is-complete');\n    chip.classList.remove('is-pending');\n    onComplete(entry);\n  });\n  actions.appendChild(done);\n\n  if (typeof onShift === 'function') {\n    const push = document.createElement('button');\n    push.type = 'button';\n    push.className = 'btn tertiary';\n    push.textContent = 'Push';\n    push.addEventListener('click', () => onShift(entry, 'push'));\n    actions.appendChild(push);\n\n    const pull = document.createElement('button');\n    pull.type = 'button';\n    pull.className = 'btn tertiary';\n    pull.textContent = 'Pull';\n    pull.addEventListener('click', () => onShift(entry, 'pull'));\n    actions.appendChild(pull);\n  }\n\n  chip.appendChild(actions);\n  return chip;\n}\n\nfunction applyPassDueUpdate(lecture, passOrder, newDue) {\n  const passes = Array.isArray(lecture?.passes)\n    ? lecture.passes.map(pass => ({ ...pass }))\n    : [];\n  const index = passes.findIndex(pass => pass?.order === passOrder);\n  if (index >= 0) {\n    passes[index] = { ...passes[index], due: newDue ?? null };\n    if (!Number.isFinite(newDue)) {\n      passes[index].due = null;\n    }\n    passes[index].completedAt = passes[index].completedAt ?? null;\n    if (passes[index].completedAt && newDue && newDue > passes[index].completedAt) {\n      passes[index].completedAt = null;\n    }\n  }\n  const status = deriveLectureStatus(passes, lecture?.status);\n  const nextDueAt = calculateNextDue(passes);\n  return { ...lecture, passes, status, nextDueAt };\n}\n\nfunction createPassCard(entry, onDrag) {\n  const card = document.createElement('div');\n  card.className = 'block-board-pass-card';\n  card.draggable = true;\n  card.style.setProperty('--card-accent', passColor(entry?.pass?.order));\n  const isComplete = Number.isFinite(entry?.pass?.completedAt);\n  card.classList.toggle('is-complete', isComplete);\n  card.classList.toggle('is-pending', !isComplete);\n  card.dataset.blockId = entry?.lecture?.blockId ?? '';\n  card.dataset.lectureId = entry?.lecture?.id ?? '';\n  card.dataset.passOrder = entry?.pass?.order ?? '';\n  card.dataset.passDue = Number.isFinite(entry?.pass?.due) ? String(entry.pass.due) : '';\n  card.dataset.status = isComplete ? 'complete' : 'pending';\n\n  const lectureName = entry?.lecture?.name || 'Lecture';\n  const title = document.createElement('div');\n  title.className = 'block-board-pass-title card-title';\n  const titleInner = document.createElement('span');\n  titleInner.className = 'block-board-pass-title-inner';\n  titleInner.textContent = lectureName;\n  title.appendChild(titleInner);\n  card.appendChild(title);\n\n  const scheduleMarquee = () => {\n    const container = title;\n    const inner = titleInner;\n    if (!container || !inner) return;\n    const available = container.clientWidth;\n    const content = inner.scrollWidth;\n    const overflow = Math.round(content - available);\n    if (available > 0 && overflow > 8) {\n      const distance = overflow + 24;\n      const duration = Math.min(22, Math.max(8, distance / 24));\n      container.classList.add('is-animated');\n      container.style.setProperty('--marquee-distance', `${distance}px`);\n      container.style.setProperty('--marquee-duration', `${duration}s`);\n    } else {\n      container.classList.remove('is-animated');\n      container.style.removeProperty('--marquee-distance');\n      container.style.removeProperty('--marquee-duration');\n    }\n  };\n\n  if (typeof requestAnimationFrame === 'function') {\n    requestAnimationFrame(scheduleMarquee);\n  } else {\n    setTimeout(scheduleMarquee, 0);\n  }\n\n  const passLabel = entry?.pass?.label || (entry?.pass?.order != null ? `Pass ${entry.pass.order}` : 'Pass');\n  const dueFullLabel = Number.isFinite(entry?.pass?.due)\n    ? formatPassDueLabel(entry.pass.due)\n    : 'Unscheduled';\n  const passOrder = document.createElement('span');\n  passOrder.className = 'block-board-pass-pill-order';\n  passOrder.textContent = passLabel;\n  card.appendChild(passOrder);\n\n  const descriptionParts = [lectureName, passLabel];\n  if (entry?.pass?.action) descriptionParts.push(entry.pass.action);\n  if (dueFullLabel) descriptionParts.push(dueFullLabel);\n  card.setAttribute('aria-label', descriptionParts.join(' \u2022 '));\n  card.title = descriptionParts.join(' \u2022 ');\n\n  card.addEventListener('dragstart', (event) => {\n    if (!event.dataTransfer) return;\n    const payload = {\n      blockId: card.dataset.blockId,\n      lectureId: card.dataset.lectureId,\n      passOrder: Number(card.dataset.passOrder),\n      due: card.dataset.passDue ? Number(card.dataset.passDue) : null\n    };\n    event.dataTransfer.effectAllowed = 'move';\n    event.dataTransfer.setData('application/json', JSON.stringify(payload));\n    onDrag?.(payload);\n  });\n  return card;\n}\n\nfunction createDayColumn(dayTs) {\n  const column = document.createElement('div');\n  column.className = 'block-board-day-column';\n  column.dataset.day = String(dayTs);\n  const header = document.createElement('div');\n  header.className = 'block-board-day-header';\n  header.textContent = formatDay(dayTs);\n  if (startOfDay(Date.now()) === dayTs) {\n    column.classList.add('today');\n  }\n  column.appendChild(header);\n  const list = document.createElement('div');\n  list.className = 'block-board-day-list';\n  column.appendChild(list);\n  column.addEventListener('dragover', (event) => {\n    event.preventDefault();\n    column.classList.add('dropping');\n  });\n  column.addEventListener('dragleave', () => {\n    column.classList.remove('dropping');\n  });\n  return column;\n}\n\nfunction scrollGridToToday(grid) {\n  if (!grid) return;\n  const todayColumn = grid.querySelector('.block-board-day-column.today');\n  if (!todayColumn) return;\n  if (grid.scrollWidth <= grid.clientWidth + 1) return;\n  const apply = () => {\n    const columnRect = todayColumn.getBoundingClientRect();\n    const gridRect = grid.getBoundingClientRect();\n    const relativeLeft = columnRect.left - gridRect.left + grid.scrollLeft;\n    const halfWidth = Math.max(0, (grid.clientWidth - todayColumn.clientWidth) / 2);\n    const maxScroll = Math.max(0, grid.scrollWidth - grid.clientWidth);\n    const target = Math.max(0, Math.min(maxScroll, relativeLeft - halfWidth));\n    if (typeof grid.scrollTo === 'function') {\n      grid.scrollTo({ left: target, behavior: 'auto' });\n    } else {\n      grid.scrollLeft = target;\n    }\n  };\n  if (typeof requestAnimationFrame === 'function') {\n    requestAnimationFrame(apply);\n  } else {\n    setTimeout(apply, 0);\n  }\n}\n\nfunction sortPassEntries(entries) {\n  return entries.slice().sort((a, b) => {\n    const aComplete = Number.isFinite(a?.pass?.completedAt);\n    const bComplete = Number.isFinite(b?.pass?.completedAt);\n    if (aComplete !== bComplete) return aComplete ? 1 : -1;\n    const orderA = Number.isFinite(a?.pass?.order) ? a.pass.order : Number.POSITIVE_INFINITY;\n    const orderB = Number.isFinite(b?.pass?.order) ? b.pass.order : Number.POSITIVE_INFINITY;\n    if (orderA !== orderB) return orderA - orderB;\n    const nameA = a?.lecture?.name || '';\n    const nameB = b?.lecture?.name || '';\n    return nameA.localeCompare(nameB);\n  });\n}\n\nasync function updateLectureSchedule(lecture, updateFn) {\n  const updated = updateFn(lecture);\n  await persistLecture(updated);\n}\n\nfunction renderUrgentQueues(root, queues, handlers) {\n  const wrapper = document.createElement('section');\n  wrapper.className = 'block-board-summary';\n  const config = [\n    { key: 'today', label: \"Today's To-Do\", empty: 'Nothing due today.', accent: 'var(--blue)' },\n    { key: 'tomorrow', label: 'Due Tomorrow', empty: 'Nothing due tomorrow.', accent: 'var(--yellow)' },\n    { key: 'overdue', label: 'Overdue', empty: 'No overdue passes. \uD83C\uDF89', accent: 'var(--rose)' }\n  ];\n  config.forEach(({ key, label, empty, accent }) => {\n    const card = document.createElement('article');\n    card.className = 'block-board-summary-card';\n    if (accent) card.style.setProperty('--summary-accent', accent);\n\n    const header = document.createElement('div');\n    header.className = 'block-board-summary-header';\n\n    const title = document.createElement('h3');\n    title.className = 'block-board-summary-title';\n    title.textContent = label;\n    header.appendChild(title);\n\n    const entries = queues[key] || [];\n    const count = document.createElement('span');\n    count.className = 'block-board-summary-count';\n    count.textContent = String(entries.length);\n    header.appendChild(count);\n\n    card.appendChild(header);\n\n    const list = document.createElement('div');\n    list.className = 'block-board-summary-list';\n    if (!entries.length) {\n      const emptyState = document.createElement('div');\n      emptyState.className = 'block-board-summary-empty';\n      emptyState.textContent = empty || 'Nothing queued.';\n      list.appendChild(emptyState);\n    } else {\n      entries.forEach(entry => {\n        const chip = buildPassElement(entry, handlers.onComplete, handlers.onShift);\n        list.appendChild(chip);\n      });\n    }\n    card.appendChild(list);\n    wrapper.appendChild(card);\n  });\n  root.appendChild(wrapper);\n}\n\nfunction buildDayAssignments(blockLectures, days) {\n  const assignments = new Map();\n  blockLectures.forEach(lecture => {\n    const passes = Array.isArray(lecture?.passes) ? lecture.passes : [];\n    passes.forEach(pass => {\n      if (!pass || Number.isFinite(pass.completedAt)) return;\n      const due = Number.isFinite(pass.due) ? startOfDay(pass.due) : null;\n      const key = due != null ? due : 'unscheduled';\n      if (!assignments.has(key)) assignments.set(key, []);\n      assignments.get(key).push({ lecture, pass });\n    });\n  });\n  days.forEach(day => {\n    if (!assignments.has(day)) assignments.set(day, []);\n  });\n  const unscheduled = assignments.get('unscheduled');\n  if (!unscheduled || !unscheduled.length) {\n    assignments.delete('unscheduled');\n  }\n  return assignments;\n}\n\nfunction attachDropHandlers(column, blockEntries, refresh) {\n  column.addEventListener('drop', async (event) => {\n    event.preventDefault();\n    column.classList.remove('dropping');\n    const payloadRaw = event.dataTransfer?.getData('application/json');\n    if (!payloadRaw) return;\n    let payload;\n    try {\n      payload = JSON.parse(payloadRaw);\n    } catch (err) {\n      return;\n    }\n    const { lectureId, passOrder } = payload || {};\n    const lecture = blockEntries.find(item => String(item.lecture?.id) === String(lectureId))?.lecture;\n    if (!lecture) return;\n    const dayValue = column.dataset.day;\n    const targetDay = dayValue ? Number(dayValue) : null;\n    const newDue = targetDay != null ? targetDay + (payload?.due != null ? (payload.due % DAY_MS) : 9 * 60 * 60 * 1000) : null;\n    await updateLectureSchedule(lecture, lec => applyPassDueUpdate(lec, passOrder, newDue));\n    await refresh({ full: true });\n  });\n}\n\nfunction renderBlockBoardBlock(container, block, blockLectures, days, refresh, gridScrollState = new Map()) {\n  const boardState = ensureBoardState();\n  const wrapper = document.createElement('section');\n  wrapper.className = 'block-board-block';\n  wrapper.dataset.blockId = String(block?.blockId ?? '');\n  if (block?.color) {\n    wrapper.style.setProperty('--block-accent', block.color);\n    wrapper.classList.add('has-accent');\n  }\n\n  const header = document.createElement('div');\n  header.className = 'block-board-block-header';\n  const heading = document.createElement('div');\n  heading.className = 'block-board-block-heading';\n  const title = document.createElement('h2');\n  title.className = 'block-board-block-title';\n  title.textContent = block?.title || block?.name || `Block ${block?.blockId}`;\n  if (block?.color) {\n    title.style.setProperty('--block-accent', block.color);\n    title.classList.add('has-accent');\n  }\n  heading.appendChild(title);\n\n  const metaParts = [];\n  const rangeText = blockRangeLabel(block);\n  if (rangeText) metaParts.push(rangeText);\n  const weekValue = Number(block?.weeks);\n  if (Number.isFinite(weekValue) && weekValue > 0) {\n    const weeks = Math.round(weekValue);\n    metaParts.push(`${weeks} week${weeks === 1 ? '' : 's'}`);\n  }\n  const span = blockSpanDays(block);\n  if (span) metaParts.push(`${span} day${span === 1 ? '' : 's'}`);\n  if (metaParts.length) {\n    const meta = document.createElement('div');\n    meta.className = 'block-board-block-meta';\n    meta.textContent = metaParts.join(' \u2022 ');\n    heading.appendChild(meta);\n  }\n  header.appendChild(heading);\n  const controls = document.createElement('div');\n  controls.className = 'block-board-block-controls';\n  const collapseBtn = document.createElement('button');\n  collapseBtn.type = 'button';\n  collapseBtn.className = 'btn secondary';\n  const blockKey = String(block?.blockId ?? '');\n  const isCollapsed = blockKey ? boardState.collapsedBlocks.includes(blockKey) : false;\n  collapseBtn.textContent = isCollapsed ? 'Expand' : 'Minimize';\n  collapseBtn.addEventListener('click', () => {\n    if (!blockKey) return;\n    const current = ensureBoardState();\n    const nextCollapsed = new Set((current.collapsedBlocks || []).map(String));\n    const manualExpanded = new Set((current.manualExpanded || []).map(String));\n    const autoCollapsed = new Set((current.autoCollapsed || []).map(String));\n    if (nextCollapsed.has(blockKey)) {\n      nextCollapsed.delete(blockKey);\n      manualExpanded.add(blockKey);\n      autoCollapsed.delete(blockKey);\n    } else {\n      nextCollapsed.add(blockKey);\n      manualExpanded.delete(blockKey);\n      autoCollapsed.delete(blockKey);\n    }\n    setBlockBoardState({\n      collapsedBlocks: Array.from(nextCollapsed),\n      manualExpanded: Array.from(manualExpanded),\n      autoCollapsed: Array.from(autoCollapsed)\n    });\n    refresh();\n  });\n  controls.appendChild(collapseBtn);\n  const hiddenTimelineSet = new Set((boardState.hiddenTimelines || []).map(id => String(id)));\n  const timelineHidden = hiddenTimelineSet.has('__all__') || hiddenTimelineSet.has(blockKey);\n  const timelineBtn = document.createElement('button');\n  timelineBtn.type = 'button';\n  timelineBtn.className = 'btn secondary';\n  timelineBtn.textContent = timelineHidden ? 'Show timeline' : 'Hide timeline';\n  timelineBtn.addEventListener('click', () => {\n    if (!blockKey) return;\n    const current = ensureBoardState();\n    const nextHidden = new Set((current.hiddenTimelines || []).map(id => String(id)));\n    const manualTimeline = new Set((current.manualTimeline || []).map(String));\n    const autoHidden = new Set((current.autoHidden || []).map(String));\n    const hideAll = nextHidden.has('__all__');\n    nextHidden.delete('__all__');\n    if (timelineHidden) {\n      nextHidden.delete(blockKey);\n      manualTimeline.add(blockKey);\n      autoHidden.delete(blockKey);\n    } else {\n      nextHidden.add(blockKey);\n      manualTimeline.delete(blockKey);\n      autoHidden.delete(blockKey);\n    }\n    if (hideAll) {\n      nextHidden.add('__all__');\n    }\n    setBlockBoardState({\n      hiddenTimelines: Array.from(nextHidden),\n      manualTimeline: Array.from(manualTimeline),\n      autoHidden: Array.from(autoHidden)\n    });\n    refresh();\n  });\n  controls.appendChild(timelineBtn);\n  header.appendChild(controls);\n  wrapper.appendChild(header);\n\n  const assignments = buildDayAssignments(blockLectures, days);\n  const unscheduledEntries = sortPassEntries(assignments.get('unscheduled') || []);\n  assignments.delete('unscheduled');\n\n  const blockEntries = [];\n  assignments.forEach(entries => {\n    sortPassEntries(entries).forEach(entry => blockEntries.push(entry));\n  });\n  unscheduledEntries.forEach(entry => blockEntries.push(entry));\n\n  if (!timelineHidden) {\n    const timelineData = collectTimelineSegments(blockLectures, days);\n    const timeline = document.createElement('div');\n    timeline.className = 'block-board-timeline';\n\n    const timelineHeader = document.createElement('div');\n    timelineHeader.className = 'block-board-timeline-header';\n    const timelineTitle = document.createElement('h3');\n    timelineTitle.className = 'block-board-timeline-title';\n    timelineTitle.textContent = `Block Timeline \u2014 ${block?.title || block?.name || 'Block'}`;\n    timelineHeader.appendChild(timelineTitle);\n\n    const spanCount = blockSpanDays(block) || days.length;\n    const spanLabel = document.createElement('span');\n    spanLabel.className = 'block-board-timeline-span';\n    spanLabel.textContent = `${spanCount} day${spanCount === 1 ? '' : 's'}`;\n    timelineHeader.appendChild(spanLabel);\n\n    timeline.appendChild(timelineHeader);\n\n    const track = document.createElement('div');\n    track.className = 'block-board-timeline-track';\n    const todayKey = startOfDay(Date.now());\n    timelineData.forEach(({ day, entries }) => {\n      const column = document.createElement('div');\n      column.className = 'block-board-timeline-column';\n      if (day === todayKey) {\n        column.classList.add('is-today');\n      }\n      const date = new Date(day);\n\n      const isoDate = Number.isFinite(day) ? date.toISOString().slice(0, 10) : '';\n      const tooltip = isoDate ? `${isoDate} \u2022 ${entries.length} due` : `${date.toLocaleDateString()} \u2022 ${entries.length} due`;\n      column.setAttribute('data-count', String(entries.length));\n\n      const bar = document.createElement('div');\n      bar.className = 'block-board-timeline-bar';\n      bar.title = tooltip;\n\n      const count = entries.length;\n      if (count > 0) {\n        const hasCompleted = entries.some(entry => entry.completed);\n        if (hasCompleted) {\n          bar.classList.add('has-complete');\n        } else {\n          bar.classList.add('is-pending');\n        }\n        const gap = 0;\n        let segmentHeight = TIMELINE_BASE_UNIT_HEIGHT;\n        const gapTotal = gap * Math.max(0, count - 1);\n        let totalHeight = segmentHeight * count + gapTotal;\n        if (totalHeight > TIMELINE_MAX_BAR_HEIGHT) {\n          const available = Math.max(TIMELINE_MAX_BAR_HEIGHT - gapTotal, TIMELINE_MIN_SEGMENT_HEIGHT * count);\n          segmentHeight = Math.max(TIMELINE_MIN_SEGMENT_HEIGHT, available / count);\n          totalHeight = segmentHeight * count + gapTotal;\n        }\n        bar.style.height = `${Math.max(totalHeight, TIMELINE_MIN_SEGMENT_HEIGHT)}px`;\n        entries.forEach(entry => {\n          const segment = document.createElement('div');\n          segment.className = 'block-board-timeline-segment';\n          segment.style.setProperty('--segment-color', passColor(entry.order));\n          segment.style.height = `${segmentHeight}px`;\n          if (entry.completed) {\n            segment.classList.add('is-complete');\n          } else {\n            segment.classList.add('is-pending');\n          }\n          bar.appendChild(segment);\n        });\n      } else {\n        bar.classList.add('is-empty');\n      }\n      column.appendChild(bar);\n\n      const label = document.createElement('div');\n      label.className = 'block-board-timeline-day';\n      label.textContent = date.getDate();\n\n      label.setAttribute('aria-hidden', 'true');\n      column.appendChild(label);\n\n      if (tooltip) {\n        column.setAttribute('aria-label', tooltip);\n      }\n\n\n      track.appendChild(column);\n    });\n    timeline.appendChild(track);\n    wrapper.appendChild(timeline);\n  }\n\n  if (isCollapsed) {\n    container.appendChild(wrapper);\n    return;\n  }\n\n  if (unscheduledEntries.length) {\n    const backlog = document.createElement('div');\n    backlog.className = 'block-board-backlog';\n    const backlogTitle = document.createElement('h3');\n    backlogTitle.className = 'block-board-backlog-title';\n    backlogTitle.textContent = 'Needs a date';\n    backlog.appendChild(backlogTitle);\n    const backlogHint = document.createElement('p');\n    backlogHint.className = 'block-board-backlog-hint';\n    backlogHint.textContent = 'Drag a pass onto a day to schedule it.';\n    backlog.appendChild(backlogHint);\n    const backlogList = document.createElement('div');\n    backlogList.className = 'block-board-backlog-list';\n    unscheduledEntries.forEach(entry => {\n      const card = createPassCard(entry);\n      backlogList.appendChild(card);\n    });\n    backlog.appendChild(backlogList);\n    wrapper.appendChild(backlog);\n  }\n\n  const board = document.createElement('div');\n  board.className = 'block-board-grid';\n\n  days.forEach(day => {\n    const column = createDayColumn(day);\n    const entries = sortPassEntries(assignments.get(day) || []);\n    entries.forEach(entry => {\n      const card = createPassCard(entry);\n      column.querySelector('.block-board-day-list').appendChild(card);\n    });\n    attachDropHandlers(column, blockEntries, refresh);\n    board.appendChild(column);\n  });\n\n  wrapper.appendChild(board);\n\n  const blockId = String(block?.blockId ?? '');\n  if (blockId && !gridScrollState.has(blockId)) {\n    scrollGridToToday(board);\n  }\n\n  container.appendChild(wrapper);\n}\n\nexport async function renderBlockBoard(container, refresh) {\n  if (!container) return;\n  const scrollSnapshot = captureBoardScrollState(container);\n  container.innerHTML = '';\n  container.classList.add('block-board-container');\n\n  const boardState = ensureBoardState();\n  const [catalog, lectures] = await Promise.all([\n    loadCatalog(),\n    fetchLectures()\n  ]);\n  let settings = null;\n  try {\n    settings = await fetchSettings();\n  } catch (err) {\n    settings = null;\n  }\n  const { blocks } = catalog;\n  setPassColorPalette(settings?.plannerDefaults?.passColors);\n  if (Array.isArray(blocks) && blocks.length) {\n    const validBlockIds = new Set();\n    blocks.forEach(block => {\n      if (!block || block.blockId == null) return;\n      validBlockIds.add(String(block.blockId));\n    });\n\n    const normalizedCollapsed = new Set((boardState.collapsedBlocks || []).map(id => String(id)));\n    const hideAllTimelines = Array.isArray(boardState.hiddenTimelines)\n      ? boardState.hiddenTimelines.includes('__all__')\n      : false;\n    const normalizedHidden = new Set(\n      (boardState.hiddenTimelines || [])\n        .map(id => String(id))\n        .filter(id => id !== '__all__')\n    );\n    const manualExpanded = new Set((boardState.manualExpanded || []).map(id => String(id)));\n    const manualTimeline = new Set((boardState.manualTimeline || []).map(id => String(id)));\n    const autoCollapsed = new Set((boardState.autoCollapsed || []).map(id => String(id)));\n    const autoHidden = new Set((boardState.autoHidden || []).map(id => String(id)));\n\n    let manualExpandedChanged = false;\n    let manualTimelineChanged = false;\n    let autoCollapsedChanged = false;\n    let autoHiddenChanged = false;\n    manualExpanded.forEach(id => {\n      if (!validBlockIds.has(id)) {\n        manualExpanded.delete(id);\n        manualExpandedChanged = true;\n      }\n    });\n    manualTimeline.forEach(id => {\n      if (!validBlockIds.has(id)) {\n        manualTimeline.delete(id);\n        manualTimelineChanged = true;\n      }\n    });\n    autoCollapsed.forEach(id => {\n      if (!validBlockIds.has(id)) {\n        autoCollapsed.delete(id);\n        autoCollapsedChanged = true;\n      }\n    });\n    autoHidden.forEach(id => {\n      if (!validBlockIds.has(id)) {\n        autoHidden.delete(id);\n        autoHiddenChanged = true;\n      }\n    });\n\n    const latestBlockId = resolveLatestBlockId(blocks);\n    let collapsedChanged = false;\n    let hiddenChanged = false;\n    blocks.forEach(block => {\n      if (!block || block.blockId == null) return;\n      const blockId = String(block.blockId);\n      const isLatest = latestBlockId != null && blockId === latestBlockId;\n      const keepOpen = isLatest || manualExpanded.has(blockId);\n      if (keepOpen) {\n        if (normalizedCollapsed.has(blockId) && autoCollapsed.has(blockId)) {\n          normalizedCollapsed.delete(blockId);\n          collapsedChanged = true;\n        }\n        if (autoCollapsed.delete(blockId)) {\n          autoCollapsedChanged = true;\n        }\n      } else if (!normalizedCollapsed.has(blockId)) {\n        normalizedCollapsed.add(blockId);\n        collapsedChanged = true;\n        if (!autoCollapsed.has(blockId)) {\n          autoCollapsed.add(blockId);\n          autoCollapsedChanged = true;\n        }\n      }\n\n      if (!hideAllTimelines) {\n        const manualShow = manualTimeline.has(blockId);\n        const shouldAutoHide = !keepOpen && !manualShow;\n        if (shouldAutoHide) {\n          if (!normalizedHidden.has(blockId)) {\n            normalizedHidden.add(blockId);\n            hiddenChanged = true;\n          }\n          if (!autoHidden.has(blockId)) {\n            autoHidden.add(blockId);\n            autoHiddenChanged = true;\n          }\n        } else {\n          const wasAutoHidden = autoHidden.has(blockId);\n          if (wasAutoHidden && normalizedHidden.has(blockId) && (manualShow || keepOpen)) {\n            normalizedHidden.delete(blockId);\n            hiddenChanged = true;\n          }\n          if (wasAutoHidden) {\n            autoHidden.delete(blockId);\n            autoHiddenChanged = true;\n          }\n        }\n      }\n    });\n\n    const collapsedArr = Array.from(normalizedCollapsed);\n    const hiddenArr = hideAllTimelines ? ['__all__'] : Array.from(normalizedHidden);\n    const manualExpandedArr = Array.from(manualExpanded);\n    const manualTimelineArr = Array.from(manualTimeline);\n    const autoCollapsedArr = Array.from(autoCollapsed);\n    const autoHiddenArr = Array.from(autoHidden);\n\n    const arraysEqual = (a = [], b = []) => {\n      if (!Array.isArray(a) || !Array.isArray(b)) return false;\n      if (a.length !== b.length) return false;\n      for (let i = 0; i < a.length; i += 1) {\n        if (a[i] !== b[i]) return false;\n      }\n      return true;\n    };\n\n    const patch = {};\n    if (!arraysEqual(boardState.collapsedBlocks || [], collapsedArr)) {\n      patch.collapsedBlocks = collapsedArr;\n    }\n    if (!arraysEqual(boardState.hiddenTimelines || [], hiddenArr)) {\n      patch.hiddenTimelines = hiddenArr;\n    }\n    if (manualExpandedChanged || !arraysEqual(boardState.manualExpanded || [], manualExpandedArr)) {\n      patch.manualExpanded = manualExpandedArr;\n    }\n    if (manualTimelineChanged || !arraysEqual(boardState.manualTimeline || [], manualTimelineArr)) {\n      patch.manualTimeline = manualTimelineArr;\n    }\n    if (autoCollapsedChanged || !arraysEqual(boardState.autoCollapsed || [], autoCollapsedArr)) {\n      patch.autoCollapsed = autoCollapsedArr;\n    }\n    if (autoHiddenChanged || !arraysEqual(boardState.autoHidden || [], autoHiddenArr)) {\n      patch.autoHidden = autoHiddenArr;\n    }\n    if (Object.keys(patch).length) {\n      setBlockBoardState(patch);\n      if (patch.collapsedBlocks) boardState.collapsedBlocks = patch.collapsedBlocks;\n      if (patch.hiddenTimelines) boardState.hiddenTimelines = patch.hiddenTimelines;\n      if (patch.manualExpanded) boardState.manualExpanded = patch.manualExpanded;\n      if (patch.manualTimeline) boardState.manualTimeline = patch.manualTimeline;\n      if (patch.autoCollapsed) boardState.autoCollapsed = patch.autoCollapsed;\n      if (patch.autoHidden) boardState.autoHidden = patch.autoHidden;\n    }\n  }\n  const fallbackDays = collectDefaultBoardDays();\n\n  const refreshBoard = async (options = {}) => {\n    if (options && options.full && typeof refresh === 'function') {\n      await refresh();\n    } else {\n      await renderBlockBoard(container, refresh);\n    }\n  };\n\n  const queues = groupLectureQueues(lectures);\n\n  const urgentHost = document.createElement('div');\n  renderUrgentQueues(urgentHost, queues, {\n    onComplete: async (entry) => {\n      const passOrder = entry?.pass?.order;\n      const lecture = entry?.lecture;\n      if (!lecture || !Number.isFinite(passOrder)) return;\n      const passIndex = Array.isArray(lecture.passes)\n        ? lecture.passes.findIndex(pass => pass?.order === passOrder)\n        : -1;\n      if (passIndex < 0) return;\n      await updateLectureSchedule(lecture, lec => markPassCompleted(lec, passIndex));\n      await refreshBoard({ full: true });\n    },\n    onShift: async (entry, mode) => {\n      if (!entry?.lecture) return;\n      const lecture = entry.lecture;\n      const passOrder = Number(entry?.pass?.order);\n      if (!Number.isFinite(passOrder)) return;\n      const lectureLabel = lecture?.name || `Lecture ${lecture?.id ?? ''}`;\n      const passLabel = entry?.pass?.label || (Number.isFinite(passOrder) ? `Pass ${passOrder}` : 'Pass');\n      const result = await openShiftDialog(mode, {\n        description: `${lectureLabel} \u2022 ${passLabel}`,\n        defaultUnit: 'days',\n        defaultValue: 1\n      });\n      if (!result || !Number.isFinite(result.minutes) || result.minutes <= 0) return;\n      const delta = mode === 'push' ? result.minutes : -result.minutes;\n      try {\n        await updateLectureSchedule(lecture, lec => shiftPassesForScope(lec, passOrder, delta, result.scope));\n        await refreshBoard({ full: true });\n      } catch (err) {\n        console.error('Failed to shift pass timing', err);\n      }\n    }\n  });\n  container.appendChild(urgentHost);\n\n  const previousGridScroll = new Map();\n  const gridEntries = Array.isArray(scrollSnapshot?.gridScroll) ? scrollSnapshot.gridScroll : [];\n  gridEntries.forEach(entry => {\n    if (!entry) return;\n    const blockId = entry?.blockId;\n    if (blockId == null) return;\n    previousGridScroll.set(String(blockId), Number(entry?.left) || 0);\n  });\n\n  const blockList = document.createElement('div');\n  blockList.className = 'block-board-list';\n  const lecturesByBlock = new Map();\n  lectures.forEach(lecture => {\n    const key = String(lecture?.blockId ?? '');\n    if (!lecturesByBlock.has(key)) lecturesByBlock.set(key, []);\n    lecturesByBlock.get(key).push(lecture);\n  });\n  blocks.forEach(block => {\n    const blockLectures = lecturesByBlock.get(String(block.blockId)) || [];\n    const blockDays = collectDaysForBlock(block, blockLectures);\n    const daysForBlock = blockDays.length ? blockDays : fallbackDays;\n    renderBlockBoardBlock(blockList, block, blockLectures, daysForBlock, refreshBoard, previousGridScroll);\n  });\n  container.appendChild(blockList);\n  restoreBoardScrollState(container, scrollSnapshot);\n}\n\nfunction captureBoardScrollState(container) {\n  if (!container || typeof container !== 'object') return null;\n  const dayScroll = [];\n  container.querySelectorAll('.block-board-day-list').forEach(list => {\n    const column = list.closest('.block-board-day-column');\n    const block = list.closest('.block-board-block');\n    const blockId = block?.dataset?.blockId ?? '';\n    const day = column?.dataset?.day ?? '';\n    if (blockId && day) {\n      dayScroll.push({ key: `${blockId}::${day}`, top: list.scrollTop });\n    }\n  });\n  const gridScroll = [];\n  container.querySelectorAll('.block-board-block').forEach(blockEl => {\n    const blockId = blockEl?.dataset?.blockId ?? '';\n    if (!blockId) return;\n    const grid = blockEl.querySelector('.block-board-grid');\n    if (!grid) return;\n    gridScroll.push({ blockId, left: grid.scrollLeft });\n  });\n  const snapshot = {\n    containerTop: container.scrollTop,\n    containerLeft: container.scrollLeft,\n    dayScroll,\n    gridScroll,\n    windowX: typeof window !== 'undefined' ? window.scrollX : null,\n    windowY: typeof window !== 'undefined' ? window.scrollY : null\n  };\n  return snapshot;\n}\n\nfunction restoreBoardScrollState(container, snapshot) {\n  if (!container || !snapshot) return;\n  const apply = () => {\n    if (typeof container.scrollTo === 'function') {\n      container.scrollTo(snapshot.containerLeft ?? 0, snapshot.containerTop ?? 0);\n    } else {\n      container.scrollLeft = snapshot.containerLeft ?? 0;\n      container.scrollTop = snapshot.containerTop ?? 0;\n    }\n    if (snapshot.windowX != null && snapshot.windowY != null && typeof window !== 'undefined') {\n      const nav = typeof navigator !== 'undefined'\n        ? navigator\n        : typeof window.navigator !== 'undefined'\n          ? window.navigator\n          : null;\n      const ua = nav && typeof nav.userAgent === 'string'\n        ? nav.userAgent.toLowerCase()\n        : '';\n      const shouldRestoreWindow = !ua.includes('jsdom') && typeof window.scrollTo === 'function';\n      if (shouldRestoreWindow) {\n        try {\n          window.scrollTo(snapshot.windowX, snapshot.windowY);\n        } catch (err) {\n          /* ignore unsupported scroll restoration */\n        }\n      }\n    }\n    const dayEntries = Array.isArray(snapshot.dayScroll) ? snapshot.dayScroll : [];\n    const dayScrollMap = new Map(dayEntries.map(entry => [entry.key, entry.top]));\n    if (dayScrollMap.size) {\n      container.querySelectorAll('.block-board-block').forEach(blockEl => {\n        const blockId = blockEl?.dataset?.blockId ?? '';\n        if (!blockId) return;\n        blockEl.querySelectorAll('.block-board-day-column').forEach(column => {\n          const day = column?.dataset?.day ?? '';\n          if (!day) return;\n          const key = `${blockId}::${day}`;\n          if (!dayScrollMap.has(key)) return;\n          const list = column.querySelector('.block-board-day-list');\n          if (list) list.scrollTop = dayScrollMap.get(key) ?? 0;\n        });\n      });\n    }\n    const gridEntries = Array.isArray(snapshot.gridScroll) ? snapshot.gridScroll : [];\n    if (gridEntries.length) {\n      const gridScrollMap = new Map(gridEntries.map(entry => [String(entry.blockId ?? ''), Number(entry.left) || 0]));\n      container.querySelectorAll('.block-board-block').forEach(blockEl => {\n        const blockId = blockEl?.dataset?.blockId ?? '';\n        if (!blockId || !gridScrollMap.has(blockId)) return;\n        const grid = blockEl.querySelector('.block-board-grid');\n        if (!grid) return;\n        const target = gridScrollMap.get(blockId);\n        if (typeof grid.scrollTo === 'function') {\n          grid.scrollTo({ left: target, behavior: 'auto' });\n        } else {\n          grid.scrollLeft = target;\n        }\n      });\n    }\n  };\n  if (typeof requestAnimationFrame === 'function') {\n    requestAnimationFrame(apply);\n  } else {\n    setTimeout(apply, 0);\n  }\n}\n", "import { listExams, upsertExam, deleteExam, listExamSessions, loadExamSession, saveExamSessionProgress, deleteExamSessionProgress } from '../../storage/storage.js';\nimport { state, setExamSession, setExamAttemptExpanded, setExamLayout } from '../../state.js';\nimport { uid, setToggleState, deepClone } from '../../utils.js';\nimport { confirmModal } from './confirm.js';\nimport { createRichTextEditor, sanitizeHtml, htmlToPlainText, isEmptyHtml } from './rich-text.js';\nimport { createFloatingWindow } from './window-manager.js';\n\nconst DEFAULT_SECONDS = 60;\nconst CSV_MAX_OPTIONS = 8;\nconst CSV_HEADERS = (() => {\n  const base = ['type', 'examTitle', 'timerMode', 'secondsPerQuestion', 'stem'];\n  for (let i = 1; i <= CSV_MAX_OPTIONS; i += 1) {\n    base.push(`option${i}`);\n    base.push(`option${i}Correct`);\n  }\n  base.push('explanation', 'tags', 'media');\n  return base;\n})();\nconst CSV_ROW_META = 'meta';\nconst CSV_ROW_QUESTION = 'question';\nconst CSV_EXPLANATION_INDEX = CSV_HEADERS.indexOf('explanation');\nconst CSV_TAGS_INDEX = CSV_HEADERS.indexOf('tags');\nconst CSV_MEDIA_INDEX = CSV_HEADERS.indexOf('media');\n\nfunction csvOptionIndex(optionNumber) {\n  return 5 + (optionNumber - 1) * 2;\n}\n\nfunction csvOptionCorrectIndex(optionNumber) {\n  return csvOptionIndex(optionNumber) + 1;\n}\n\nconst timerHandles = new WeakMap();\nlet keyHandler = null;\nlet keyHandlerSession = null;\nlet lastExamStatusMessage = '';\n\nfunction sanitizeRichText(value) {\n  const raw = value == null ? '' : String(value);\n  if (!raw) return '';\n  const looksHtml = /<([a-z][^>]*>)/i.test(raw);\n  const normalized = looksHtml ? raw : raw.replace(/\\r?\\n/g, '<br>');\n  const sanitized = sanitizeHtml(normalized);\n  return isEmptyHtml(sanitized) ? '' : sanitized;\n}\n\nfunction ensureArrayTags(tags) {\n  if (!Array.isArray(tags)) {\n    if (tags == null) return [];\n    if (typeof tags === 'string') {\n      return tags.split(/[|,]/).map(tag => tag.trim()).filter(Boolean);\n    }\n    return [];\n  }\n  return tags.map(tag => String(tag).trim()).filter(Boolean);\n}\n\nfunction parseTagString(tags) {\n  if (!tags) return [];\n  return String(tags).split(/[|,]/).map(tag => tag.trim()).filter(Boolean);\n}\n\nfunction parseBooleanFlag(value) {\n  if (value == null) return false;\n  const str = String(value).trim().toLowerCase();\n  return ['true', '1', 'yes', 'y', 'correct'].includes(str);\n}\n\nfunction csvEscape(value) {\n  const str = value == null ? '' : String(value);\n  if (!str) return '';\n  if (/[\"]/.test(str) || /[\\n\\r,]/.test(str)) {\n    return `\"${str.replace(/\"/g, '\"\"')}\"`;\n  }\n  return str;\n}\n\nfunction downloadBlob(blob, filename) {\n  const url = URL.createObjectURL(blob);\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n  URL.revokeObjectURL(url);\n}\n\nfunction scorePercentage(result) {\n  if (!result || !Number.isFinite(result.correct) || !Number.isFinite(result.total) || result.total <= 0) {\n    return null;\n  }\n  return Math.round((result.correct / result.total) * 100);\n}\n\nfunction scoreBadgeClass(pct) {\n  if (!Number.isFinite(pct)) return 'neutral';\n  if (pct >= 85) return 'good';\n  if (pct >= 70) return 'warn';\n  return 'bad';\n}\n\nfunction createScoreBadge(result, label) {\n  const pct = scorePercentage(result);\n  const badge = document.createElement('span');\n  badge.className = ['exam-score-badge', `exam-score-badge--${scoreBadgeClass(pct)}`].join(' ');\n  if (label) {\n    const labelEl = document.createElement('span');\n    labelEl.className = 'exam-score-badge-label';\n    labelEl.textContent = label;\n    badge.appendChild(labelEl);\n  }\n  const value = document.createElement('span');\n  value.className = 'exam-score-badge-value';\n  if (pct == null) {\n    value.textContent = '\u2014';\n  } else {\n    value.textContent = `${pct}%`;\n  }\n  badge.appendChild(value);\n  return badge;\n}\n\nfunction setTimerElement(sess, element) {\n  if (!sess) return;\n  sess.__timerElement = element || null;\n  if (element) {\n    updateTimerElement(sess);\n  }\n}\n\nfunction updateTimerElement(sess) {\n  if (!sess) return;\n  const el = sess.__timerElement;\n  if (!el) return;\n  const remaining = typeof sess.remainingMs === 'number'\n    ? Math.max(0, sess.remainingMs)\n    : totalExamTimeMs(sess.exam);\n  el.textContent = formatCountdown(remaining);\n}\n\nfunction ensureQuestionStats(sess) {\n  const questionCount = sess?.exam?.questions?.length || 0;\n  if (!sess) return;\n  if (!Array.isArray(sess.questionStats)) {\n    sess.questionStats = Array.from({ length: questionCount }, () => ({\n      timeMs: 0,\n      changes: [],\n      enteredAt: null,\n      initialAnswer: null,\n      initialAnswerAt: null\n    }));\n    return;\n  }\n  if (sess.questionStats.length !== questionCount) {\n    const next = Array.from({ length: questionCount }, (_, idx) => {\n      const prev = sess.questionStats[idx] || {};\n      return {\n        timeMs: Number.isFinite(prev.timeMs) ? prev.timeMs : 0,\n        changes: Array.isArray(prev.changes) ? [...prev.changes] : [],\n        enteredAt: null,\n        initialAnswer: prev.initialAnswer ?? null,\n        initialAnswerAt: prev.initialAnswerAt ?? null\n      };\n    });\n    sess.questionStats = next;\n    return;\n  }\n  sess.questionStats.forEach(stat => {\n    if (!stat) return;\n    if (!Array.isArray(stat.changes)) stat.changes = [];\n    if (!Number.isFinite(stat.timeMs)) stat.timeMs = 0;\n    if (stat.enteredAt == null) stat.enteredAt = null;\n    if (!('initialAnswer' in stat)) stat.initialAnswer = null;\n    if (!('initialAnswerAt' in stat)) stat.initialAnswerAt = null;\n  });\n}\n\nfunction beginQuestionTiming(sess, idx) {\n  if (!sess || sess.mode !== 'taking') return;\n  ensureQuestionStats(sess);\n  const stat = sess.questionStats?.[idx];\n  if (!stat) return;\n  if (stat.enteredAt == null) {\n    stat.enteredAt = Date.now();\n  }\n}\n\nfunction finalizeQuestionTiming(sess, idx) {\n  if (!sess || sess.mode !== 'taking') return;\n  ensureQuestionStats(sess);\n  const stat = sess.questionStats?.[idx];\n  if (!stat || stat.enteredAt == null) return;\n  const now = Date.now();\n  const delta = Math.max(0, now - stat.enteredAt);\n  stat.timeMs = (Number.isFinite(stat.timeMs) ? stat.timeMs : 0) + delta;\n  stat.enteredAt = null;\n}\n\nfunction finalizeActiveQuestionTiming(sess) {\n  if (!sess || typeof sess.idx !== 'number') return;\n  finalizeQuestionTiming(sess, sess.idx);\n}\n\nfunction ensureScrollPositions(sess) {\n  if (!sess) return;\n  if (!sess.scrollPositions || typeof sess.scrollPositions !== 'object') {\n    sess.scrollPositions = {};\n  }\n}\n\nfunction resolveScrollContainer(root) {\n  const hasDocument = typeof document !== 'undefined';\n  if (root && typeof root.closest === 'function') {\n    const scoped = root.closest('main');\n    if (scoped) return scoped;\n  }\n  if (hasDocument) {\n    const main = document.querySelector('main');\n    if (main) return main;\n  }\n  if (typeof window !== 'undefined') return window;\n  return null;\n}\n\nfunction isWindowScroller(scroller) {\n  return typeof window !== 'undefined' && scroller === window;\n}\n\nfunction readScrollPosition(scroller) {\n  if (!scroller) return 0;\n  if (isWindowScroller(scroller)) {\n    return window.scrollY || window.pageYOffset || 0;\n  }\n  return scroller.scrollTop || 0;\n}\n\nfunction applyScrollPosition(scroller, value) {\n  if (!scroller) return;\n  const top = Number.isFinite(value) ? value : 0;\n  if (isWindowScroller(scroller)) {\n    if (typeof window.scrollTo === 'function') {\n      window.scrollTo({ left: 0, top, behavior: 'auto' });\n    }\n    return;\n  }\n  if (typeof scroller.scrollTo === 'function') {\n    scroller.scrollTo({ left: 0, top, behavior: 'auto' });\n  } else {\n    scroller.scrollTop = top;\n  }\n}\n\nfunction storeScrollPosition(sess, idx, value) {\n  if (!sess || typeof idx !== 'number') return;\n  ensureScrollPositions(sess);\n  const numeric = Number.isFinite(value) ? value : 0;\n  sess.scrollPositions[idx] = numeric;\n}\n\nfunction getStoredScroll(sess, idx) {\n  if (!sess || typeof idx !== 'number') return null;\n  const store = sess.scrollPositions;\n  if (!store || typeof store !== 'object') return null;\n  const value = store[idx];\n  return Number.isFinite(value) ? value : null;\n}\n\nfunction navigateToQuestion(sess, nextIdx, render) {\n  if (!sess || typeof nextIdx !== 'number') return;\n  const total = sess.exam?.questions?.length || 0;\n  if (!total) return;\n  const clamped = Math.min(Math.max(nextIdx, 0), Math.max(0, total - 1));\n  if (clamped === sess.idx) return;\n  if (typeof sess.idx === 'number') {\n    const scroller = resolveScrollContainer();\n    const scrollPos = readScrollPosition(scroller);\n    storeScrollPosition(sess, sess.idx, scrollPos);\n  }\n  if (sess.mode === 'taking') {\n    finalizeActiveQuestionTiming(sess);\n  }\n  sess.idx = clamped;\n  if (sess.mode === 'taking') {\n    beginQuestionTiming(sess, clamped);\n  }\n  render();\n}\n\nfunction recordAnswerChange(sess, idx, question, nextAnswer) {\n  if (!sess || sess.mode !== 'taking') return;\n  ensureQuestionStats(sess);\n  const stat = sess.questionStats?.[idx];\n  if (!stat) return;\n  const prev = sess.answers?.[idx];\n  if (prev === nextAnswer) return;\n  if (prev == null) {\n    if (nextAnswer != null && stat.initialAnswer == null) {\n      stat.initialAnswer = nextAnswer;\n      stat.initialAnswerAt = Date.now();\n    }\n    return;\n  }\n  const change = {\n    at: Date.now(),\n    from: prev ?? null,\n    to: nextAnswer ?? null\n  };\n  if (prev != null) change.fromCorrect = prev === question.answer;\n  if (nextAnswer != null) change.toCorrect = nextAnswer === question.answer;\n  if (!Array.isArray(stat.changes)) stat.changes = [];\n  stat.changes.push(change);\n}\n\nfunction snapshotQuestionStats(sess) {\n  ensureQuestionStats(sess);\n  return (sess.questionStats || []).map(stat => ({\n    timeMs: Number.isFinite(stat?.timeMs) ? stat.timeMs : 0,\n    changes: Array.isArray(stat?.changes) ? stat.changes.map(change => ({ ...change })) : [],\n    initialAnswer: stat?.initialAnswer ?? null,\n    initialAnswerAt: stat?.initialAnswerAt ?? null\n  }));\n}\n\nfunction extractAnswerSequence(stat, finalAnswer) {\n  const sequence = [];\n  const push = value => {\n    if (value == null) return;\n    if (sequence[sequence.length - 1] === value) return;\n    sequence.push(value);\n  };\n\n  if (stat && stat.initialAnswer != null) {\n    push(stat.initialAnswer);\n  }\n\n  const changes = Array.isArray(stat?.changes) ? stat.changes : [];\n  changes.forEach(change => {\n    if (!change) return;\n    if (change.to != null) push(change.to);\n  });\n\n  if (finalAnswer != null) {\n    push(finalAnswer);\n  }\n\n  return sequence;\n}\n\nfunction analyzeAnswerChange(stat, question, finalAnswer) {\n  if (!question) {\n    return {\n      initialAnswer: null,\n      finalAnswer: null,\n      initialCorrect: null,\n      finalCorrect: null,\n      changed: false,\n      direction: null,\n      switched: false,\n      sequence: []\n    };\n  }\n\n  const answerId = question.answer;\n  const sequence = extractAnswerSequence(stat, finalAnswer);\n  const initialAnswer = sequence.length ? sequence[0] : (stat?.initialAnswer ?? null);\n  const resolvedFinalAnswer = sequence.length ? sequence[sequence.length - 1] : (finalAnswer ?? null);\n\n  const initialCorrect = initialAnswer != null ? initialAnswer === answerId : null;\n  const finalCorrect = resolvedFinalAnswer != null ? resolvedFinalAnswer === answerId : null;\n\n  const switched = sequence.length > 1;\n  const changed = switched && initialAnswer != null && resolvedFinalAnswer != null && initialAnswer !== resolvedFinalAnswer;\n\n  let direction = null;\n  if (changed) {\n    if (initialCorrect === true && finalCorrect === false) {\n      direction = 'right-to-wrong';\n    } else if (initialCorrect === false && finalCorrect === true) {\n      direction = 'wrong-to-right';\n    } else {\n      direction = 'neutral';\n    }\n  }\n\n  return {\n    initialAnswer,\n    finalAnswer: resolvedFinalAnswer,\n    initialCorrect,\n    finalCorrect,\n    changed,\n    direction,\n    switched,\n    sequence\n  };\n}\n\nfunction countMeaningfulAnswerChanges(stat) {\n  if (!stat || !Array.isArray(stat.changes)) return 0;\n  let count = 0;\n  stat.changes.forEach(change => {\n    if (!change) return;\n    const from = change.from ?? null;\n    const to = change.to ?? null;\n    if (from == null) return;\n    if (from === to) return;\n    count += 1;\n  });\n  return count;\n}\n\nfunction summarizeAnswerChanges(questionStats, exam, answers = {}) {\n  let rightToWrong = 0;\n  let wrongToRight = 0;\n  let switched = 0;\n  let endedDifferent = 0;\n  questionStats.forEach((stat, idx) => {\n    const question = exam?.questions?.[idx];\n    if (!question) return;\n    const finalAnswer = answers[idx];\n    const details = analyzeAnswerChange(stat, question, finalAnswer);\n    if (details.switched) {\n      switched += 1;\n    }\n    if (details.changed) {\n      endedDifferent += 1;\n      if (details.direction === 'right-to-wrong') rightToWrong += 1;\n      if (details.direction === 'wrong-to-right') wrongToRight += 1;\n    }\n  });\n  return {\n    rightToWrong,\n    wrongToRight,\n    switched,\n    endedDifferent,\n    returnedToOriginal: Math.max(0, switched - endedDifferent),\n    totalChanges: switched\n  };\n}\n\nfunction clone(value) {\n  return value != null ? deepClone(value) : value;\n}\n\nfunction totalExamTimeMs(exam) {\n  const seconds = typeof exam.secondsPerQuestion === 'number' ? exam.secondsPerQuestion : DEFAULT_SECONDS;\n  return seconds * (exam.questions?.length || 0) * 1000;\n}\n\nfunction stopTimer(sess) {\n  finalizeActiveQuestionTiming(sess);\n  const handle = timerHandles.get(sess);\n  if (handle) {\n    clearInterval(handle);\n    timerHandles.delete(sess);\n  }\n  if (sess?.startedAt) {\n    const now = Date.now();\n    const delta = Math.max(0, now - sess.startedAt);\n    sess.elapsedMs = (sess.elapsedMs || 0) + delta;\n    if (sess.exam?.timerMode === 'timed' && typeof sess.remainingMs === 'number') {\n      sess.remainingMs = Math.max(0, sess.remainingMs - delta);\n    }\n    sess.startedAt = null;\n    updateTimerElement(sess);\n  }\n}\n\nfunction ensureTimer(sess, render) {\n  if (!sess || sess.mode !== 'taking' || sess.exam.timerMode !== 'timed') return;\n  if (timerHandles.has(sess)) return;\n  if (typeof sess.remainingMs !== 'number') {\n    sess.remainingMs = totalExamTimeMs(sess.exam);\n  }\n  if (typeof sess.elapsedMs !== 'number') sess.elapsedMs = 0;\n  sess.startedAt = Date.now();\n  const handle = setInterval(() => {\n    const now = Date.now();\n    const last = sess.startedAt || now;\n    const delta = Math.max(0, now - last);\n    sess.startedAt = now;\n    sess.elapsedMs = (sess.elapsedMs || 0) + delta;\n    sess.remainingMs = Math.max(0, (sess.remainingMs ?? 0) - delta);\n    if (sess.remainingMs <= 0) {\n      stopTimer(sess);\n      finalizeExam(sess, render, { autoSubmit: true });\n    } else {\n      updateTimerElement(sess);\n    }\n  }, 1000);\n  timerHandles.set(sess, handle);\n}\n\nfunction teardownKeyboardNavigation() {\n  if (keyHandler) {\n    window.removeEventListener('keydown', keyHandler);\n    keyHandler = null;\n    keyHandlerSession = null;\n  }\n}\n\nfunction setupKeyboardNavigation(sess, render) {\n  if (!sess || sess.mode === 'summary') {\n    teardownKeyboardNavigation();\n    return;\n  }\n  if (keyHandler && keyHandlerSession === sess) return;\n  teardownKeyboardNavigation();\n  keyHandlerSession = sess;\n  keyHandler = event => {\n    if (event.defaultPrevented) return;\n    const target = event.target;\n    if (target instanceof HTMLElement) {\n      const tag = target.tagName;\n      if (tag === 'INPUT' || tag === 'TEXTAREA' || tag === 'SELECT' || target.isContentEditable) return;\n    }\n    if (event.key === 'ArrowRight') {\n      if (sess.idx < sess.exam.questions.length - 1) {\n        event.preventDefault();\n        navigateToQuestion(sess, sess.idx + 1, render);\n      }\n    } else if (event.key === 'ArrowLeft') {\n      if (sess.idx > 0) {\n        event.preventDefault();\n        navigateToQuestion(sess, sess.idx - 1, render);\n      }\n    }\n  };\n  window.addEventListener('keydown', keyHandler);\n}\n\nfunction formatCountdown(ms) {\n  const totalSeconds = Math.max(0, Math.ceil(ms / 1000));\n  const hours = Math.floor(totalSeconds / 3600);\n  const minutes = Math.floor((totalSeconds % 3600) / 60);\n  const seconds = totalSeconds % 60;\n  if (hours > 0) {\n    return [hours, minutes, seconds].map(val => String(val).padStart(2, '0')).join(':');\n  }\n  return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;\n}\n\nfunction currentElapsedMs(sess) {\n  const base = sess?.elapsedMs || 0;\n  if (sess?.startedAt) {\n    return base + Math.max(0, Date.now() - sess.startedAt);\n  }\n  return base;\n}\n\nfunction slugify(text) {\n  const lowered = (text || '').toLowerCase();\n  const normalized = lowered.replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');\n  return normalized || 'exam';\n}\n\nfunction triggerExamDownload(exam) {\n  try {\n    const data = JSON.stringify(exam, null, 2);\n    const blob = new Blob([data], { type: 'application/json' });\n    const url = URL.createObjectURL(blob);\n    const a = document.createElement('a');\n    a.href = url;\n    a.download = `${slugify(exam.examTitle || 'exam')}.json`;\n    document.body.appendChild(a);\n    a.click();\n    document.body.removeChild(a);\n    setTimeout(() => URL.revokeObjectURL(url), 0);\n    return true;\n  } catch (err) {\n    console.warn('Failed to export exam', err);\n    return false;\n  }\n}\n\n\nfunction examToCsv(exam) {\n  const rows = [];\n  rows.push(CSV_HEADERS);\n\n  const metaRow = new Array(CSV_HEADERS.length).fill('');\n  metaRow[0] = CSV_ROW_META;\n  metaRow[1] = exam.examTitle || '';\n  metaRow[2] = exam.timerMode === 'timed' ? 'timed' : 'untimed';\n  metaRow[3] = Number.isFinite(exam.secondsPerQuestion) ? String(exam.secondsPerQuestion) : String(DEFAULT_SECONDS);\n  rows.push(metaRow);\n\n  (exam.questions || []).forEach(question => {\n    const row = new Array(CSV_HEADERS.length).fill('');\n    row[0] = CSV_ROW_QUESTION;\n    row[4] = question.stem || '';\n    const options = Array.isArray(question.options) ? question.options : [];\n    options.slice(0, CSV_MAX_OPTIONS).forEach((opt, idx) => {\n      const optionCol = csvOptionIndex(idx + 1);\n      const correctCol = csvOptionCorrectIndex(idx + 1);\n      row[optionCol] = opt.text || '';\n      row[correctCol] = opt.id === question.answer ? 'TRUE' : '';\n    });\n    if (CSV_EXPLANATION_INDEX >= 0) row[CSV_EXPLANATION_INDEX] = question.explanation || '';\n    if (CSV_TAGS_INDEX >= 0) row[CSV_TAGS_INDEX] = Array.isArray(question.tags) ? question.tags.join(' | ') : '';\n    if (CSV_MEDIA_INDEX >= 0) row[CSV_MEDIA_INDEX] = question.media || '';\n    rows.push(row);\n  });\n\n  return rows.map(row => row.map(csvEscape).join(',')).join('\\r\\n');\n}\n\nfunction downloadExamCsv(exam) {\n  const csv = examToCsv(exam);\n  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n  downloadBlob(blob, `${slugify(exam.examTitle || 'exam')}.csv`);\n}\n\nfunction downloadExamCsvTemplate() {\n  const sampleQuestion = createBlankQuestion();\n  sampleQuestion.stem = sanitizeRichText('What is the capital of France?');\n  sampleQuestion.options = [\n    { id: uid(), text: sanitizeRichText('Paris') },\n    { id: uid(), text: sanitizeRichText('London') },\n    { id: uid(), text: sanitizeRichText('Rome') }\n  ];\n  sampleQuestion.answer = sampleQuestion.options[0]?.id || '';\n  sampleQuestion.explanation = sanitizeRichText('Paris is the capital and most populous city of France.');\n  sampleQuestion.tags = ['geography'];\n\n  const { exam } = ensureExamShape({\n    examTitle: 'Example Exam',\n    timerMode: 'untimed',\n    secondsPerQuestion: DEFAULT_SECONDS,\n    questions: [sampleQuestion],\n    results: []\n  });\n\n  const csv = examToCsv(exam);\n  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n  downloadBlob(blob, 'exam-template.csv');\n}\n\nfunction parseCsv(text) {\n  const rows = [];\n  let current = '';\n  let row = [];\n  let inQuotes = false;\n\n  for (let i = 0; i < text.length; i += 1) {\n    const char = text[i];\n    if (inQuotes) {\n      if (char === '\"') {\n        if (text[i + 1] === '\"') {\n          current += '\"';\n          i += 1;\n        } else {\n          inQuotes = false;\n        }\n      } else {\n        current += char;\n      }\n    } else if (char === '\"') {\n      inQuotes = true;\n    } else if (char === ',') {\n      row.push(current);\n      current = '';\n    } else if (char === '\\r') {\n      row.push(current);\n      rows.push(row);\n      row = [];\n      current = '';\n      if (text[i + 1] === '\\n') i += 1;\n    } else if (char === '\\n') {\n      row.push(current);\n      rows.push(row);\n      row = [];\n      current = '';\n    } else {\n      current += char;\n    }\n  }\n\n  row.push(current);\n  if (row.length > 1 || row[0].trim()) {\n    rows.push(row);\n  }\n\n  return rows.filter(r => !(r.length === 1 && r[0].trim() === ''));\n}\n\nfunction examFromCsv(text) {\n  const rows = parseCsv(text);\n  if (!rows.length) {\n    throw new Error('Empty CSV');\n  }\n  const header = rows[0].map(col => col.trim());\n  const indexMap = new Map();\n  header.forEach((name, idx) => {\n    if (!name) return;\n    indexMap.set(name, idx);\n  });\n\n  const getCell = (row, key) => {\n    const idx = indexMap.has(key) ? indexMap.get(key) : -1;\n    if (idx == null || idx < 0) return '';\n    return row[idx] ?? '';\n  };\n\n  const base = {\n    examTitle: 'Imported Exam',\n    timerMode: 'untimed',\n    secondsPerQuestion: DEFAULT_SECONDS,\n    questions: [],\n    results: []\n  };\n\n  rows.slice(1).forEach(row => {\n    const type = String(getCell(row, 'type') || '').trim().toLowerCase();\n    if (!type) return;\n    if (type === CSV_ROW_META) {\n      const title = String(getCell(row, 'examTitle') || '').trim();\n      if (title) base.examTitle = title;\n      const mode = String(getCell(row, 'timerMode') || '').trim().toLowerCase();\n      if (mode === 'timed' || mode === 'untimed') base.timerMode = mode;\n      const seconds = Number(getCell(row, 'secondsPerQuestion'));\n      if (Number.isFinite(seconds) && seconds > 0) base.secondsPerQuestion = seconds;\n      return;\n    }\n    if (type !== CSV_ROW_QUESTION) return;\n\n    const question = createBlankQuestion();\n    question.stem = sanitizeRichText(getCell(row, 'stem'));\n    question.explanation = sanitizeRichText(getCell(row, 'explanation'));\n    question.tags = parseTagString(getCell(row, 'tags'));\n    question.media = String(getCell(row, 'media') || '').trim();\n    question.options = [];\n    question.answer = '';\n\n    for (let i = 1; i <= CSV_MAX_OPTIONS; i += 1) {\n      const optionHtml = sanitizeRichText(getCell(row, `option${i}`));\n      if (!optionHtml) continue;\n      const option = { id: uid(), text: optionHtml };\n      question.options.push(option);\n      if (!question.answer && parseBooleanFlag(getCell(row, `option${i}Correct`))) {\n        question.answer = option.id;\n      }\n    }\n\n    if (question.options.length < 2) {\n      return;\n    }\n    if (!question.answer) {\n      question.answer = question.options[0].id;\n    }\n    base.questions.push(question);\n  });\n\n  if (!base.questions.length) {\n    throw new Error('No questions found in CSV');\n  }\n\n  return ensureExamShape(base).exam;\n}\n\n\nfunction ensureExamShape(exam) {\n  const next = clone(exam) || {};\n  let changed = false;\n\n  if (!next.id) { next.id = uid(); changed = true; }\n  if (!next.examTitle) { next.examTitle = 'Untitled Exam'; changed = true; }\n  if (next.timerMode !== 'timed') {\n    if (next.timerMode !== 'untimed') changed = true;\n    next.timerMode = 'untimed';\n  }\n  if (typeof next.secondsPerQuestion !== 'number' || next.secondsPerQuestion <= 0) {\n    next.secondsPerQuestion = DEFAULT_SECONDS;\n    changed = true;\n  }\n  if (!Array.isArray(next.questions)) {\n    next.questions = [];\n    changed = true;\n  }\n  next.questions = next.questions.map(q => {\n    const question = { ...q };\n    if (!question.id) { question.id = uid(); changed = true; }\n    const originalStem = question.stem;\n    question.stem = sanitizeRichText(question.stem);\n    if (originalStem !== question.stem) changed = true;\n    if (!Array.isArray(question.options)) {\n      question.options = [];\n      changed = true;\n    }\n    question.options = question.options.map(opt => {\n      const option = { ...opt };\n      if (!option.id) { option.id = uid(); changed = true; }\n      const originalText = option.text;\n      option.text = sanitizeRichText(option.text);\n      if (originalText !== option.text) changed = true;\n      return option;\n    });\n    if (!question.answer || !question.options.some(opt => opt.id === question.answer)) {\n      question.answer = question.options[0]?.id || '';\n      changed = true;\n    }\n    const originalExplanation = question.explanation;\n    question.explanation = sanitizeRichText(question.explanation);\n    if (originalExplanation !== question.explanation) changed = true;\n    const normalizedTags = ensureArrayTags(question.tags);\n    if (question.tags?.length !== normalizedTags.length || question.tags?.some((t, idx) => t !== normalizedTags[idx])) {\n      question.tags = normalizedTags;\n      changed = true;\n    } else {\n      question.tags = normalizedTags;\n    }\n    if (question.media == null) { question.media = ''; changed = true; }\n    return question;\n  });\n\n  if (!Array.isArray(next.results)) {\n    next.results = [];\n    changed = true;\n  }\n  next.results = next.results.map(res => {\n    const result = { ...res };\n    if (!result.id) { result.id = uid(); changed = true; }\n    if (typeof result.when !== 'number') { result.when = Date.now(); changed = true; }\n    if (typeof result.correct !== 'number') { result.correct = Number(result.correct) || 0; changed = true; }\n    if (typeof result.total !== 'number') { result.total = Number(result.total) || (next.questions?.length ?? 0); changed = true; }\n    if (!result.answers || typeof result.answers !== 'object') { result.answers = {}; changed = true; }\n    if (!Array.isArray(result.flagged)) { result.flagged = []; changed = true; }\n    if (typeof result.durationMs !== 'number') { result.durationMs = 0; changed = true; }\n    if (typeof result.answered !== 'number') { result.answered = Object.keys(result.answers || {}).length; changed = true; }\n    return result;\n  });\n\n  return { exam: next, changed };\n}\n\nfunction createBlankQuestion() {\n  return {\n    id: uid(),\n    stem: '',\n    options: [1, 2, 3, 4].map(() => ({ id: uid(), text: '' })),\n    answer: '',\n    explanation: '',\n    tags: [],\n    media: ''\n  };\n}\n\nfunction createTakingSession(exam) {\n  const snapshot = clone(exam);\n  const totalMs = snapshot.timerMode === 'timed' ? totalExamTimeMs(snapshot) : null;\n  return {\n    mode: 'taking',\n    exam: snapshot,\n    idx: 0,\n    answers: {},\n    flagged: {},\n    checked: {},\n    startedAt: Date.now(),\n    elapsedMs: 0,\n    remainingMs: totalMs,\n    questionStats: snapshot.questions.map(() => ({\n      timeMs: 0,\n      changes: [],\n      enteredAt: null,\n      initialAnswer: null,\n      initialAnswerAt: null\n    }))\n  };\n}\n\nfunction hydrateSavedSession(saved, fallbackExam) {\n  const baseExam = saved?.exam ? ensureExamShape(saved.exam).exam : fallbackExam;\n  const exam = clone(baseExam);\n  const questionCount = exam.questions.length;\n  const idx = Math.min(Math.max(Number(saved?.idx) || 0, 0), Math.max(0, questionCount - 1));\n  const remaining = typeof saved?.remainingMs === 'number'\n    ? Math.max(0, saved.remainingMs)\n    : (exam.timerMode === 'timed' ? totalExamTimeMs(exam) : null);\n  const elapsed = Math.max(0, Number(saved?.elapsedMs) || 0);\n  return {\n    mode: 'taking',\n    exam,\n    idx,\n    answers: saved?.answers ? { ...saved.answers } : {},\n    flagged: saved?.flagged ? { ...saved.flagged } : {},\n    checked: saved?.checked ? { ...saved.checked } : {},\n    startedAt: Date.now(),\n    elapsedMs: elapsed,\n    remainingMs: remaining,\n    questionStats: exam.questions.map((_, questionIdx) => {\n      const stat = saved?.questionStats?.[questionIdx] || {};\n      return {\n        timeMs: Number.isFinite(stat.timeMs) ? stat.timeMs : 0,\n        changes: Array.isArray(stat.changes) ? stat.changes.map(change => ({ ...change })) : [],\n        enteredAt: null,\n        initialAnswer: stat.initialAnswer ?? null,\n        initialAnswerAt: Number.isFinite(stat.initialAnswerAt) ? stat.initialAnswerAt : null\n      };\n    })\n  };\n}\n\nexport async function renderExams(root, render) {\n  root.innerHTML = '';\n  root.className = 'exam-view';\n\n  const controls = document.createElement('div');\n  controls.className = 'exam-controls';\n\n  const heading = document.createElement('div');\n  heading.className = 'exam-heading';\n  heading.innerHTML = '<h1>Exams</h1><p>Import exams, take them, and review your attempts.</p>';\n  controls.appendChild(heading);\n\n  const actions = document.createElement('div');\n  actions.className = 'exam-control-actions';\n\n  const status = document.createElement('div');\n  status.className = 'exam-status';\n\n  const fileInput = document.createElement('input');\n  fileInput.type = 'file';\n  fileInput.accept = '.json,.csv,application/json,text/csv';\n  fileInput.style.display = 'none';\n  fileInput.addEventListener('change', async e => {\n    const file = e.target.files?.[0];\n    if (!file) return;\n    try {\n      const name = (file.name || '').toLowerCase();\n      if (name.endsWith('.csv') || (file.type || '').includes('csv')) {\n        const text = await file.text();\n        const imported = examFromCsv(text);\n        await upsertExam({ ...imported, updatedAt: Date.now() });\n        lastExamStatusMessage = `Imported \"${imported.examTitle}\" from CSV.`;\n        render();\n      } else {\n        const text = await file.text();\n        const parsed = JSON.parse(text);\n        const { exam } = ensureExamShape(parsed);\n        await upsertExam({ ...exam, updatedAt: Date.now() });\n        lastExamStatusMessage = `Imported \"${exam.examTitle}\" from JSON.`;\n        render();\n      }\n    } catch (err) {\n      console.warn('Failed to import exam', err);\n      status.textContent = 'Unable to import exam \u2014 check the file format.';\n    } finally {\n      fileInput.value = '';\n    }\n  });\n\n  const importBtn = document.createElement('button');\n  importBtn.type = 'button';\n  importBtn.className = 'btn secondary';\n  importBtn.textContent = 'Import JSON/CSV';\n  importBtn.addEventListener('click', () => fileInput.click());\n  actions.appendChild(importBtn);\n\n  const templateBtn = document.createElement('button');\n  templateBtn.type = 'button';\n  templateBtn.className = 'btn secondary';\n  templateBtn.textContent = 'CSV Template';\n  templateBtn.addEventListener('click', () => {\n    try {\n      downloadExamCsvTemplate();\n      status.textContent = 'CSV template downloaded.';\n    } catch (err) {\n      console.warn('Failed to create CSV template', err);\n      status.textContent = 'Unable to download template.';\n    }\n  });\n  actions.appendChild(templateBtn);\n\n  const newBtn = document.createElement('button');\n  newBtn.type = 'button';\n  newBtn.className = 'btn';\n  newBtn.textContent = 'New Exam';\n  newBtn.addEventListener('click', () => openExamEditor(null, render));\n  actions.appendChild(newBtn);\n\n  controls.appendChild(actions);\n\n  const layout = state.examLayout || { mode: 'grid', detailsVisible: true };\n  const viewMode = layout.mode === 'row' ? 'row' : 'grid';\n  const detailsVisible = layout.detailsVisible !== false;\n\n  const layoutControls = document.createElement('div');\n  layoutControls.className = 'exam-layout-controls';\n\n  const layoutToggle = document.createElement('button');\n  layoutToggle.type = 'button';\n  layoutToggle.className = 'exam-layout-toggle';\n  layoutToggle.setAttribute('aria-pressed', viewMode === 'row' ? 'true' : 'false');\n  layoutToggle.setAttribute('aria-label', viewMode === 'row' ? 'Switch to column view' : 'Switch to row view');\n  const toggleIcon = document.createElement('span');\n  toggleIcon.className = 'exam-layout-toggle-icon';\n  layoutToggle.appendChild(toggleIcon);\n  const toggleText = document.createElement('span');\n  toggleText.className = 'sr-only';\n  toggleText.textContent = viewMode === 'row' ? 'Show exams in columns' : 'Show exams in rows';\n  layoutToggle.appendChild(toggleText);\n  layoutToggle.addEventListener('click', () => {\n    const nextMode = viewMode === 'row' ? 'grid' : 'row';\n    setExamLayout({ mode: nextMode });\n    render();\n  });\n\n  layoutControls.appendChild(layoutToggle);\n\n  controls.appendChild(layoutControls);\n  controls.appendChild(status);\n\n  root.appendChild(controls);\n  root.appendChild(fileInput);\n\n  if (lastExamStatusMessage) {\n    status.textContent = lastExamStatusMessage;\n    lastExamStatusMessage = '';\n  } else {\n    status.textContent = '';\n  }\n\n  const stored = await listExams();\n  const exams = [];\n  for (const raw of stored) {\n    const { exam, changed } = ensureExamShape(raw);\n    exams.push(exam);\n    if (changed) await upsertExam(exam);\n  }\n  exams.sort((a, b) => (b.updatedAt || 0) - (a.updatedAt || 0));\n\n  const savedSessions = await listExamSessions();\n  const sessionMap = new Map();\n  for (const sess of savedSessions) {\n    if (sess?.examId) sessionMap.set(sess.examId, sess);\n  }\n\n  // Clean up orphaned sessions for removed exams\n  for (const sess of savedSessions) {\n    if (!exams.find(ex => ex.id === sess.examId)) {\n      await deleteExamSessionProgress(sess.examId);\n    }\n  }\n\n  if (!exams.length) {\n    const empty = document.createElement('div');\n    empty.className = 'exam-empty';\n    empty.innerHTML = '<p>No exams yet. Import a JSON or CSV exam, download the template, or create one from scratch.</p>';\n    root.appendChild(empty);\n    return;\n  }\n\n  const layoutSnapshot = { mode: viewMode, detailsVisible };\n\n  const grid = document.createElement('div');\n  grid.className = 'exam-grid';\n  if (viewMode === 'row') {\n    grid.classList.add('exam-grid--row');\n  }\n  exams.forEach(exam => {\n    grid.appendChild(buildExamCard(exam, render, sessionMap.get(exam.id), status, layoutSnapshot));\n  });\n  root.appendChild(grid);\n}\n\nfunction buildExamCard(exam, render, savedSession, statusEl, layout) {\n  const layoutMode = layout?.mode === 'row' ? 'row' : 'grid';\n  const defaultExpanded = layout?.detailsVisible !== false;\n  const expandedState = state.examAttemptExpanded[exam.id];\n  const isExpanded = expandedState != null ? expandedState : defaultExpanded;\n  const last = latestResult(exam);\n  const best = bestResult(exam);\n\n  const card = document.createElement('article');\n  card.className = 'card exam-card';\n  if (layoutMode === 'row') {\n    card.classList.add('exam-card--row');\n  }\n  if (isExpanded) {\n    card.classList.add('exam-card--expanded');\n  }\n\n  const header = document.createElement('div');\n  header.className = 'exam-card-header';\n  card.appendChild(header);\n\n  const summaryButton = document.createElement('button');\n  summaryButton.type = 'button';\n  summaryButton.className = 'exam-card-summary';\n  summaryButton.setAttribute('aria-expanded', isExpanded ? 'true' : 'false');\n  summaryButton.addEventListener('click', () => {\n    setExamAttemptExpanded(exam.id, !isExpanded);\n    render();\n  });\n  header.appendChild(summaryButton);\n\n  const summaryContent = document.createElement('div');\n  summaryContent.className = 'exam-card-summary-content';\n  summaryButton.appendChild(summaryContent);\n\n  const titleGroup = document.createElement('div');\n  titleGroup.className = 'exam-card-title-group';\n  summaryContent.appendChild(titleGroup);\n\n  const title = document.createElement('h2');\n  title.className = 'exam-card-title';\n  title.textContent = exam.examTitle;\n  titleGroup.appendChild(title);\n\n  const meta = document.createElement('div');\n  meta.className = 'exam-card-meta';\n  const questionCount = document.createElement('span');\n  questionCount.textContent = `${exam.questions.length} question${exam.questions.length === 1 ? '' : 's'}`;\n  meta.appendChild(questionCount);\n  const timerInfo = document.createElement('span');\n  timerInfo.textContent = exam.timerMode === 'timed'\n    ? `Timed \u2022 ${exam.secondsPerQuestion}s/question`\n    : 'Untimed';\n  meta.appendChild(timerInfo);\n  titleGroup.appendChild(meta);\n\n  const glance = document.createElement('div');\n  glance.className = 'exam-card-pills';\n  summaryContent.appendChild(glance);\n\n  if (exam.results.length) {\n    const attemptsChip = document.createElement('span');\n    attemptsChip.className = 'exam-card-chip';\n    attemptsChip.textContent = `${exam.results.length} attempt${exam.results.length === 1 ? '' : 's'}`;\n    attemptsChip.title = `${exam.results.length} recorded attempt${exam.results.length === 1 ? '' : 's'}`;\n    glance.appendChild(attemptsChip);\n  }\n\n  if (best) {\n    const badge = createScoreBadge(best);\n    badge.classList.add('exam-score-badge--pill');\n    badge.dataset.badge = 'best';\n    badge.title = `Best attempt \u2022 ${formatScore(best)}`;\n    badge.setAttribute('aria-label', `Best attempt ${formatScore(best)}`);\n    glance.appendChild(badge);\n  }\n  if (last && (!best || last.id !== best.id)) {\n    const badge = createScoreBadge(last);\n    badge.classList.add('exam-score-badge--pill');\n    badge.dataset.badge = 'last';\n    badge.title = `Last attempt \u2022 ${formatScore(last)}`;\n    badge.setAttribute('aria-label', `Last attempt ${formatScore(last)}`);\n    glance.appendChild(badge);\n  }\n  if (savedSession) {\n    const progressChip = document.createElement('span');\n    progressChip.className = 'exam-card-chip exam-card-chip--progress';\n    progressChip.textContent = 'In progress';\n    glance.appendChild(progressChip);\n  }\n\n  const caret = document.createElement('span');\n  caret.className = 'exam-card-caret';\n  summaryButton.appendChild(caret);\n\n  const quickAction = document.createElement('div');\n  quickAction.className = 'exam-card-cta';\n  header.appendChild(quickAction);\n\n  const quickBtn = document.createElement('button');\n  quickBtn.className = 'btn exam-card-primary';\n  quickBtn.disabled = !savedSession && !last && exam.questions.length === 0;\n  quickAction.appendChild(quickBtn);\n\n  if (savedSession) {\n    quickBtn.textContent = 'Resume';\n    quickBtn.addEventListener('click', async () => {\n      const latest = await loadExamSession(exam.id);\n      if (!latest) {\n        if (statusEl) statusEl.textContent = 'Saved attempt could not be found.';\n        render();\n        return;\n      }\n      const session = hydrateSavedSession(latest, exam);\n      setExamSession(session);\n      render();\n    });\n  } else if (last) {\n    quickBtn.textContent = 'Review';\n    quickBtn.addEventListener('click', () => {\n      setExamSession({ mode: 'review', exam: clone(exam), result: clone(last), idx: 0 });\n      render();\n    });\n  } else {\n    quickBtn.textContent = 'Start';\n    quickBtn.addEventListener('click', () => {\n      setExamSession(createTakingSession(exam));\n      render();\n    });\n  }\n\n  const menuWrap = document.createElement('div');\n  menuWrap.className = 'exam-card-menu';\n  quickAction.appendChild(menuWrap);\n\n  const menuToggle = document.createElement('button');\n  menuToggle.type = 'button';\n  menuToggle.className = 'exam-card-menu-toggle';\n  menuToggle.setAttribute('aria-haspopup', 'true');\n  menuToggle.setAttribute('aria-expanded', 'false');\n  const menuId = `exam-card-menu-${exam.id}`;\n  menuToggle.setAttribute('aria-controls', menuId);\n\n  const menuToggleIcon = document.createElement('span');\n  menuToggleIcon.className = 'exam-card-menu-toggle__icon';\n  const menuToggleIconBar = document.createElement('span');\n  menuToggleIconBar.className = 'exam-card-menu-toggle__icon-bar';\n  menuToggleIcon.appendChild(menuToggleIconBar);\n  menuToggle.appendChild(menuToggleIcon);\n\n  const menuToggleLabel = document.createElement('span');\n  menuToggleLabel.className = 'exam-card-menu-toggle__label';\n  menuToggleLabel.textContent = 'Actions';\n  menuToggle.appendChild(menuToggleLabel);\n\n  const menuToggleSr = document.createElement('span');\n  menuToggleSr.className = 'sr-only';\n  menuToggleSr.textContent = 'Toggle exam actions';\n  menuToggle.appendChild(menuToggleSr);\n\n  menuWrap.appendChild(menuToggle);\n\n  const menuPanel = document.createElement('div');\n  menuPanel.className = 'exam-card-menu-panel';\n  menuPanel.id = menuId;\n  menuPanel.setAttribute('aria-hidden', 'true');\n  menuPanel.setAttribute('role', 'menu');\n  menuWrap.appendChild(menuPanel);\n\n  let menuGapRaf = null;\n  const updateMenuGap = () => {\n    if (!menuOpen) return;\n    const panelRect = menuPanel.getBoundingClientRect();\n    const cardRect = card.getBoundingClientRect();\n    const overflow = Math.max(0, Math.ceil(panelRect.bottom - cardRect.bottom));\n    const gap = overflow + 16;\n    card.style.setProperty('--exam-card-menu-gap', `${gap}px`);\n  };\n\n  const clearMenuGap = () => {\n    if (menuGapRaf != null) {\n      cancelAnimationFrame(menuGapRaf);\n      menuGapRaf = null;\n    }\n    card.style.removeProperty('--exam-card-menu-gap');\n  };\n\n  let menuOpen = false;\n  const handleOutside = event => {\n    if (!menuOpen) return;\n    if (menuWrap.contains(event.target)) return;\n    closeMenu();\n  };\n\n  const handleKeydown = event => {\n    if (!menuOpen) return;\n    if (event.key === 'Escape') {\n      event.preventDefault();\n      closeMenu();\n      menuToggle.focus();\n    }\n  };\n\n  const handleFocus = event => {\n    if (!menuOpen) return;\n    if (menuWrap.contains(event.target)) return;\n    closeMenu();\n  };\n\n  function openMenu() {\n    if (menuOpen) return;\n    menuOpen = true;\n    card.classList.add('exam-card--menu-open');\n    menuWrap.classList.add('exam-card-menu--open');\n    menuToggle.setAttribute('aria-expanded', 'true');\n    menuPanel.setAttribute('aria-hidden', 'false');\n    updateMenuGap();\n    menuGapRaf = requestAnimationFrame(() => {\n      menuGapRaf = null;\n      updateMenuGap();\n    });\n    document.addEventListener('click', handleOutside, true);\n    document.addEventListener('keydown', handleKeydown, true);\n    document.addEventListener('focusin', handleFocus, true);\n    window.addEventListener('resize', updateMenuGap);\n  }\n\n  function closeMenu() {\n    if (!menuOpen) return;\n    menuOpen = false;\n    card.classList.remove('exam-card--menu-open');\n    menuWrap.classList.remove('exam-card-menu--open');\n    menuToggle.setAttribute('aria-expanded', 'false');\n    menuPanel.setAttribute('aria-hidden', 'true');\n    document.removeEventListener('click', handleOutside, true);\n    document.removeEventListener('keydown', handleKeydown, true);\n    document.removeEventListener('focusin', handleFocus, true);\n    window.removeEventListener('resize', updateMenuGap);\n    clearMenuGap();\n  }\n\n  menuToggle.addEventListener('click', event => {\n    event.stopPropagation();\n    if (menuOpen) {\n      closeMenu();\n    } else {\n      openMenu();\n    }\n  });\n\n  menuPanel.addEventListener('click', event => {\n    event.stopPropagation();\n  });\n\n  const addMenuAction = (label, handler, options = {}) => {\n    const item = document.createElement('button');\n    item.type = 'button';\n    item.className = 'exam-card-menu-item';\n    item.setAttribute('role', 'menuitem');\n    if (options.variant === 'danger') {\n      item.classList.add('is-danger');\n    }\n    if (options.disabled) {\n      item.disabled = true;\n    }\n    item.textContent = label;\n    item.addEventListener('click', async () => {\n      if (item.disabled) return;\n      const result = await handler();\n      if (result === false) return;\n      closeMenu();\n    });\n    menuPanel.appendChild(item);\n  };\n\n  addMenuAction('Restart Exam', async () => {\n    if (exam.questions.length === 0) return false;\n    if (savedSession) {\n      const confirm = await confirmModal('Start a new attempt and discard saved progress?');\n      if (!confirm) return false;\n      await deleteExamSessionProgress(exam.id).catch(() => {});\n    }\n    setExamSession(createTakingSession(exam));\n    render();\n  }, { disabled: exam.questions.length === 0 });\n\n  if (last) {\n    addMenuAction('Review Last Attempt', () => {\n      setExamSession({ mode: 'review', exam: clone(exam), result: clone(last), idx: 0 });\n      render();\n    });\n  }\n\n  addMenuAction('Edit Exam', () => {\n    openExamEditor(exam, render);\n  });\n\n  addMenuAction('Export JSON', () => {\n    const ok = triggerExamDownload(exam);\n    if (!ok && statusEl) {\n      statusEl.textContent = 'Unable to export exam.';\n    } else if (ok && statusEl) {\n      statusEl.textContent = 'Exam exported as JSON.';\n    }\n  });\n\n  addMenuAction('Export CSV', () => {\n    try {\n      downloadExamCsv(exam);\n      if (statusEl) statusEl.textContent = 'Exam exported as CSV.';\n    } catch (err) {\n      console.warn('Failed to export exam CSV', err);\n      if (statusEl) statusEl.textContent = 'Unable to export exam CSV.';\n    }\n  });\n\n  addMenuAction('Delete Exam', async () => {\n    const ok = await confirmModal(`Delete \"${exam.examTitle}\"? This will remove all attempts.`);\n    if (!ok) return false;\n    await deleteExamSessionProgress(exam.id).catch(() => {});\n    await deleteExam(exam.id);\n    render();\n  }, { variant: 'danger' });\n\n  const details = document.createElement('div');\n  details.className = 'exam-card-details';\n  if (!isExpanded) {\n    details.setAttribute('hidden', 'true');\n  }\n  card.appendChild(details);\n\n  if (savedSession) {\n    const banner = document.createElement('div');\n    banner.className = 'exam-saved-banner';\n    const updated = savedSession.updatedAt ? new Date(savedSession.updatedAt).toLocaleString() : null;\n    banner.textContent = updated ? `Saved attempt \u2022 ${updated}` : 'Saved attempt available';\n    details.appendChild(banner);\n  }\n\n  const attemptsWrap = document.createElement('div');\n  attemptsWrap.className = 'exam-attempts';\n  const attemptsHeader = document.createElement('div');\n  attemptsHeader.className = 'exam-attempts-header';\n  const attemptsTitle = document.createElement('h3');\n  attemptsTitle.textContent = 'Attempts';\n  attemptsHeader.appendChild(attemptsTitle);\n  const attemptsCount = document.createElement('span');\n  attemptsCount.className = 'exam-attempt-count';\n  attemptsCount.textContent = String(exam.results.length);\n  attemptsHeader.appendChild(attemptsCount);\n  attemptsWrap.appendChild(attemptsHeader);\n\n  if (!exam.results.length) {\n    const none = document.createElement('p');\n    none.className = 'exam-attempt-empty';\n    none.textContent = 'No attempts yet.';\n    attemptsWrap.appendChild(none);\n  } else {\n    const list = document.createElement('div');\n    list.className = 'exam-attempt-list';\n    [...exam.results]\n      .sort((a, b) => b.when - a.when)\n      .forEach(result => {\n        list.appendChild(buildAttemptRow(exam, result, render));\n      });\n    attemptsWrap.appendChild(list);\n  }\n\n  details.appendChild(attemptsWrap);\n\n  return card;\n}\n\nfunction buildAttemptRow(exam, result, render) {\n  const row = document.createElement('div');\n  row.className = 'exam-attempt-row';\n\n  const main = document.createElement('div');\n  main.className = 'exam-attempt-main';\n  row.appendChild(main);\n\n  const badge = createScoreBadge(result);\n  badge.classList.add('exam-score-badge--pill', 'exam-attempt-score');\n  badge.title = formatScore(result);\n  main.appendChild(badge);\n\n  const details = document.createElement('div');\n  details.className = 'exam-attempt-details';\n  main.appendChild(details);\n\n  const date = document.createElement('div');\n  date.className = 'exam-attempt-date';\n  date.textContent = new Date(result.when).toLocaleString();\n  details.appendChild(date);\n\n  const meta = document.createElement('div');\n  meta.className = 'exam-attempt-meta';\n  const answeredText = `${result.answered}/${result.total} answered`;\n  const flaggedText = `${result.flagged.length} flagged`;\n  const durationText = result.durationMs ? formatDuration(result.durationMs) : '\u2014';\n  meta.textContent = `${answeredText} \u2022 ${flaggedText} \u2022 ${durationText}`;\n  details.appendChild(meta);\n\n  const actions = document.createElement('div');\n  actions.className = 'exam-attempt-actions';\n  row.appendChild(actions);\n\n  const review = document.createElement('button');\n  review.className = 'btn secondary exam-attempt-review';\n  review.textContent = 'Review';\n  review.addEventListener('click', () => {\n    setExamSession({ mode: 'review', exam: clone(exam), result: clone(result), idx: 0 });\n    render();\n  });\n  actions.appendChild(review);\n\n  return row;\n}\n\nfunction createStat(label, value) {\n  const wrap = document.createElement('div');\n  wrap.className = 'exam-stat';\n  const lbl = document.createElement('div');\n  lbl.className = 'exam-stat-label';\n  lbl.textContent = label;\n  const val = document.createElement('div');\n  val.className = 'exam-stat-value';\n  val.textContent = value;\n  wrap.appendChild(lbl);\n  wrap.appendChild(val);\n  return wrap;\n}\n\nfunction latestResult(exam) {\n  if (!exam.results?.length) return null;\n  return exam.results.reduce((acc, res) => (acc == null || res.when > acc.when ? res : acc), null);\n}\n\nfunction bestResult(exam) {\n  if (!exam.results?.length) return null;\n  return exam.results.reduce((acc, res) => {\n    const pct = res.total ? res.correct / res.total : 0;\n    const bestPct = acc?.total ? acc.correct / acc.total : -1;\n    if (!acc || pct > bestPct) return res;\n    return acc;\n  }, null);\n}\n\nfunction formatScore(result) {\n  const pct = result.total ? Math.round((result.correct / result.total) * 100) : 0;\n  return `${result.correct}/${result.total} \u2022 ${pct}%`;\n}\n\nfunction formatDuration(ms) {\n  if (ms == null) return '\u2014';\n  const totalSeconds = Math.max(0, Math.round(ms / 1000));\n  const hours = Math.floor(totalSeconds / 3600);\n  const minutes = Math.floor((totalSeconds % 3600) / 60);\n  const seconds = totalSeconds % 60;\n  const parts = [];\n  if (hours) parts.push(`${hours}h`);\n  if (minutes) parts.push(`${minutes}m`);\n  parts.push(`${seconds}s`);\n  return parts.join(' ');\n}\n\nfunction optionText(question, id) {\n  const html = question.options.find(opt => opt.id === id)?.text || '';\n  return htmlToPlainText(html).trim();\n}\n\nfunction mediaElement(source) {\n  if (!source) return null;\n  const wrap = document.createElement('div');\n  wrap.className = 'exam-media';\n  const lower = source.toLowerCase();\n  if (lower.startsWith('data:video') || /\\.(mp4|webm|ogg)$/i.test(lower)) {\n    const video = document.createElement('video');\n    video.controls = true;\n    video.src = source;\n    wrap.appendChild(video);\n  } else if (lower.startsWith('data:audio') || /\\.(mp3|wav|ogg)$/i.test(lower)) {\n    const audio = document.createElement('audio');\n    audio.controls = true;\n    audio.src = source;\n    wrap.appendChild(audio);\n  } else {\n    const img = document.createElement('img');\n    img.src = source;\n    img.alt = 'Question media';\n    wrap.appendChild(img);\n  }\n  return wrap;\n}\n\nfunction answerClass(question, selectedId, optionId) {\n  const isCorrect = optionId === question.answer;\n  if (selectedId == null) return isCorrect ? 'correct-answer' : '';\n  if (selectedId === optionId) {\n    return selectedId === question.answer ? 'correct-answer' : 'incorrect-answer';\n  }\n  return isCorrect ? 'correct-answer' : '';\n}\n\nfunction renderQuestionMap(sidebar, sess, render) {\n  const map = document.createElement('section');\n  map.className = 'question-map';\n\n  const header = document.createElement('div');\n  header.className = 'question-map__header';\n  const title = document.createElement('h3');\n  title.textContent = 'Question Map';\n  header.appendChild(title);\n\n  const questionCount = sess.exam.questions.length;\n  const isReview = sess.mode === 'review';\n  const answers = isReview ? sess.result?.answers || {} : sess.answers || {};\n  const answeredCount = sess.exam.questions.reduce((count, question, idx) => {\n    const answer = answers[idx];\n    if (answer == null) return count;\n    const matched = question.options.some(opt => opt.id === answer);\n    return matched ? count + 1 : count;\n  }, 0);\n  const countBadge = document.createElement('span');\n  countBadge.className = 'question-map__count';\n  countBadge.textContent = `${answeredCount}/${questionCount} answered`;\n  header.appendChild(countBadge);\n  map.appendChild(header);\n\n  const grid = document.createElement('div');\n  grid.className = 'question-map__grid';\n  map.appendChild(grid);\n\n  const statsList = isReview\n    ? (Array.isArray(sess.result?.questionStats) ? sess.result.questionStats : [])\n    : (Array.isArray(sess.questionStats) ? sess.questionStats : []);\n  const summary = isReview ? summarizeAnswerChanges(statsList, sess.exam, answers) : null;\n  if (isReview && sess.result) {\n    sess.result.changeSummary = summary;\n  }\n\n  const flaggedSet = new Set(sess.mode === 'review'\n    ? (sess.result.flagged || [])\n    : Object.entries(sess.flagged || {}).filter(([_, v]) => v).map(([idx]) => Number(idx)));\n\n  sess.exam.questions.forEach((question, idx) => {\n    const item = document.createElement('button');\n    item.type = 'button';\n    item.className = 'question-map__item';\n    item.textContent = String(idx + 1);\n    const isCurrent = sess.idx === idx;\n    item.classList.toggle('is-current', isCurrent);\n    item.setAttribute('aria-pressed', isCurrent ? 'true' : 'false');\n    if (isCurrent) {\n      item.setAttribute('aria-current', 'true');\n    } else {\n      item.removeAttribute('aria-current');\n    }\n\n    const answer = answers[idx];\n    const answered = answer != null && question.options.some(opt => opt.id === answer);\n    const tooltipParts = [];\n    let status = 'unanswered';\n    const wasChecked = !isReview && Boolean(sess.checked?.[idx]);\n\n    if (isReview) {\n      if (answered) {\n        const isCorrect = answer === question.answer;\n        status = isCorrect ? 'correct' : 'incorrect';\n        tooltipParts.push(isCorrect ? 'Answered correctly' : 'Answered incorrectly');\n      } else {\n        status = 'review-unanswered';\n        tooltipParts.push('Not answered');\n      }\n\n      const stat = statsList[idx];\n      const changeDetails = analyzeAnswerChange(stat, question, answer);\n      delete item.dataset.changeDirection;\n      if (changeDetails.changed) {\n        if (changeDetails.direction === 'right-to-wrong') {\n          item.dataset.changeDirection = 'right-to-wrong';\n          tooltipParts.push('Changed from correct to incorrect');\n        } else if (changeDetails.direction === 'wrong-to-right') {\n          item.dataset.changeDirection = 'wrong-to-right';\n          tooltipParts.push('Changed from incorrect to correct');\n        } else {\n          item.dataset.changeDirection = 'changed';\n          tooltipParts.push('Changed answer');\n        }\n      } else if (changeDetails.switched) {\n        item.dataset.changeDirection = 'returned';\n        tooltipParts.push('Changed answers but returned to start');\n      }\n    } else {\n      if (wasChecked && answered) {\n        const isCorrect = answer === question.answer;\n        status = isCorrect ? 'correct' : 'incorrect';\n        tooltipParts.push(isCorrect ? 'Checked correct' : 'Checked incorrect');\n      } else if (answered) {\n        status = 'answered';\n        tooltipParts.push('Answered');\n      } else {\n        tooltipParts.push(wasChecked ? 'Checked without answer' : 'Not answered');\n      }\n    }\n\n    item.dataset.status = status;\n    if (status === 'correct' || status === 'incorrect') {\n      item.classList.add('is-graded');\n    } else if (status === 'answered') {\n      item.classList.add('is-answered');\n    } else {\n      item.classList.add('is-unanswered');\n    }\n    if (status === 'review-unanswered') {\n      item.classList.add('is-review-unanswered');\n    }\n\n    if (flaggedSet.has(idx)) {\n      item.dataset.flagged = 'true';\n    } else {\n      item.dataset.flagged = 'false';\n    }\n\n    if (tooltipParts.length) {\n      item.title = tooltipParts.join(' \u00B7 ');\n    }\n\n    item.addEventListener('click', () => {\n      navigateToQuestion(sess, idx, render);\n    });\n\n    grid.appendChild(item);\n  });\n\n  if (summary) {\n    const meta = document.createElement('div');\n    meta.className = 'question-map__summary';\n    const summaryTitle = document.createElement('div');\n    summaryTitle.className = 'question-map__summary-title';\n    summaryTitle.textContent = 'Answer changes';\n    meta.appendChild(summaryTitle);\n\n    const summaryStats = document.createElement('div');\n    summaryStats.className = 'question-map__summary-stats';\n    summaryStats.innerHTML = `\n      <span><strong>${summary.switched}</strong> switched</span>\n      <span><strong>${summary.returnedToOriginal}</strong> returned</span>\n      <span><strong>${summary.rightToWrong}</strong> right \u2192 wrong</span>\n      <span><strong>${summary.wrongToRight}</strong> wrong \u2192 right</span>\n    `;\n    meta.appendChild(summaryStats);\n    map.appendChild(meta);\n  }\n\n  sidebar.appendChild(map);\n  return summary;\n}\n\nexport function renderExamRunner(root, render) {\n  const sess = state.examSession;\n  if (!sess) {\n    teardownKeyboardNavigation();\n    return;\n  }\n  const hasWindow = typeof window !== 'undefined';\n  const prevIdx = sess.__lastRenderedIdx;\n  const prevMode = sess.__lastRenderedMode;\n  const scroller = resolveScrollContainer(root);\n  const prevScrollY = readScrollPosition(scroller);\n  if (scroller) {\n    if (typeof prevIdx === 'number') {\n      storeScrollPosition(sess, prevIdx, prevScrollY);\n    } else if (typeof sess.idx === 'number') {\n      storeScrollPosition(sess, sess.idx, prevScrollY);\n    }\n  }\n  root.innerHTML = '';\n  root.className = 'exam-session';\n\n  if (sess.mode === 'summary') {\n    teardownKeyboardNavigation();\n    renderSummary(root, render, sess);\n    return;\n  }\n\n  ensureScrollPositions(sess);\n  setupKeyboardNavigation(sess, render);\n\n  if (!sess.answers) sess.answers = {};\n  if (!sess.flagged) sess.flagged = {};\n  if (!sess.checked) sess.checked = {};\n  if (typeof sess.elapsedMs !== 'number') sess.elapsedMs = 0;\n  if (sess.exam.timerMode === 'timed' && typeof sess.remainingMs !== 'number') {\n    sess.remainingMs = totalExamTimeMs(sess.exam);\n  }\n  if (!sess.startedAt) sess.startedAt = Date.now();\n\n  const questionCount = sess.exam.questions.length;\n  if (!questionCount) {\n    const empty = document.createElement('div');\n    empty.className = 'exam-empty';\n    empty.innerHTML = '<p>This exam does not contain any questions.</p>';\n    const back = document.createElement('button');\n    back.className = 'btn';\n    back.textContent = 'Back to Exams';\n    back.addEventListener('click', () => { teardownKeyboardNavigation(); setExamSession(null); render(); });\n    empty.appendChild(back);\n    root.appendChild(empty);\n    return;\n  }\n\n  if (sess.mode === 'taking' && sess.exam.timerMode === 'timed') {\n    ensureTimer(sess, render);\n  }\n\n  if (sess.idx < 0) sess.idx = 0;\n  if (sess.idx >= questionCount) sess.idx = questionCount - 1;\n\n  ensureQuestionStats(sess);\n  if (sess.mode === 'taking') {\n    beginQuestionTiming(sess, sess.idx);\n  }\n\n  const container = document.createElement('div');\n  container.className = 'exam-runner';\n  root.appendChild(container);\n\n  const main = document.createElement('section');\n  main.className = 'exam-main';\n  container.appendChild(main);\n\n  const sidebar = document.createElement('aside');\n  sidebar.className = 'exam-sidebar';\n  container.appendChild(sidebar);\n\n  const question = sess.exam.questions[sess.idx];\n  const answers = sess.mode === 'review' ? sess.result.answers || {} : sess.answers || {};\n  const selected = answers[sess.idx];\n  const isInstantCheck = sess.mode === 'taking' && sess.exam.timerMode !== 'timed' && Boolean(sess.checked?.[sess.idx]);\n  const showReview = sess.mode === 'review' || isInstantCheck;\n\n  const top = document.createElement('div');\n  top.className = 'exam-topbar';\n  const progress = document.createElement('div');\n  progress.className = 'exam-progress';\n  progress.textContent = `${sess.exam.examTitle} \u2022 Question ${sess.idx + 1} of ${questionCount}`;\n  top.appendChild(progress);\n\n  const flagBtn = document.createElement('button');\n  flagBtn.type = 'button';\n  flagBtn.className = 'flag-btn';\n  const isFlagged = sess.mode === 'review'\n    ? (sess.result.flagged || []).includes(sess.idx)\n    : Boolean(sess.flagged?.[sess.idx]);\n  setToggleState(flagBtn, isFlagged);\n  flagBtn.textContent = isFlagged ? '\uD83D\uDEA9 Flagged' : 'Flag question';\n  if (sess.mode === 'taking') {\n    flagBtn.addEventListener('click', () => {\n      if (!sess.flagged) sess.flagged = {};\n      sess.flagged[sess.idx] = !isFlagged;\n      render();\n    });\n  } else {\n    flagBtn.disabled = true;\n  }\n  top.appendChild(flagBtn);\n\n  if (sess.mode === 'taking' && sess.exam.timerMode === 'timed') {\n    const timerEl = document.createElement('div');\n    timerEl.className = 'exam-timer';\n    const remainingMs = typeof sess.remainingMs === 'number' ? sess.remainingMs : totalExamTimeMs(sess.exam);\n    timerEl.textContent = formatCountdown(remainingMs);\n    setTimerElement(sess, timerEl);\n    top.appendChild(timerEl);\n  } else {\n    setTimerElement(sess, null);\n  }\n  main.appendChild(top);\n\n  const stem = document.createElement('div');\n  stem.className = 'exam-stem';\n  const stemHtml = question.stem && !isEmptyHtml(question.stem) ? question.stem : '';\n  stem.innerHTML = stemHtml || '<p class=\"exam-stem-empty\">(No prompt)</p>';\n  main.appendChild(stem);\n\n  const media = mediaElement(question.media);\n  if (media) main.appendChild(media);\n\n  if (question.tags?.length) {\n    const tagWrap = document.createElement('div');\n    tagWrap.className = 'exam-tags';\n    question.tags.forEach(tag => {\n      const chip = document.createElement('span');\n      chip.className = 'exam-tag';\n      chip.textContent = tag;\n      tagWrap.appendChild(chip);\n    });\n    main.appendChild(tagWrap);\n  }\n\n  const optionsWrap = document.createElement('div');\n  optionsWrap.className = 'exam-options';\n  if (!question.options.length) {\n    const warn = document.createElement('p');\n    warn.className = 'exam-warning';\n    warn.textContent = 'This question has no answer options.';\n    optionsWrap.appendChild(warn);\n  }\n\n  question.options.forEach(opt => {\n    const choice = document.createElement(sess.mode === 'taking' ? 'button' : 'div');\n    if (sess.mode === 'taking') choice.type = 'button';\n    choice.className = 'exam-option';\n    if (sess.mode === 'review') choice.classList.add('review');\n\n    const indicator = document.createElement('span');\n    indicator.className = 'option-indicator';\n    choice.appendChild(indicator);\n\n    const label = document.createElement('span');\n    label.className = 'option-text';\n    label.innerHTML = opt.text || '<span class=\"exam-option-empty\">(Empty option)</span>';\n    choice.appendChild(label);\n    const isSelected = selected === opt.id;\n    if (sess.mode === 'taking') {\n      setToggleState(choice, isSelected, 'selected');\n      choice.addEventListener('click', () => {\n        recordAnswerChange(sess, sess.idx, question, opt.id);\n        sess.answers[sess.idx] = opt.id;\n        if (sess.exam.timerMode !== 'timed' && sess.checked) {\n          delete sess.checked[sess.idx];\n        }\n        render();\n      });\n      if (isInstantCheck) {\n        const cls = answerClass(question, selected, opt.id);\n        if (cls) choice.classList.add(cls);\n        if (isSelected) choice.classList.add('chosen');\n      }\n    } else {\n      const cls = answerClass(question, selected, opt.id);\n      if (cls) choice.classList.add(cls);\n      if (isSelected) choice.classList.add('chosen');\n    }\n    optionsWrap.appendChild(choice);\n  });\n\n  main.appendChild(optionsWrap);\n\n  if (showReview) {\n    const verdict = document.createElement('div');\n    verdict.className = 'exam-verdict';\n    let verdictText = 'Not answered';\n    let verdictClass = 'neutral';\n    if (selected != null) {\n      if (selected === question.answer) {\n        verdictText = 'Correct';\n        verdictClass = 'correct';\n      } else {\n        verdictText = 'Incorrect';\n        verdictClass = 'incorrect';\n      }\n    }\n    verdict.classList.add(verdictClass);\n    verdict.textContent = sess.mode === 'review' ? verdictText : `Checked: ${verdictText}`;\n    main.appendChild(verdict);\n\n    const answerSummary = document.createElement('div');\n    answerSummary.className = 'exam-answer-summary';\n    const your = optionText(question, selected);\n    const correct = optionText(question, question.answer);\n    answerSummary.innerHTML = `<div><strong>Your answer:</strong> ${your || '\u2014'}</div><div><strong>Correct answer:</strong> ${correct || '\u2014'}</div>`;\n    main.appendChild(answerSummary);\n\n    if (sess.mode === 'review') {\n      const stats = sess.result?.questionStats?.[sess.idx];\n      if (stats) {\n        const insights = document.createElement('div');\n        insights.className = 'exam-review-insights';\n        const timeSpent = document.createElement('div');\n        timeSpent.innerHTML = `<strong>Time spent:</strong> ${formatDuration(stats.timeMs)}`;\n        insights.appendChild(timeSpent);\n\n        const finalAnswer = sess.result?.answers?.[sess.idx];\n        const changeDetails = analyzeAnswerChange(stats, question, finalAnswer);\n\n        if (changeDetails.switched) {\n          const changeInfo = document.createElement('div');\n          const label = document.createElement('strong');\n          label.textContent = 'Answer change:';\n          changeInfo.appendChild(label);\n          changeInfo.append(' ');\n\n          const joinChoices = list => {\n            if (!list.length) return '';\n            if (list.length === 1) return list[0];\n            return `${list.slice(0, -1).join(', ')} and ${list[list.length - 1]}`;\n          };\n\n          const formatChoice = (answerId, fallback) => {\n            if (answerId == null) return fallback;\n            const label = optionText(question, answerId);\n            if (label) return `\"${label}\"`;\n            return fallback;\n          };\n          const initialDisplay = formatChoice(changeDetails.initialAnswer, 'your original choice');\n          const finalDisplay = formatChoice(changeDetails.finalAnswer, 'no answer');\n          let message = '';\n\n          if (changeDetails.changed) {\n            if (changeDetails.direction === 'right-to-wrong') {\n              message = `You changed from ${initialDisplay} (correct) to ${finalDisplay} (incorrect).`;\n            } else if (changeDetails.direction === 'wrong-to-right') {\n              message = `You changed from ${initialDisplay} (incorrect) to ${finalDisplay} (correct).`;\n            } else if (changeDetails.initialCorrect === false && changeDetails.finalCorrect === false) {\n              message = `You changed from ${initialDisplay} to ${finalDisplay}, but both choices were incorrect.`;\n            } else {\n              message = `You changed from ${initialDisplay} to ${finalDisplay}.`;\n            }\n          } else {\n            const intermediateIds = [];\n            changeDetails.sequence.slice(1, -1).forEach(id => {\n              if (id == null) return;\n              if (id === changeDetails.initialAnswer) return;\n              if (!intermediateIds.includes(id)) intermediateIds.push(id);\n            });\n            const intermediateLabels = intermediateIds\n              .map(id => optionText(question, id))\n              .filter(label => label && label.trim().length)\n              .map(label => `\"${label}\"`);\n            if (intermediateLabels.length) {\n              const joined = joinChoices(intermediateLabels);\n              message = `You tried ${joined} but returned to ${initialDisplay}.`;\n            } else {\n              message = `You briefly changed your answer but returned to ${initialDisplay}.`;\n            }\n          }\n\n          changeInfo.append(message);\n          insights.appendChild(changeInfo);\n        }\n        main.appendChild(insights);\n      }\n    }\n\n    if (question.explanation && !isEmptyHtml(question.explanation)) {\n      const explain = document.createElement('div');\n      explain.className = 'exam-explanation';\n      const title = document.createElement('h3');\n      title.textContent = 'Explanation';\n      const body = document.createElement('div');\n      body.className = 'exam-explanation-body';\n      body.innerHTML = question.explanation;\n      explain.appendChild(title);\n      explain.appendChild(body);\n      main.appendChild(explain);\n    }\n  }\n\n  const paletteSummary = renderQuestionMap(sidebar, sess, render);\n  renderSidebarMeta(sidebar, sess, paletteSummary);\n\n  const nav = document.createElement('div');\n  nav.className = 'exam-nav';\n\n  const prev = document.createElement('button');\n  prev.className = 'btn secondary';\n  prev.textContent = 'Previous';\n  prev.disabled = sess.idx === 0;\n  prev.addEventListener('click', () => {\n    if (sess.idx > 0) {\n      navigateToQuestion(sess, sess.idx - 1, render);\n    }\n  });\n  nav.appendChild(prev);\n\n  if (sess.mode === 'taking') {\n    const saveBtn = document.createElement('button');\n    saveBtn.className = 'btn secondary';\n    saveBtn.textContent = 'Save & Exit';\n    saveBtn.addEventListener('click', async () => {\n      await saveProgressAndExit(sess, render);\n    });\n    nav.appendChild(saveBtn);\n\n    if (sess.exam.timerMode !== 'timed') {\n      const checkBtn = document.createElement('button');\n      checkBtn.className = 'btn secondary';\n      checkBtn.textContent = isInstantCheck ? 'Hide Check' : 'Check Answer';\n      checkBtn.disabled = question.options.length === 0;\n      checkBtn.addEventListener('click', () => {\n        if (!sess.checked) sess.checked = {};\n        if (isInstantCheck) {\n          delete sess.checked[sess.idx];\n        } else {\n          sess.checked[sess.idx] = true;\n        }\n        render();\n      });\n      nav.appendChild(checkBtn);\n    }\n\n    const nextBtn = document.createElement('button');\n    nextBtn.className = 'btn secondary';\n    nextBtn.textContent = 'Next Question';\n    nextBtn.disabled = sess.idx >= questionCount - 1;\n    nextBtn.addEventListener('click', () => {\n      if (sess.idx < questionCount - 1) {\n        navigateToQuestion(sess, sess.idx + 1, render);\n      }\n    });\n    nav.appendChild(nextBtn);\n\n    const submit = document.createElement('button');\n    submit.className = 'btn';\n    submit.textContent = 'Submit Exam';\n    submit.addEventListener('click', async () => {\n      await finalizeExam(sess, render);\n    });\n    nav.appendChild(submit);\n  } else {\n    const nextBtn = document.createElement('button');\n    nextBtn.className = 'btn secondary';\n    nextBtn.textContent = 'Next';\n    nextBtn.disabled = sess.idx >= questionCount - 1;\n    nextBtn.addEventListener('click', () => {\n      if (sess.idx < questionCount - 1) {\n        navigateToQuestion(sess, sess.idx + 1, render);\n      }\n    });\n    nav.appendChild(nextBtn);\n\n    const exit = document.createElement('button');\n    exit.className = 'btn';\n    if (sess.fromSummary) {\n      exit.textContent = 'Back to Summary';\n      exit.addEventListener('click', () => {\n        setExamSession({ mode: 'summary', exam: sess.exam, latestResult: sess.fromSummary });\n        render();\n      });\n    } else {\n      exit.textContent = 'Back to Exams';\n      exit.addEventListener('click', () => { teardownKeyboardNavigation(); setExamSession(null); render(); });\n    }\n    nav.appendChild(exit);\n  }\n\n  root.appendChild(nav);\n\n  const sameQuestion = prevIdx === sess.idx && prevMode === sess.mode;\n  sess.__lastRenderedIdx = sess.idx;\n  sess.__lastRenderedMode = sess.mode;\n  const queueFrame = typeof window !== 'undefined' && typeof window.requestAnimationFrame === 'function'\n    ? cb => window.requestAnimationFrame(cb)\n    : cb => setTimeout(cb, 0);\n  if (scroller) {\n    if (sameQuestion) {\n      const targetY = typeof sess.idx === 'number'\n        ? (getStoredScroll(sess, sess.idx) ?? prevScrollY)\n        : prevScrollY;\n      if (typeof sess.idx === 'number') {\n        storeScrollPosition(sess, sess.idx, targetY);\n\n      }\n      const restore = () => {\n        if (Math.abs(readScrollPosition(scroller) - targetY) > 1) {\n          applyScrollPosition(scroller, targetY);\n        }\n      };\n      queueFrame(restore);\n    } else {\n      const storedScroll = getStoredScroll(sess, sess.idx);\n      const targetY = storedScroll ?? 0;\n      if (typeof sess.idx === 'number' && storedScroll == null) {\n        storeScrollPosition(sess, sess.idx, targetY);\n      }\n      const restore = () => {\n        applyScrollPosition(scroller, targetY);\n      };\n      queueFrame(restore);\n    }\n  }\n}\nfunction renderSidebarMeta(sidebar, sess, changeSummary) {\n  const info = document.createElement('div');\n  info.className = 'exam-sidebar-info';\n\n  const attempts = document.createElement('div');\n  attempts.innerHTML = `<strong>Attempts:</strong> ${sess.exam.results?.length || 0}`;\n  info.appendChild(attempts);\n\n  if (sess.mode === 'review') {\n    if (sess.result.durationMs) {\n      const duration = document.createElement('div');\n      duration.innerHTML = `<strong>Duration:</strong> ${formatDuration(sess.result.durationMs)}`;\n      info.appendChild(duration);\n    }\n    const summary = changeSummary\n      || (sess.result ? summarizeAnswerChanges(sess.result.questionStats || [], sess.exam, sess.result.answers || {}) : null);\n    if (summary) {\n      const changeMeta = document.createElement('div');\n      changeMeta.innerHTML = `<strong>Answer switches:</strong> ${summary.switched || 0} (Returned: ${summary.returnedToOriginal || 0}, Right \u2192 Wrong: ${summary.rightToWrong || 0}, Wrong \u2192 Right: ${summary.wrongToRight || 0})`;\n      info.appendChild(changeMeta);\n    }\n  } else if (sess.mode === 'taking') {\n    if (sess.exam.timerMode === 'timed') {\n      const remaining = typeof sess.remainingMs === 'number' ? sess.remainingMs : totalExamTimeMs(sess.exam);\n      const timer = document.createElement('div');\n      timer.innerHTML = `<strong>Time Remaining:</strong> ${formatCountdown(remaining)}`;\n      info.appendChild(timer);\n\n      const pace = document.createElement('div');\n      pace.innerHTML = `<strong>Pace:</strong> ${sess.exam.secondsPerQuestion}s/question`;\n      info.appendChild(pace);\n    } else {\n      const timerMode = document.createElement('div');\n      timerMode.innerHTML = '<strong>Timer:</strong> Untimed';\n      info.appendChild(timerMode);\n\n      const elapsed = document.createElement('div');\n      elapsed.innerHTML = `<strong>Elapsed:</strong> ${formatDuration(currentElapsedMs(sess))}`;\n      info.appendChild(elapsed);\n    }\n  }\n\n  sidebar.appendChild(info);\n}\n\nasync function saveProgressAndExit(sess, render) {\n  stopTimer(sess);\n  const questionStats = snapshotQuestionStats(sess);\n  const payload = {\n    examId: sess.exam.id,\n    exam: clone(sess.exam),\n    idx: sess.idx,\n    answers: { ...(sess.answers || {}) },\n    flagged: { ...(sess.flagged || {}) },\n    checked: { ...(sess.checked || {}) },\n    remainingMs: typeof sess.remainingMs === 'number' ? Math.max(0, sess.remainingMs) : null,\n    elapsedMs: sess.elapsedMs || 0,\n    mode: 'taking',\n    questionStats\n  };\n  await saveExamSessionProgress(payload);\n  lastExamStatusMessage = 'Attempt saved. You can resume later.';\n  teardownKeyboardNavigation();\n  setExamSession(null);\n  render();\n}\n\nasync function finalizeExam(sess, render, options = {}) {\n  const isAuto = Boolean(options.autoSubmit);\n  stopTimer(sess);\n\n  const unanswered = sess.exam.questions\n    .map((_, idx) => (sess.answers[idx] == null ? idx + 1 : null))\n    .filter(Number.isFinite);\n  if (!isAuto && unanswered.length) {\n    const list = unanswered.join(', ');\n    const confirm = await confirmModal(`You have ${unanswered.length} unanswered question${unanswered.length === 1 ? '' : 's'} (Question${unanswered.length === 1 ? '' : 's'}: ${list}). Submit anyway?`);\n    if (!confirm) return;\n  }\n\n  const answers = {};\n  let correct = 0;\n  let answeredCount = 0;\n  sess.exam.questions.forEach((question, idx) => {\n    const ans = sess.answers[idx];\n    if (ans != null) {\n      answers[idx] = ans;\n      answeredCount += 1;\n      if (ans === question.answer) correct += 1;\n    }\n  });\n\n  const flagged = Object.entries(sess.flagged || {})\n    .filter(([_, val]) => Boolean(val))\n    .map(([idx]) => Number(idx));\n\n  const questionStats = snapshotQuestionStats(sess);\n  const changeSummary = summarizeAnswerChanges(questionStats, sess.exam, answers);\n\n  const result = {\n    id: uid(),\n    when: Date.now(),\n    correct,\n    total: sess.exam.questions.length,\n    answers,\n    flagged,\n    durationMs: sess.elapsedMs || 0,\n    answered: answeredCount,\n    questionStats,\n    changeSummary\n  };\n\n  const updatedExam = clone(sess.exam);\n  updatedExam.results = [...(updatedExam.results || []), result];\n  updatedExam.updatedAt = Date.now();\n  await upsertExam(updatedExam);\n  await deleteExamSessionProgress(updatedExam.id).catch(() => {});\n\n  if (isAuto) {\n    lastExamStatusMessage = 'Time expired. Attempt submitted automatically.';\n  }\n\n  teardownKeyboardNavigation();\n  setExamSession({ mode: 'summary', exam: updatedExam, latestResult: result });\n  render();\n}\n\nfunction renderSummary(root, render, sess) {\n  const wrap = document.createElement('div');\n  wrap.className = 'exam-summary';\n\n  const title = document.createElement('h2');\n  title.textContent = `${sess.exam.examTitle} \u2014 Results`;\n  wrap.appendChild(title);\n\n  const score = document.createElement('div');\n  score.className = 'exam-summary-score';\n  const pct = sess.latestResult.total ? Math.round((sess.latestResult.correct / sess.latestResult.total) * 100) : 0;\n  score.innerHTML = `<span class=\"score-number\">${sess.latestResult.correct}/${sess.latestResult.total}</span><span class=\"score-percent\">${pct}%</span>`;\n  wrap.appendChild(score);\n\n  const metrics = document.createElement('div');\n  metrics.className = 'exam-summary-metrics';\n  metrics.appendChild(createStat('Answered', `${sess.latestResult.answered}/${sess.latestResult.total}`));\n  metrics.appendChild(createStat('Flagged', String(sess.latestResult.flagged.length)));\n  metrics.appendChild(createStat('Duration', formatDuration(sess.latestResult.durationMs)));\n  wrap.appendChild(metrics);\n\n  const actions = document.createElement('div');\n  actions.className = 'exam-summary-actions';\n\n  const reviewBtn = document.createElement('button');\n  reviewBtn.className = 'btn';\n  reviewBtn.textContent = 'Review Attempt';\n  reviewBtn.addEventListener('click', () => {\n    setExamSession({\n      mode: 'review',\n      exam: clone(sess.exam),\n      result: clone(sess.latestResult),\n      idx: 0,\n      fromSummary: clone(sess.latestResult)\n    });\n    render();\n  });\n  actions.appendChild(reviewBtn);\n\n  const retake = document.createElement('button');\n  retake.className = 'btn secondary';\n  retake.textContent = 'Retake Exam';\n  retake.addEventListener('click', () => {\n    setExamSession(createTakingSession(sess.exam));\n    render();\n  });\n  actions.appendChild(retake);\n\n  const exit = document.createElement('button');\n  exit.className = 'btn';\n  exit.textContent = 'Back to Exams';\n  exit.addEventListener('click', () => { setExamSession(null); render(); });\n  actions.appendChild(exit);\n\n  wrap.appendChild(actions);\n  root.appendChild(wrap);\n}\n\nfunction openExamEditor(existing, render) {\n  const { exam } = ensureExamShape(existing || {\n    id: uid(),\n    examTitle: 'New Exam',\n    timerMode: 'untimed',\n    secondsPerQuestion: DEFAULT_SECONDS,\n    questions: [],\n    results: []\n  });\n\n  let dirty = false;\n  const markDirty = () => { dirty = true; };\n\n  const floating = createFloatingWindow({\n    title: existing ? 'Edit Exam' : 'Create Exam',\n    width: 980,\n    onBeforeClose: async (reason) => {\n      if (reason === 'saved') return true;\n      if (!dirty) return true;\n      const choice = await promptSaveChoice();\n      if (choice === 'cancel') return false;\n      if (choice === 'discard') return true;\n      if (choice === 'save') {\n        const ok = await persistExam();\n        if (ok) {\n          dirty = false;\n          render();\n        }\n        return ok;\n      }\n      return false;\n    }\n  });\n\n  const form = document.createElement('form');\n  form.className = 'exam-editor';\n  floating.body.appendChild(form);\n\n  const error = document.createElement('div');\n  error.className = 'exam-error';\n  form.appendChild(error);\n\n  const titleField = document.createElement('label');\n  titleField.className = 'exam-field';\n  const titleLabel = document.createElement('span');\n  titleLabel.className = 'exam-field-label';\n  titleLabel.textContent = 'Title';\n  const titleInput = document.createElement('input');\n  titleInput.className = 'input';\n  titleInput.value = exam.examTitle;\n  titleInput.addEventListener('input', () => { exam.examTitle = titleInput.value; markDirty(); });\n  titleField.append(titleLabel, titleInput);\n  form.appendChild(titleField);\n\n  const timerRow = document.createElement('div');\n  timerRow.className = 'exam-timer-row';\n  form.appendChild(timerRow);\n\n  const modeField = document.createElement('label');\n  modeField.className = 'exam-field';\n  const modeSpan = document.createElement('span');\n  modeSpan.className = 'exam-field-label';\n  modeSpan.textContent = 'Timer Mode';\n  const modeSelect = document.createElement('select');\n  modeSelect.className = 'input';\n  ['untimed', 'timed'].forEach(mode => {\n    const opt = document.createElement('option');\n    opt.value = mode;\n    opt.textContent = mode === 'timed' ? 'Timed' : 'Untimed';\n    modeSelect.appendChild(opt);\n  });\n  modeSelect.value = exam.timerMode;\n  modeSelect.addEventListener('change', () => {\n    exam.timerMode = modeSelect.value;\n    secondsField.classList.toggle('is-hidden', exam.timerMode !== 'timed');\n    markDirty();\n  });\n  modeField.append(modeSpan, modeSelect);\n  timerRow.appendChild(modeField);\n\n  const secondsField = document.createElement('label');\n  secondsField.className = 'exam-field';\n  const secondsSpan = document.createElement('span');\n  secondsSpan.className = 'exam-field-label';\n  secondsSpan.textContent = 'Seconds per question';\n  const secondsInput = document.createElement('input');\n  secondsInput.type = 'number';\n  secondsInput.min = '10';\n  secondsInput.className = 'input';\n  secondsInput.value = String(exam.secondsPerQuestion);\n  secondsInput.addEventListener('input', () => {\n    const val = Number(secondsInput.value);\n    if (!Number.isNaN(val) && val > 0) {\n      exam.secondsPerQuestion = val;\n      markDirty();\n    }\n  });\n  secondsField.append(secondsSpan, secondsInput);\n  if (exam.timerMode !== 'timed') secondsField.classList.add('is-hidden');\n  timerRow.appendChild(secondsField);\n\n  const questionsHeader = document.createElement('div');\n  questionsHeader.className = 'exam-question-header';\n  const qTitle = document.createElement('h3');\n  qTitle.textContent = 'Questions';\n  const addQuestion = document.createElement('button');\n  addQuestion.type = 'button';\n  addQuestion.className = 'btn secondary';\n  addQuestion.textContent = 'Add Question';\n  addQuestion.addEventListener('click', () => {\n    exam.questions.push(createBlankQuestion());\n    markDirty();\n    scheduleRenderQuestions();\n  });\n  questionsHeader.append(qTitle, addQuestion);\n  form.appendChild(questionsHeader);\n\n  const questionSection = document.createElement('div');\n  questionSection.className = 'exam-question-section';\n  form.appendChild(questionSection);\n\n  function renderQuestions() {\n    questionSection.innerHTML = '';\n    if (!exam.questions.length) {\n      const empty = document.createElement('p');\n      empty.className = 'exam-question-empty';\n      empty.textContent = 'No questions yet. Add your first question to get started.';\n      questionSection.appendChild(empty);\n      return;\n    }\n\n    const fragment = document.createDocumentFragment();\n\n    exam.questions.forEach((question, idx) => {\n      const card = document.createElement('div');\n      card.className = 'exam-question-editor';\n\n      const header = document.createElement('div');\n      header.className = 'exam-question-editor-header';\n      const label = document.createElement('h4');\n      label.textContent = `Question ${idx + 1}`;\n      header.appendChild(label);\n\n      const remove = document.createElement('button');\n      remove.type = 'button';\n      remove.className = 'ghost-btn';\n      remove.textContent = 'Remove';\n      remove.addEventListener('click', () => {\n        exam.questions.splice(idx, 1);\n        markDirty();\n        scheduleRenderQuestions();\n      });\n      header.appendChild(remove);\n      card.appendChild(header);\n\n      const stemField = document.createElement('div');\n      stemField.className = 'exam-field exam-field--rich';\n      const stemLabel = document.createElement('span');\n      stemLabel.className = 'exam-field-label';\n      stemLabel.textContent = 'Prompt';\n      stemField.appendChild(stemLabel);\n      const stemEditor = createRichTextEditor({\n        value: question.stem,\n        ariaLabel: `Question ${idx + 1} prompt`,\n        onChange: () => {\n          question.stem = stemEditor.getValue();\n          markDirty();\n        }\n      });\n      stemEditor.element.classList.add('exam-rich-input');\n      stemField.appendChild(stemEditor.element);\n      card.appendChild(stemField);\n\n      const mediaField = document.createElement('div');\n      mediaField.className = 'exam-field exam-field--media';\n      const mediaLabel = document.createElement('span');\n      mediaLabel.className = 'exam-field-label';\n      mediaLabel.textContent = 'Media (URL or upload)';\n      mediaField.appendChild(mediaLabel);\n\n      const mediaInput = document.createElement('input');\n      mediaInput.className = 'input';\n      mediaInput.placeholder = 'https://example.com/image.png';\n      mediaInput.value = question.media || '';\n      mediaInput.addEventListener('input', () => {\n        question.media = mediaInput.value.trim();\n        updatePreview();\n        markDirty();\n      });\n      mediaField.appendChild(mediaInput);\n\n      const mediaUpload = document.createElement('input');\n      mediaUpload.type = 'file';\n      mediaUpload.accept = 'image/*,video/*,audio/*';\n      mediaUpload.addEventListener('change', () => {\n        const file = mediaUpload.files?.[0];\n        if (!file) return;\n        markDirty();\n        const reader = new FileReader();\n        reader.onload = () => {\n          question.media = typeof reader.result === 'string' ? reader.result : '';\n          mediaInput.value = question.media;\n          updatePreview();\n          markDirty();\n        };\n        reader.readAsDataURL(file);\n      });\n      mediaField.appendChild(mediaUpload);\n\n      const clearMedia = document.createElement('button');\n      clearMedia.type = 'button';\n      clearMedia.className = 'ghost-btn';\n      clearMedia.textContent = 'Remove media';\n      clearMedia.addEventListener('click', () => {\n        question.media = '';\n        mediaInput.value = '';\n        mediaUpload.value = '';\n        updatePreview();\n        markDirty();\n      });\n      mediaField.appendChild(clearMedia);\n\n      card.appendChild(mediaField);\n\n      const preview = document.createElement('div');\n      preview.className = 'exam-media-preview';\n      function updatePreview() {\n        preview.innerHTML = '';\n        const el = mediaElement(question.media);\n        if (el) preview.appendChild(el);\n      }\n      updatePreview();\n      card.appendChild(preview);\n\n      const tagsField = document.createElement('label');\n      tagsField.className = 'exam-field';\n      const tagsLabel = document.createElement('span');\n      tagsLabel.className = 'exam-field-label';\n      tagsLabel.textContent = 'Tags (comma or | separated)';\n      const tagsInput = document.createElement('input');\n      tagsInput.className = 'input';\n      tagsInput.value = question.tags.join(', ');\n      tagsInput.addEventListener('input', () => {\n        question.tags = parseTagString(tagsInput.value);\n        markDirty();\n      });\n      tagsField.append(tagsLabel, tagsInput);\n      card.appendChild(tagsField);\n\n      const explanationField = document.createElement('div');\n      explanationField.className = 'exam-field exam-field--rich';\n      const explanationLabel = document.createElement('span');\n      explanationLabel.className = 'exam-field-label';\n      explanationLabel.textContent = 'Explanation';\n      explanationField.appendChild(explanationLabel);\n      const explanationEditor = createRichTextEditor({\n        value: question.explanation,\n        ariaLabel: `Question ${idx + 1} explanation`,\n        onChange: () => {\n          question.explanation = explanationEditor.getValue();\n          markDirty();\n        }\n      });\n      explanationEditor.element.classList.add('exam-rich-input');\n      explanationField.appendChild(explanationEditor.element);\n      card.appendChild(explanationField);\n\n      const optionsWrap = document.createElement('div');\n      optionsWrap.className = 'exam-option-editor-list';\n\n      function renderOptions() {\n        optionsWrap.innerHTML = '';\n        question.options.forEach((opt, optIdx) => {\n          const row = document.createElement('div');\n          row.className = 'exam-option-editor';\n\n          const radio = document.createElement('input');\n          radio.type = 'radio';\n          radio.name = `correct-${question.id}`;\n          radio.checked = question.answer === opt.id;\n          radio.addEventListener('change', () => {\n            question.answer = opt.id;\n            markDirty();\n          });\n          row.appendChild(radio);\n\n          const editor = createRichTextEditor({\n            value: opt.text,\n            ariaLabel: `Option ${optIdx + 1}`,\n            onChange: () => {\n              opt.text = editor.getValue();\n              markDirty();\n            }\n          });\n          editor.element.classList.add('exam-option-rich');\n          row.appendChild(editor.element);\n\n          const removeBtn = document.createElement('button');\n          removeBtn.type = 'button';\n          removeBtn.className = 'ghost-btn';\n          removeBtn.textContent = 'Remove';\n          removeBtn.disabled = question.options.length <= 2;\n          removeBtn.addEventListener('click', () => {\n            question.options.splice(optIdx, 1);\n            if (question.answer === opt.id) {\n              question.answer = question.options[0]?.id || '';\n            }\n            markDirty();\n            renderOptions();\n          });\n          row.appendChild(removeBtn);\n\n          optionsWrap.appendChild(row);\n        });\n      }\n\n      renderOptions();\n\n      const addOption = document.createElement('button');\n      addOption.type = 'button';\n      addOption.className = 'btn secondary';\n      addOption.textContent = 'Add Option';\n      addOption.addEventListener('click', () => {\n        const opt = { id: uid(), text: '' };\n        question.options.push(opt);\n        markDirty();\n        renderOptions();\n      });\n\n      card.appendChild(optionsWrap);\n      card.appendChild(addOption);\n\n      fragment.appendChild(card);\n    });\n\n    questionSection.appendChild(fragment);\n  }\n\n  const scheduleRenderQuestions = (() => {\n    let scheduled = false;\n    const schedule = typeof window !== 'undefined' && typeof window.requestAnimationFrame === 'function'\n      ? window.requestAnimationFrame.bind(window)\n      : (cb) => setTimeout(cb, 0);\n    return () => {\n      if (scheduled) return;\n      scheduled = true;\n      schedule(() => {\n        scheduled = false;\n        renderQuestions();\n      });\n    };\n  })();\n\n  scheduleRenderQuestions();\n\n  const actions = document.createElement('div');\n  actions.className = 'exam-editor-actions';\n  const saveBtn = document.createElement('button');\n  saveBtn.type = 'submit';\n  saveBtn.className = 'btn';\n  saveBtn.textContent = 'Save Exam';\n  actions.appendChild(saveBtn);\n\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'btn secondary';\n  closeBtn.textContent = 'Close';\n  closeBtn.addEventListener('click', () => { void floating.close('cancel'); });\n  actions.appendChild(closeBtn);\n\n  form.appendChild(actions);\n\n  async function persistExam() {\n    error.textContent = '';\n\n    const title = titleInput.value.trim();\n    if (!title) {\n      error.textContent = 'Exam title is required.';\n      return false;\n    }\n\n    if (!exam.questions.length) {\n      error.textContent = 'Add at least one question.';\n      return false;\n    }\n\n    for (let i = 0; i < exam.questions.length; i += 1) {\n      const question = exam.questions[i];\n      question.stem = sanitizeRichText(question.stem);\n      question.explanation = sanitizeRichText(question.explanation);\n      question.media = question.media?.trim() || '';\n      question.options = question.options.map(opt => ({\n        id: opt.id || uid(),\n        text: sanitizeRichText(opt.text)\n      })).filter(opt => !isEmptyHtml(opt.text));\n      question.tags = ensureArrayTags(question.tags);\n\n      if (isEmptyHtml(question.stem)) {\n        error.textContent = `Question ${i + 1} needs a prompt.`;\n        return false;\n      }\n      if (question.options.length < 2) {\n        error.textContent = `Question ${i + 1} needs at least two answer options.`;\n        return false;\n      }\n      if (!question.answer || !question.options.some(opt => opt.id === question.answer)) {\n        question.answer = question.options[0].id;\n      }\n    }\n\n    const payload = {\n      ...exam,\n      examTitle: title,\n      updatedAt: Date.now()\n    };\n\n    await upsertExam(payload);\n    return true;\n  }\n\n  form.addEventListener('submit', async e => {\n    e.preventDefault();\n    const ok = await persistExam();\n    if (!ok) return;\n    dirty = false;\n    await floating.close('saved');\n    render();\n  });\n\n  function promptSaveChoice() {\n    return new Promise(resolve => {\n      const modal = document.createElement('div');\n      modal.className = 'modal';\n\n      const card = document.createElement('div');\n      card.className = 'card';\n\n      const message = document.createElement('p');\n      message.textContent = 'Save changes before closing?';\n      card.appendChild(message);\n\n      const actionsRow = document.createElement('div');\n      actionsRow.className = 'modal-actions';\n\n      const saveBtn = document.createElement('button');\n      saveBtn.type = 'button';\n      saveBtn.className = 'btn';\n      saveBtn.textContent = 'Save';\n      saveBtn.addEventListener('click', () => { cleanup(); resolve('save'); });\n\n      const discardBtn = document.createElement('button');\n      discardBtn.type = 'button';\n      discardBtn.className = 'btn secondary';\n      discardBtn.textContent = 'Discard';\n      discardBtn.addEventListener('click', () => { cleanup(); resolve('discard'); });\n\n      const cancelBtn = document.createElement('button');\n      cancelBtn.type = 'button';\n      cancelBtn.className = 'ghost-btn';\n      cancelBtn.textContent = 'Keep Editing';\n      cancelBtn.addEventListener('click', () => { cleanup(); resolve('cancel'); });\n\n      actionsRow.append(saveBtn, discardBtn, cancelBtn);\n      card.appendChild(actionsRow);\n      modal.appendChild(card);\n\n      modal.addEventListener('click', e => {\n        if (e.target === modal) {\n          cleanup();\n          resolve('cancel');\n        }\n      });\n\n      document.body.appendChild(modal);\n      saveBtn.focus();\n\n      function cleanup() {\n        if (modal.parentNode) document.body.removeChild(modal);\n      }\n    });\n  }\n\n  titleInput.focus();\n}\n", "import { renderRichText } from './rich-text.js';\nimport { createFloatingWindow } from './window-manager.js';\n\nconst fieldDefs = {\n  disease: [\n    ['etiology','Etiology'],\n    ['pathophys','Pathophys'],\n    ['clinical','Clinical'],\n    ['diagnosis','Diagnosis'],\n    ['treatment','Treatment'],\n    ['complications','Complications'],\n    ['mnemonic','Mnemonic']\n  ],\n  drug: [\n    ['class','Class'],\n    ['source','Source'],\n    ['moa','MOA'],\n    ['uses','Uses'],\n    ['sideEffects','Side Effects'],\n    ['contraindications','Contraindications'],\n    ['mnemonic','Mnemonic']\n  ],\n  concept: [\n    ['type','Type'],\n    ['definition','Definition'],\n    ['mechanism','Mechanism'],\n    ['clinicalRelevance','Clinical Relevance'],\n    ['example','Example'],\n    ['mnemonic','Mnemonic']\n  ]\n};\n\nfunction escapeHtml(str = '') {\n  return String(str)\n    .replace(/&/g, '&amp;')\n    .replace(/</g, '&lt;')\n    .replace(/>/g, '&gt;')\n    .replace(/\"/g, '&quot;')\n    .replace(/'/g, '&#39;');\n}\n\nfunction collectExtras(item) {\n  if (Array.isArray(item.extras) && item.extras.length) return item.extras;\n  if (item.facts && item.facts.length) {\n    return [{\n      id: 'legacy-facts',\n      title: 'Highlights',\n      body: `<ul>${item.facts.map(f => `<li>${escapeHtml(f)}</li>`).join('')}</ul>`\n    }];\n  }\n  return [];\n}\n\nconst FALLBACK_ACCENTS = {\n  disease: '#c084fc',\n  drug: '#60a5fa',\n  concept: '#4ade80'\n};\n\nconst DEFAULT_ACCENT = '#38bdf8';\nconst HEX_COLOR = /^#([0-9a-f]{3}|[0-9a-f]{6})$/i;\n\nfunction resolveAccentColor(item) {\n  if (item && typeof item.color === 'string' && HEX_COLOR.test(item.color.trim())) {\n    return normalizeHex(item.color.trim());\n  }\n  const fallback = FALLBACK_ACCENTS[item?.kind];\n  if (typeof fallback === 'string') {\n    return normalizeHex(fallback);\n  }\n  return DEFAULT_ACCENT;\n}\n\nfunction normalizeHex(value) {\n  if (typeof value !== 'string') return DEFAULT_ACCENT;\n  const trimmed = value.trim();\n  if (!HEX_COLOR.test(trimmed)) return DEFAULT_ACCENT;\n  if (trimmed.length === 4) {\n    const [, r, g, b] = trimmed;\n    return `#${r}${r}${g}${g}${b}${b}`.toUpperCase();\n  }\n  return trimmed.toUpperCase();\n}\n\nexport function showPopup(item, options = {}) {\n  const { onEdit, onColorChange, onLink, onGravityChange } = options;\n  const titleText = item?.name || item?.concept || 'Item';\n  const accent = resolveAccentColor(item);\n  const win = createFloatingWindow({ title: titleText, width: 560 });\n\n  const card = document.createElement('div');\n  card.className = 'card popup-card';\n  card.style.borderTop = `4px solid ${accent}`;\n\n  const header = document.createElement('div');\n  header.className = 'popup-card-header';\n  const title = document.createElement('h2');\n  title.textContent = titleText;\n  header.appendChild(title);\n  card.appendChild(header);\n\n  if (typeof onColorChange === 'function') {\n    const meta = document.createElement('div');\n    meta.className = 'popup-meta';\n    const colorLabel = document.createElement('label');\n    colorLabel.className = 'popup-color-control';\n    const labelText = document.createElement('span');\n    labelText.textContent = 'Accent';\n    colorLabel.appendChild(labelText);\n    const colorInput = document.createElement('input');\n    colorInput.type = 'color';\n    colorInput.value = accent;\n    colorLabel.appendChild(colorInput);\n    const colorValue = document.createElement('span');\n    colorValue.className = 'popup-color-value';\n    colorValue.textContent = accent;\n    colorLabel.appendChild(colorValue);\n    meta.appendChild(colorLabel);\n    card.appendChild(meta);\n\n    let currentAccent = accent;\n\n    const updateAccentPreview = (value, commit = false) => {\n      const normalized = normalizeHex(value);\n      card.style.borderTop = `4px solid ${normalized}`;\n      colorValue.textContent = normalized;\n      if (commit) {\n        currentAccent = normalized;\n      }\n    };\n\n    colorInput.addEventListener('input', () => {\n      updateAccentPreview(colorInput.value);\n    });\n\n    colorInput.addEventListener('change', async () => {\n      if (typeof onColorChange === 'function') {\n        const next = normalizeHex(colorInput.value);\n        updateAccentPreview(next);\n        try {\n          await onColorChange(next);\n          updateAccentPreview(next, true);\n        } catch (err) {\n          console.error(err);\n          updateAccentPreview(currentAccent, true);\n          colorInput.value = currentAccent;\n        }\n      } else {\n        updateAccentPreview(colorInput.value, true);\n      }\n    });\n  }\n\n  if (typeof onGravityChange === 'function') {\n    const gravityBox = document.createElement('div');\n    gravityBox.className = 'popup-gravity';\n\n    const gravityLabel = document.createElement('label');\n    gravityLabel.className = 'popup-gravity-label';\n    gravityLabel.textContent = 'Simulated link boost';\n\n    const gravityInput = document.createElement('input');\n    gravityInput.type = 'number';\n    gravityInput.min = '0';\n    gravityInput.step = '1';\n    gravityInput.className = 'input popup-gravity-input';\n    const initialBoost = typeof item.mapGravityBoost === 'number' ? item.mapGravityBoost : 0;\n    let currentBoost = initialBoost;\n    gravityInput.value = String(initialBoost);\n    gravityLabel.appendChild(gravityInput);\n    gravityBox.appendChild(gravityLabel);\n\n    const gravityHint = document.createElement('p');\n    gravityHint.className = 'popup-gravity-hint';\n    gravityHint.textContent = 'Adds to link count when organizing maps.';\n    gravityBox.appendChild(gravityHint);\n\n    const applyBoost = async () => {\n      if (typeof onGravityChange !== 'function') return;\n      const raw = gravityInput.value;\n      try {\n        const normalized = await onGravityChange(raw);\n        const value = Number(normalized);\n        if (Number.isFinite(value)) {\n          currentBoost = value;\n          gravityInput.value = String(value);\n        } else {\n          gravityInput.value = String(currentBoost);\n        }\n      } catch (err) {\n        console.error(err);\n        gravityInput.value = String(currentBoost);\n      }\n    };\n\n    gravityInput.addEventListener('change', applyBoost);\n    gravityInput.addEventListener('blur', applyBoost);\n\n    card.appendChild(gravityBox);\n  }\n\n  const defs = fieldDefs[item.kind] || [];\n  defs.forEach(([field, label]) => {\n    const val = item[field];\n    if (!val) return;\n    const sec = document.createElement('div');\n    sec.className = 'section';\n    const tl = document.createElement('div');\n    tl.className = 'section-title';\n    tl.textContent = label;\n    sec.appendChild(tl);\n    const txt = document.createElement('div');\n    renderRichText(txt, val);\n    sec.appendChild(txt);\n    card.appendChild(sec);\n  });\n\n  const extras = collectExtras(item);\n  extras.forEach(extra => {\n    if (!extra || !extra.body) return;\n    const sec = document.createElement('div');\n    sec.className = 'section section--extra';\n    const tl = document.createElement('div');\n    tl.className = 'section-title';\n    tl.textContent = extra.title || 'Additional Section';\n    sec.appendChild(tl);\n    const txt = document.createElement('div');\n    renderRichText(txt, extra.body);\n    sec.appendChild(txt);\n    card.appendChild(sec);\n  });\n\n  const actions = document.createElement('div');\n  actions.className = 'popup-actions';\n\n  if (typeof onEdit === 'function') {\n    const editBtn = document.createElement('button');\n    editBtn.type = 'button';\n    editBtn.className = 'btn secondary';\n    editBtn.textContent = 'Edit';\n    editBtn.addEventListener('click', () => {\n      void win.close('edit');\n      onEdit();\n    });\n    actions.appendChild(editBtn);\n  }\n\n  if (typeof onLink === 'function') {\n    const linkBtn = document.createElement('button');\n    linkBtn.type = 'button';\n    linkBtn.className = 'btn secondary';\n    linkBtn.textContent = 'Link';\n    linkBtn.addEventListener('click', () => {\n      void win.close('link');\n      onLink();\n    });\n    actions.appendChild(linkBtn);\n  }\n\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'btn';\n  closeBtn.textContent = 'Close';\n  closeBtn.addEventListener('click', () => {\n    void win.close('close');\n  });\n  actions.appendChild(closeBtn);\n\n  card.appendChild(actions);\n\n  win.setContent(card);\n  win.setTitle(titleText);\n  return win;\n}\n", "import { listItemsByKind, getItem, upsertItem, getMapConfig, saveMapConfig } from '../../storage/storage.js';\nimport { loadBlockCatalog } from '../../storage/block-catalog.js';\nimport { uid, deepClone } from '../../utils.js';\nimport { showPopup } from './popup.js';\nimport { openEditor } from './editor.js';\nimport { createFloatingWindow } from './window-manager.js';\n\nconst TOOL = {\n  NAVIGATE: 'navigate',\n  HIDE: 'hide',\n  BREAK: 'break-link',\n  ADD_LINK: 'add-link',\n  AREA: 'area'\n};\n\nfunction createCursor(svg, hotX = 8, hotY = 8) {\n  const encoded = encodeURIComponent(svg.trim())\n    .replace(/%0A/g, '')\n    .replace(/%20/g, ' ');\n  return `url(\"data:image/svg+xml,${encoded}\") ${hotX} ${hotY}, pointer`;\n}\n\nconst CURSOR_STYLE = {\n  hide: createCursor(\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">'\n    + '<path d=\"M6 19.5l9-9a3 3 0 0 1 4.24 0l6.5 6.5a3 3 0 0 1 0 4.24l-9 9H9a3 3 0 0 1-3-3z\" fill=\"#f97316\" />'\n    + '<path d=\"M8.2 21.2l8.6 8.6\" stroke=\"#fed7aa\" stroke-width=\"3\" stroke-linecap=\"round\" />'\n    + '<path d=\"M11.3 24.5l4 4\" stroke=\"#fff7ed\" stroke-width=\"2\" stroke-linecap=\"round\" />'\n    + '</svg>',\n    7,\n    26\n  ),\n  break: createCursor(\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">'\n    + '<circle cx=\"11\" cy=\"11\" r=\"4\" fill=\"none\" stroke=\"#f97316\" stroke-width=\"2.2\" />'\n    + '<circle cx=\"11\" cy=\"21\" r=\"4\" fill=\"none\" stroke=\"#f97316\" stroke-width=\"2.2\" />'\n    + '<path d=\"M14.5 13L24 3.5\" stroke=\"#fbbf24\" stroke-width=\"2.6\" stroke-linecap=\"round\" />'\n    + '<path d=\"M14.5 19L24 28.5\" stroke=\"#fbbf24\" stroke-width=\"2.6\" stroke-linecap=\"round\" />'\n    + '<path d=\"M6 6l7 7\" stroke=\"#f97316\" stroke-width=\"2.2\" stroke-linecap=\"round\" />'\n    + '<path d=\"M6 26l7-7\" stroke=\"#f97316\" stroke-width=\"2.2\" stroke-linecap=\"round\" />'\n    + '</svg>',\n    18,\n    18\n  ),\n  link: createCursor(\n    '<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"32\" height=\"32\" viewBox=\"0 0 32 32\">'\n    + '<path d=\"M12 11h5a4.5 4.5 0 0 1 0 9h-3\" fill=\"none\" stroke=\"#38bdf8\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />'\n    + '<path d=\"M14 15h-4a4.5 4.5 0 0 0 0 9h5\" fill=\"none\" stroke=\"#38bdf8\" stroke-width=\"3\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />'\n    + '<path d=\"M13 19h6\" stroke=\"#bae6fd\" stroke-width=\"2\" stroke-linecap=\"round\" />'\n    + '</svg>',\n    9,\n    23\n  )\n};\n\nconst PAN_ACCELERATION = 1.8;\nconst ZOOM_INTENSITY = 0.0041;\nconst NODE_DRAG_DISTANCE_THRESHOLD = 0;\n\nconst ICONS = {\n  sliders:\n    '<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">'\n    + '<path d=\"M6 7h12\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" />'\n    + '<path d=\"M6 12h8\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" />'\n    + '<path d=\"M6 17h14\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" />'\n    + '<circle cx=\"16\" cy=\"7\" r=\"2.5\" stroke=\"currentColor\" stroke-width=\"1.6\" />'\n    + '<circle cx=\"11\" cy=\"12\" r=\"2.5\" stroke=\"currentColor\" stroke-width=\"1.6\" />'\n    + '<circle cx=\"19\" cy=\"17\" r=\"2.5\" stroke=\"currentColor\" stroke-width=\"1.6\" />'\n    + '</svg>',\n  close:\n    '<svg viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">'\n    + '<path d=\"M5 5l10 10M15 5L5 15\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" />'\n    + '</svg>',\n  plus:\n    '<svg viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">'\n    + '<path d=\"M10 4v12M4 10h12\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" />'\n    + '</svg>',\n  search:\n    '<svg viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">'\n    + '<circle cx=\"9\" cy=\"9\" r=\"5.2\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" />'\n    + '<path d=\"M12.8 12.8L16.5 16.5\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" />'\n    + '</svg>',\n  arrowRight:\n    '<svg viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">'\n    + '<path d=\"M4 10h10\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />'\n    + '<path d=\"M10 6l4 4-4 4\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />'\n    + '</svg>',\n  gear:\n    '<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">'\n    + '<path d=\"M12 8.5a3.5 3.5 0 1 0 0 7 3.5 3.5 0 0 0 0-7z\" stroke=\"currentColor\" stroke-width=\"1.6\" />'\n    + '<path d=\"M4.5 12.5l1.8.52c.26.08.46.28.54.54l.52 1.8a.9.9 0 0 0 1.47.41l1.43-1.08a.9.9 0 0 1 .99-.07l1.63.82a.9.9 0 0 0 1.22-.41l.73-1.66a.9.9 0 0 1 .73-.52l1.88-.2a.9.9 0 0 0 .78-1.07l-.39-1.85a.9.9 0 0 1 .25-.83l1.29-1.29a.9.9 0 0 0-.01-1.27l-1.29-1.29a.9.9 0 0 0-.83-.25l-1.85.39a.9.9 0 0 1-1.07-.78l-.2-1.88A.9.9 0 0 0 13.3 2h-2.6a.9.9 0 0 0-.9.78l-.2 1.88a.9.9 0 0 1-1.07.78l-1.85-.39a.9.9 0 0 0-.83.25L4.56 6.59a.9.9 0 0 0-.01 1.27l1.29 1.29c.22.22.31.54.25.83l-.39 1.85a.9.9 0 0 0 .7 1.07z\" stroke=\"currentColor\" stroke-width=\"1.2\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />'\n    + '</svg>',\n  trash:\n\n    '<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">'\n    + '<path d=\"M6 7h12\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" />'\n    + '<path d=\"M9 7V5a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v2\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" />'\n    + '<path d=\"M18 7v11a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2V7\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" stroke-linejoin=\"round\" />'\n    + '<path d=\"M10 11v6M14 11v6\" stroke=\"currentColor\" stroke-width=\"1.8\" stroke-linecap=\"round\" />'\n    + '</svg>'\n};\n\nconst DEFAULT_LINK_COLOR = '#888888';\nconst DEFAULT_LINE_STYLE = 'solid';\nconst DEFAULT_LINE_DECORATION = 'none';\nconst DEFAULT_DECORATION_DIRECTION = 'end';\nconst DEFAULT_LINE_GLOW = false;\nconst DEFAULT_LINE_THICKNESS = 'regular';\nconst DEFAULT_CURVE_ANCHOR = 0.5;\nconst CURVE_HANDLE_COUNT = 1;\nconst CURVE_HANDLE_MAX_OFFSET = 3.5;\nconst MIN_NODE_RADIUS = 20;\nconst MAX_NODE_RADIUS = 60;\nconst MAX_GRAVITY_BOOST = 999;\nconst NODE_COLLISION_MARGIN = 36;\nconst DEFAULT_REORGANIZE_SPACING = 220;\nconst HANDLE_STICKY_RELEASE_DELAY = 260;\nconst VIEW_MEMORY_MAX_AGE = 10 * 60 * 1000;\n\nconst LINE_STYLE_OPTIONS = [\n  { value: 'solid', label: 'Smooth' },\n  { value: 'dashed', label: 'Dashed' },\n  { value: 'dotted', label: 'Dotted' }\n];\n\nconst LINE_DECORATION_OPTIONS = [\n  { value: 'none', label: 'None' },\n  { value: 'arrow', label: 'Arrowhead' },\n  { value: 'inhibit', label: 'Inhibitor \u22A3' },\n  { value: 'block', label: 'Blocked \u2715' }\n];\n\nconst LINE_DECORATION_DIRECTION_OPTIONS = [\n  { value: 'end', label: 'A \u2192 B' },\n  { value: 'start', label: 'B \u2192 A' },\n  { value: 'both', label: 'Both directions' }\n];\n\nconst LINE_STYLE_CLASSNAMES = ['map-edge--solid', 'map-edge--dashed', 'map-edge--dotted'];\nconst LINE_DECORATION_CLASSNAMES = [\n  'map-edge--decoration-arrow',\n  'map-edge--decoration-inhibit',\n  'map-edge--decoration-block'\n];\n\nconst LINE_STYLE_VALUE_SET = new Set(LINE_STYLE_OPTIONS.map(option => option.value));\nconst LINE_DECORATION_VALUE_SET = new Set(LINE_DECORATION_OPTIONS.map(option => option.value));\nconst LINE_DIRECTION_VALUE_SET = new Set(LINE_DECORATION_DIRECTION_OPTIONS.map(option => option.value));\n\nconst LINE_THICKNESS_VALUES = {\n  thin: 1.8,\n  regular: 3,\n  bold: 4.6\n};\n\nconst LINE_THICKNESS_OPTIONS = [\n  { value: 'thin', label: 'Thin' },\n  { value: 'regular', label: 'Regular' },\n  { value: 'bold', label: 'Bold' }\n];\n\nconst LINE_HOVER_WIDTH_MULTIPLIER = 1.2;\n\nconst LINE_TYPE_PRESETS = [\n  { value: 'line', label: 'Line', style: 'solid', decoration: 'none', direction: DEFAULT_DECORATION_DIRECTION },\n  { value: 'arrow', label: 'Arrow', style: 'solid', decoration: 'arrow', direction: 'end', directional: true },\n  { value: 'inhibit', label: 'Inhibitor \u22A3', style: 'solid', decoration: 'inhibit', direction: 'end', directional: true },\n  { value: 'blocked', label: 'Blocked \u2715', style: 'solid', decoration: 'block', direction: DEFAULT_DECORATION_DIRECTION },\n  { value: 'dashed', label: 'Dashed', style: 'dashed', decoration: 'none', direction: DEFAULT_DECORATION_DIRECTION },\n  { value: 'dotted', label: 'Dotted', style: 'dotted', decoration: 'none', direction: DEFAULT_DECORATION_DIRECTION }\n];\n\nconst LINE_TYPE_PRESET_LOOKUP = new Map(LINE_TYPE_PRESETS.map(option => [option.value, option]));\n\nconst LINE_GAP_SAMPLE_STEP = 0.08;\nconst LINE_GAP_MIN_DISTANCE = 12;\nconst LINE_GAP_STROKE_MULTIPLIER = 2.4;\n\nconst EDGE_DRAG_HOLD_DELAY = 160;\nconst EDGE_DRAG_MOVE_THRESHOLD = 3.5;\nconst EDGE_CLICK_DISTANCE = 12;\nconst EDGE_ANIMATION_DURATION = 120;\n\nconst LEGACY_STYLE_MAPPINGS = {\n  'arrow': { style: 'solid', decoration: 'arrow', decorationDirection: 'end' },\n  'arrow-end': { style: 'solid', decoration: 'arrow', decorationDirection: 'end' },\n  'arrow-start': { style: 'solid', decoration: 'arrow', decorationDirection: 'start' },\n  'arrow-both': { style: 'solid', decoration: 'arrow', decorationDirection: 'both' },\n  'blocked': { style: 'solid', decoration: 'block', decorationDirection: 'end' },\n  'inhibit': { style: 'solid', decoration: 'inhibit', decorationDirection: 'end' },\n  'glow': { style: 'solid', glow: true }\n};\n\nconst KIND_FALLBACK_COLORS = {\n  disease: 'var(--purple)',\n  drug: 'var(--blue)',\n  concept: 'var(--green)'\n};\n\nconst mapState = {\n  tool: TOOL.NAVIGATE,\n  selectionIds: [],\n  previewSelection: null,\n  selectionPreviewSignature: '',\n  pendingLink: null,\n  hiddenMenuTab: 'nodes',\n  panelVisible: true,\n  menuPinned: false,\n  menuOpen: false,\n  listenersAttached: false,\n  draggingView: false,\n  viewWasDragged: false,\n  nodeDrag: null,\n  areaDrag: null,\n  menuDrag: null,\n  edgeDrag: null,\n  selectionRect: null,\n  nodeWasDragged: false,\n  lastPointerDownInfo: null,\n  viewBox: null,\n  svg: null,\n  g: null,\n  positions: {},\n  itemMap: {},\n  elements: new Map(),\n  root: null,\n  container: null,\n  updateViewBox: () => {},\n  selectionBox: null,\n  sizeLimit: 2000,\n  minView: 100,\n  lastPointer: { x: 0, y: 0, mapX: 0, mapY: 0 },\n  autoPan: null,\n  autoPanFrame: null,\n  autoPanPointer: null,\n  toolboxPos: { x: 16, y: 16 },\n  toolboxDrag: null,\n  toolboxEl: null,\n  toolboxContainer: null,\n  toolboxBadges: null,\n  baseCursor: 'grab',\n  prefersReducedMotion: null,\n  motionMedia: null,\n  pendingEdgeAnimations: new Map(),\n  cursorOverride: null,\n  defaultViewSize: null,\n  lastScaleSize: null,\n  viewBoxFrame: null,\n  pendingViewBoxOptions: null,\n  svgRect: null,\n  svgRectTime: 0,\n  justCompletedSelection: false,\n  edgeTooltip: null,\n  hoveredEdge: null,\n  hoveredEdgePointer: { x: 0, y: 0 },\n  currentScales: { nodeScale: 1, labelScale: 1, lineScale: 1 },\n  suppressNextClick: false,\n  edgeDragJustCompleted: false,\n  edgePress: null,\n  viewPointerId: null,\n  viewDragStart: null,\n  mapConfig: null,\n  mapConfigLoaded: false,\n  blocks: [],\n  visibleItems: [],\n  searchValue: '',\n  searchFeedback: null,\n  searchInput: null,\n  searchFieldEl: null,\n  searchFeedbackEl: null,\n  searchSuggestions: [],\n  searchSuggestionsEl: null,\n  searchActiveIndex: -1,\n  searchSuggestionTimer: null,\n  paletteSearch: '',\n  nodeRadii: null,\n  gravityModel: null,\n  edgeLayer: null,\n  nodeLayer: null,\n  lineMarkers: new Map(),\n  markerDefs: null,\n  lineMarkerCache: new Map(),\n  edgeRefs: new Map(),\n  allEdges: new Set(),\n  pendingNodeUpdates: new Map(),\n  pendingEdgeUpdates: new Set(),\n  nodeUpdateFrame: null,\n  edgeUpdateFrame: null,\n  activeLineMenu: null,\n  pendingFocusId: null,\n  restoredViewFromMemory: false,\n  viewMemoryTimer: null,\n  viewMemoryDirty: false\n};\n\nfunction normalizeMapTab(tab = {}) {\n  const filter = tab.filter && typeof tab.filter === 'object' ? tab.filter : {};\n  const layout = {};\n  if (tab.layout && typeof tab.layout === 'object') {\n    Object.entries(tab.layout).forEach(([id, pos]) => {\n      if (!id || !pos || typeof pos !== 'object') return;\n      const x = Number(pos.x);\n      const y = Number(pos.y);\n      if (!Number.isFinite(x) || !Number.isFinite(y)) return;\n      layout[id] = { x, y };\n    });\n  }\n  const viewState = normalizeViewState(tab.viewState || tab.view || tab.viewBox);\n  const normalized = {\n    id: tab.id || uid(),\n    name: tab.name || 'Untitled map',\n    includeLinked: tab.includeLinked !== false,\n    manualMode: Boolean(tab.manualMode),\n    manualIds: Array.isArray(tab.manualIds) ? Array.from(new Set(tab.manualIds.filter(Boolean))) : [],\n    layout,\n    layoutSeeded: tab.layoutSeeded === true,\n    filter: {\n      blockId: filter.blockId || '',\n      weeks: getFilterWeeks(filter),\n      lectureKeys: getFilterLectureKeys(filter)\n    },\n    viewState: viewState\n  };\n  return normalized;\n}\n\nfunction normalizeViewState(view = {}) {\n  if (!view || typeof view !== 'object') {\n    return null;\n  }\n  const x = Number(view.x);\n  const y = Number(view.y);\n  const width = Number(view.w ?? view.width);\n  const height = Number(view.h ?? view.height ?? width);\n  const timestamp = Number(view.timestamp ?? view.time ?? view.updatedAt);\n  if (!Number.isFinite(x) || !Number.isFinite(y) || !Number.isFinite(width) || !Number.isFinite(height)) {\n    return null;\n  }\n  if (width <= 0 || height <= 0) {\n    return null;\n  }\n  return {\n    x,\n    y,\n    w: width,\n    h: height,\n    timestamp: Number.isFinite(timestamp) ? timestamp : 0\n  };\n}\n\nfunction getRestorableViewState(tab) {\n  if (!tab) return null;\n  const normalized = normalizeViewState(tab.viewState);\n  if (!normalized) {\n    return null;\n  }\n  const lastUpdated = Number(normalized.timestamp) || 0;\n  if (lastUpdated > 0) {\n    const age = Date.now() - lastUpdated;\n    if (Number.isFinite(age) && age > VIEW_MEMORY_MAX_AGE) {\n      return null;\n    }\n  }\n  return normalized;\n}\n\nfunction findNewestVisibleNode(items = []) {\n  if (!Array.isArray(items) || !items.length) {\n    return null;\n  }\n  let newest = null;\n  let newestValue = -Infinity;\n  items.forEach(item => {\n    if (!item || typeof item !== 'object') return;\n    const created = Number(item.createdAt ?? item.updatedAt);\n    if (Number.isFinite(created) && created > newestValue) {\n      newest = item;\n      newestValue = created;\n    }\n  });\n  return newest;\n}\n\nfunction rememberViewBox() {\n  if (!mapState.viewBox) return;\n  const tab = getActiveTab();\n  if (!tab) return;\n  const snapshot = {\n    x: mapState.viewBox.x,\n    y: mapState.viewBox.y,\n    w: mapState.viewBox.w,\n    h: mapState.viewBox.h,\n    timestamp: Date.now()\n  };\n  tab.viewState = snapshot;\n  mapState.viewMemoryDirty = true;\n  scheduleViewStatePersist();\n}\n\nfunction scheduleViewStatePersist() {\n  if (mapState.viewMemoryTimer) return;\n  mapState.viewMemoryTimer = setTimeout(() => {\n    mapState.viewMemoryTimer = null;\n    if (!mapState.viewMemoryDirty) return;\n    mapState.viewMemoryDirty = false;\n    persistMapConfig().catch(() => {});\n  }, 300);\n}\n\nasync function flushViewStatePersist() {\n  if (mapState.viewMemoryTimer) {\n    clearTimeout(mapState.viewMemoryTimer);\n    mapState.viewMemoryTimer = null;\n  }\n  if (!mapState.viewMemoryDirty) {\n    return;\n  }\n  mapState.viewMemoryDirty = false;\n  await persistMapConfig();\n}\n\nfunction parseWeekValue(value) {\n  if (typeof value === 'number' && Number.isFinite(value)) {\n    return value;\n  }\n  if (typeof value === 'string' && value.trim()) {\n    const parsed = Number(value);\n    if (Number.isFinite(parsed)) {\n      return parsed;\n    }\n  }\n  return null;\n}\n\nfunction normalizeWeekArray(values = []) {\n  const seen = new Set();\n  const result = [];\n  values.forEach(value => {\n    const week = parseWeekValue(value);\n    if (!Number.isFinite(week) || seen.has(week)) return;\n    seen.add(week);\n    result.push(week);\n  });\n  result.sort((a, b) => a - b);\n  return result;\n}\n\nfunction normalizeLectureKeyArray(values = []) {\n  const seen = new Set();\n  const result = [];\n  values.forEach(value => {\n    const key = typeof value === 'string' ? value.trim() : '';\n    if (!key || seen.has(key)) return;\n    seen.add(key);\n    result.push(key);\n  });\n  return result;\n}\n\nfunction getFilterWeeks(filter = {}) {\n  if (!filter || typeof filter !== 'object') {\n    return [];\n  }\n  const weeks = normalizeWeekArray(filter.weeks);\n  if (weeks.length) {\n    return weeks;\n  }\n  const legacy = parseWeekValue(filter.week);\n  return Number.isFinite(legacy) ? [legacy] : [];\n}\n\nfunction getFilterLectureKeys(filter = {}) {\n  if (!filter || typeof filter !== 'object') {\n    return [];\n  }\n  const keys = normalizeLectureKeyArray(filter.lectureKeys);\n  if (keys.length) {\n    return keys;\n  }\n  const legacy = typeof filter.lectureKey === 'string' ? filter.lectureKey.trim() : '';\n  return legacy ? [legacy] : [];\n}\n\nfunction setFilterWeeks(targetFilter, weeks = []) {\n  if (!targetFilter || typeof targetFilter !== 'object') return;\n  targetFilter.weeks = normalizeWeekArray(weeks);\n  if ('week' in targetFilter) {\n    targetFilter.week = '';\n  }\n}\n\nfunction setFilterLectureKeys(targetFilter, keys = []) {\n  if (!targetFilter || typeof targetFilter !== 'object') return;\n  targetFilter.lectureKeys = normalizeLectureKeyArray(keys);\n  if ('lectureKey' in targetFilter) {\n    targetFilter.lectureKey = '';\n  }\n}\n\nfunction deriveItemGroupKeys(item) {\n  const groups = [];\n  const lectures = Array.isArray(item?.lectures) ? item.lectures : [];\n  if (lectures.length) {\n    lectures.forEach(lecture => {\n      const blockKey = lecture.blockId ? `block:${lecture.blockId}` : 'block:__';\n      const lectureId = lecture.id != null ? `lec:${lecture.id}` : '';\n      const lectureName = lecture.name ? `name:${lecture.name}` : '';\n      const week = Number.isFinite(lecture.week) ? `week:${lecture.week}` : '';\n      const key = [blockKey, week, lectureId || lectureName].filter(Boolean).join('|');\n      groups.push(key || blockKey);\n    });\n  } else if (Array.isArray(item?.blocks) && item.blocks.length) {\n    item.blocks.forEach(blockId => {\n      groups.push(`block-only:${blockId}`);\n    });\n  }\n  if (!groups.length) {\n    groups.push(`kind:${item?.kind || 'concept'}`);\n  }\n  return groups;\n}\n\nfunction parseGroupKey(key = '') {\n  const info = { block: '__', week: '__', lecture: key || '__' };\n  if (!key) {\n    return info;\n  }\n  const parts = String(key).split('|');\n  parts.forEach(part => {\n    if (part.startsWith('block:')) {\n      const value = part.slice(6);\n      info.block = value || '__';\n    } else if (part.startsWith('block-only:')) {\n      const value = part.slice(11);\n      info.block = value || '__';\n    } else if (part.startsWith('week:')) {\n      const value = part.slice(5);\n      info.week = value || '__';\n    } else if (part.startsWith('lec:')) {\n      const value = part.slice(4);\n      info.lecture = value || info.lecture;\n    } else if (part.startsWith('name:') && (info.lecture === key || info.lecture === '__')) {\n      const value = part.slice(5);\n      info.lecture = value || info.lecture;\n    }\n  });\n  if (!info.lecture || info.lecture === '__') {\n    info.lecture = key || '__';\n  }\n  return info;\n}\n\nfunction getPrimaryGroupKey(item, keys = deriveItemGroupKeys(item)) {\n  if (Array.isArray(keys) && keys.length) {\n    return keys[0];\n  }\n  return `kind:${item?.kind || 'concept'}`;\n}\n\nfunction normalizeMapConfig(config = null) {\n  const base = config && typeof config === 'object' ? { ...config } : {};\n  const tabs = Array.isArray(base.tabs)\n    ? base.tabs.map(normalizeMapTab)\n    : [normalizeMapTab({ id: 'default', name: 'All concepts', includeLinked: true, layoutSeeded: true })];\n  const ids = new Set();\n  const deduped = [];\n  tabs.forEach(tab => {\n    if (ids.has(tab.id)) {\n      const clone = { ...tab, id: uid() };\n      ids.add(clone.id);\n      deduped.push(clone);\n    } else {\n      ids.add(tab.id);\n      deduped.push(tab);\n    }\n  });\n  const active = deduped.find(tab => tab.id === base.activeTabId) || deduped[0];\n  return {\n    activeTabId: active.id,\n    tabs: deduped\n  };\n}\n\nfunction ensureTabLayout(tab) {\n  if (!tab) return {};\n  if (!tab.layout || typeof tab.layout !== 'object') {\n    tab.layout = {};\n  }\n  return tab.layout;\n}\n\nfunction normalizeGravityBoost(value) {\n  if (value === null || value === undefined) return 0;\n  const num = Number(value);\n  if (!Number.isFinite(num) || num <= 0) return 0;\n  const clamped = Math.min(MAX_GRAVITY_BOOST, num);\n  return Math.round(clamped * 100) / 100;\n}\n\nfunction getItemGravityBoost(item) {\n  if (!item || typeof item !== 'object') return 0;\n  return normalizeGravityBoost(item.mapGravityBoost);\n}\n\nfunction buildGravityModel(items = []) {\n  const list = Array.isArray(items) ? items : [];\n  const idSet = new Set();\n  list.forEach(item => {\n    if (item?.id) {\n      idSet.add(item.id);\n    }\n  });\n  const adjacency = new Map();\n  const weights = new Map();\n  const neighborWeights = new Map();\n  const baseCounts = new Map();\n  let maxWeight = 0;\n  list.forEach(item => {\n    if (!item || !item.id) return;\n    const seen = new Set();\n    const neighbors = [];\n    (item.links || []).forEach(link => {\n      const targetId = link?.id;\n      if (!targetId) return;\n      if (link.hidden) return;\n      if (!idSet.has(targetId)) return;\n      if (seen.has(targetId)) return;\n      seen.add(targetId);\n      neighbors.push(targetId);\n    });\n    adjacency.set(item.id, neighbors);\n    const degree = neighbors.length;\n    const boost = getItemGravityBoost(item);\n    const weight = degree + boost;\n    weights.set(item.id, weight);\n    baseCounts.set(item.id, { degree, boost });\n    if (weight > maxWeight) {\n      maxWeight = weight;\n    }\n  });\n  list.forEach(item => {\n    if (!item?.id) return;\n    const neighbors = adjacency.get(item.id) || [];\n    const sorted = neighbors\n      .map(id => weights.get(id) || 0)\n      .sort((a, b) => b - a);\n    neighborWeights.set(item.id, sorted);\n  });\n  const influence = new Map();\n  list.forEach(item => {\n    if (!item?.id) return;\n    const neighbors = adjacency.get(item.id) || [];\n    const baseWeight = weights.get(item.id) || 0;\n    if (!neighbors.length) {\n      influence.set(item.id, baseWeight);\n      return;\n    }\n    let directSum = 0;\n    neighbors.forEach(id => {\n      directSum += weights.get(id) || 0;\n    });\n    const directAvg = directSum / neighbors.length;\n    let secondSum = 0;\n    neighbors.forEach(id => {\n      const secondNeighbors = adjacency.get(id) || [];\n      if (!secondNeighbors.length) return;\n      let secondWeight = 0;\n      secondNeighbors.forEach(innerId => {\n        secondWeight += weights.get(innerId) || 0;\n      });\n      secondSum += secondWeight / secondNeighbors.length;\n    });\n    const secondAvg = neighbors.length ? secondSum / neighbors.length : 0;\n    const score = baseWeight + directAvg * 0.6 + secondAvg * 0.3;\n    influence.set(item.id, score);\n  });\n  return { weights, adjacency, neighborWeights, influence, maxWeight, baseCounts };\n}\n\nfunction computeNodeRadiusFromWeight(weight, maxWeight) {\n  const clampedMax = Math.max(Number(maxWeight) || 0, 1);\n  const normalized = clamp((Number(weight) || 0) / clampedMax, 0, 1);\n  return MIN_NODE_RADIUS + (MAX_NODE_RADIUS - MIN_NODE_RADIUS) * normalized;\n}\n\nfunction computeRadiiFromModel(model, items = mapState.visibleItems || []) {\n  const radii = new Map();\n  if (!model) return radii;\n  const { weights, maxWeight } = model;\n  (Array.isArray(items) ? items : []).forEach(item => {\n    if (!item?.id) return;\n    const radius = computeNodeRadiusFromWeight(weights.get(item.id) || 0, maxWeight);\n    radii.set(item.id, radius);\n  });\n  return radii;\n}\n\nfunction refreshGravityModel() {\n  const items = Array.isArray(mapState.visibleItems) ? mapState.visibleItems : [];\n  const model = buildGravityModel(items);\n  mapState.gravityModel = model;\n  const nodeRadii = computeRadiiFromModel(model, items);\n  mapState.nodeRadii = nodeRadii;\n  const touched = [];\n  nodeRadii.forEach((radius, id) => {\n    const entry = mapState.elements?.get(id);\n    if (!entry?.circle) return;\n    entry.circle.dataset.radius = radius;\n    updateNodeGeometry(id, entry);\n    touched.push(id);\n  });\n  touched.forEach(id => updateEdgesFor(id));\n  return model;\n}\n\nfunction computeLayoutCenter() {\n  const positions = mapState.positions || {};\n  let minX = Infinity;\n  let maxX = -Infinity;\n  let minY = Infinity;\n  let maxY = -Infinity;\n  Object.values(positions).forEach(pos => {\n    if (!pos) return;\n    const { x, y } = pos;\n    if (!Number.isFinite(x) || !Number.isFinite(y)) return;\n    if (x < minX) minX = x;\n    if (x > maxX) maxX = x;\n    if (y < minY) minY = y;\n    if (y > maxY) maxY = y;\n  });\n  if (!Number.isFinite(minX) || !Number.isFinite(maxX) || !Number.isFinite(minY) || !Number.isFinite(maxY)) {\n    const limit = Math.max(mapState.sizeLimit || 0, 2000);\n    const fallback = limit / 2;\n    return { x: fallback, y: fallback };\n  }\n  return {\n    x: (minX + maxX) / 2,\n    y: (minY + maxY) / 2\n  };\n}\n\n\nfunction computeSmartLayout(model, options = {}) {\n  const items = Array.isArray(mapState.visibleItems)\n    ? mapState.visibleItems.filter(it => it && it.id)\n    : [];\n  if (!items.length) return {};\n\n  const workingModel = model || mapState.gravityModel || buildGravityModel(items);\n  const { weights, adjacency, influence } = workingModel;\n  const radii = computeRadiiFromModel(workingModel, items);\n\n  let totalRadius = 0;\n  let radiusCount = 0;\n  let maxRadius = MIN_NODE_RADIUS;\n  const weightValues = [];\n  items.forEach(item => {\n    const radius = radii.get(item.id) || MIN_NODE_RADIUS;\n    totalRadius += radius;\n    radiusCount += 1;\n    if (radius > maxRadius) {\n      maxRadius = radius;\n    }\n    weightValues.push(weights.get(item.id) || 0);\n  });\n  const avgRadius = radiusCount ? totalRadius / radiusCount : MIN_NODE_RADIUS;\n  const typicalRadius = Math.max(avgRadius, maxRadius * 0.75, MIN_NODE_RADIUS);\n\n  const sizeLimit = Math.max(mapState.sizeLimit || 0, 2600);\n  const requestedCenter = options.center || computeLayoutCenter();\n  const fallbackCenter = sizeLimit > 0 ? sizeLimit / 2 : typicalRadius * 20;\n  const center = {\n    x: Number.isFinite(requestedCenter?.x) ? clamp(requestedCenter.x, typicalRadius, sizeLimit - typicalRadius) : fallbackCenter,\n    y: Number.isFinite(requestedCenter?.y) ? clamp(requestedCenter.y, typicalRadius, sizeLimit - typicalRadius) : fallbackCenter\n  };\n\n  const baseSpacing = Math.max(\n    options.baseSpacing ?? DEFAULT_REORGANIZE_SPACING,\n    typicalRadius * 3.4,\n    maxRadius * 2.6\n  );\n  const margin = NODE_COLLISION_MARGIN + Math.max(24, typicalRadius * 0.5);\n\n  const groupNodes = new Map();\n  const primaryGroupById = new Map();\n  items.forEach(item => {\n    if (!item?.id) return;\n    const keys = deriveItemGroupKeys(item);\n    const primary = getPrimaryGroupKey(item, keys);\n    primaryGroupById.set(item.id, primary);\n    const list = groupNodes.get(primary) || [];\n    list.push(item.id);\n    groupNodes.set(primary, list);\n  });\n  if (!groupNodes.size) {\n    return {};\n  }\n\n  const groupMetrics = new Map();\n  groupNodes.forEach((ids, key) => {\n    let sumRadius = 0;\n    let maxGroupRadius = 0;\n    let totalWeight = 0;\n    let totalInfluence = 0;\n    ids.forEach(id => {\n      const radius = radii.get(id) || typicalRadius;\n      sumRadius += radius;\n      if (radius > maxGroupRadius) {\n        maxGroupRadius = radius;\n      }\n      totalWeight += weights.get(id) || 0;\n      totalInfluence += influence.get(id) || 0;\n    });\n    groupMetrics.set(key, {\n      count: ids.length,\n      sumRadius,\n      maxRadius: maxGroupRadius || typicalRadius,\n      totalWeight,\n      totalInfluence\n    });\n  });\n\n  const blockAggregates = new Map();\n  const weekAggregates = new Map();\n  groupMetrics.forEach((metric, key) => {\n    const parsed = parseGroupKey(key);\n    const blockKey = parsed.block || '__';\n    const weekId = parsed.week || '__';\n    const blockEntry = blockAggregates.get(blockKey) || { weight: 0, count: 0 };\n    blockEntry.weight += metric.totalInfluence + metric.totalWeight;\n    blockEntry.count += metric.count;\n    blockAggregates.set(blockKey, blockEntry);\n    const weekKey = `${blockKey}::${weekId}`;\n    const weekEntry = weekAggregates.get(weekKey) || { weight: 0, count: 0 };\n    weekEntry.weight += metric.totalInfluence + metric.totalWeight;\n    weekEntry.count += metric.count;\n    weekAggregates.set(weekKey, weekEntry);\n  });\n\n  const groupSpacingCache = new Map();\n  const groupSpacingBase = Math.max(baseSpacing * 0.95, typicalRadius * 3.6, maxRadius * 2.5 + 56);\n  const lectureSpacingBase = Math.max(groupSpacingBase * 1.22, typicalRadius * 4.6);\n  const weekSpacingBase = Math.max(lectureSpacingBase * 1.18, typicalRadius * 5.3);\n  const blockSpacingBase = Math.max(weekSpacingBase * 1.22, typicalRadius * 6.0);\n\n  function getGroupSpacing(key) {\n    if (groupSpacingCache.has(key)) return groupSpacingCache.get(key);\n    const metric = groupMetrics.get(key) || {\n      count: 0,\n      sumRadius: 0,\n      maxRadius: typicalRadius,\n      totalWeight: 0,\n      totalInfluence: 0\n    };\n    const avgRadius = metric.count ? metric.sumRadius / metric.count : typicalRadius;\n    const influenceBoost = Math.sqrt(Math.max(metric.totalInfluence, metric.totalWeight, 0)) * typicalRadius * 0.35;\n    const spacing = Math.max(\n      groupSpacingBase,\n      avgRadius * 3 + 60,\n      metric.maxRadius * 3.4 + 80,\n      baseSpacing + influenceBoost\n    );\n    groupSpacingCache.set(key, spacing);\n    return spacing;\n  }\n\n  const clampClusterPoint = pos => ({\n    x: clamp(pos.x, margin, sizeLimit - margin),\n    y: clamp(pos.y, margin, sizeLimit - margin)\n  });\n\n  const clampPosition = (pos, radius) => {\n    const r = Math.max(radius || MIN_NODE_RADIUS, MIN_NODE_RADIUS);\n    const minCoord = r + margin;\n    const maxCoord = Math.max(minCoord, sizeLimit - r - margin);\n    return {\n      x: clamp(pos.x, minCoord, maxCoord),\n      y: clamp(pos.y, minCoord, maxCoord)\n    };\n  };\n\n  const placements = new Map();\n  const orbitUsage = new Map();\n  const groupOrbit = new Map();\n\n  const resolveCollisions = (id, initial, radiusOverride = null) => {\n    const radius = radiusOverride ?? radii.get(id) ?? typicalRadius;\n    let position = { x: initial.x, y: initial.y };\n    for (let iter = 0; iter < 8; iter += 1) {\n      let adjusted = false;\n      placements.forEach((otherPos, otherId) => {\n        if (otherId === id) return;\n        const otherRadius = radii.get(otherId) || typicalRadius;\n        const minDistance = radius + otherRadius + margin;\n        const dx = position.x - otherPos.x;\n        const dy = position.y - otherPos.y;\n        const dist = Math.hypot(dx, dy) || 0.0001;\n        if (dist < minDistance) {\n          const push = (minDistance - dist) * 0.5;\n          position.x += (dx / dist) * push;\n          position.y += (dy / dist) * push;\n          adjusted = true;\n        }\n      });\n      position = clampPosition(position, radius);\n      if (!adjusted) break;\n    }\n    return position;\n  };\n\n  const ensureOrbitState = (id, options = {}) => {\n    if (orbitUsage.has(id)) {\n      const existing = orbitUsage.get(id);\n      if (Number.isFinite(options.baseDistance)) {\n        existing.baseDistance = options.baseDistance;\n      }\n      if (Number.isFinite(options.layerSpacing)) {\n        existing.layerSpacing = options.layerSpacing;\n      }\n      if (Number.isFinite(options.slotWeight)) {\n        existing.slots = Math.max(6, Math.round(options.slotWeight * 1.5) + 6);\n      }\n      return existing;\n    }\n    const slotWeight = Number.isFinite(options.slotWeight) ? options.slotWeight : weights.get(id) || 0;\n    const baseSlots = Math.max(6, Math.round(slotWeight * 1.5) + 6);\n    const state = {\n      layer: 0,\n      index: 0,\n      slots: baseSlots,\n      baseDistance: Number.isFinite(options.baseDistance) ? options.baseDistance : baseSpacing * 0.55,\n      layerSpacing: Number.isFinite(options.layerSpacing) ? options.layerSpacing : baseSpacing * 0.42\n    };\n    orbitUsage.set(id, state);\n    return state;\n  };\n\n  const nextOrbitPosition = (anchorId, radius, opts = {}) => {\n    const anchorPos = placements.get(anchorId) || center;\n    const anchorRadius = radii.get(anchorId) || typicalRadius;\n    const baseDistance = Number.isFinite(opts.baseDistance)\n      ? opts.baseDistance\n      : Math.max((opts.groupSpacing || baseSpacing) * 0.42, baseSpacing * 0.5);\n    const layerSpacing = Number.isFinite(opts.layerSpacing)\n      ? opts.layerSpacing\n      : Math.max((opts.groupSpacing || baseSpacing) * 0.34, baseSpacing * 0.38);\n    const state = ensureOrbitState(anchorId, {\n      baseDistance,\n      layerSpacing,\n      slotWeight: opts.slotWeight\n    });\n    const slots = Math.max(6, state.slots + state.layer * 3);\n    const angleOffset = state.layer % 2 ? 0.5 : 0;\n    const angle = ((state.index + angleOffset) / slots) * Math.PI * 2;\n    const distance = anchorRadius + radius + state.baseDistance + state.layer * state.layerSpacing;\n    state.index += 1;\n    if (state.index >= slots) {\n      state.index = 0;\n      state.layer += 1;\n    }\n    return {\n      x: anchorPos.x + Math.cos(angle) * distance,\n      y: anchorPos.y + Math.sin(angle) * distance\n    };\n  };\n\n  const ensureGroupOrbit = key => {\n    if (groupOrbit.has(key)) return groupOrbit.get(key);\n    const metric = groupMetrics.get(key);\n    const spacing = Math.max(getGroupSpacing(key) * 0.5, baseSpacing * 0.55);\n    const slots = Math.max(8, Math.round((metric?.totalWeight || 0) * 1.2) + 8);\n    const state = { layer: 0, index: 0, baseSpacing: spacing, slots };\n    groupOrbit.set(key, state);\n    return state;\n  };\n\n  const nextGroupPosition = (key, radius) => {\n    const origin = clusterOrigins.get(key) || { x: center.x, y: center.y, spacing: getGroupSpacing(key) };\n    const state = ensureGroupOrbit(key);\n    const slots = Math.max(state.slots + state.layer * 4, 8);\n    const angleOffset = state.layer % 2 ? 0.5 : 0;\n    const angle = ((state.index + angleOffset) / slots) * Math.PI * 2;\n    const distance = origin.spacing * 0.52 + state.baseSpacing * state.layer + radius + typicalRadius * 0.65;\n    state.index += 1;\n    if (state.index >= slots) {\n      state.index = 0;\n      state.layer += 1;\n    }\n    return {\n      x: origin.x + Math.cos(angle) * distance,\n      y: origin.y + Math.sin(angle) * distance\n    };\n  };\n\n  const blockCenters = new Map();\n  const blockPositionList = [];\n  const weekCenters = new Map();\n  const weekPositionsByBlock = new Map();\n  const lectureCenters = new Map();\n  const lecturesByWeek = new Map();\n\n  function ensureBlockCenter(blockKey) {\n    if (blockCenters.has(blockKey)) return blockCenters.get(blockKey);\n    const agg = blockAggregates.get(blockKey) || { weight: 0, count: 0 };\n    const spacing = Math.max(\n      blockSpacingBase,\n      baseSpacing + Math.sqrt(Math.max(agg.weight, 0)) * typicalRadius * 0.45 + agg.count * typicalRadius * 0.18\n    );\n    const candidate = pickClusterPosition(blockPositionList, spacing, center, {\n      buffer: spacing * 0.35\n    });\n    const point = clampClusterPoint(candidate);\n    const info = { x: point.x, y: point.y, spacing, buffer: spacing * 0.85 };\n    blockCenters.set(blockKey, info);\n    blockPositionList.push(info);\n    return info;\n  }\n\n  function ensureWeekCenter(blockKey, weekId, blockCenter) {\n    const weekKey = `${blockKey}::${weekId}`;\n    if (weekCenters.has(weekKey)) return weekCenters.get(weekKey);\n    const agg = weekAggregates.get(weekKey) || { weight: 0, count: 0 };\n    const existing = weekPositionsByBlock.get(blockKey) || [];\n    const spacing = Math.max(\n      weekSpacingBase,\n      blockCenter.spacing * 0.64,\n      baseSpacing + Math.sqrt(Math.max(agg.weight, 0)) * typicalRadius * 0.34 + agg.count * typicalRadius * 0.16\n    );\n    const candidate = pickClusterPosition(existing, spacing, blockCenter, {\n      buffer: spacing * 0.3,\n      maxRadius: blockCenter.spacing * 0.85\n    });\n    const point = clampClusterPoint(candidate);\n    const info = { x: point.x, y: point.y, spacing, buffer: spacing * 0.75 };\n    weekCenters.set(weekKey, info);\n    existing.push(info);\n    weekPositionsByBlock.set(blockKey, existing);\n    return info;\n  }\n\n  function ensureLectureCenter(blockKey, weekId, lectureId, weekCenter, groupKey) {\n    const weekKey = `${blockKey}::${weekId}`;\n    const lectureKey = `${weekKey}::${lectureId}`;\n    if (lectureCenters.has(lectureKey)) return lectureCenters.get(lectureKey);\n    const existing = lecturesByWeek.get(weekKey) || [];\n    const spacing = Math.max(lectureSpacingBase, weekCenter.spacing * 0.62, getGroupSpacing(groupKey));\n    const candidate = pickClusterPosition(existing, spacing, weekCenter, {\n      buffer: spacing * 0.24,\n      maxRadius: weekCenter.spacing * 0.7\n    });\n    const point = clampClusterPoint(candidate);\n    const info = { x: point.x, y: point.y, spacing, buffer: spacing * 0.7 };\n    lectureCenters.set(lectureKey, info);\n    existing.push(info);\n    lecturesByWeek.set(weekKey, existing);\n    return info;\n  }\n\n  const blockOrder = new Map();\n  Array.from(blockAggregates.entries())\n    .sort((a, b) => {\n      const scoreA = a[1].weight + a[1].count * 0.6;\n      const scoreB = b[1].weight + b[1].count * 0.6;\n      if (Math.abs(scoreA - scoreB) > 0.0001) return scoreB - scoreA;\n      return String(a[0]).localeCompare(String(b[0]));\n    })\n    .forEach((entry, index) => {\n      blockOrder.set(entry[0], index);\n    });\n\n  const weekOrder = new Map();\n  Array.from(weekAggregates.entries())\n    .sort((a, b) => {\n      const scoreA = a[1].weight + a[1].count * 0.5;\n      const scoreB = b[1].weight + b[1].count * 0.5;\n      if (Math.abs(scoreA - scoreB) > 0.0001) return scoreB - scoreA;\n      return String(a[0]).localeCompare(String(b[0]));\n    })\n    .forEach((entry, index) => {\n      weekOrder.set(entry[0], index);\n    });\n\n  const groupOrder = Array.from(groupNodes.keys()).sort((a, b) => {\n    const parsedA = parseGroupKey(a);\n    const parsedB = parseGroupKey(b);\n    const blockIdxA = blockOrder.get(parsedA.block || '__') ?? Number.MAX_SAFE_INTEGER;\n    const blockIdxB = blockOrder.get(parsedB.block || '__') ?? Number.MAX_SAFE_INTEGER;\n    if (blockIdxA !== blockIdxB) return blockIdxA - blockIdxB;\n    const weekKeyA = `${parsedA.block || '__'}::${parsedA.week || '__'}`;\n    const weekKeyB = `${parsedB.block || '__'}::${parsedB.week || '__'}`;\n    const weekIdxA = weekOrder.get(weekKeyA) ?? Number.MAX_SAFE_INTEGER;\n    const weekIdxB = weekOrder.get(weekKeyB) ?? Number.MAX_SAFE_INTEGER;\n    if (weekIdxA !== weekIdxB) return weekIdxA - weekIdxB;\n    const metricA = groupMetrics.get(a) || { totalInfluence: 0, totalWeight: 0, count: 0 };\n    const metricB = groupMetrics.get(b) || { totalInfluence: 0, totalWeight: 0, count: 0 };\n    const scoreA = metricA.totalInfluence + metricA.totalWeight;\n    const scoreB = metricB.totalInfluence + metricB.totalWeight;\n    if (Math.abs(scoreA - scoreB) > 0.0001) return scoreB - scoreA;\n    if (metricA.count !== metricB.count) return metricB.count - metricA.count;\n    return String(a).localeCompare(String(b));\n  });\n\n  const clusterOrigins = new Map();\n  groupOrder.forEach(key => {\n    const parsed = parseGroupKey(key);\n    const blockKey = parsed.block || '__';\n    const weekId = parsed.week || '__';\n    const lectureId = parsed.lecture || key;\n    const blockCenter = ensureBlockCenter(blockKey);\n    const weekCenter = ensureWeekCenter(blockKey, weekId, blockCenter);\n    const lectureCenter = ensureLectureCenter(blockKey, weekId, lectureId, weekCenter, key);\n    clusterOrigins.set(key, {\n      x: lectureCenter.x,\n      y: lectureCenter.y,\n      spacing: Math.max(lectureCenter.spacing, getGroupSpacing(key))\n    });\n  });\n\n  const heavyThreshold = (() => {\n    if (!weightValues.length) return 0;\n    const sorted = weightValues.slice().sort((a, b) => a - b);\n    const index = Math.max(0, Math.floor(sorted.length * 0.75) - 1);\n    return sorted[index];\n  })();\n\n  groupOrder.forEach(groupKey => {\n    const ids = groupNodes.get(groupKey) || [];\n    if (!ids.length) return;\n    const nodes = ids\n      .slice()\n      .sort((a, b) => {\n        const diffInfluence = (influence.get(b) || 0) - (influence.get(a) || 0);\n        if (Math.abs(diffInfluence) > 0.0001) return diffInfluence;\n        const diffWeight = (weights.get(b) || 0) - (weights.get(a) || 0);\n        if (Math.abs(diffWeight) > 0.0001) return diffWeight;\n        return String(a).localeCompare(String(b));\n      });\n\n    const origin = clusterOrigins.get(groupKey) || { x: center.x, y: center.y, spacing: getGroupSpacing(groupKey) };\n    const primaryId = nodes[0];\n    const primaryRadius = radii.get(primaryId) || typicalRadius;\n    const primaryPos = clampPosition({ x: origin.x, y: origin.y }, primaryRadius);\n    placements.set(primaryId, primaryPos);\n    ensureOrbitState(primaryId, {\n      baseDistance: origin.spacing * 0.48,\n      layerSpacing: origin.spacing * 0.36,\n      slotWeight: weights.get(primaryId) || 0\n    });\n\n    for (let index = 1; index < nodes.length; index += 1) {\n      const id = nodes[index];\n      const radius = radii.get(id) || typicalRadius;\n      const neighbors = adjacency.get(id) || [];\n      const placedNeighbors = neighbors.filter(n => placements.has(n));\n      let guess = null;\n\n      if (placedNeighbors.length >= 2) {\n        let sumX = 0;\n        let sumY = 0;\n        let totalWeight = 0;\n        const neighborGroups = new Set();\n        placedNeighbors.forEach(neighborId => {\n          const pos = placements.get(neighborId);\n          if (!pos) return;\n          const weight = Math.max(0.2, weights.get(neighborId) || 0);\n          sumX += pos.x * weight;\n          sumY += pos.y * weight;\n          totalWeight += weight;\n          neighborGroups.add(primaryGroupById.get(neighborId));\n        });\n        if (totalWeight > 0) {\n          guess = { x: sumX / totalWeight, y: sumY / totalWeight };\n          if (neighborGroups.size > 1) {\n            guess.x = (guess.x + origin.x) / 2;\n            guess.y = (guess.y + origin.y) / 2;\n          }\n        }\n      }\n\n      if (!guess && placedNeighbors.length === 1) {\n        const anchorId = placedNeighbors[0];\n        const anchorGroup = primaryGroupById.get(anchorId);\n        const anchorSpacing = clusterOrigins.get(anchorGroup || '')?.spacing || getGroupSpacing(anchorGroup || groupKey);\n        guess = nextOrbitPosition(anchorId, radius, {\n          groupSpacing: Math.max(anchorSpacing, origin.spacing),\n          slotWeight: weights.get(anchorId) || 0\n        });\n      }\n\n      if (!guess) {\n        guess = nextGroupPosition(groupKey, radius);\n      }\n\n      const position = resolveCollisions(id, guess, radius);\n      placements.set(id, position);\n      if ((adjacency.get(id) || []).length > 1) {\n        ensureOrbitState(id, {\n          baseDistance: origin.spacing * 0.5,\n          layerSpacing: origin.spacing * 0.4,\n          slotWeight: weights.get(id) || 0\n        });\n      }\n    }\n  });\n\n  const ids = Array.from(placements.keys());\n  for (let iter = 0; iter < 5; iter += 1) {\n    let changed = false;\n    for (let i = 0; i < ids.length; i += 1) {\n      for (let j = i + 1; j < ids.length; j += 1) {\n        const aId = ids[i];\n        const bId = ids[j];\n        const aPos = placements.get(aId);\n        const bPos = placements.get(bId);\n        if (!aPos || !bPos) continue;\n        const aRadius = radii.get(aId) || typicalRadius;\n        const bRadius = radii.get(bId) || typicalRadius;\n        let minDistance = aRadius + bRadius + margin;\n        const aWeight = weights.get(aId) || 0;\n        const bWeight = weights.get(bId) || 0;\n        const aGroup = primaryGroupById.get(aId);\n        const bGroup = primaryGroupById.get(bId);\n        if (aWeight >= heavyThreshold || bWeight >= heavyThreshold) {\n          minDistance += baseSpacing * 0.35;\n        }\n        if (aGroup && bGroup && aGroup !== bGroup) {\n          minDistance += baseSpacing * 0.25;\n        }\n        const dx = bPos.x - aPos.x;\n        const dy = bPos.y - aPos.y;\n        const dist = Math.hypot(dx, dy) || 0.0001;\n        if (dist < minDistance) {\n          const push = (minDistance - dist) / 2;\n          const nx = dx / dist;\n          const ny = dy / dist;\n          aPos.x -= nx * push;\n          aPos.y -= ny * push;\n          bPos.x += nx * push;\n          bPos.y += ny * push;\n          placements.set(aId, clampPosition(aPos, aRadius));\n          placements.set(bId, clampPosition(bPos, bRadius));\n          changed = true;\n        }\n      }\n    }\n    if (!changed) break;\n  }\n\n  for (let iter = 0; iter < 2; iter += 1) {\n    const updates = [];\n    ids.forEach(id => {\n      const weight = weights.get(id) || 0;\n      if (weight >= heavyThreshold) return;\n      const neighbors = adjacency.get(id) || [];\n      if (neighbors.length < 2) return;\n      const current = placements.get(id);\n      if (!current) return;\n      let sumX = 0;\n      let sumY = 0;\n      let totalWeight = 0;\n      neighbors.forEach(neighborId => {\n        const pos = placements.get(neighborId);\n        if (!pos) return;\n        const weightValue = Math.max(0.25, weights.get(neighborId) || 0);\n        sumX += pos.x * weightValue;\n        sumY += pos.y * weightValue;\n        totalWeight += weightValue;\n      });\n      if (!totalWeight) return;\n      const target = {\n        x: current.x + ((sumX / totalWeight) - current.x) * 0.32,\n        y: current.y + ((sumY / totalWeight) - current.y) * 0.32\n      };\n      updates.push([id, resolveCollisions(id, target)]);\n    });\n    updates.forEach(([id, pos]) => {\n      placements.set(id, pos);\n    });\n  }\n\n  let minX = Infinity;\n  let maxX = -Infinity;\n  let minY = Infinity;\n  let maxY = -Infinity;\n  placements.forEach(pos => {\n    if (!pos) return;\n    if (pos.x < minX) minX = pos.x;\n    if (pos.x > maxX) maxX = pos.x;\n    if (pos.y < minY) minY = pos.y;\n    if (pos.y > maxY) maxY = pos.y;\n  });\n  if (Number.isFinite(minX) && Number.isFinite(maxX) && Number.isFinite(minY) && Number.isFinite(maxY)) {\n    const offsetX = center.x - (minX + maxX) / 2;\n    const offsetY = center.y - (minY + maxY) / 2;\n    placements.forEach((pos, id) => {\n      if (!pos) return;\n      const adjusted = { x: pos.x + offsetX, y: pos.y + offsetY };\n      placements.set(id, clampPosition(adjusted, radii.get(id) || typicalRadius));\n    });\n  }\n\n  const layout = {};\n  placements.forEach((pos, id) => {\n    if (!pos) return;\n    layout[id] = { x: pos.x, y: pos.y };\n  });\n  return layout;\n}\n\nasync function smartReorganizeActiveMap() {\n  const items = Array.isArray(mapState.visibleItems) ? mapState.visibleItems : [];\n  if (!items.length) return {};\n  const model = refreshGravityModel() || mapState.gravityModel || buildGravityModel(items);\n  const layout = computeSmartLayout(model);\n  const ids = Object.keys(layout);\n  if (!ids.length) return {};\n  const tab = getActiveTab();\n  ids.forEach(id => {\n    mapState.positions[id] = layout[id];\n    scheduleNodePositionUpdate(id, layout[id], { immediate: true });\n  });\n  if (tab) {\n    const storedLayout = ensureTabLayout(tab);\n    ids.forEach(id => {\n      storedLayout[id] = { ...layout[id] };\n    });\n    tab.layoutSeeded = true;\n    await persistMapConfig();\n  }\n  flushQueuedEdgeUpdates({ force: true });\n  return layout;\n}\n\nasync function ensureMapConfig() {\n  if (mapState.mapConfigLoaded && mapState.mapConfig) {\n    return mapState.mapConfig;\n  }\n  const raw = await getMapConfig();\n  const normalized = normalizeMapConfig(raw);\n  mapState.mapConfig = normalized;\n  mapState.mapConfigLoaded = true;\n  if (JSON.stringify(raw) !== JSON.stringify(normalized)) {\n    await saveMapConfig(normalized);\n  }\n  return normalized;\n}\n\nasync function persistMapConfig() {\n  if (!mapState.mapConfig) return;\n  const snapshot = deepClone(mapState.mapConfig);\n  await saveMapConfig(snapshot);\n}\n\nfunction getActiveTab() {\n  const config = mapState.mapConfig;\n  if (!config) return null;\n  return config.tabs.find(tab => tab.id === config.activeTabId) || config.tabs[0] || null;\n}\n\nasync function setActiveTab(tabId) {\n  const config = mapState.mapConfig;\n  if (!config) return;\n  const tab = config.tabs.find(t => t.id === tabId);\n  if (!tab) return;\n  config.activeTabId = tab.id;\n  mapState.searchValue = '';\n  mapState.searchFeedback = null;\n  mapState.paletteSearch = '';\n  mapState.selectionIds = [];\n  mapState.previewSelection = null;\n  mapState.selectionPreviewSignature = '';\n  mapState.pendingLink = null;\n  await persistMapConfig();\n  await renderMap(mapState.root);\n}\n\nasync function createMapTab() {\n  const config = mapState.mapConfig || normalizeMapConfig(null);\n  const count = config.tabs.length + 1;\n  const tab = normalizeMapTab({\n    id: uid(),\n    name: `Map ${count}`,\n    includeLinked: true,\n    manualMode: false,\n    manualIds: [],\n    layoutSeeded: true,\n    filter: { blockId: '', weeks: [], lectureKeys: [] }\n  });\n  config.tabs.push(tab);\n  config.activeTabId = tab.id;\n  mapState.mapConfig = config;\n  mapState.searchValue = '';\n  mapState.searchFeedback = null;\n  await persistMapConfig();\n  await renderMap(mapState.root);\n}\n\nasync function deleteActiveTab() {\n  const config = mapState.mapConfig;\n  if (!config) return;\n  if (config.tabs.length <= 1) {\n    alert('At least one map tab is required.');\n    return;\n  }\n  const tab = getActiveTab();\n  if (!tab) return;\n  const confirmed = confirm(`Delete map \u201C${tab.name}\u201D?`);\n  if (!confirmed) return;\n  config.tabs = config.tabs.filter(t => t.id !== tab.id);\n  config.activeTabId = config.tabs[0]?.id || '';\n  mapState.searchValue = '';\n  mapState.searchFeedback = null;\n  await persistMapConfig();\n  await renderMap(mapState.root);\n}\n\nfunction updateSearchFeedback(message, type = '') {\n  if (message) {\n    mapState.searchFeedback = { message, type };\n  } else {\n    mapState.searchFeedback = null;\n  }\n  applyStoredSearchFeedback();\n}\n\nfunction applyStoredSearchFeedback() {\n  const el = mapState.searchFeedbackEl;\n  if (!el) return;\n  const info = mapState.searchFeedback;\n  if (info && info.message) {\n    el.textContent = info.message;\n    el.className = 'map-search-feedback' + (info.type ? ` ${info.type}` : '');\n  } else {\n    el.textContent = '';\n    el.className = 'map-search-feedback';\n  }\n}\n\nfunction updateSearchSuggestions(query) {\n  const container = mapState.searchSuggestionsEl;\n  if (!container) return;\n  if (mapState.searchSuggestionTimer) {\n    clearTimeout(mapState.searchSuggestionTimer);\n    mapState.searchSuggestionTimer = null;\n  }\n  container.innerHTML = '';\n  mapState.searchSuggestions = [];\n  mapState.searchActiveIndex = -1;\n  const field = mapState.searchFieldEl;\n  const trimmed = (query || '').trim();\n  if (!trimmed) {\n    container.classList.remove('visible');\n    if (field) field.classList.remove('has-suggestions');\n    return;\n  }\n  const lower = trimmed.toLowerCase();\n  const items = (mapState.visibleItems || [])\n    .map(item => ({ id: item.id, label: titleOf(item) || '' }))\n    .filter(entry => entry.label && entry.label.toLowerCase().includes(lower));\n  if (!items.length) {\n    container.classList.remove('visible');\n    if (field) field.classList.remove('has-suggestions');\n    return;\n  }\n  const seen = new Set();\n  const unique = [];\n  items.forEach(entry => {\n    if (!entry.id || seen.has(entry.id)) return;\n    seen.add(entry.id);\n    unique.push(entry);\n  });\n  unique.sort((a, b) => {\n    const aIndex = a.label.toLowerCase().indexOf(lower);\n    const bIndex = b.label.toLowerCase().indexOf(lower);\n    if (aIndex !== bIndex) return aIndex - bIndex;\n    return a.label.localeCompare(b.label);\n  });\n  const limited = unique.slice(0, 6);\n  if (!limited.length) {\n    container.classList.remove('visible');\n    if (field) field.classList.remove('has-suggestions');\n    return;\n  }\n  mapState.searchSuggestions = limited;\n  limited.forEach((entry, index) => {\n    const option = document.createElement('button');\n    option.type = 'button';\n    option.className = 'map-search-suggestion';\n    option.textContent = entry.label;\n    option.addEventListener('mousedown', evt => {\n      evt.preventDefault();\n    });\n    option.addEventListener('click', () => {\n      applySearchSuggestion(index);\n    });\n    container.appendChild(option);\n  });\n  container.classList.add('visible');\n  if (field) field.classList.add('has-suggestions');\n}\n\nfunction clearSearchSuggestions() {\n  const container = mapState.searchSuggestionsEl;\n  if (mapState.searchSuggestionTimer) {\n    clearTimeout(mapState.searchSuggestionTimer);\n    mapState.searchSuggestionTimer = null;\n  }\n  if (container) {\n    container.innerHTML = '';\n    container.classList.remove('visible');\n  }\n  mapState.searchSuggestions = [];\n  mapState.searchActiveIndex = -1;\n  const field = mapState.searchFieldEl;\n  if (field) {\n    field.classList.remove('has-suggestions');\n  }\n}\n\nfunction highlightSearchSuggestion(index) {\n  const container = mapState.searchSuggestionsEl;\n  if (!container) return;\n  const options = Array.from(container.querySelectorAll('.map-search-suggestion'));\n  if (!options.length) return;\n  const clamped = ((index % options.length) + options.length) % options.length;\n  options.forEach((option, i) => {\n    option.classList.toggle('active', i === clamped);\n    if (i === clamped) {\n      option.scrollIntoView({ block: 'nearest' });\n    }\n  });\n  mapState.searchActiveIndex = clamped;\n}\n\nfunction applySearchSuggestion(index) {\n  const suggestion = mapState.searchSuggestions?.[index];\n  if (!suggestion) return;\n  if (mapState.searchInput) {\n    mapState.searchInput.value = suggestion.label;\n    mapState.searchValue = suggestion.label;\n    mapState.searchInput.focus();\n  }\n  clearSearchSuggestions();\n  handleSearchSubmit(suggestion.label);\n}\n\nfunction setSearchInputState({ notFound = false } = {}) {\n  const input = mapState.searchInput;\n  if (input) {\n    input.classList.toggle('not-found', Boolean(notFound));\n  }\n  if (mapState.searchFieldEl) {\n    mapState.searchFieldEl.classList.toggle('not-found', Boolean(notFound));\n  }\n}\n\nfunction createMapTabsPanel(activeTab) {\n  const config = mapState.mapConfig || { tabs: [] };\n  const tabsWrap = document.createElement('div');\n  tabsWrap.className = 'map-tabs';\n\n  const header = document.createElement('div');\n  header.className = 'map-tabs-header';\n\n  const heading = document.createElement('div');\n  heading.className = 'map-tabs-heading';\n  const title = document.createElement('h2');\n  title.className = 'map-tabs-title';\n  title.textContent = 'Concept maps';\n  heading.appendChild(title);\n  const subtitle = document.createElement('p');\n  subtitle.className = 'map-tabs-subtitle';\n  subtitle.textContent = 'Jump between saved layouts or spin up a fresh canvas.';\n  heading.appendChild(subtitle);\n  header.appendChild(heading);\n\n  const actions = document.createElement('div');\n  actions.className = 'map-tab-actions';\n\n  const addBtn = document.createElement('button');\n  addBtn.type = 'button';\n  addBtn.className = 'map-pill-btn map-tab-add';\n  addBtn.setAttribute('aria-label', 'Create new map tab');\n  addBtn.innerHTML = `${ICONS.plus}<span>New map</span>`;\n  addBtn.addEventListener('click', () => {\n    createMapTab();\n  });\n  actions.appendChild(addBtn);\n\n  header.appendChild(actions);\n  tabsWrap.appendChild(header);\n\n  const tabList = document.createElement('div');\n  tabList.className = 'map-tab-list';\n  config.tabs.forEach(tab => {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'map-tab' + (activeTab && tab.id === activeTab.id ? ' active' : '');\n    btn.textContent = tab.name || 'Untitled map';\n    btn.addEventListener('click', () => {\n      if (!activeTab || tab.id !== activeTab.id) {\n        setActiveTab(tab.id);\n      }\n    });\n    tabList.appendChild(btn);\n  });\n  tabsWrap.appendChild(tabList);\n\n  return tabsWrap;\n}\n\nfunction createSearchOverlay() {\n  const searchWrap = document.createElement('div');\n  searchWrap.className = 'map-search-container map-search-overlay';\n\n  const form = document.createElement('form');\n  form.className = 'map-search';\n  form.addEventListener('submit', evt => {\n    evt.preventDefault();\n    handleSearchSubmit(input.value);\n  });\n\n  const field = document.createElement('div');\n  field.className = 'map-search-field';\n\n  const icon = document.createElement('span');\n  icon.className = 'map-search-icon';\n  icon.innerHTML = ICONS.search;\n  field.appendChild(icon);\n\n  const input = document.createElement('input');\n  input.type = 'search';\n  input.className = 'input map-search-input';\n  input.placeholder = 'Search concepts\u2026';\n  input.value = mapState.searchValue || '';\n  input.addEventListener('input', () => {\n    mapState.searchValue = input.value;\n    setSearchInputState({ notFound: false });\n    if (!input.value.trim()) {\n      updateSearchFeedback('', '');\n    }\n    updateSearchSuggestions(input.value);\n  });\n  input.addEventListener('focus', () => {\n    if (mapState.searchSuggestionTimer) {\n      clearTimeout(mapState.searchSuggestionTimer);\n      mapState.searchSuggestionTimer = null;\n    }\n    updateSearchSuggestions(input.value);\n  });\n  input.addEventListener('blur', () => {\n    if (mapState.searchSuggestionTimer) {\n      clearTimeout(mapState.searchSuggestionTimer);\n    }\n    mapState.searchSuggestionTimer = setTimeout(() => {\n      clearSearchSuggestions();\n    }, 120);\n  });\n  input.addEventListener('keydown', evt => {\n    if (!mapState.searchSuggestions || mapState.searchSuggestions.length === 0) return;\n    if (evt.key === 'ArrowDown') {\n      evt.preventDefault();\n      const next = (mapState.searchActiveIndex + 1) % mapState.searchSuggestions.length;\n      highlightSearchSuggestion(next);\n    } else if (evt.key === 'ArrowUp') {\n      evt.preventDefault();\n      const total = mapState.searchSuggestions.length;\n      const next = (mapState.searchActiveIndex - 1 + total) % total;\n      highlightSearchSuggestion(next);\n    } else if (evt.key === 'Enter') {\n      if (mapState.searchActiveIndex >= 0 && mapState.searchActiveIndex < mapState.searchSuggestions.length) {\n        evt.preventDefault();\n        applySearchSuggestion(mapState.searchActiveIndex);\n      }\n    } else if (evt.key === 'Escape') {\n      clearSearchSuggestions();\n    }\n  });\n  field.appendChild(input);\n\n  const submit = document.createElement('button');\n  submit.type = 'submit';\n  submit.className = 'map-search-submit';\n  submit.innerHTML = `${ICONS.arrowRight}<span class=\"sr-only\">Search</span>`;\n  field.appendChild(submit);\n\n  form.appendChild(field);\n\n  const suggestions = document.createElement('div');\n  suggestions.className = 'map-search-suggestions';\n  form.appendChild(suggestions);\n\n  searchWrap.appendChild(form);\n\n  const feedback = document.createElement('div');\n  feedback.className = 'map-search-feedback';\n  searchWrap.appendChild(feedback);\n\n  mapState.searchInput = input;\n  mapState.searchFieldEl = field;\n  mapState.searchFeedbackEl = feedback;\n  mapState.searchSuggestionsEl = suggestions;\n  mapState.searchSuggestions = [];\n  mapState.searchActiveIndex = -1;\n  applyStoredSearchFeedback();\n  updateSearchSuggestions(input.value);\n\n  return searchWrap;\n}\n\nfunction createMapControlsPanel(activeTab) {\n  const controls = document.createElement('div');\n  controls.className = 'map-controls';\n  if (!activeTab) {\n    return controls;\n  }\n\n  const titleRow = document.createElement('div');\n  titleRow.className = 'map-controls-row';\n\n  const nameLabel = document.createElement('label');\n  nameLabel.className = 'map-control map-control-name';\n  nameLabel.textContent = 'Map name';\n  const nameInput = document.createElement('input');\n  nameInput.className = 'input map-name-input';\n  nameInput.value = activeTab.name || '';\n  nameInput.addEventListener('change', async () => {\n    const next = nameInput.value.trim() || 'Untitled map';\n    if (next === activeTab.name) return;\n    activeTab.name = next;\n    await persistMapConfig();\n    await renderMap(mapState.root);\n  });\n  nameLabel.appendChild(nameInput);\n  titleRow.appendChild(nameLabel);\n\n  const deleteBtn = document.createElement('button');\n  deleteBtn.type = 'button';\n  deleteBtn.className = 'map-icon-btn danger map-delete-tab';\n  deleteBtn.setAttribute('aria-label', 'Delete map');\n  deleteBtn.innerHTML = `${ICONS.trash}<span class=\"sr-only\">Delete map</span>`;\n  if ((mapState.mapConfig?.tabs || []).length <= 1) {\n    deleteBtn.disabled = true;\n  }\n  deleteBtn.addEventListener('click', () => {\n    deleteActiveTab();\n  });\n  titleRow.appendChild(deleteBtn);\n\n  controls.appendChild(titleRow);\n\n  const toggleRow = document.createElement('div');\n  toggleRow.className = 'map-controls-row';\n\n  const manualToggle = document.createElement('label');\n  manualToggle.className = 'map-toggle';\n  const manualInput = document.createElement('input');\n  manualInput.type = 'checkbox';\n  manualInput.checked = Boolean(activeTab.manualMode);\n  manualInput.addEventListener('change', async () => {\n    activeTab.manualMode = manualInput.checked;\n    if (manualInput.checked) {\n      activeTab.filter.blockId = '';\n      setFilterWeeks(activeTab.filter, []);\n      setFilterLectureKeys(activeTab.filter, []);\n      activeTab.includeLinked = false;\n    } else {\n      activeTab.includeLinked = true;\n    }\n    await persistMapConfig();\n    await renderMap(mapState.root);\n  });\n  const manualSpan = document.createElement('span');\n  manualSpan.textContent = 'Manual mode';\n  manualToggle.appendChild(manualInput);\n  manualToggle.appendChild(manualSpan);\n  toggleRow.appendChild(manualToggle);\n\n  const linkedToggle = document.createElement('label');\n  linkedToggle.className = 'map-toggle';\n  const linkedInput = document.createElement('input');\n  linkedInput.type = 'checkbox';\n  linkedInput.checked = activeTab.manualMode ? false : activeTab.includeLinked !== false;\n  linkedInput.addEventListener('change', async () => {\n    activeTab.includeLinked = linkedInput.checked;\n    await persistMapConfig();\n    await renderMap(mapState.root);\n  });\n  const linkedSpan = document.createElement('span');\n  linkedSpan.textContent = 'Include linked concepts';\n  linkedToggle.appendChild(linkedInput);\n  linkedToggle.appendChild(linkedSpan);\n  toggleRow.appendChild(linkedToggle);\n\n  controls.appendChild(toggleRow);\n\n  const filterRow = document.createElement('div');\n  filterRow.className = 'map-controls-row';\n\n  const blockWrap = document.createElement('label');\n  blockWrap.className = 'map-control map-control-group';\n  const blockLabel = document.createElement('span');\n  blockLabel.className = 'map-control-label';\n  blockLabel.textContent = 'Block';\n  blockWrap.appendChild(blockLabel);\n  const blockSelect = document.createElement('select');\n  blockSelect.className = 'map-select';\n  const blocks = mapState.blocks || [];\n  const blockDefault = document.createElement('option');\n  blockDefault.value = '';\n  blockDefault.textContent = 'All blocks';\n  blockSelect.appendChild(blockDefault);\n  blocks.forEach(block => {\n    const opt = document.createElement('option');\n    opt.value = block.blockId;\n    opt.textContent = block.name || block.blockId;\n    blockSelect.appendChild(opt);\n  });\n  blockSelect.value = activeTab.filter.blockId || '';\n  blockSelect.disabled = Boolean(activeTab.manualMode);\n  blockSelect.addEventListener('change', async () => {\n    activeTab.filter.blockId = blockSelect.value;\n    setFilterWeeks(activeTab.filter, []);\n    setFilterLectureKeys(activeTab.filter, []);\n    await persistMapConfig();\n    await renderMap(mapState.root);\n  });\n  blockWrap.appendChild(blockSelect);\n  filterRow.appendChild(blockWrap);\n\n  const makeChip = ({ label, active = false, onToggle, disabled = false, title }) => {\n    const chip = document.createElement('button');\n    chip.type = 'button';\n    chip.className = 'map-chip' + (active ? ' active' : '');\n    chip.textContent = label;\n    chip.setAttribute('aria-pressed', active ? 'true' : 'false');\n    if (title) {\n      chip.title = title;\n    }\n    if (disabled) {\n      chip.disabled = true;\n      chip.classList.add('disabled');\n    } else if (typeof onToggle === 'function') {\n      chip.addEventListener('click', onToggle);\n    }\n    return chip;\n  };\n\n  const selectedWeeks = new Set(getFilterWeeks(activeTab.filter));\n  const selectedLectures = new Set(getFilterLectureKeys(activeTab.filter));\n  const weekBlock = blocks.find(b => b.blockId === blockSelect.value);\n  const filtersDisabled = Boolean(activeTab.manualMode);\n  const hasBlock = Boolean(blockSelect.value);\n\n  const weekWrap = document.createElement('div');\n  weekWrap.className = 'map-control map-control-group';\n  const weekLabel = document.createElement('div');\n  weekLabel.className = 'map-control-label';\n  weekLabel.textContent = 'Weeks';\n  weekWrap.appendChild(weekLabel);\n  const weekList = document.createElement('div');\n  weekList.className = 'map-chip-list';\n  weekWrap.appendChild(weekList);\n\n  const applyWeeks = async nextWeeks => {\n    setFilterWeeks(activeTab.filter, nextWeeks);\n    setFilterLectureKeys(activeTab.filter, []);\n    await persistMapConfig();\n    await renderMap(mapState.root);\n  };\n\n  if (!hasBlock || filtersDisabled) {\n    const message = document.createElement('div');\n    message.className = 'map-chip-empty';\n    message.textContent = filtersDisabled ? 'Disabled in manual mode.' : 'Choose a block to filter weeks.';\n    weekList.appendChild(message);\n  } else {\n    const weekNumbers = new Set();\n    if (weekBlock) {\n      if (Number(weekBlock.weeks)) {\n        for (let i = 1; i <= Number(weekBlock.weeks); i++) {\n          weekNumbers.add(i);\n        }\n      }\n      (weekBlock.lectures || []).forEach(lec => {\n        if (Number.isFinite(lec?.week)) {\n          weekNumbers.add(lec.week);\n        }\n      });\n    }\n    const sortedWeeks = Array.from(weekNumbers).sort((a, b) => a - b);\n    weekList.appendChild(\n      makeChip({\n        label: 'All weeks',\n        active: selectedWeeks.size === 0,\n        onToggle: () => applyWeeks([])\n      })\n    );\n    if (!sortedWeeks.length) {\n      const empty = document.createElement('div');\n      empty.className = 'map-chip-empty';\n      empty.textContent = 'No weeks found for this block.';\n      weekList.appendChild(empty);\n    } else {\n      sortedWeeks.forEach(num => {\n        weekList.appendChild(\n          makeChip({\n            label: `Week ${num}`,\n            active: selectedWeeks.has(num),\n            onToggle: () => {\n              const next = new Set(selectedWeeks);\n              if (next.has(num)) {\n                next.delete(num);\n              } else {\n                next.add(num);\n              }\n              applyWeeks(Array.from(next).sort((a, b) => a - b));\n            }\n          })\n        );\n      });\n    }\n  }\n  filterRow.appendChild(weekWrap);\n\n  const lectureWrap = document.createElement('div');\n  lectureWrap.className = 'map-control map-control-group';\n  const lectureLabel = document.createElement('div');\n  lectureLabel.className = 'map-control-label';\n  lectureLabel.textContent = 'Lectures';\n  lectureWrap.appendChild(lectureLabel);\n  const lectureList = document.createElement('div');\n  lectureList.className = 'map-chip-list';\n  lectureWrap.appendChild(lectureList);\n\n  const applyLectures = async nextKeys => {\n    setFilterLectureKeys(activeTab.filter, nextKeys);\n    await persistMapConfig();\n    await renderMap(mapState.root);\n  };\n\n  if (!hasBlock || filtersDisabled) {\n    const message = document.createElement('div');\n    message.className = 'map-chip-empty';\n    message.textContent = filtersDisabled ? 'Disabled in manual mode.' : 'Choose a block first.';\n    lectureList.appendChild(message);\n  } else {\n    const lectures = Array.isArray(weekBlock?.lectures) ? weekBlock.lectures : [];\n    const filteredLectures = lectures\n      .filter(lec => !selectedWeeks.size || selectedWeeks.has(Number(lec.week)))\n      .sort((a, b) => {\n        const weekA = Number(a.week) || 0;\n        const weekB = Number(b.week) || 0;\n        if (weekA !== weekB) return weekA - weekB;\n        const idA = Number(a.id) || 0;\n        const idB = Number(b.id) || 0;\n        return idA - idB;\n      });\n\n    lectureList.appendChild(\n      makeChip({\n        label: 'All lectures',\n        active: selectedLectures.size === 0,\n        onToggle: () => applyLectures([])\n      })\n    );\n\n    if (!filteredLectures.length) {\n      const empty = document.createElement('div');\n      empty.className = 'map-chip-empty';\n      empty.textContent = selectedWeeks.size\n        ? 'No lectures match the selected weeks.'\n        : 'No lectures found for this block.';\n      lectureList.appendChild(empty);\n    } else {\n      filteredLectures.forEach(lec => {\n        const keyParts = [`block:${weekBlock.blockId}`];\n        if (lec.id != null && lec.id !== '') {\n          keyParts.push(`id:${lec.id}`);\n        }\n        if (lec.name) {\n          keyParts.push(`name:${lec.name}`);\n        }\n        if (Number.isFinite(Number(lec.week))) {\n          keyParts.push(`week:${Number(lec.week)}`);\n        }\n        const key = keyParts.join('|');\n        const legacyKey = `${weekBlock.blockId}|${lec.id}`;\n        const isActive = selectedLectures.has(key) || selectedLectures.has(legacyKey);\n        const label = lec.name ? lec.name : `Lecture ${lec.id}`;\n        const weekLabel = Number.isFinite(lec.week) ? `Week ${lec.week}` : '';\n        lectureList.appendChild(\n          makeChip({\n            label: weekLabel ? `${label} \u00B7 ${weekLabel}` : label,\n            title: weekLabel ? `${label} (${weekLabel})` : label,\n            active: isActive,\n            onToggle: () => {\n              const next = new Set(selectedLectures);\n              next.delete(legacyKey);\n              if (isActive) {\n                next.delete(key);\n              } else {\n                next.add(key);\n              }\n              applyLectures(Array.from(next));\n            }\n          })\n        );\n      });\n    }\n  }\n  filterRow.appendChild(lectureWrap);\n\n  const resetBtn = document.createElement('button');\n  resetBtn.type = 'button';\n  resetBtn.className = 'btn map-reset-filters';\n  resetBtn.textContent = 'Clear filters';\n  resetBtn.disabled = Boolean(activeTab.manualMode);\n  resetBtn.addEventListener('click', async () => {\n    activeTab.filter.blockId = '';\n    setFilterWeeks(activeTab.filter, []);\n    setFilterLectureKeys(activeTab.filter, []);\n    await persistMapConfig();\n    await renderMap(mapState.root);\n  });\n  filterRow.appendChild(resetBtn);\n\n  controls.appendChild(filterRow);\n\n  const layoutRow = document.createElement('div');\n  layoutRow.className = 'map-controls-row map-controls-row--actions';\n  const reorganizeBtn = document.createElement('button');\n  reorganizeBtn.type = 'button';\n  reorganizeBtn.className = 'btn secondary map-reorganize-btn';\n  reorganizeBtn.textContent = 'Smart reorganize';\n  reorganizeBtn.addEventListener('click', async () => {\n    if (reorganizeBtn.dataset.state === 'busy') return;\n    const originalText = reorganizeBtn.textContent;\n    reorganizeBtn.dataset.state = 'busy';\n    reorganizeBtn.disabled = true;\n    reorganizeBtn.textContent = 'Organizing\u2026';\n    try {\n      await smartReorganizeActiveMap();\n    } catch (err) {\n      console.error(err);\n    } finally {\n      reorganizeBtn.disabled = false;\n      reorganizeBtn.textContent = originalText;\n      delete reorganizeBtn.dataset.state;\n    }\n  });\n  layoutRow.appendChild(reorganizeBtn);\n  controls.appendChild(layoutRow);\n\n  return controls;\n}\n\nfunction createMapPalettePanel(items, activeTab) {\n  if (!activeTab || !activeTab.manualMode) {\n    return null;\n  }\n  const palette = document.createElement('div');\n  palette.className = 'map-palette';\n\n  const title = document.createElement('h3');\n  title.textContent = 'Concept library';\n  palette.appendChild(title);\n\n  const description = document.createElement('p');\n  description.className = 'map-palette-hint';\n  description.textContent = 'Drag terms onto the canvas to add them to this map.';\n  palette.appendChild(description);\n\n  const searchInput = document.createElement('input');\n  searchInput.type = 'search';\n  searchInput.className = 'input map-palette-search';\n  searchInput.placeholder = 'Filter terms';\n  searchInput.value = mapState.paletteSearch || '';\n  palette.appendChild(searchInput);\n\n  const list = document.createElement('div');\n  list.className = 'map-palette-list';\n  palette.appendChild(list);\n\n  const manualSet = new Set(Array.isArray(activeTab.manualIds) ? activeTab.manualIds : []);\n  const itemMap = mapState.itemMap || {};\n\n  function renderList() {\n    list.innerHTML = '';\n    const query = searchInput.value.trim().toLowerCase();\n    const available = items\n      .filter(it => !manualSet.has(it.id))\n      .filter(it => !query || titleOf(it).toLowerCase().includes(query))\n      .sort((a, b) => titleOf(a).localeCompare(titleOf(b)));\n    if (!available.length) {\n      const empty = document.createElement('div');\n      empty.className = 'map-palette-empty';\n      empty.textContent = query ? 'No matching terms.' : 'All terms have been added.';\n      list.appendChild(empty);\n      return;\n    }\n    available.forEach(it => {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'map-palette-item';\n      btn.textContent = titleOf(it) || it.id;\n      btn.addEventListener('mousedown', evt => {\n        const sourceItem = itemMap[it.id] || it;\n        startMenuDrag(sourceItem, evt, { source: 'palette' });\n      });\n      list.appendChild(btn);\n    });\n  }\n\n  searchInput.addEventListener('input', () => {\n    mapState.paletteSearch = searchInput.value;\n    renderList();\n  });\n\n  renderList();\n\n  const activeWrap = document.createElement('div');\n  activeWrap.className = 'map-palette-active';\n  const activeTitle = document.createElement('h4');\n  activeTitle.textContent = `Active concepts (${manualSet.size})`;\n  activeWrap.appendChild(activeTitle);\n\n  const activeList = document.createElement('div');\n  activeList.className = 'map-palette-active-list';\n  if (!manualSet.size) {\n    const empty = document.createElement('div');\n    empty.className = 'map-palette-empty';\n    empty.textContent = 'No concepts yet. Drag from the library to begin.';\n    activeList.appendChild(empty);\n  } else {\n    activeTab.manualIds.forEach(id => {\n      const item = itemMap[id];\n      if (!item) return;\n      const row = document.createElement('div');\n      row.className = 'map-palette-active-item';\n      const label = document.createElement('span');\n      label.textContent = titleOf(item) || id;\n      row.appendChild(label);\n      const removeBtn = document.createElement('button');\n      removeBtn.type = 'button';\n      removeBtn.className = 'icon-btn ghost';\n      removeBtn.setAttribute('aria-label', `Remove ${titleOf(item) || 'item'} from this map`);\n      removeBtn.textContent = '\u2715';\n      removeBtn.addEventListener('click', async () => {\n        const tab = getActiveTab();\n        if (!tab) return;\n        tab.manualIds = (tab.manualIds || []).filter(mid => mid !== id);\n        await persistMapConfig();\n        await renderMap(mapState.root);\n      });\n      row.appendChild(removeBtn);\n      activeList.appendChild(row);\n    });\n  }\n  activeWrap.appendChild(activeList);\n  palette.appendChild(activeWrap);\n\n  return palette;\n}\n\nfunction handleSearchSubmit(rawQuery) {\n  clearSearchSuggestions();\n  const query = (rawQuery || '').trim();\n  if (!query) {\n    mapState.searchValue = '';\n    updateSearchFeedback('', '');\n    setSearchInputState({ notFound: false });\n    return;\n  }\n  mapState.searchValue = rawQuery;\n  const items = mapState.visibleItems || [];\n  const lower = query.toLowerCase();\n  let match = items.find(it => (titleOf(it) || '').toLowerCase() === lower);\n  if (!match) {\n    match = items.find(it => (titleOf(it) || '').toLowerCase().includes(lower));\n  }\n  if (!match) {\n    updateSearchFeedback('No matching concept on this map.', 'error');\n    setSearchInputState({ notFound: true });\n    return;\n  }\n  const success = centerOnNode(match.id);\n  if (success) {\n    updateSearchFeedback(`Centered on ${titleOf(match)}.`, 'success');\n    setSearchInputState({ notFound: false });\n  } else {\n    updateSearchFeedback('Could not focus on that concept.', 'error');\n    setSearchInputState({ notFound: true });\n  }\n}\n\nfunction centerOnNode(id, options = {}) {\n  if (!mapState.viewBox || !mapState.positions) return false;\n  const pos = mapState.positions[id];\n  if (!pos) return false;\n  const width = mapState.viewBox.w;\n  const height = mapState.viewBox.h;\n  const limit = mapState.sizeLimit || 0;\n  const maxX = Math.max(0, limit - width);\n  const maxY = Math.max(0, limit - height);\n  const nextX = clamp(pos.x - width / 2, 0, maxX);\n  const nextY = clamp(pos.y - height / 2, 0, maxY);\n  if (Number.isFinite(nextX)) mapState.viewBox.x = nextX;\n  if (Number.isFinite(nextY)) mapState.viewBox.y = nextY;\n  if (mapState.updateViewBox) {\n    mapState.updateViewBox({ immediate: true });\n  }\n  if (options.select !== false) {\n    mapState.selectionIds = [id];\n    updateSelectionHighlight();\n  }\n  return true;\n}\n\nfunction filterHasCriteria(filter = {}) {\n  if (!filter || typeof filter !== 'object') {\n    return false;\n  }\n  if (typeof filter.blockId === 'string' && filter.blockId.trim()) {\n    return true;\n  }\n  if (getFilterWeeks(filter).length) {\n    return true;\n  }\n  if (getFilterLectureKeys(filter).length) {\n    return true;\n  }\n  return false;\n}\n\nfunction matchesFilter(item, filter = {}) {\n  if (!filter) return true;\n  const normalizedBlock = typeof filter.blockId === 'string' ? filter.blockId.trim() : '';\n  const weekValues = getFilterWeeks(filter).map(week => Number(week)).filter(Number.isFinite);\n  const weekSet = new Set(weekValues);\n  const lectureKeys = getFilterLectureKeys(filter);\n  const lectureFilters = lectureKeys.map(key => parseLectureFilterKey(key, normalizedBlock));\n  const lectures = Array.isArray(item.lectures) ? item.lectures : [];\n  const blocks = Array.isArray(item.blocks) ? item.blocks : [];\n\n  if (normalizedBlock) {\n    const inBlock = blocks.includes(normalizedBlock) || lectures.some(lec => lec?.blockId === normalizedBlock);\n    if (!inBlock) return false;\n  }\n\n  if (weekSet.size) {\n    const satisfiesWeek = lectures.some(lec => {\n      if (!lec) return false;\n      if (normalizedBlock && lec.blockId !== normalizedBlock) return false;\n      const weekNumber = Number(lec.week);\n      return Number.isFinite(weekNumber) && weekSet.has(weekNumber);\n    }) || (Array.isArray(item.weeks) && item.weeks.some(week => weekSet.has(Number(week))));\n    if (!satisfiesWeek) return false;\n  }\n\n  if (lectureFilters.length) {\n    const satisfiesLecture = lectureFilters.some(spec => {\n      const blockMatch = (spec.block || normalizedBlock || '').trim();\n      const idMatch = (spec.id || '').trim().toLowerCase();\n      const nameMatch = (spec.name || '').trim().toLowerCase();\n      const weekMatch = Number.isFinite(Number(spec.week)) ? Number(spec.week) : null;\n      return lectures.some(lec => {\n        if (!lec) return false;\n        if (blockMatch && lec.blockId !== blockMatch) return false;\n        if (weekMatch !== null) {\n          const lecWeek = Number(lec.week);\n          if (!Number.isFinite(lecWeek) || lecWeek !== weekMatch) {\n            return false;\n          }\n        }\n        const values = new Set();\n        if (lec.id != null) {\n          const idValue = String(lec.id).trim().toLowerCase();\n          if (idValue) {\n            values.add(idValue);\n          }\n        }\n        if (lec.uid != null) {\n          const uidValue = String(lec.uid).trim().toLowerCase();\n          if (uidValue) {\n            values.add(uidValue);\n          }\n        }\n        if (lec.name) {\n          values.add(lec.name.trim().toLowerCase());\n        }\n        if (idMatch && values.has(idMatch)) return true;\n        if (nameMatch && values.has(nameMatch)) return true;\n        return !idMatch && !nameMatch;\n      });\n    });\n    if (!satisfiesLecture) return false;\n  }\n\n  return true;\n}\n\nfunction applyTabFilters(items, tab) {\n  if (!tab) {\n    return items.filter(it => !it.mapHidden);\n  }\n  const manualSet = new Set(Array.isArray(tab.manualIds) ? tab.manualIds : []);\n  let base;\n  if (tab.manualMode) {\n    base = items.filter(it => manualSet.has(it.id));\n  } else {\n    base = items.filter(it => !it.mapHidden && matchesFilter(it, tab.filter));\n  }\n  const allowed = new Set(base.map(it => it.id));\n  const filterActive = !tab.manualMode && filterHasCriteria(tab.filter);\n  if (tab.includeLinked !== false) {\n    const queue = [...allowed];\n    while (queue.length) {\n      const id = queue.pop();\n      const item = mapState.itemMap?.[id];\n      if (!item) continue;\n      (item.links || []).forEach(link => {\n        const other = mapState.itemMap?.[link.id];\n        if (!other) return;\n        if (other.mapHidden && !manualSet.has(other.id)) return;\n        if (!allowed.has(other.id) && (!filterActive || matchesFilter(other, tab.filter))) {\n          allowed.add(other.id);\n          queue.push(other.id);\n        }\n      });\n    }\n  }\n  return items.filter(it => {\n    if (!allowed.has(it.id)) return false;\n    if (tab.manualMode) {\n      if (manualSet.has(it.id)) return true;\n      return !it.mapHidden;\n    }\n    return !it.mapHidden || manualSet.has(it.id);\n  });\n}\n\nfunction openItemPopup(itemId) {\n  const item = mapState.itemMap?.[itemId];\n  if (!item) return;\n  showPopup(item, {\n    onEdit: () => openItemEditor(itemId),\n    onColorChange: color => updateItemColor(itemId, color),\n    onLink: () => openLinkAssistant(itemId),\n    onGravityChange: value => updateItemGravityBoost(itemId, value)\n  });\n}\n\nfunction openItemEditor(itemId) {\n  const item = mapState.itemMap?.[itemId];\n  if (!item) return;\n  openEditor(item.kind, async () => {\n    await renderMap(mapState.root);\n  }, item);\n}\n\nasync function updateItemColor(itemId, color) {\n  const item = await getItem(itemId);\n  if (!item) return;\n  const normalized = typeof color === 'string' && color ? color : '';\n  if (normalized) {\n    item.color = normalized;\n  } else if (item.color) {\n    delete item.color;\n  }\n  await upsertItem(item);\n  if (!mapState.itemMap) {\n    mapState.itemMap = {};\n  }\n  const cached = mapState.itemMap[itemId];\n  if (cached) {\n    if (normalized) {\n      cached.color = normalized;\n    } else {\n      delete cached.color;\n    }\n  }\n  if (Array.isArray(mapState.visibleItems)) {\n    const visible = mapState.visibleItems.find(it => it.id === itemId);\n    if (visible) {\n      if (normalized) {\n        visible.color = normalized;\n      } else {\n        delete visible.color;\n      }\n    }\n  }\n  refreshNodeColor(itemId);\n}\n\nasync function updateItemGravityBoost(itemId, boost) {\n  const item = await getItem(itemId);\n  if (!item) return 0;\n  const normalized = normalizeGravityBoost(boost);\n  item.mapGravityBoost = normalized;\n  await upsertItem(item);\n  integrateItemUpdates(item);\n  refreshGravityModel();\n  return normalized;\n}\n\nfunction parseLectureFilterKey(rawKey, fallbackBlock = '') {\n  const info = {\n    block: fallbackBlock || '',\n    id: '',\n    name: '',\n    week: ''\n  };\n  if (!rawKey) {\n    return info;\n  }\n  const parts = String(rawKey)\n    .split('|')\n    .map(part => part.trim())\n    .filter(Boolean);\n  parts.forEach((part, index) => {\n    if (part.startsWith('block:')) {\n      info.block = part.slice(6) || info.block;\n    } else if (part.startsWith('id:')) {\n      info.id = part.slice(3) || info.id;\n    } else if (part.startsWith('name:')) {\n      info.name = part.slice(5) || info.name;\n    } else if (part.startsWith('week:')) {\n      info.week = part.slice(5) || info.week;\n    } else if (index === 0 && !info.block) {\n      info.block = part;\n    } else if (!info.id) {\n      info.id = part;\n    }\n  });\n  return info;\n}\n\nfunction setAreaInteracting(active) {\n  if (!mapState.root) return;\n  mapState.root.classList.toggle('map-area-interacting', Boolean(active));\n}\n\nexport async function renderMap(root) {\n  if (mapState.root && mapState.root !== root) {\n    mapState.root.classList.remove('map-area-interacting');\n  }\n  mapState.root = root;\n  closeLineMenu();\n  await flushViewStatePersist();\n  const fragment = document.createDocumentFragment();\n  mapState.nodeDrag = null;\n  mapState.areaDrag = null;\n  mapState.draggingView = false;\n  mapState.menuDrag = null;\n  mapState.edgeDrag = null;\n  if (mapState.pendingEdgeUpdates) {\n    mapState.pendingEdgeUpdates.clear();\n  }\n  if (mapState.pendingEdgeAnimations) {\n    mapState.pendingEdgeAnimations.clear();\n  }\n  mapState.edgeUpdateFrame = null;\n  mapState.selectionRect = null;\n  mapState.previewSelection = null;\n  mapState.selectionPreviewSignature = '';\n  mapState.nodeWasDragged = false;\n  mapState.justCompletedSelection = false;\n  mapState.edgeDragJustCompleted = false;\n  mapState.viewPointerId = null;\n  mapState.searchInput = null;\n  mapState.searchFieldEl = null;\n  mapState.searchFeedbackEl = null;\n  mapState.searchSuggestions = [];\n  mapState.searchSuggestionsEl = null;\n  mapState.searchActiveIndex = -1;\n  if (mapState.searchSuggestionTimer) {\n    clearTimeout(mapState.searchSuggestionTimer);\n    mapState.searchSuggestionTimer = null;\n  }\n  stopToolboxDrag();\n  mapState.toolboxEl = null;\n  mapState.toolboxContainer = null;\n  mapState.toolboxBadges = null;\n  mapState.cursorOverride = null;\n  mapState.hoveredEdge = null;\n  mapState.hoveredEdgePointer = { x: 0, y: 0 };\n  if (mapState.lineMarkers) {\n    mapState.lineMarkers.clear();\n  } else {\n    mapState.lineMarkers = new Map();\n  }\n  if (mapState.edgeRefs) {\n    mapState.edgeRefs.clear();\n  } else {\n    mapState.edgeRefs = new Map();\n  }\n  if (mapState.allEdges) {\n    mapState.allEdges.clear();\n  } else {\n    mapState.allEdges = new Set();\n  }\n  stopAutoPan();\n  setAreaInteracting(false);\n  mapState.edgeLayer = null;\n  mapState.nodeLayer = null;\n  flushNodePositionUpdates({ cancelFrame: true });\n  if (mapState.pendingNodeUpdates) {\n    mapState.pendingNodeUpdates.clear();\n  }\n\n  ensureListeners();\n\n  await ensureMapConfig();\n  const catalog = await loadBlockCatalog();\n  mapState.blocks = (catalog.blocks || []).map(block => ({\n    ...block,\n    lectures: (catalog.lectureLists?.[block.blockId] || []).map(lecture => ({ ...lecture }))\n  }));\n\n  const items = [\n    ...(await listItemsByKind('disease')),\n    ...(await listItemsByKind('drug')),\n    ...(await listItemsByKind('concept'))\n  ];\n\n  const hiddenNodes = items.filter(it => it.mapHidden);\n\n  const itemMap = Object.fromEntries(items.map(it => [it.id, it]));\n  mapState.itemMap = itemMap;\n\n  const activeTab = getActiveTab();\n  const visibleItems = applyTabFilters(items, activeTab);\n  mapState.visibleItems = visibleItems;\n\n  const itemGroupCache = new Map();\n  visibleItems.forEach(it => {\n    itemGroupCache.set(it.id, deriveItemGroupKeys(it));\n  });\n\n  const base = 1000;\n  const size = Math.max(base, visibleItems.length * 150);\n  const viewport = base;\n  mapState.sizeLimit = size * 2;\n  mapState.minView = 100;\n\n  const wrapper = document.createElement('div');\n  wrapper.className = 'map-wrapper';\n  fragment.appendChild(wrapper);\n\n  const stage = document.createElement('div');\n  stage.className = 'map-stage';\n  wrapper.appendChild(stage);\n\n  const container = document.createElement('div');\n  container.className = 'map-container';\n  stage.appendChild(container);\n  mapState.container = container;\n  container.addEventListener('pointerdown', e => {\n    if (mapState.tool === TOOL.AREA) return;\n    if (e.button !== 0) return;\n    if (e.target !== container) return;\n    closeLineMenu();\n    if (beginViewDrag(e)) {\n      e.preventDefault();\n    }\n  });\n\n  const overlay = document.createElement('div');\n  overlay.className = 'map-overlay';\n  stage.appendChild(overlay);\n\n  const menu = document.createElement('div');\n  menu.className = 'map-menu';\n  overlay.appendChild(menu);\n\n  const toggle = document.createElement('button');\n  toggle.type = 'button';\n  toggle.className = 'map-menu-toggle';\n  toggle.setAttribute('aria-haspopup', 'true');\n  toggle.setAttribute('aria-expanded', 'false');\n  toggle.setAttribute('aria-label', 'Open map controls');\n  toggle.innerHTML = `<span class=\"map-menu-icon\" aria-hidden=\"true\">${ICONS.sliders}</span><span class=\"sr-only\">Open map controls</span>`;\n  menu.appendChild(toggle);\n\n  const panel = document.createElement('div');\n  panel.className = 'map-menu-panel';\n  panel.setAttribute('aria-label', 'Map controls');\n  menu.appendChild(panel);\n\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'map-menu-close';\n  closeBtn.setAttribute('aria-label', 'Hide map controls');\n  closeBtn.innerHTML = `<span class=\"sr-only\">Hide map controls</span>${ICONS.close}`;\n  const panelHeader = document.createElement('div');\n  panelHeader.className = 'map-menu-header';\n  const panelTitle = document.createElement('div');\n  panelTitle.className = 'map-menu-title';\n  panelTitle.textContent = 'Map controls';\n  panelHeader.appendChild(panelTitle);\n  panelHeader.appendChild(closeBtn);\n  panel.appendChild(panelHeader);\n\n  const tabsPanel = createMapTabsPanel(activeTab);\n  panel.appendChild(tabsPanel);\n\n  const controlsPanel = createMapControlsPanel(activeTab);\n  if (controlsPanel) {\n    panel.appendChild(controlsPanel);\n  }\n\n  const palettePanel = createMapPalettePanel(items, activeTab);\n  if (palettePanel) {\n    panel.appendChild(palettePanel);\n  }\n\n  const searchOverlay = createSearchOverlay();\n  overlay.appendChild(searchOverlay);\n\n  let menuHoverOpen = Boolean(mapState.menuPinned) || Boolean(mapState.menuOpen);\n  let menuHoverCloseTimer = null;\n\n  const clearMenuHoverClose = () => {\n    if (menuHoverCloseTimer !== null) {\n      clearTimeout(menuHoverCloseTimer);\n      menuHoverCloseTimer = null;\n    }\n  };\n\n  const applyMenuState = () => {\n    const open = Boolean(mapState.menuPinned) || menuHoverOpen;\n    mapState.menuOpen = open;\n    menu.classList.toggle('open', open);\n    menu.classList.toggle('pinned', Boolean(mapState.menuPinned));\n    toggle.setAttribute('aria-expanded', open ? 'true' : 'false');\n    toggle.setAttribute('aria-pressed', mapState.menuPinned ? 'true' : 'false');\n    toggle.setAttribute('aria-label', open ? 'Hide map controls' : 'Open map controls');\n  };\n\n  const openMenu = ({ pinned = false } = {}) => {\n    if (pinned) {\n      mapState.menuPinned = true;\n    }\n    menuHoverOpen = true;\n    mapState.menuOpen = true;\n    clearMenuHoverClose();\n    applyMenuState();\n  };\n\n  const closeMenu = ({ unpin = false } = {}) => {\n    if (unpin) {\n      mapState.menuPinned = false;\n    }\n    menuHoverOpen = false;\n    if (!mapState.menuPinned) {\n      mapState.menuOpen = false;\n    }\n    clearMenuHoverClose();\n    applyMenuState();\n  };\n\n  const scheduleMenuClose = () => {\n    if (mapState.menuPinned) {\n      return;\n    }\n    clearMenuHoverClose();\n    menuHoverCloseTimer = setTimeout(() => {\n      menuHoverCloseTimer = null;\n      closeMenu();\n    }, 140);\n  };\n\n  applyMenuState();\n\n  toggle.addEventListener('click', evt => {\n    evt.preventDefault();\n    if (mapState.menuPinned) {\n      closeMenu({ unpin: true });\n    } else {\n      openMenu({ pinned: true });\n    }\n  });\n\n\n  const handleHoverOpen = () => openMenu();\n\n  menu.addEventListener('mouseenter', handleHoverOpen);\n  toggle.addEventListener('mouseenter', handleHoverOpen);\n  panel.addEventListener('mouseenter', handleHoverOpen);\n  toggle.addEventListener('focusin', handleHoverOpen);\n  panel.addEventListener('focusin', handleHoverOpen);\n\n  menu.addEventListener('mouseleave', scheduleMenuClose);\n  menu.addEventListener('focusout', evt => {\n    if (!menu.contains(evt.relatedTarget) && !mapState.menuPinned) {\n\n      closeMenu();\n    }\n  });\n\n\n  closeBtn.addEventListener('click', () => {\n    closeMenu({ unpin: true });\n  });\n\n\n  const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');\n  svg.classList.add('map-svg');\n  const defaultView = {\n    x: (size - viewport) / 2,\n    y: (size - viewport) / 2,\n    w: viewport,\n    h: viewport\n  };\n  const minSize = mapState.minView || defaultView.w;\n  const maxSize = mapState.sizeLimit || defaultView.w;\n  const storedView = getRestorableViewState(activeTab);\n  let viewBox;\n  let restoredFromMemory = false;\n  let pendingFocusId = null;\n  if (mapState.viewBox) {\n    const current = mapState.viewBox;\n    const cx = Number.isFinite(current.x) && Number.isFinite(current.w) ? current.x + current.w / 2 : defaultView.x + defaultView.w / 2;\n    const cy = Number.isFinite(current.y) && Number.isFinite(current.h) ? current.y + current.h / 2 : defaultView.y + defaultView.h / 2;\n    const desiredSize = Number.isFinite(current.w) ? current.w : defaultView.w;\n    const clamped = clamp(desiredSize, minSize, maxSize);\n    viewBox = {\n      x: cx - clamped / 2,\n      y: cy - clamped / 2,\n      w: clamped,\n      h: clamped\n    };\n    restoredFromMemory = true;\n  } else if (storedView) {\n    const desiredSize = Number.isFinite(storedView.w) ? storedView.w : defaultView.w;\n    const clamped = clamp(desiredSize, minSize, maxSize);\n    const limit = Math.max(mapState.sizeLimit || 0, clamped);\n    const maxX = limit - clamped;\n    const maxY = limit - clamped;\n    const sx = Number.isFinite(storedView.x) ? storedView.x : defaultView.x;\n    const sy = Number.isFinite(storedView.y) ? storedView.y : defaultView.y;\n    viewBox = {\n      x: clamp(sx, 0, maxX),\n      y: clamp(sy, 0, maxY),\n      w: clamped,\n      h: clamped\n    };\n    restoredFromMemory = true;\n  } else {\n    viewBox = { ...defaultView };\n    const newest = findNewestVisibleNode(visibleItems);\n    if (newest) {\n      pendingFocusId = newest.id;\n    }\n  }\n\n  mapState.pendingFocusId = pendingFocusId;\n  mapState.restoredViewFromMemory = restoredFromMemory;\n\n  mapState.svg = svg;\n  mapState.viewBox = viewBox;\n  if (!Number.isFinite(mapState.defaultViewSize)) {\n    mapState.defaultViewSize = viewBox.w;\n  }\n\n  const commitViewBox = (options = {}) => {\n    svg.setAttribute('viewBox', `${viewBox.x} ${viewBox.y} ${viewBox.w} ${viewBox.h}`);\n    const { forceScale = false } = options;\n    if (forceScale) {\n      mapState.lastScaleSize = { w: viewBox.w, h: viewBox.h };\n      adjustScale();\n      rememberViewBox();\n      return;\n    }\n    const prev = mapState.lastScaleSize;\n    const sizeChanged =\n      !prev || Math.abs(prev.w - viewBox.w) > 0.5 || Math.abs(prev.h - viewBox.h) > 0.5;\n    if (sizeChanged) {\n      mapState.lastScaleSize = { w: viewBox.w, h: viewBox.h };\n      adjustScale();\n    }\n    rememberViewBox();\n  };\n\n  const updateViewBox = (options = {}) => {\n    const pending = {\n      ...(mapState.pendingViewBoxOptions || {}),\n      forceScale: Boolean(options.forceScale) || Boolean(mapState.pendingViewBoxOptions?.forceScale)\n    };\n    mapState.pendingViewBoxOptions = pending;\n    const immediate = Boolean(options.immediate) || typeof window === 'undefined';\n    if (immediate) {\n      if (mapState.viewBoxFrame && typeof window !== 'undefined' && typeof window.cancelAnimationFrame === 'function') {\n        window.cancelAnimationFrame(mapState.viewBoxFrame);\n      }\n      mapState.viewBoxFrame = null;\n      const commitOptions = mapState.pendingViewBoxOptions;\n      mapState.pendingViewBoxOptions = null;\n      commitViewBox(commitOptions || {});\n      return;\n    }\n    if (mapState.viewBoxFrame) {\n      return;\n    }\n    if (typeof window === 'undefined' || typeof window.requestAnimationFrame !== 'function') {\n      const commitOptions = mapState.pendingViewBoxOptions;\n      mapState.pendingViewBoxOptions = null;\n      commitViewBox(commitOptions || {});\n      return;\n    }\n    mapState.viewBoxFrame = window.requestAnimationFrame(() => {\n      const commitOptions = mapState.pendingViewBoxOptions;\n      mapState.pendingViewBoxOptions = null;\n      mapState.viewBoxFrame = null;\n      commitViewBox(commitOptions || {});\n    });\n  };\n\n  mapState.updateViewBox = updateViewBox;\n\n  const g = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  const edgeLayer = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  edgeLayer.classList.add('map-layer', 'map-layer--edges');\n  const nodeLayer = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n  nodeLayer.classList.add('map-layer', 'map-layer--nodes');\n  const defs = document.createElementNS('http://www.w3.org/2000/svg', 'defs');\n  buildLineMarkers(defs);\n  g.appendChild(edgeLayer);\n  g.appendChild(nodeLayer);\n  svg.appendChild(defs);\n  svg.appendChild(g);\n  mapState.g = g;\n  mapState.edgeLayer = edgeLayer;\n  mapState.nodeLayer = nodeLayer;\n\n  container.appendChild(svg);\n\n  const tooltip = document.createElement('div');\n  tooltip.className = 'map-edge-tooltip hidden';\n  container.appendChild(tooltip);\n  mapState.edgeTooltip = tooltip;\n\n  const selectionBox = document.createElement('div');\n  selectionBox.className = 'map-selection hidden';\n  container.appendChild(selectionBox);\n  mapState.selectionBox = selectionBox;\n\n  attachSvgEvents(svg);\n\n  const positions = {};\n  mapState.positions = positions;\n  mapState.elements = new Map();\n\n  const gravityModel = buildGravityModel(visibleItems);\n  mapState.gravityModel = gravityModel;\n  const nodeRadii = computeRadiiFromModel(gravityModel, visibleItems);\n  mapState.nodeRadii = nodeRadii;\n\n  let totalRadius = 0;\n  let radiusCount = 0;\n  let maxRadius = MIN_NODE_RADIUS;\n  visibleItems.forEach(it => {\n    const radius = nodeRadii.get(it.id) || MIN_NODE_RADIUS;\n    if (!Number.isFinite(radius)) return;\n    totalRadius += radius;\n    radiusCount += 1;\n    if (radius > maxRadius) {\n      maxRadius = radius;\n    }\n  });\n  const avgRadius = radiusCount ? totalRadius / radiusCount : MIN_NODE_RADIUS;\n  const typicalRadius = Math.max(avgRadius, maxRadius * 0.75, MIN_NODE_RADIUS);\n  const nodeLength = Math.max(70, typicalRadius * 2.0);\n  const groupSpacingBase = Math.max(nodeLength * 1.05, maxRadius * 2.2 + 30);\n  const lectureSpacingBase = Math.max(nodeLength * 2.5, maxRadius * 3.6);\n  const weekSpacingBase = Math.max(lectureSpacingBase * 1.18, nodeLength * 3.8);\n  const blockSpacingBase = Math.max(weekSpacingBase * 1.22, nodeLength * 5.0);\n\n  const groupMetrics = new Map();\n  const groupSpacingCache = new Map();\n  function touchGroupMetric(key, radius, bucket) {\n    if (!key) return;\n    const metric = groupMetrics.get(key) || {\n      existingCount: 0,\n      pendingCount: 0,\n      sumRadius: 0,\n      maxRadius: 0\n    };\n    if (bucket === 'existing') {\n      metric.existingCount += 1;\n    } else if (bucket === 'pending') {\n      metric.pendingCount += 1;\n    }\n    metric.sumRadius += radius;\n    if (radius > metric.maxRadius) {\n      metric.maxRadius = radius;\n    }\n    groupMetrics.set(key, metric);\n  }\n  function getGroupSpacing(key) {\n    if (groupSpacingCache.has(key)) {\n      return groupSpacingCache.get(key);\n    }\n    const metric = groupMetrics.get(key) || {\n      existingCount: 0,\n      pendingCount: 0,\n      sumRadius: 0,\n      maxRadius: 0\n    };\n    const totalCount = (metric.existingCount || 0) + (metric.pendingCount || 0);\n    const maxR = metric.maxRadius || typicalRadius;\n    const avgR = totalCount ? metric.sumRadius / totalCount : typicalRadius;\n    const spacing = Math.max(groupSpacingBase, avgR * 2.0 + 20, maxR * 2.4 + 32);\n    groupSpacingCache.set(key, spacing);\n    return spacing;\n  }\n\n  const center = size / 2;\n  const newItems = [];\n  const layout = activeTab ? ensureTabLayout(activeTab) : null;\n  const allowLegacyPositions = Boolean(activeTab && activeTab.layoutSeeded !== true);\n  let layoutDirty = false;\n  let legacyImported = false;\n\n  visibleItems.forEach(it => {\n    if (layout && layout[it.id]) {\n      positions[it.id] = { ...layout[it.id] };\n      return;\n    }\n    const legacy = it.mapPos;\n    if (\n      allowLegacyPositions &&\n      legacy &&\n      typeof legacy === 'object' &&\n      Number.isFinite(Number(legacy.x)) &&\n      Number.isFinite(Number(legacy.y))\n    ) {\n      const x = Number(legacy.x);\n      const y = Number(legacy.y);\n      positions[it.id] = { x, y };\n      if (layout) {\n        layout[it.id] = { x, y };\n        layoutDirty = true;\n        legacyImported = true;\n      }\n      return;\n    }\n    const groups = itemGroupCache.get(it.id) || deriveItemGroupKeys(it);\n    const primaryGroup = getPrimaryGroupKey(it, groups);\n    const weight = gravityModel.weights?.get(it.id) || 0;\n    newItems.push({ item: it, primaryGroup, degree: weight });\n  });\n\n  const existingGroupInfo = new Map();\n  Object.entries(positions).forEach(([id, pos]) => {\n    if (!pos) return;\n    const groups = itemGroupCache.get(id) || [];\n    const radius = nodeRadii.get(id) || MIN_NODE_RADIUS;\n    groups.forEach(key => {\n      const info = existingGroupInfo.get(key) || {\n        minX: pos.x,\n        maxX: pos.x,\n        minY: pos.y,\n        maxY: pos.y,\n        count: 0,\n        maxRadius: radius,\n        sumRadius: 0\n      };\n      info.count += 1;\n      info.minX = Math.min(info.minX, pos.x);\n      info.maxX = Math.max(info.maxX, pos.x);\n      info.minY = Math.min(info.minY, pos.y);\n      info.maxY = Math.max(info.maxY, pos.y);\n      info.maxRadius = Math.max(info.maxRadius ?? radius, radius);\n      info.sumRadius = (info.sumRadius || 0) + radius;\n      existingGroupInfo.set(key, info);\n      touchGroupMetric(key, radius, 'existing');\n    });\n  });\n\n  const pendingCounts = new Map();\n  newItems.forEach(entry => {\n    pendingCounts.set(entry.primaryGroup, (pendingCounts.get(entry.primaryGroup) || 0) + 1);\n    const radius = nodeRadii.get(entry.item.id) || MIN_NODE_RADIUS;\n    touchGroupMetric(entry.primaryGroup, radius, 'pending');\n  });\n\n  const clusterOrigins = new Map();\n  const seenGroups = new Set();\n  const newGroupOrder = [];\n  newItems.forEach(entry => {\n    const key = entry.primaryGroup;\n    if (existingGroupInfo.has(key)) return;\n    if (seenGroups.has(key)) return;\n    seenGroups.add(key);\n    newGroupOrder.push(key);\n  });\n\n  const blockAggregates = new Map();\n  const weekAggregates = new Map();\n  const lecturesByWeek = new Map();\n  const lectureCenters = new Map();\n  existingGroupInfo.forEach((info, key) => {\n    const parsed = parseGroupKey(key);\n    const blockKey = parsed.block || '__';\n    const weekId = parsed.week || '__';\n    const weekKey = `${blockKey}::${weekId}`;\n    const centerX = (info.minX + info.maxX) / 2;\n    const centerY = (info.minY + info.maxY) / 2;\n    const blockAgg = blockAggregates.get(blockKey) || { x: 0, y: 0, count: 0 };\n    blockAgg.x += centerX;\n    blockAgg.y += centerY;\n    blockAgg.count += 1;\n    blockAggregates.set(blockKey, blockAgg);\n    const weekAgg = weekAggregates.get(weekKey) || { x: 0, y: 0, count: 0 };\n    weekAgg.x += centerX;\n    weekAgg.y += centerY;\n    weekAgg.count += 1;\n    weekAggregates.set(weekKey, weekAgg);\n    const lectureList = lecturesByWeek.get(weekKey) || [];\n    lectureList.push({ x: centerX, y: centerY, spacing: lectureSpacingBase });\n    lecturesByWeek.set(weekKey, lectureList);\n    const lectureKey = `${weekKey}::${parsed.lecture || key}`;\n    if (!lectureCenters.has(lectureKey)) {\n      lectureCenters.set(lectureKey, { x: centerX, y: centerY, spacing: getGroupSpacing(key) });\n    }\n  });\n\n  const blockCenters = new Map();\n  const blockPositionList = [];\n  blockAggregates.forEach((agg, blockKey) => {\n    if (!agg.count) return;\n    const point = {\n      x: agg.x / agg.count,\n      y: agg.y / agg.count,\n      spacing: blockSpacingBase,\n      buffer: blockSpacingBase\n    };\n    blockCenters.set(blockKey, point);\n    blockPositionList.push(point);\n  });\n\n  const weekCenters = new Map();\n  const weekPositionsByBlock = new Map();\n  weekAggregates.forEach((agg, weekKey) => {\n    if (!agg.count) return;\n    const point = {\n      x: agg.x / agg.count,\n      y: agg.y / agg.count,\n      spacing: weekSpacingBase,\n      buffer: weekSpacingBase\n    };\n    weekCenters.set(weekKey, point);\n    const [blockKey] = weekKey.split('::');\n    const list = weekPositionsByBlock.get(blockKey) || [];\n    list.push(point);\n    weekPositionsByBlock.set(blockKey, list);\n  });\n\n  const BLOCK_SPACING = blockSpacingBase;\n  const WEEK_SPACING = weekSpacingBase;\n  const LECTURE_SPACING = lectureSpacingBase;\n\n  function ensureBlockCenter(blockKey) {\n    if (blockCenters.has(blockKey)) return blockCenters.get(blockKey);\n    const base = { x: center, y: center };\n    const candidate = pickClusterPosition(blockPositionList, BLOCK_SPACING, base, {\n      buffer: BLOCK_SPACING * 0.3\n    });\n    const enriched = {\n      x: candidate.x,\n      y: candidate.y,\n      spacing: BLOCK_SPACING,\n      buffer: BLOCK_SPACING\n    };\n    blockCenters.set(blockKey, enriched);\n    blockPositionList.push(enriched);\n    return enriched;\n  }\n\n  function ensureWeekCenter(blockKey, weekId, blockCenter) {\n    const weekKey = `${blockKey}::${weekId}`;\n    if (weekCenters.has(weekKey)) return weekCenters.get(weekKey);\n    const existing = weekPositionsByBlock.get(blockKey) || [];\n    const candidate = pickClusterPosition(existing, WEEK_SPACING, blockCenter, {\n      buffer: WEEK_SPACING * 0.25\n    });\n    const enriched = {\n      x: candidate.x,\n      y: candidate.y,\n      spacing: WEEK_SPACING,\n      buffer: WEEK_SPACING\n    };\n    weekCenters.set(weekKey, enriched);\n    existing.push(enriched);\n    weekPositionsByBlock.set(blockKey, existing);\n    return enriched;\n  }\n\n  function ensureLectureCenter(blockKey, weekId, lectureId, weekCenter) {\n    const weekKey = `${blockKey}::${weekId}`;\n    const lectureKey = `${weekKey}::${lectureId}`;\n    if (lectureCenters.has(lectureKey)) return lectureCenters.get(lectureKey);\n    const existing = lecturesByWeek.get(weekKey) || [];\n    const spacing = Math.max(LECTURE_SPACING, getGroupSpacing(lectureKey));\n    const candidate = pickClusterPosition(existing, spacing, weekCenter, {\n      buffer: spacing * 0.25\n    });\n    const enriched = {\n      x: candidate.x,\n      y: candidate.y,\n      spacing,\n      buffer: spacing\n    };\n    lectureCenters.set(lectureKey, enriched);\n    existing.push(enriched);\n    lecturesByWeek.set(weekKey, existing);\n    return enriched;\n  }\n\n  newGroupOrder.forEach(key => {\n    const parsed = parseGroupKey(key);\n    const blockKey = parsed.block || '__';\n    const weekId = parsed.week || '__';\n    const lectureId = parsed.lecture || key;\n    const blockCenter = ensureBlockCenter(blockKey);\n    const weekCenter = ensureWeekCenter(blockKey, weekId, blockCenter);\n    const lectureCenter = ensureLectureCenter(blockKey, weekId, lectureId, weekCenter);\n    clusterOrigins.set(key, {\n      x: lectureCenter.x,\n      y: lectureCenter.y,\n      spacing: Math.max(getGroupSpacing(key), lectureCenter.spacing || 0)\n    });\n  });\n\n  const groupPlacement = new Map();\n\n  function ensureGroupPlacement(key) {\n    if (groupPlacement.has(key)) {\n      return groupPlacement.get(key);\n    }\n    const existing = existingGroupInfo.get(key);\n    const pending = pendingCounts.get(key) || 0;\n    const total = (existing?.count || 0) + pending;\n    const columns = Math.max(2, Math.ceil(Math.sqrt(Math.max(total, 1))));\n    const rows = Math.max(1, Math.ceil(Math.max(total, 1) / columns));\n    const originSource = clusterOrigins.get(key);\n    const origin = existing\n      ? {\n          x: (existing.minX + existing.maxX) / 2,\n          y: (existing.minY + existing.maxY) / 2\n        }\n      : originSource\n        ? { x: originSource.x, y: originSource.y }\n        : { x: center, y: center };\n    let spacing = Math.max(getGroupSpacing(key), originSource?.spacing || 0);\n    if (existing?.count > 1) {\n      const spread = Math.max(existing.maxX - existing.minX, existing.maxY - existing.minY);\n      const averageRadius = (existing.sumRadius || 0) / Math.max(existing.count, 1);\n      spacing = Math.max(\n        spacing,\n        spread / Math.max(1, existing.count - 1) + Math.max(averageRadius * 1.8, typicalRadius * 1.6)\n      );\n    } else if (existing?.count === 1) {\n      spacing = Math.max(spacing, (existing.maxRadius || typicalRadius) * 2.6);\n    } else {\n      spacing = Math.max(spacing, groupSpacingBase);\n    }\n    const info = { origin, columns, rows, spacing, index: existing?.count || 0 };\n    groupPlacement.set(key, info);\n    return info;\n  }\n\n  function allocateGroupPosition(key, entry) {\n    const info = ensureGroupPlacement(key);\n    const itemRadius = entry ? (nodeRadii.get(entry.item.id) || typicalRadius) : typicalRadius;\n    const maxAttempts = 400;\n    for (let offset = 0; offset < maxAttempts; offset += 1) {\n      const idx = info.index + offset;\n      const col = idx % info.columns;\n      const row = Math.floor(idx / info.columns);\n      const neededRows = Math.max(info.rows, row + 1);\n      const colCenter = (info.columns - 1) / 2;\n      const rowCenter = (neededRows - 1) / 2;\n      const x = info.origin.x + (col - colCenter) * info.spacing;\n      const y = info.origin.y + (row - rowCenter) * info.spacing;\n      let collision = false;\n      for (const existingId in positions) {\n        const other = positions[existingId];\n        if (!other) continue;\n        const otherRadius = nodeRadii.get(existingId) || typicalRadius;\n        const minDistance = itemRadius + otherRadius + Math.max(30, info.spacing * 0.35);\n        if (Math.hypot(other.x - x, other.y - y) < minDistance) {\n          collision = true;\n          break;\n        }\n      }\n      if (!collision) {\n        info.index = idx + 1;\n        info.rows = Math.max(info.rows, neededRows);\n        groupPlacement.set(key, info);\n        return { x, y };\n      }\n    }\n    info.index += maxAttempts;\n    groupPlacement.set(key, info);\n    return {\n      x: info.origin.x + (Math.random() - 0.5) * info.spacing,\n      y: info.origin.y + (Math.random() - 0.5) * info.spacing\n    };\n  }\n\n  newItems.sort((a, b) => b.degree - a.degree);\n  newItems.forEach(entry => {\n    const pos = allocateGroupPosition(entry.primaryGroup, entry);\n    positions[entry.item.id] = pos;\n    if (layout) {\n      layout[entry.item.id] = { ...pos };\n      layoutDirty = true;\n    }\n  });\n\n  if (activeTab && legacyImported && activeTab.layoutSeeded !== true) {\n    activeTab.layoutSeeded = true;\n    layoutDirty = true;\n  }\n\n  if (layoutDirty) {\n    await persistMapConfig();\n  }\n\n  mapState.selectionIds = mapState.selectionIds.filter(id => positions[id]);\n\n  const hiddenLinks = gatherHiddenLinks(items, itemMap);\n\n  buildToolbox(container, hiddenNodes.length, hiddenLinks.length);\n  buildHiddenPanel(container, hiddenNodes, hiddenLinks);\n\n  const drawn = new Set();\n  const nodeLayerRef = mapState.nodeLayer || g;\n  visibleItems.forEach(it => {\n    (it.links || []).forEach(link => {\n      const targetId = link?.id;\n      if (!targetId) return;\n      if (link.hidden) return;\n      if (!positions[targetId]) return;\n      const key = it.id < targetId ? `${it.id}|${targetId}` : `${targetId}|${it.id}`;\n      if (drawn.has(key)) return;\n      drawn.add(key);\n      const info = { ...link, id: targetId };\n      applyLinkVisibility(it.id, targetId, info);\n    });\n  });\n\n  visibleItems.forEach(it => {\n    const pos = positions[it.id];\n    if (!pos) return;\n\n    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n    circle.setAttribute('cx', pos.x);\n    circle.setAttribute('cy', pos.y);\n    const cachedRadius = mapState.nodeRadii?.get(it.id);\n    const baseR = typeof cachedRadius === 'number'\n      ? cachedRadius\n      : computeNodeRadiusFromWeight(\n          gravityModel.weights?.get(it.id) || 0,\n          gravityModel.maxWeight || 1\n        );\n    circle.setAttribute('r', baseR);\n    circle.dataset.radius = baseR;\n    circle.setAttribute('class', 'map-node');\n    circle.dataset.id = it.id;\n    circle.setAttribute('fill', getNodeFill(it));\n\n    const handleNodePointerDown = e => {\n      if (e.button !== 0) return;\n      const isNavigateTool = mapState.tool === TOOL.NAVIGATE;\n      const isAreaDrag = mapState.tool === TOOL.AREA && mapState.selectionIds.includes(it.id);\n      if (!isNavigateTool && !isAreaDrag) return;\n      e.stopPropagation();\n      e.preventDefault();\n      mapState.suppressNextClick = false;\n      mapState.lastPointerDownInfo = null;\n      getSvgRect({ force: true });\n      const pointer = clientToMap(e.clientX, e.clientY);\n      const current = mapState.positions[it.id] || pos;\n      const { x, y } = pointer;\n      if (isNavigateTool) {\n        const selectionSet = new Set(\n          mapState.selectionIds.filter(id => mapState.positions[id] || positions[id])\n        );\n        const wasSelected = selectionSet.has(it.id);\n        const hadMultipleBefore = selectionSet.size > 1;\n        let addedToSelection = false;\n\n        if (e.shiftKey) {\n          if (!wasSelected) {\n            selectionSet.add(it.id);\n            addedToSelection = true;\n          }\n        } else {\n          if (!wasSelected || hadMultipleBefore) {\n            selectionSet.clear();\n            selectionSet.add(it.id);\n            addedToSelection = !wasSelected;\n          }\n        }\n\n        if (!selectionSet.size) {\n          selectionSet.add(it.id);\n          addedToSelection = !wasSelected;\n        }\n\n        const uniqueSelection = Array.from(selectionSet);\n        mapState.selectionIds = uniqueSelection;\n        mapState.previewSelection = null;\n        mapState.selectionPreviewSignature = '';\n        updateSelectionHighlight();\n        mapState.lastPointerDownInfo = { id: it.id, shift: e.shiftKey, added: addedToSelection };\n\n        const dragNodes = [];\n        uniqueSelection.forEach(id => {\n          const source = mapState.positions[id] || positions[id] || (id === it.id ? current : null);\n          if (!source) return;\n          dragNodes.push({\n            id,\n            start: { x: source.x, y: source.y },\n            offset: {\n              dx: pointer.x - source.x,\n              dy: pointer.y - source.y\n            }\n          });\n        });\n\n        if (!dragNodes.length) {\n          mapState.nodeDrag = null;\n          mapState.nodeWasDragged = false;\n          refreshCursor({ keepOverride: true });\n          return;\n        }\n\n        mapState.nodeDrag = {\n          pointerId: e.pointerId,\n          captureTarget: e.currentTarget || circle,\n          client: { x: e.clientX, y: e.clientY },\n          startPointer: { x: pointer.x, y: pointer.y },\n          lastPointer: { x: pointer.x, y: pointer.y },\n          nodes: dragNodes,\n          moved: false,\n          primaryId: it.id\n        };\n        if (mapState.nodeDrag.captureTarget?.setPointerCapture) {\n          try {\n            mapState.nodeDrag.captureTarget.setPointerCapture(e.pointerId);\n          } catch {}\n        }\n        mapState.nodeWasDragged = false;\n        setAreaInteracting(true);\n      } else {\n        const selectionIds = [...mapState.selectionIds];\n        mapState.areaDrag = {\n          ids: selectionIds,\n          start: { x, y },\n          origin: selectionIds.map(id => {\n            const source = mapState.positions[id] || positions[id] || { x: 0, y: 0 };\n            return { id, pos: { ...source } };\n          }),\n          moved: false,\n          pointerId: e.pointerId,\n          captureTarget: e.currentTarget || circle,\n          client: { x: e.clientX, y: e.clientY }\n        };\n        if (mapState.areaDrag.captureTarget?.setPointerCapture) {\n          try {\n            mapState.areaDrag.captureTarget.setPointerCapture(e.pointerId);\n          } catch {}\n        }\n        mapState.nodeWasDragged = false;\n        setAreaInteracting(true);\n      }\n      refreshCursor({ keepOverride: false });\n    };\n\n    circle.addEventListener('pointerdown', handleNodePointerDown);\n\n    circle.addEventListener('click', async e => {\n      e.stopPropagation();\n      if (mapState.tool === TOOL.NAVIGATE && e.shiftKey) {\n        mapState.nodeWasDragged = false;\n        mapState.suppressNextClick = false;\n        const info = mapState.lastPointerDownInfo;\n        const skipToggle = info && info.id === it.id && info.shift && info.added;\n        if (!skipToggle) {\n          const set = new Set(mapState.selectionIds);\n          if (set.has(it.id)) {\n            set.delete(it.id);\n          } else {\n            set.add(it.id);\n          }\n          mapState.selectionIds = Array.from(set);\n          mapState.previewSelection = null;\n          mapState.selectionPreviewSignature = '';\n          updateSelectionHighlight();\n        }\n        mapState.lastPointerDownInfo = null;\n        return;\n      }\n      if (mapState.suppressNextClick) {\n        mapState.suppressNextClick = false;\n        mapState.nodeWasDragged = false;\n        mapState.lastPointerDownInfo = null;\n        return;\n      }\n      if (mapState.tool === TOOL.NAVIGATE) {\n        if (!mapState.nodeWasDragged) {\n          openItemPopup(it.id);\n        }\n        mapState.nodeWasDragged = false;\n        mapState.lastPointerDownInfo = null;\n      } else if (mapState.tool === TOOL.HIDE) {\n        if (confirm(`Remove ${titleOf(it)} from the map?`)) {\n          applyLocalNodeHidden(it.id, true);\n          refreshToolboxBadges();\n          setNodeHidden(it.id, true)\n            .then(() => renderMap(root))\n            .catch(err => {\n              console.error(err);\n            });\n        }\n      } else if (mapState.tool === TOOL.ADD_LINK) {\n        await handleAddLinkClick(it.id);\n      }\n    });\n\n    circle.addEventListener('mouseenter', () => {\n      if (mapState.tool === TOOL.HIDE) {\n        applyCursorOverride('hide');\n      } else if (mapState.tool === TOOL.ADD_LINK) {\n        applyCursorOverride('link');\n      }\n    });\n\n    circle.addEventListener('mouseleave', () => {\n      if (mapState.tool === TOOL.HIDE) {\n        clearCursorOverride('hide');\n      }\n      if (mapState.tool === TOOL.ADD_LINK) {\n        clearCursorOverride('link');\n      }\n    });\n\n    nodeLayerRef.appendChild(circle);\n\n    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');\n    text.setAttribute('x', pos.x);\n    text.setAttribute('y', pos.y - (baseR + 12));\n    text.setAttribute('class', 'map-label');\n    text.setAttribute('font-size', '16');\n    text.dataset.id = it.id;\n    text.textContent = it.name || it.concept || '?';\n    text.addEventListener('pointerdown', handleNodePointerDown);\n    text.addEventListener('click', async e => {\n      e.stopPropagation();\n      if (mapState.tool === TOOL.NAVIGATE && e.shiftKey) {\n        mapState.nodeWasDragged = false;\n        mapState.suppressNextClick = false;\n        const info = mapState.lastPointerDownInfo;\n        const skipToggle = info && info.id === it.id && info.shift && info.added;\n        if (!skipToggle) {\n          const set = new Set(mapState.selectionIds);\n          if (set.has(it.id)) {\n            set.delete(it.id);\n          } else {\n            set.add(it.id);\n          }\n          mapState.selectionIds = Array.from(set);\n          mapState.previewSelection = null;\n          mapState.selectionPreviewSignature = '';\n          updateSelectionHighlight();\n        }\n        mapState.lastPointerDownInfo = null;\n        return;\n      }\n      if (mapState.suppressNextClick) {\n        mapState.suppressNextClick = false;\n        mapState.nodeWasDragged = false;\n        mapState.lastPointerDownInfo = null;\n        return;\n      }\n      if (mapState.tool === TOOL.NAVIGATE && !mapState.nodeWasDragged) {\n        openItemPopup(it.id);\n        mapState.lastPointerDownInfo = null;\n      } else if (mapState.tool === TOOL.HIDE) {\n        if (confirm(`Remove ${titleOf(it)} from the map?`)) {\n          applyLocalNodeHidden(it.id, true);\n          refreshToolboxBadges();\n          setNodeHidden(it.id, true)\n            .then(() => renderMap(root))\n            .catch(err => {\n              console.error(err);\n            });\n        }\n      } else if (mapState.tool === TOOL.ADD_LINK) {\n        await handleAddLinkClick(it.id);\n      }\n      mapState.nodeWasDragged = false;\n    });\n    nodeLayerRef.appendChild(text);\n\n    mapState.elements.set(it.id, { circle, label: text });\n  });\n\n  updateSelectionHighlight();\n  updatePendingHighlight();\n\n  if (mapState.pendingFocusId && !mapState.restoredViewFromMemory) {\n    const success = centerOnNode(mapState.pendingFocusId, { select: false });\n    if (success) {\n      mapState.restoredViewFromMemory = true;\n    }\n  }\n  mapState.pendingFocusId = null;\n\n  updateViewBox({ forceScale: true, immediate: true });\n  refreshCursor();\n  root.replaceChildren(fragment);\n}\n\nfunction ensureListeners() {\n  if (mapState.listenersAttached || typeof window === 'undefined') return;\n  window.addEventListener('pointermove', handlePointerMove);\n  window.addEventListener('pointerup', handlePointerUp);\n  window.addEventListener('pointercancel', handlePointerUp);\n  mapState.listenersAttached = true;\n  if (!window._mapResizeAttached) {\n    window.addEventListener('resize', () => {\n      invalidateSvgRect();\n      adjustScale();\n    });\n    window._mapResizeAttached = true;\n  }\n  if (!window._mapToolboxResizeAttached) {\n    window.addEventListener('resize', ensureToolboxWithinBounds);\n    window._mapToolboxResizeAttached = true;\n  }\n}\n\nfunction buildLineMarkers(defs) {\n  const svgNS = 'http://www.w3.org/2000/svg';\n  const configs = [\n    {\n      id: 'arrow-end',\n      viewBox: '0 0 16 16',\n      refX: 14,\n      refY: 8,\n      markerWidth: 9,\n      markerHeight: 9,\n      path: 'M2 2 L14 8 L2 14 L6 8 Z',\n      units: 'strokeWidth',\n      scaleMode: 'stroke'\n    },\n    {\n      id: 'arrow-start',\n      viewBox: '0 0 16 16',\n      refX: 2,\n      refY: 8,\n      markerWidth: 9,\n      markerHeight: 9,\n      path: 'M14 2 L2 8 L14 14 L10 8 Z',\n      units: 'strokeWidth',\n      scaleMode: 'stroke'\n    }\n  ];\n  mapState.markerDefs = defs;\n  mapState.lineMarkers = new Map();\n  if (!mapState.lineMarkerCache) {\n    mapState.lineMarkerCache = new Map();\n  } else {\n    mapState.lineMarkerCache.clear();\n  }\n  configs.forEach(cfg => {\n    const marker = document.createElementNS(svgNS, 'marker');\n    marker.setAttribute('id', cfg.id);\n    marker.setAttribute('viewBox', cfg.viewBox);\n    marker.dataset.baseRefX = String(cfg.refX);\n    marker.dataset.baseRefY = String(cfg.refY);\n    marker.dataset.baseWidth = String(cfg.markerWidth);\n    marker.dataset.baseHeight = String(cfg.markerHeight);\n    marker.dataset.scaleMode = cfg.scaleMode || 'absolute';\n    marker.setAttribute('refX', String(cfg.refX));\n    marker.setAttribute('refY', String(cfg.refY));\n    marker.setAttribute('markerWidth', String(cfg.markerWidth));\n    marker.setAttribute('markerHeight', String(cfg.markerHeight));\n    marker.setAttribute('orient', 'auto');\n    marker.setAttribute('markerUnits', cfg.units || 'userSpaceOnUse');\n    marker.setAttribute('class', 'map-marker');\n    const path = document.createElementNS(svgNS, 'path');\n    path.setAttribute('d', cfg.path);\n    path.setAttribute('fill', 'context-stroke');\n    path.setAttribute('stroke', 'context-stroke');\n    path.setAttribute('stroke-linejoin', 'round');\n    marker.appendChild(path);\n    defs.appendChild(marker);\n    mapState.lineMarkers.set(cfg.id, marker);\n  });\n  updateMarkerSizes();\n}\n\nfunction updateMarkerSizes() {\n  const markers = mapState.lineMarkers;\n  if (!markers || markers.size === 0) return;\n  const { zoomRatio = 1, lineScale = 1 } = getCurrentScales();\n  const ratio = Number.isFinite(zoomRatio) && zoomRatio > 0 ? zoomRatio : 1;\n  const strokeScale = Number.isFinite(lineScale) && lineScale > 0 ? lineScale : 1;\n  markers.forEach(marker => {\n    const baseWidth = Number(marker.dataset.baseWidth) || 12;\n    const baseHeight = Number(marker.dataset.baseHeight) || 12;\n    const baseRefX = Number(marker.dataset.baseRefX) || 0;\n    const baseRefY = Number(marker.dataset.baseRefY) || 0;\n    const scaleMode = marker.dataset.scaleMode || 'absolute';\n    if (scaleMode === 'stroke') {\n      marker.setAttribute('markerWidth', String(baseWidth));\n      marker.setAttribute('markerHeight', String(baseHeight));\n      marker.setAttribute('refX', String(baseRefX));\n      marker.setAttribute('refY', String(baseRefY));\n    } else {\n      const width = baseWidth * ratio * strokeScale;\n      const height = baseHeight * ratio * strokeScale;\n      marker.setAttribute('markerWidth', String(width));\n      marker.setAttribute('markerHeight', String(height));\n      marker.setAttribute('refX', String(baseRefX * ratio * strokeScale));\n      marker.setAttribute('refY', String(baseRefY * ratio * strokeScale));\n    }\n  });\n}\n\nfunction beginViewDrag(e) {\n  if (!mapState.svg || !mapState.viewBox) return false;\n  if (e.button !== 0) return false;\n  mapState.justCompletedSelection = false;\n  getSvgRect({ force: true });\n  const startMap = clientToMap(e.clientX, e.clientY);\n  mapState.draggingView = true;\n  mapState.viewWasDragged = false;\n  mapState.viewPointerId = e.pointerId;\n  mapState.lastPointer = {\n    x: e.clientX,\n    y: e.clientY,\n    mapX: startMap.x,\n    mapY: startMap.y\n  };\n  mapState.viewDragStart = {\n    clientX: e.clientX,\n    clientY: e.clientY,\n    viewX: mapState.viewBox.x,\n    viewY: mapState.viewBox.y\n  };\n  if (e.currentTarget?.setPointerCapture) {\n    try {\n      e.currentTarget.setPointerCapture(e.pointerId);\n    } catch {}\n  }\n  setAreaInteracting(true);\n  refreshCursor({ keepOverride: false });\n  return true;\n}\n\nfunction attachSvgEvents(svg) {\n  svg.addEventListener('pointerdown', e => {\n    if (e.button !== 0) return;\n    if (e.target !== svg) return;\n    closeLineMenu();\n    mapState.justCompletedSelection = false;\n    getSvgRect({ force: true });\n    mapState.lastPointerDownInfo = null;\n    if (mapState.tool !== TOOL.AREA) {\n      e.preventDefault();\n      beginViewDrag(e);\n    } else {\n      e.preventDefault();\n      startSelectionDrag(e.pointerId, e.clientX, e.clientY);\n      if (svg.setPointerCapture) {\n        try {\n          svg.setPointerCapture(e.pointerId);\n        } catch {}\n      }\n      setAreaInteracting(true);\n    }\n  });\n\n  svg.addEventListener('click', e => {\n    if (mapState.tool !== TOOL.AREA) return;\n    if (e.target !== svg) return;\n    if (mapState.justCompletedSelection) {\n      mapState.justCompletedSelection = false;\n      return;\n    }\n    if (mapState.selectionIds.length || mapState.previewSelection) {\n      mapState.selectionIds = [];\n      mapState.previewSelection = null;\n      mapState.selectionPreviewSignature = '';\n      updateSelectionHighlight();\n    }\n    setAreaInteracting(false);\n  });\n\n  svg.addEventListener('wheel', e => {\n    e.preventDefault();\n    if (!mapState.viewBox) return;\n    const rect = getSvgRect({ force: true });\n    if (!rect || !rect.width || !rect.height) return;\n    const pixelMode = e.deltaMode === 0;\n    const wantsZoom = e.ctrlKey || e.metaKey || e.altKey || !pixelMode;\n    if (!wantsZoom) {\n      const scaleX = rect.width ? (mapState.viewBox.w / rect.width) : 0;\n      const scaleY = rect.height ? (mapState.viewBox.h / rect.height) : 0;\n      mapState.viewBox.x += e.deltaX * scaleX * PAN_ACCELERATION;\n      mapState.viewBox.y += e.deltaY * scaleY * PAN_ACCELERATION;\n      constrainViewBox();\n      mapState.updateViewBox({ immediate: true });\n      return;\n    }\n    const ratioX = (e.clientX - rect.left) / rect.width;\n    const ratioY = (e.clientY - rect.top) / rect.height;\n    const mx = mapState.viewBox.x + ratioX * mapState.viewBox.w;\n    const my = mapState.viewBox.y + ratioY * mapState.viewBox.h;\n    let deltaY = e.deltaY;\n    if (e.deltaMode === 1) {\n      deltaY *= 16;\n    } else if (e.deltaMode === 2) {\n      deltaY *= rect.height;\n    }\n    const rawFactor = Math.exp(deltaY * ZOOM_INTENSITY);\n    const factor = Number.isFinite(rawFactor) && rawFactor > 0 ? rawFactor : 1;\n    const maxSize = mapState.sizeLimit || 2000;\n    const minSize = mapState.minView || 100;\n    const nextW = clamp(mapState.viewBox.w * factor, minSize, maxSize);\n    mapState.viewBox.w = nextW;\n    mapState.viewBox.h = nextW;\n    mapState.viewBox.x = mx - ratioX * nextW;\n    mapState.viewBox.y = my - ratioY * nextW;\n    constrainViewBox();\n    mapState.updateViewBox();\n  }, { passive: false });\n}\n\nfunction getNodeDragTargets() {\n  const drag = mapState.nodeDrag;\n  if (!drag) return [];\n  if (Array.isArray(drag.nodes) && drag.nodes.length) {\n    return drag.nodes;\n  }\n  if (Array.isArray(drag.targets) && drag.targets.length) {\n    return drag.targets;\n  }\n  if (drag.id) {\n    return [{ id: drag.id }];\n  }\n  return [];\n}\n\nfunction refreshEdgesForIds(ids, options = {}) {\n  if (!Array.isArray(ids) || !ids.length) {\n    return;\n  }\n  const seen = new Set();\n  ids.forEach(id => {\n    if (id == null) return;\n    const key = String(id);\n    if (seen.has(key)) return;\n    seen.add(key);\n    updateEdgesFor(id, options);\n  });\n}\n\nfunction applyNodeDragFromPointer(pointer, options = {}) {\n  if (!pointer) return false;\n  const drag = mapState.nodeDrag;\n  if (!drag) return false;\n  const lastPointer = drag.lastPointer;\n  if (\n    lastPointer &&\n    Math.abs(lastPointer.x - pointer.x) < 0.0001 &&\n    Math.abs(lastPointer.y - pointer.y) < 0.0001\n  ) {\n    return false;\n  }\n  const targets = Array.isArray(drag.nodes) ? drag.nodes : [];\n  if (!targets.length) return false;\n  let applied = false;\n  let moved = drag.moved === true;\n  const startPointer = drag.startPointer || null;\n  targets.forEach(target => {\n    if (!target) return;\n    const { id, offset = { dx: 0, dy: 0 }, start } = target;\n    if (!id) return;\n    const nx = pointer.x - offset.dx;\n    const ny = pointer.y - offset.dy;\n    scheduleNodePositionUpdate(id, { x: nx, y: ny }, { immediate: true, animate: true });\n    if (!moved && start) {\n      const dx = nx - start.x;\n      const dy = ny - start.y;\n      if (Math.hypot(dx, dy) > NODE_DRAG_DISTANCE_THRESHOLD) {\n        moved = true;\n      }\n    }\n    applied = true;\n  });\n  drag.lastPointer = { x: pointer.x, y: pointer.y };\n  drag.moved = moved;\n  if (applied && moved && options.markDragged !== false) {\n    mapState.nodeWasDragged = true;\n  }\n  return applied;\n}\n\nfunction handlePointerMove(e) {\n  if (!mapState.svg) return;\n\n  const pendingPress = mapState.edgePress;\n  if (pendingPress && pendingPress.pointerId === e.pointerId && !pendingPress.activated) {\n    const dx = e.clientX - pendingPress.startClient.x;\n    const dy = e.clientY - pendingPress.startClient.y;\n    if (Math.hypot(dx, dy) > EDGE_DRAG_MOVE_THRESHOLD) {\n      const pointer = clientToMap(e.clientX, e.clientY);\n      activateEdgePress(pendingPress, pointer, { fromMove: true });\n    }\n  }\n\n  if (mapState.toolboxDrag) {\n    moveToolboxDrag(e.clientX, e.clientY);\n    return;\n  }\n\n  if (mapState.menuDrag) {\n    updateMenuDragPosition(e.clientX, e.clientY);\n    return;\n  }\n\n  if (mapState.edgeDrag && mapState.edgeDrag.pointerId === e.pointerId) {\n    const drag = mapState.edgeDrag;\n    if (!drag.line || typeof drag.handleIndex !== 'number') return;\n    const distance = Math.hypot(e.clientX - drag.clientStart.x, e.clientY - drag.clientStart.y);\n    if (!drag.hasDragged && distance < 2.4) {\n      return;\n    }\n    if (!drag.hasDragged) {\n      drag.hasDragged = true;\n    }\n    const pointer = clientToMap(e.clientX, e.clientY);\n    const base = drag.base;\n    if (!pointer || !base) return;\n    const dx = base.endX - base.startX;\n    const dy = base.endY - base.startY;\n    const length = base.trimmedLength || Math.hypot(dx, dy) || 1;\n    if (!length) return;\n    const nx = -base.uy;\n    const ny = base.ux;\n    let handles = drag.handles || [];\n    const index = clamp(drag.handleIndex, 0, handles.length - 1);\n    const handle = handles[index];\n    if (!handle) return;\n    const projectionAlong = ((pointer.x - base.startX) * dx + (pointer.y - base.startY) * dy) / (length * length);\n    const nextPosition = clampHandlePosition(projectionAlong);\n    const baseX = base.startX + dx * nextPosition;\n    const baseY = base.startY + dy * nextPosition;\n    const weight = getHandleWeight(nextPosition);\n    const rawOffset = ((pointer.x - baseX) * nx + (pointer.y - baseY) * ny) / length;\n    const normalized = clampHandleOffset(rawOffset / (weight || 1));\n    handle.position = nextPosition;\n    handle.offset = normalized;\n    handle.weight = weight;\n    drag.offsetChanged =\n      drag.offsetChanged\n      || Math.abs((handle.startOffset ?? handle.offset) - handle.offset) > 0.0005\n      || Math.abs((handle.startPosition ?? handle.position) - handle.position) > 0.0005;\n    const sortedHandles = handles.slice().sort((a, b) => a.position - b.position);\n    const newIndex = sortedHandles.indexOf(handle);\n    handles = sortedHandles;\n    drag.handles = handles;\n    if (newIndex >= 0) {\n      drag.handleIndex = newIndex;\n    }\n    if (drag.createdHandle) {\n      drag.createdIndex = handles.indexOf(drag.createdHandle);\n    }\n    const patchHandles = handles.map(h => ({ position: h.position, offset: h.offset }));\n    applyLineStyle(drag.line, { curveHandles: patchHandles });\n    return;\n  }\n\n  if (mapState.nodeDrag && mapState.nodeDrag.pointerId === e.pointerId) {\n    mapState.nodeDrag.client = { x: e.clientX, y: e.clientY };\n    updateAutoPanFromPointer(e.clientX, e.clientY, { allowDuringDrag: true });\n    const pointer = clientToMap(e.clientX, e.clientY);\n    applyNodeDragFromPointer(pointer);\n    return;\n  }\n\n  if (mapState.areaDrag && mapState.areaDrag.pointerId === e.pointerId) {\n    mapState.areaDrag.client = { x: e.clientX, y: e.clientY };\n    updateAutoPanFromPointer(e.clientX, e.clientY, { allowDuringDrag: true });\n    const { x, y } = clientToMap(e.clientX, e.clientY);\n    const dx = x - mapState.areaDrag.start.x;\n    const dy = y - mapState.areaDrag.start.y;\n    mapState.areaDrag.moved = Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5;\n    mapState.areaDrag.origin.forEach(({ id, pos }) => {\n      const nx = pos.x + dx;\n      const ny = pos.y + dy;\n      scheduleNodePositionUpdate(id, { x: nx, y: ny }, { immediate: true, animate: true });\n    });\n    mapState.nodeWasDragged = true;\n    return;\n  }\n\n  if (mapState.draggingView && mapState.viewPointerId === e.pointerId) {\n    const start = mapState.viewDragStart;\n    if (!start) return;\n    const rect = getSvgRect();\n    if (!rect || !rect.width || !rect.height) return;\n    if (typeof e.preventDefault === 'function') {\n      e.preventDefault();\n    }\n    const movedDistance = Math.hypot(e.clientX - start.clientX, e.clientY - start.clientY);\n    if (!mapState.viewWasDragged && movedDistance > 1.5) {\n      mapState.viewWasDragged = true;\n    }\n    const scaleX = mapState.viewBox.w / rect.width;\n    const scaleY = mapState.viewBox.h / rect.height;\n    const deltaX = (e.clientX - start.clientX) * PAN_ACCELERATION;\n    const deltaY = (e.clientY - start.clientY) * PAN_ACCELERATION;\n    mapState.viewBox.x = start.viewX - deltaX * scaleX;\n    mapState.viewBox.y = start.viewY - deltaY * scaleY;\n    constrainViewBox();\n    mapState.lastPointer = { x: e.clientX, y: e.clientY };\n    mapState.updateViewBox({ immediate: true });\n    if (mapState.selectionRect) {\n      refreshSelectionMaps();\n    }\n    return;\n  }\n\n  if (mapState.selectionRect && mapState.selectionRect.pointerId === e.pointerId) {\n    updateAutoPanFromPointer(e.clientX, e.clientY);\n    updateSelectionDragPosition(e.clientX, e.clientY);\n  }\n}\n\nasync function handlePointerUp(e) {\n  if (!mapState.svg) return;\n\n  flushNodePositionUpdates({ cancelFrame: true });\n\n  stopAutoPan();\n\n  if (mapState.toolboxDrag) {\n    stopToolboxDrag();\n  }\n\n  if (mapState.menuDrag) {\n    await finishMenuDrag(e.clientX, e.clientY);\n    return;\n  }\n\n  const edgePress = mapState.edgePress;\n  if (edgePress && edgePress.pointerId === e.pointerId) {\n    clearEdgePressTimer(edgePress);\n    mapState.edgePress = null;\n    if (!edgePress.activated && edgePress.type === 'handle') {\n      const dx = e.clientX - edgePress.startClient.x;\n      const dy = e.clientY - edgePress.startClient.y;\n      if (Math.hypot(dx, dy) <= EDGE_CLICK_DISTANCE) {\n        const line = edgePress.line;\n        if (line && confirm('Remove this anchor point?')) {\n          await removeHandleAt(line, edgePress.handleIndex);\n        } else if (line) {\n          showLineHandles(line);\n          applyLineHover(line);\n        }\n      }\n    }\n  }\n\n  let cursorNeedsRefresh = false;\n\n  if (mapState.edgeDrag && mapState.edgeDrag.pointerId === e.pointerId) {\n    const drag = mapState.edgeDrag;\n    mapState.edgeDrag = null;\n    if (drag.captureTarget?.releasePointerCapture) {\n      try {\n        drag.captureTarget.releasePointerCapture(e.pointerId);\n      } catch {}\n    }\n    const handles = drag.handles || [];\n    const createdIndex = Number.isInteger(drag.createdIndex) ? drag.createdIndex : -1;\n    const createdHandle = drag.createdHandle || (createdIndex >= 0 ? handles[createdIndex] : null);\n    const changed =\n      drag.offsetChanged\n      || handles.some(handle => {\n        const startOffset = handle.startOffset ?? handle.offset;\n        const startPosition = handle.startPosition ?? handle.position;\n        return Math.abs(handle.offset - startOffset) > 0.0005 || Math.abs(handle.position - startPosition) > 0.0005;\n      });\n    const shouldAutoRemove = drag.insertedHandle && !drag.hasDragged;\n    if (shouldAutoRemove && createdHandle) {\n      const trimmed = handles.filter(handle => handle !== createdHandle);\n      const patch = buildCurvePatchFromHandles(trimmed);\n      await updateLink(drag.aId, drag.bId, patch);\n      applyLineStyle(drag.line, patch);\n      applyLinkPatchToState(drag.aId, drag.bId, patch);\n      mapState.edgeDragJustCompleted = true;\n      setTimeout(() => {\n        mapState.edgeDragJustCompleted = false;\n      }, 0);\n    } else if (changed) {\n      const payloadHandles = handles.map(handle => ({ position: handle.position, offset: handle.offset }));\n      const patch = buildCurvePatchFromHandles(payloadHandles);\n      await updateLink(drag.aId, drag.bId, patch);\n      applyLineStyle(drag.line, patch);\n      applyLinkPatchToState(drag.aId, drag.bId, patch);\n      mapState.edgeDragJustCompleted = true;\n      setTimeout(() => {\n        mapState.edgeDragJustCompleted = false;\n      }, 0);\n    }\n    if (drag.line) {\n      drag.line._handleSticky = false;\n      const hovered = typeof drag.line.matches === 'function' && drag.line.matches(':hover');\n      if (hovered) {\n        showLineHandles(drag.line);\n      } else {\n        hideLineHandles(drag.line, { force: true });\n      }\n    }\n    cursorNeedsRefresh = true;\n  }\n\n  if (mapState.nodeDrag && mapState.nodeDrag.pointerId === e.pointerId) {\n    const drag = mapState.nodeDrag;\n    const dragTargets = getNodeDragTargets();\n    if (drag.captureTarget?.releasePointerCapture) {\n      try {\n        drag.captureTarget.releasePointerCapture(e.pointerId);\n      } catch {}\n    }\n    const wasDragged = mapState.nodeWasDragged || drag.moved;\n    if (wasDragged && mapState.lastPointerDownInfo?.id === drag.primaryId) {\n      mapState.lastPointerDownInfo = null;\n    }\n    mapState.nodeDrag = null;\n    flushQueuedEdgeUpdates({ force: true });\n    cursorNeedsRefresh = true;\n    if (wasDragged) {\n      const ids = dragTargets.map(target => target.id).filter(Boolean);\n      if (!ids.length && drag.id) {\n        ids.push(drag.id);\n      }\n      const uniqueIds = Array.from(new Set(ids));\n      if (uniqueIds.length) {\n        for (const nodeId of uniqueIds) {\n          await persistNodePosition(nodeId, { persist: false });\n        }\n        await persistMapConfig();\n      }\n      mapState.suppressNextClick = true;\n    } else {\n      mapState.suppressNextClick = false;\n    }\n    mapState.nodeWasDragged = false;\n    setAreaInteracting(false);\n  }\n\n  if (mapState.areaDrag && mapState.areaDrag.pointerId === e.pointerId) {\n    const currentDrag = mapState.areaDrag;\n    const moved = currentDrag.moved;\n    const ids = currentDrag.ids;\n    if (currentDrag.captureTarget?.releasePointerCapture) {\n      try {\n        currentDrag.captureTarget.releasePointerCapture(e.pointerId);\n      } catch {}\n    }\n    mapState.areaDrag = null;\n    flushQueuedEdgeUpdates({ force: true });\n    cursorNeedsRefresh = true;\n    if (moved) {\n      for (const id of ids) {\n        await persistNodePosition(id, { persist: false });\n      }\n      await persistMapConfig();\n      mapState.suppressNextClick = true;\n    } else {\n      mapState.suppressNextClick = false;\n    }\n    mapState.nodeWasDragged = false;\n    stopAutoPan();\n    setAreaInteracting(false);\n  }\n\n  if (mapState.draggingView && mapState.viewPointerId === e.pointerId) {\n    const wasDragged = mapState.viewWasDragged;\n    mapState.draggingView = false;\n    mapState.viewPointerId = null;\n    mapState.viewDragStart = null;\n    mapState.viewWasDragged = false;\n    if (mapState.svg?.releasePointerCapture) {\n      try {\n        mapState.svg.releasePointerCapture(e.pointerId);\n      } catch {}\n    }\n    cursorNeedsRefresh = true;\n    setAreaInteracting(false);\n    if (!wasDragged && (mapState.selectionIds.length || mapState.previewSelection)) {\n      mapState.selectionIds = [];\n      mapState.previewSelection = null;\n      mapState.selectionPreviewSignature = '';\n      updateSelectionHighlight();\n    }\n  }\n\n  if (mapState.selectionRect && mapState.selectionRect.pointerId === e.pointerId) {\n    finalizeSelectionDrag();\n    stopAutoPan();\n    setAreaInteracting(false);\n    mapState.justCompletedSelection = true;\n    if (mapState.svg?.releasePointerCapture) {\n      try {\n        mapState.svg.releasePointerCapture(e.pointerId);\n      } catch {}\n    }\n  }\n\n  if (cursorNeedsRefresh) {\n    refreshCursor({ keepOverride: true });\n  }\n}\n\nfunction buildCurvePatchFromHandles(handles = []) {\n  const sanitized = Array.isArray(handles)\n    ? handles\n        .map(handle => ({\n          position: clampHandlePosition(handle.position),\n          offset: clampHandleOffset(handle.offset)\n        }))\n        .filter(handle => Number.isFinite(handle.position) && Number.isFinite(handle.offset))\n    : [];\n  if (!sanitized.length) {\n    return {\n      curveHandles: [],\n      curve: 0,\n      curveAnchor: DEFAULT_CURVE_ANCHOR\n    };\n  }\n  let dominant = { position: DEFAULT_CURVE_ANCHOR, offset: 0 };\n  sanitized.forEach(handle => {\n    if (Math.abs(handle.offset) > Math.abs(dominant.offset)) {\n      dominant = handle;\n    }\n  });\n  return {\n    curveHandles: sanitized,\n    curve: clampHandleOffset(dominant.offset),\n    curveAnchor: clampHandlePosition(dominant.position)\n  };\n}\n\nfunction queueEdgeUpdate(id, options = {}) {\n  if (!id) return;\n  if (!mapState.pendingEdgeUpdates) {\n    mapState.pendingEdgeUpdates = new Set();\n  }\n  mapState.pendingEdgeUpdates.add(String(id));\n  const { immediate = false, animate = false } = options;\n  if (animate) {\n    if (!mapState.pendingEdgeAnimations) {\n      mapState.pendingEdgeAnimations = new Map();\n    }\n    mapState.pendingEdgeAnimations.set(String(id), true);\n  }\n  const needsImmediateFlush = immediate\n    || typeof window === 'undefined'\n    || typeof window.requestAnimationFrame !== 'function';\n  if (needsImmediateFlush) {\n    flushQueuedEdgeUpdates({ force: true });\n    return;\n  }\n  if (mapState.edgeUpdateFrame) {\n    return;\n  }\n  mapState.edgeUpdateFrame = window.requestAnimationFrame(() => {\n    mapState.edgeUpdateFrame = null;\n    flushQueuedEdgeUpdates();\n  });\n}\n\nfunction flushQueuedEdgeUpdates({ force = false } = {}) {\n  const pending = mapState.pendingEdgeUpdates;\n  if (!pending || !pending.size) return;\n  if (mapState.edgeUpdateFrame && typeof window !== 'undefined') {\n    if (force && typeof window.cancelAnimationFrame === 'function') {\n      window.cancelAnimationFrame(mapState.edgeUpdateFrame);\n      mapState.edgeUpdateFrame = null;\n    } else if (!force) {\n      return;\n    }\n  }\n  const ids = Array.from(pending);\n  pending.clear();\n  mapState.edgeUpdateFrame = null;\n  const animateMap = mapState.pendingEdgeAnimations;\n  ids.forEach(id => {\n    const key = String(id);\n    const shouldAnimate = Boolean(animateMap?.get(key));\n    if (animateMap) {\n      animateMap.delete(key);\n    }\n    updateEdgesFor(key, { animate: shouldAnimate });\n  });\n}\n\nfunction scheduleNodePositionUpdate(id, pos, options = {}) {\n  if (!id || !pos) return;\n  const { immediate = false, animate = false } = options;\n  mapState.positions[id] = pos;\n  if (immediate) {\n    if (mapState.pendingNodeUpdates && typeof mapState.pendingNodeUpdates.delete === 'function') {\n      mapState.pendingNodeUpdates.delete(id);\n    }\n    const entry = mapState.elements.get(id);\n    let hadRegisteredEdges = false;\n    if (entry) {\n      updateNodeGeometry(id, entry);\n      const registered = mapState.edgeRefs?.get(String(id));\n      hadRegisteredEdges = Boolean(registered && registered.size);\n      updateEdgesFor(id, { animate });\n    }\n    if (!hadRegisteredEdges) {\n      queueEdgeUpdate(id, { immediate: true, animate });\n    }\n    return;\n  }\n  if (!mapState.pendingNodeUpdates) {\n    mapState.pendingNodeUpdates = new Map();\n  }\n  const existing = mapState.pendingNodeUpdates.get(id);\n  const nextAnimate = animate || Boolean(existing?.animate);\n  mapState.pendingNodeUpdates.set(id, { pos, animate: nextAnimate });\n  queueEdgeUpdate(id, { animate: nextAnimate });\n  if (typeof window === 'undefined' || typeof window.requestAnimationFrame !== 'function') {\n    flushNodePositionUpdates();\n    return;\n  }\n  if (mapState.nodeUpdateFrame) {\n    return;\n  }\n  mapState.nodeUpdateFrame = window.requestAnimationFrame(() => {\n    mapState.nodeUpdateFrame = null;\n    flushNodePositionUpdates();\n  });\n}\n\nfunction flushNodePositionUpdates({ cancelFrame = false } = {}) {\n  if (cancelFrame && mapState.nodeUpdateFrame && typeof window !== 'undefined' && typeof window.cancelAnimationFrame === 'function') {\n    window.cancelAnimationFrame(mapState.nodeUpdateFrame);\n    mapState.nodeUpdateFrame = null;\n  }\n  const updates = mapState.pendingNodeUpdates;\n  if (!updates || !updates.size) return;\n  const touched = [];\n  updates.forEach((value, id) => {\n    const info = value && typeof value === 'object' && Object.prototype.hasOwnProperty.call(value, 'pos')\n      ? value\n      : { pos: value };\n    const entry = mapState.elements.get(id);\n    if (!entry) return;\n    updateNodeGeometry(id, entry);\n    touched.push({ id, animate: Boolean(info.animate) });\n  });\n  updates.clear();\n  touched.forEach(({ id, animate }) => {\n    updateEdgesFor(id, { animate });\n  });\n}\n\nfunction getNow() {\n  if (typeof performance !== 'undefined' && typeof performance.now === 'function') {\n    return performance.now();\n  }\n  return Date.now();\n}\n\nfunction invalidateSvgRect() {\n  mapState.svgRect = null;\n  mapState.svgRectTime = 0;\n}\n\nfunction getSvgRect(options = {}) {\n  const svg = mapState.svg;\n  if (!svg) return null;\n  const { force = false } = options;\n  if (force) {\n    mapState.svgRect = svg.getBoundingClientRect();\n    mapState.svgRectTime = getNow();\n    return mapState.svgRect;\n  }\n  const now = getNow();\n  if (!mapState.svgRect || !mapState.svgRectTime || now - mapState.svgRectTime > 100) {\n    mapState.svgRect = svg.getBoundingClientRect();\n    mapState.svgRectTime = now;\n  }\n  return mapState.svgRect;\n}\n\nfunction constrainViewBox() {\n  const viewBox = mapState.viewBox;\n  if (!viewBox) return;\n  const maxSize = mapState.sizeLimit || 0;\n  if (maxSize > 0) {\n    const maxX = Math.max(0, maxSize - viewBox.w);\n    const maxY = Math.max(0, maxSize - viewBox.h);\n    viewBox.x = clamp(viewBox.x, 0, maxX);\n    viewBox.y = clamp(viewBox.y, 0, maxY);\n  }\n}\n\nfunction clientToMap(clientX, clientY) {\n  const viewBox = mapState.viewBox;\n  if (!mapState.svg || !viewBox) return { x: 0, y: 0 };\n  const rect = getSvgRect();\n  if (!rect || !rect.width || !rect.height) {\n    return { x: viewBox.x, y: viewBox.y };\n  }\n  const ratioX = (clientX - rect.left) / rect.width;\n  const ratioY = (clientY - rect.top) / rect.height;\n  return {\n    x: viewBox.x + ratioX * viewBox.w,\n    y: viewBox.y + ratioY * viewBox.h\n  };\n}\n\nfunction getElementPosition(entry, id) {\n  if (entry?.circle) {\n    const cx = Number(entry.circle.getAttribute('cx'));\n    const cy = Number(entry.circle.getAttribute('cy'));\n    if (Number.isFinite(cx) && Number.isFinite(cy)) {\n      return { x: cx, y: cy };\n    }\n  }\n  return mapState.positions?.[id] || null;\n}\n\nfunction getElementRadius(entry, id) {\n  if (entry?.circle) {\n    const r = Number(entry.circle.getAttribute('r'));\n    if (Number.isFinite(r) && r > 0) {\n      return r;\n    }\n  }\n  return getNodeRadius(id);\n}\n\nfunction collectNodesInRect(minX, maxX, minY, maxY) {\n  const preview = [];\n  const seen = new Set();\n  mapState.elements.forEach((entry, id) => {\n    const pos = getElementPosition(entry, id);\n    if (!pos) return;\n    const radius = getElementRadius(entry, id);\n    if (!Number.isFinite(radius) || radius < 0) return;\n    const label = entry?.label || null;\n    const labelHeight = label ? (Number(label.getAttribute('font-size')) || 16) * 0.7 : 0;\n    const verticalRadius = radius + labelHeight + 10;\n    const expandedRadius = radius + 6;\n    const insideBox = pos.x >= minX && pos.x <= maxX && pos.y >= minY && pos.y <= maxY;\n    const intersectsBox = !insideBox\n      ? pos.x + expandedRadius >= minX\n        && pos.x - expandedRadius <= maxX\n        && pos.y + radius >= minY\n        && pos.y - verticalRadius <= maxY\n      : true;\n    if (insideBox || intersectsBox) {\n      if (!seen.has(id)) {\n        preview.push(id);\n        seen.add(id);\n      }\n    }\n  });\n  return preview;\n}\n\nfunction startSelectionDrag(pointerId, clientX, clientY) {\n  const originClient = { x: clientX, y: clientY };\n  const originMap = clientToMap(clientX, clientY);\n  mapState.selectionRect = {\n    pointerId,\n    originClient,\n    originMap,\n    currentClient: { ...originClient },\n    currentMap: { ...originMap },\n    changed: false\n  };\n  if (mapState.selectionBox) {\n    mapState.selectionBox.classList.remove('hidden');\n  }\n  mapState.previewSelection = [];\n  mapState.selectionPreviewSignature = '';\n  syncSelectionOverlay();\n}\n\nfunction updateSelectionDragPosition(clientX, clientY) {\n  const rect = mapState.selectionRect;\n  if (!rect) return;\n  rect.currentClient = { x: clientX, y: clientY };\n  rect.currentMap = clientToMap(clientX, clientY);\n  syncSelectionOverlay();\n}\n\nfunction refreshSelectionMaps({ updateOrigin = false } = {}) {\n  const rect = mapState.selectionRect;\n  if (!rect) return;\n  if (updateOrigin && rect.originClient) {\n    rect.originMap = clientToMap(rect.originClient.x, rect.originClient.y);\n  }\n  if (rect.currentClient) {\n    rect.currentMap = clientToMap(rect.currentClient.x, rect.currentClient.y);\n  }\n  syncSelectionOverlay();\n}\n\nfunction syncSelectionOverlay() {\n  const rect = mapState.selectionRect;\n  if (!rect || !mapState.selectionBox) return;\n  const { originClient, currentClient, originMap, currentMap } = rect;\n  if (!originClient || !currentClient) return;\n  const svgRect = getSvgRect();\n  if (!svgRect) return;\n  const left = Math.min(originClient.x, currentClient.x) - svgRect.left;\n  const top = Math.min(originClient.y, currentClient.y) - svgRect.top;\n  const width = Math.abs(originClient.x - currentClient.x);\n  const height = Math.abs(originClient.y - currentClient.y);\n  mapState.selectionBox.style.left = `${left}px`;\n  mapState.selectionBox.style.top = `${top}px`;\n  mapState.selectionBox.style.width = `${width}px`;\n  mapState.selectionBox.style.height = `${height}px`;\n  rect.changed = width > 3 || height > 3;\n\n  if (!originMap || !currentMap) return;\n  const minX = Math.min(originMap.x, currentMap.x);\n  const maxX = Math.max(originMap.x, currentMap.x);\n  const minY = Math.min(originMap.y, currentMap.y);\n  const maxY = Math.max(originMap.y, currentMap.y);\n  const preview = collectNodesInRect(minX, maxX, minY, maxY);\n  const signature = preview.length ? preview.slice().sort().join('|') : '';\n  if (signature !== mapState.selectionPreviewSignature) {\n    mapState.previewSelection = preview;\n    mapState.selectionPreviewSignature = signature;\n    updateSelectionHighlight();\n  }\n}\n\nfunction finalizeSelectionDrag({ commit = true } = {}) {\n  if (mapState.selectionBox) {\n    mapState.selectionBox.classList.add('hidden');\n    mapState.selectionBox.style.width = '0px';\n    mapState.selectionBox.style.height = '0px';\n  }\n  const shouldCommit = commit !== false && (mapState.selectionRect?.changed || (mapState.previewSelection?.length ?? 0) > 0);\n  if (shouldCommit) {\n    const ids = mapState.previewSelection ? mapState.previewSelection.slice() : [];\n    mapState.selectionIds = ids;\n  }\n  mapState.selectionRect = null;\n  mapState.previewSelection = null;\n  mapState.selectionPreviewSignature = '';\n  updateSelectionHighlight();\n}\n\nfunction pickClusterPosition(existing = [], spacing = 200, base = { x: 0, y: 0 }, options = {}) {\n  const baseX = Number.isFinite(base?.x) ? base.x : 0;\n  const baseY = Number.isFinite(base?.y) ? base.y : 0;\n  const minDistanceBase = Math.max(spacing * 0.82, spacing - 80);\n  const buffer = Number.isFinite(options?.buffer) ? options.buffer : 0;\n  const maxRadius = Number.isFinite(options?.maxRadius) ? options.maxRadius : 0;\n  const targetDistance = Math.max(minDistanceBase + buffer, spacing * 0.75, maxRadius);\n  for (let radius = 0; radius <= 6; radius += 1) {\n    for (let dx = -radius; dx <= radius; dx += 1) {\n      for (let dy = -radius; dy <= radius; dy += 1) {\n        if (Math.max(Math.abs(dx), Math.abs(dy)) !== radius) continue;\n        const candidate = {\n          x: baseX + dx * spacing,\n          y: baseY + dy * spacing\n        };\n        let collision = false;\n        for (const pos of existing) {\n          if (!pos) continue;\n          const px = Number.isFinite(pos?.x) ? pos.x : 0;\n          const py = Number.isFinite(pos?.y) ? pos.y : 0;\n          const dist = Math.hypot(px - candidate.x, py - candidate.y);\n          const existingSpacing = Number.isFinite(pos?.spacing) ? pos.spacing : spacing;\n          const existingBuffer = Number.isFinite(pos?.buffer) ? pos.buffer : 0;\n          const required = Math.max(targetDistance, (existingSpacing + spacing) * 0.5, existingBuffer);\n          if (dist < required) {\n            collision = true;\n            break;\n          }\n        }\n        if (!collision) {\n          return candidate;\n        }\n      }\n    }\n  }\n  return {\n    x: baseX + (Math.random() - 0.5) * spacing,\n    y: baseY + (Math.random() - 0.5) * spacing\n  };\n}\n\nfunction updateAutoPanFromPointer(clientX, clientY, options = {}) {\n  if (!mapState.svg) return;\n  const { allowDuringDrag = false, force = false } = options;\n  const dragging = allowDuringDrag && (mapState.nodeDrag || mapState.areaDrag);\n  const shouldAutoPan = force || mapState.tool === TOOL.AREA || dragging;\n  if (!shouldAutoPan) {\n    stopAutoPan();\n    return;\n  }\n  mapState.autoPanPointer = { x: clientX, y: clientY };\n  const vector = computeAutoPanVector(clientX, clientY);\n  if (vector) {\n    startAutoPan(vector);\n  } else {\n    stopAutoPan();\n  }\n}\n\nfunction computeAutoPanVector(clientX, clientY) {\n  const rect = getSvgRect();\n  if (!rect) return null;\n  const threshold = 40;\n  const baseSpeed = 25;\n  let dx = 0;\n  let dy = 0;\n\n  const leftDist = clientX - rect.left;\n  const rightDist = rect.right - clientX;\n  const topDist = clientY - rect.top;\n  const bottomDist = rect.bottom - clientY;\n\n  if (leftDist < threshold) {\n    const intensity = Math.min(1, Math.max(0, threshold - leftDist) / threshold);\n    dx -= intensity * baseSpeed;\n  } else if (rightDist < threshold) {\n    const intensity = Math.min(1, Math.max(0, threshold - rightDist) / threshold);\n    dx += intensity * baseSpeed;\n  }\n\n  if (topDist < threshold) {\n    const intensity = Math.min(1, Math.max(0, threshold - topDist) / threshold);\n    dy -= intensity * baseSpeed;\n  } else if (bottomDist < threshold) {\n    const intensity = Math.min(1, Math.max(0, threshold - bottomDist) / threshold);\n    dy += intensity * baseSpeed;\n  }\n\n  if (dx || dy) {\n    return { dx, dy };\n  }\n  return null;\n}\n\nfunction startAutoPan(vector) {\n  if (!vector) return;\n  mapState.autoPan = { dx: vector.dx, dy: vector.dy };\n  applyAutoPan(mapState.autoPan);\n  if (typeof window === 'undefined') return;\n  if (mapState.autoPanFrame) return;\n  const step = () => {\n    if (!mapState.autoPan) {\n      mapState.autoPanFrame = null;\n      return;\n    }\n    if (mapState.autoPanPointer) {\n      const nextVector = computeAutoPanVector(mapState.autoPanPointer.x, mapState.autoPanPointer.y);\n      if (!nextVector) {\n        stopAutoPan();\n        return;\n      }\n      mapState.autoPan.dx = nextVector.dx;\n      mapState.autoPan.dy = nextVector.dy;\n    }\n    applyAutoPan(mapState.autoPan);\n    mapState.autoPanFrame = window.requestAnimationFrame(step);\n  };\n  mapState.autoPanFrame = window.requestAnimationFrame(step);\n}\n\nfunction applyAutoPan(vector) {\n  if (!mapState.svg || !mapState.viewBox || !mapState.updateViewBox) return;\n  const rect = getSvgRect();\n  if (!rect || !rect.width || !rect.height) return;\n  const scaleX = mapState.viewBox.w / rect.width;\n  const scaleY = mapState.viewBox.h / rect.height;\n  mapState.viewBox.x += vector.dx * scaleX;\n  mapState.viewBox.y += vector.dy * scaleY;\n  constrainViewBox();\n  mapState.updateViewBox({ immediate: true });\n  if (mapState.selectionRect) {\n    refreshSelectionMaps({ updateOrigin: true });\n  }\n  if (mapState.nodeDrag?.client) {\n    const pointer = clientToMap(mapState.nodeDrag.client.x, mapState.nodeDrag.client.y);\n    applyNodeDragFromPointer(pointer);\n  }\n  if (mapState.areaDrag?.client) {\n    const pointer = clientToMap(mapState.areaDrag.client.x, mapState.areaDrag.client.y);\n    const dx = pointer.x - mapState.areaDrag.start.x;\n    const dy = pointer.y - mapState.areaDrag.start.y;\n    mapState.areaDrag.moved = mapState.areaDrag.moved || Math.abs(dx) > 0.5 || Math.abs(dy) > 0.5;\n    mapState.areaDrag.origin.forEach(({ id, pos }) => {\n      const nx = pos.x + dx;\n      const ny = pos.y + dy;\n      scheduleNodePositionUpdate(id, { x: nx, y: ny }, { immediate: true, animate: true });\n    });\n    mapState.nodeWasDragged = true;\n  }\n}\n\nfunction stopAutoPan() {\n  mapState.autoPan = null;\n  mapState.autoPanPointer = null;\n  if (mapState.autoPanFrame && typeof window !== 'undefined') {\n    window.cancelAnimationFrame(mapState.autoPanFrame);\n  }\n  mapState.autoPanFrame = null;\n}\n\nfunction getCurrentScales() {\n  return mapState.currentScales || { nodeScale: 1, labelScale: 1, lineScale: 1 };\n}\n\nfunction getLineThicknessValue(key) {\n  return LINE_THICKNESS_VALUES[key] || LINE_THICKNESS_VALUES[DEFAULT_LINE_THICKNESS];\n}\n\nfunction normalizeLineStyle(style) {\n  if (LINE_STYLE_VALUE_SET.has(style)) {\n    return style;\n  }\n  if (style && LEGACY_STYLE_MAPPINGS[style]?.style && LINE_STYLE_VALUE_SET.has(LEGACY_STYLE_MAPPINGS[style].style)) {\n    return LEGACY_STYLE_MAPPINGS[style].style;\n  }\n  return DEFAULT_LINE_STYLE;\n}\n\nfunction normalizeLineDecoration(decoration, styleHint) {\n  if (LINE_DECORATION_VALUE_SET.has(decoration)) {\n    return decoration;\n  }\n  if (styleHint && LEGACY_STYLE_MAPPINGS[styleHint]?.decoration) {\n    const mapped = LEGACY_STYLE_MAPPINGS[styleHint].decoration;\n    if (LINE_DECORATION_VALUE_SET.has(mapped)) {\n      return mapped;\n    }\n  }\n  return DEFAULT_LINE_DECORATION;\n}\n\nfunction normalizeDecorationDirection(direction, decoration, styleHint) {\n  if (decoration === 'none') {\n    return DEFAULT_DECORATION_DIRECTION;\n  }\n  if (LINE_DIRECTION_VALUE_SET.has(direction)) {\n    return direction;\n  }\n  if (styleHint && LEGACY_STYLE_MAPPINGS[styleHint]?.decorationDirection) {\n    const mapped = LEGACY_STYLE_MAPPINGS[styleHint].decorationDirection;\n    if (LINE_DIRECTION_VALUE_SET.has(mapped)) {\n      return mapped;\n    }\n  }\n  return DEFAULT_DECORATION_DIRECTION;\n}\n\nfunction normalizeLineGlow(glow, styleHint) {\n  if (typeof glow === 'string') {\n    if (glow === 'true' || glow === '1') return true;\n    if (glow === 'false' || glow === '0') return false;\n  }\n  if (typeof glow === 'number') {\n    return glow !== 0;\n  }\n  if (typeof glow === 'boolean') {\n    return glow;\n  }\n  if (styleHint && LEGACY_STYLE_MAPPINGS[styleHint]?.glow) {\n    return true;\n  }\n  return DEFAULT_LINE_GLOW;\n}\n\nfunction normalizeLinkAppearance(info = {}) {\n  const styleHint = info.style ?? info.linkStyle;\n  const style = normalizeLineStyle(styleHint);\n  const decoration = normalizeLineDecoration(info.decoration, styleHint);\n  const decorationDirection = normalizeDecorationDirection(\n    info.decorationDirection,\n    decoration,\n    styleHint\n  );\n  const glow = normalizeLineGlow(info.glow, styleHint);\n  return { style, decoration, decorationDirection, glow };\n}\n\nfunction getLineTypePreset(value) {\n  return LINE_TYPE_PRESET_LOOKUP.get(value) || LINE_TYPE_PRESET_LOOKUP.get('line');\n}\n\nfunction inferLineTypePreset(style, decoration) {\n  const normalizedStyle = normalizeLineStyle(style);\n  const normalizedDecoration = normalizeLineDecoration(decoration, style);\n  for (const option of LINE_TYPE_PRESETS) {\n    if (option.style === normalizedStyle && option.decoration === normalizedDecoration) {\n      return option.value;\n    }\n  }\n  if (normalizedDecoration === 'block') {\n    return 'blocked';\n  }\n  if (normalizedStyle === 'dashed') {\n    return 'dashed';\n  }\n  if (normalizedStyle === 'dotted') {\n    return 'dotted';\n  }\n  return 'line';\n}\n\nfunction isDirectionalPreset(preset) {\n  return Boolean(preset && preset.directional);\n}\n\nfunction flipDecorationDirection(direction) {\n  if (direction === 'start') return 'end';\n  if (direction === 'end') return 'start';\n  return direction || DEFAULT_DECORATION_DIRECTION;\n}\n\nfunction updateNodeGeometry(id, entry = mapState.elements.get(id)) {\n  if (!entry) return;\n  const { circle, label } = entry;\n  const pos = mapState.positions[id];\n  if (!circle || !pos) return;\n  const baseR = Number(circle.dataset.radius) || 20;\n  const scales = getCurrentScales();\n  const nodeScale = scales.nodeScale || 1;\n  const labelScale = scales.labelScale || 1;\n  circle.setAttribute('cx', pos.x);\n  circle.setAttribute('cy', pos.y);\n  circle.setAttribute('r', baseR * nodeScale);\n  if (label) {\n    label.setAttribute('x', pos.x);\n    const offset = (baseR + 12) * nodeScale;\n    label.setAttribute('y', pos.y - offset);\n    const fontSize = Math.max(14, 16 * labelScale);\n    label.setAttribute('font-size', fontSize);\n  }\n}\n\nfunction updateSelectionHighlight() {\n  const ids = mapState.previewSelection || mapState.selectionIds;\n  const set = new Set(ids);\n  mapState.elements.forEach(({ circle, label }, id) => {\n    if (set.has(id)) {\n      circle.classList.add('selected');\n      label.classList.add('selected');\n    } else {\n      circle.classList.remove('selected');\n      label.classList.remove('selected');\n    }\n  });\n}\n\nconst EDGE_NODE_KEY = Symbol('edgeNodes');\n\nfunction ensureEdgeRegistry() {\n  if (!mapState.edgeRefs) {\n    mapState.edgeRefs = new Map();\n  }\n  if (!mapState.allEdges) {\n    mapState.allEdges = new Set();\n  }\n}\n\nfunction registerEdgeElement(edge, aId, bId) {\n  if (!edge) return;\n  ensureEdgeRegistry();\n  mapState.allEdges.add(edge);\n  const keyA = String(aId);\n  const keyB = String(bId);\n  edge[EDGE_NODE_KEY] = { aId: keyA, bId: keyB };\n  [keyA, keyB].forEach(id => {\n    if (!id) return;\n    let set = mapState.edgeRefs.get(id);\n    if (!set) {\n      set = new Set();\n      mapState.edgeRefs.set(id, set);\n    }\n    set.add(edge);\n  });\n}\n\nfunction unregisterEdgeElement(edge) {\n  if (!edge) return;\n  const info = edge[EDGE_NODE_KEY];\n  if (info) {\n    [info.aId, info.bId].forEach(id => {\n      const key = String(id);\n      const set = mapState.edgeRefs?.get(key);\n      if (!set) return;\n      set.delete(edge);\n      if (!set.size) {\n        mapState.edgeRefs.delete(key);\n      }\n    });\n    delete edge[EDGE_NODE_KEY];\n  }\n  if (mapState.allEdges) {\n    mapState.allEdges.delete(edge);\n  }\n}\n\nfunction getLinkInfo(aId, bId) {\n  if (!mapState.itemMap) return null;\n  const key = String(aId);\n  const source = mapState.itemMap[key] || mapState.itemMap[aId];\n  if (!source || !Array.isArray(source.links)) return null;\n  const otherKey = String(bId);\n  return source.links.find(link => String(link?.id) === otherKey) || null;\n}\n\nfunction integrateItemUpdates(...items) {\n  if (!items || !items.length) return;\n  items.forEach(item => {\n    if (!item || !item.id) return;\n    if (!mapState.itemMap) {\n      mapState.itemMap = {};\n    }\n    mapState.itemMap[item.id] = item;\n    if (Array.isArray(mapState.visibleItems)) {\n      const idx = mapState.visibleItems.findIndex(it => it && it.id === item.id);\n      if (idx >= 0) {\n        mapState.visibleItems[idx] = item;\n      }\n    }\n  });\n}\n\nfunction getEdgeElement(aId, bId) {\n  ensureEdgeRegistry();\n  const keyA = String(aId);\n  const keyB = String(bId);\n  const set = mapState.edgeRefs?.get(keyA);\n  if (set) {\n    for (const edge of set) {\n      if (!edge?.dataset) continue;\n      const da = String(edge.dataset.a);\n      const db = String(edge.dataset.b);\n      if ((da === keyA && db === keyB) || (da === keyB && db === keyA)) {\n        return edge;\n      }\n    }\n  }\n  if (mapState.allEdges) {\n    for (const edge of mapState.allEdges) {\n      if (!edge?.dataset) continue;\n      const da = String(edge.dataset.a);\n      const db = String(edge.dataset.b);\n      if ((da === keyA && db === keyB) || (da === keyB && db === keyA)) {\n        return edge;\n      }\n    }\n  }\n  return null;\n}\n\nfunction beginEdgeHandleDrag(line, handleIndex, evt, options = {}) {\n  if (!line || !line.dataset) return;\n  const aId = line.dataset.a;\n  const bId = line.dataset.b;\n  if (!aId || !bId) return;\n  const pointerId = evt.pointerId;\n  const geometry = options.geometry || getLineGeometry(aId, bId, { line });\n  if (!geometry) return;\n  const pointer = options.pointer || clientToMap(evt.clientX, evt.clientY);\n  const prepared = prepareHandlesForDrag(geometry, pointer, handleIndex, {\n    forceCreate: options.trigger === 'line'\n  });\n  const handles = prepared.handles.map(handle => {\n    const weight = handle.weight ?? getHandleWeight(handle.position);\n    return {\n      position: handle.position,\n      offset: handle.offset,\n      weight,\n      startOffset: handle.offset,\n      startPosition: handle.position\n    };\n  });\n  if (!handles.length) return;\n  const index = clamp(prepared.index, 0, handles.length - 1);\n  const createdIndex = Number.isInteger(prepared.createdIndex) ? prepared.createdIndex : -1;\n  const insertedHandle = Number.isFinite(prepared.originalLength)\n    ? handles.length > prepared.originalLength\n    : createdIndex >= 0;\n  const createdHandle = insertedHandle ? handles[index] : null;\n  const captureTarget = evt.currentTarget || line;\n  const baseLength = geometry.trimmedLength || Math.hypot(geometry.endX - geometry.startX, geometry.endY - geometry.startY) || 1;\n  mapState.edgeDrag = {\n    pointerId,\n    line,\n    aId,\n    bId,\n    captureTarget,\n    handleIndex: index,\n    handles,\n    base: {\n      startX: geometry.startX,\n      startY: geometry.startY,\n      endX: geometry.endX,\n      endY: geometry.endY,\n      ux: geometry.ux,\n      uy: geometry.uy,\n      trimmedLength: baseLength\n    },\n    offsetChanged: false,\n    hasDragged: false,\n    geometry,\n    fromHandle: Boolean(evt?.target && evt.target !== line),\n    clientStart: { x: evt.clientX, y: evt.clientY },\n    createdIndex,\n    createdHandle,\n    insertedHandle,\n    trigger: options.trigger || 'handle',\n    activatedByHold: options.activatedByHold === true\n  };\n  setLineHandlesVisible(line, true, { force: true, sticky: true });\n  if (mapState.edgeDrag.captureTarget?.setPointerCapture) {\n    try {\n      mapState.edgeDrag.captureTarget.setPointerCapture(pointerId);\n    } catch {}\n  }\n}\n\nfunction clearEdgePressTimer(press) {\n  if (!press) return;\n  if (press.holdTimer) {\n    clearTimeout(press.holdTimer);\n    press.holdTimer = null;\n  }\n}\n\nfunction resetEdgePress() {\n  if (mapState.edgePress) {\n    clearEdgePressTimer(mapState.edgePress);\n  }\n  mapState.edgePress = null;\n}\n\nfunction activateEdgePress(press, pointer, options = {}) {\n  if (!press || press.activated) return;\n  clearEdgePressTimer(press);\n  press.activated = true;\n  const line = press.line;\n  const aId = press.aId;\n  const bId = press.bId;\n  if (!line || !aId || !bId) {\n    resetEdgePress();\n    return;\n  }\n  const geometry = getLineGeometry(aId, bId, { line });\n  if (!geometry) {\n    resetEdgePress();\n    return;\n  }\n  const evt = press.originalEvent || press.event;\n  if (!evt) {\n    resetEdgePress();\n    return;\n  }\n  const pointerMeta = pointer || press.pointerStart || clientToMap(evt.clientX, evt.clientY);\n  beginEdgeHandleDrag(line, press.type === 'handle' ? press.handleIndex : press.handleIndex ?? 0, evt, {\n    geometry,\n    pointer: pointerMeta,\n    trigger: press.type,\n    activatedByHold: options.fromHold === true || options.fromTimer === true\n  });\n  mapState.edgePress = null;\n}\n\nfunction startLinePress(line, aId, bId, evt) {\n  resetEdgePress();\n  const pointer = clientToMap(evt.clientX, evt.clientY);\n  const press = {\n    type: 'line',\n    pointerId: evt.pointerId,\n    line,\n    aId,\n    bId,\n    event: evt,\n    originalEvent: evt,\n    pointerStart: pointer,\n    startClient: { x: evt.clientX, y: evt.clientY },\n    holdTimer: null,\n    activated: false,\n    handleIndex: 0\n  };\n  if (typeof window !== 'undefined') {\n    press.holdTimer = window.setTimeout(() => {\n      activateEdgePress(press, press.pointerStart, { fromTimer: true, fromHold: true });\n    }, EDGE_DRAG_HOLD_DELAY);\n  }\n  mapState.edgePress = press;\n}\n\nfunction startHandlePress(line, handleIndex, evt) {\n  resetEdgePress();\n  const pointer = clientToMap(evt.clientX, evt.clientY);\n  const press = {\n    type: 'handle',\n    pointerId: evt.pointerId,\n    line,\n    aId: line?.dataset?.a,\n    bId: line?.dataset?.b,\n    handleIndex,\n    event: evt,\n    originalEvent: evt,\n    pointerStart: pointer,\n    startClient: { x: evt.clientX, y: evt.clientY },\n    holdTimer: null,\n    activated: false,\n    handleElement: evt.currentTarget || null,\n    hoveredAtPress: Boolean(\n      evt.currentTarget?.classList?.contains('is-hovered')\n      || evt.currentTarget?.parentNode?.classList?.contains('is-hovered')\n    )\n  };\n  if (typeof window !== 'undefined') {\n    press.holdTimer = window.setTimeout(() => {\n      activateEdgePress(press, press.pointerStart, { fromTimer: true, fromHold: true });\n    }, EDGE_DRAG_HOLD_DELAY);\n  }\n  mapState.edgePress = press;\n}\n\nasync function removeHandleAt(line, handleIndex) {\n  if (!line || !line.dataset) return;\n  const aId = line.dataset.a;\n  const bId = line.dataset.b;\n  if (!aId || !bId) return;\n  const handles = parseCurveHandles(line.dataset.handles) || [];\n  if (handleIndex < 0 || handleIndex >= handles.length) return;\n  const nextHandles = handles.filter((_, idx) => idx !== handleIndex);\n  const patch = buildCurvePatchFromHandles(nextHandles);\n  await updateLink(aId, bId, patch);\n  applyLineStyle(line, patch);\n  applyLinkPatchToState(aId, bId, patch);\n  mapState.edgeDragJustCompleted = true;\n  setTimeout(() => {\n    mapState.edgeDragJustCompleted = false;\n  }, 0);\n}\n\nasync function straightenLine(line) {\n  if (!line || !line.dataset) return;\n  const aId = line.dataset.a;\n  const bId = line.dataset.b;\n  if (!aId || !bId) return;\n  const patch = buildCurvePatchFromHandles([]);\n  await updateLink(aId, bId, patch);\n  applyLineStyle(line, patch);\n  applyLinkPatchToState(aId, bId, patch);\n  mapState.edgeDragJustCompleted = true;\n  setTimeout(() => {\n    mapState.edgeDragJustCompleted = false;\n  }, 0);\n}\n\nfunction attachEdgeInteraction(path, aId, bId) {\n  if (!path || path.dataset.interactive === '1') return;\n  path.dataset.interactive = '1';\n  path.addEventListener('pointerdown', evt => {\n    if (evt.button !== 0) return;\n    if (mapState.tool !== TOOL.NAVIGATE) return;\n    mapState.suppressNextClick = false;\n    evt.stopPropagation();\n    if (typeof evt.preventDefault === 'function') {\n      evt.preventDefault();\n    }\n    startLinePress(path, aId, bId, evt);\n  });\n  path.addEventListener('click', e => {\n    e.stopPropagation();\n    handleEdgeClick(path, aId, bId, e);\n  });\n  path.addEventListener('mouseenter', evt => {\n    if (mapState.tool === TOOL.HIDE) {\n      applyCursorOverride('hide');\n    } else if (mapState.tool === TOOL.BREAK) {\n      applyCursorOverride('break');\n    }\n    const geometry = getLineGeometry(aId, bId, { line: path });\n    showLineHandles(path, geometry);\n    showEdgeTooltip(path, evt);\n    applyLineHover(path);\n  });\n  path.addEventListener('mouseleave', () => {\n    if (mapState.tool === TOOL.HIDE) {\n      clearCursorOverride('hide');\n    }\n    if (mapState.tool === TOOL.BREAK) {\n      clearCursorOverride('break');\n    }\n    hideLineHandles(path);\n    hideEdgeTooltip(path);\n    clearLineHover(path);\n  });\n  path.addEventListener('mousemove', evt => moveEdgeTooltip(path, evt));\n}\n\nfunction ensureEdgeBetween(aId, bId, linkInfo = {}) {\n  if (!mapState.positions?.[aId] || !mapState.positions?.[bId]) {\n    return null;\n  }\n  const info = linkInfo || {};\n  if (info.hidden) {\n    removeEdgeBetween(aId, bId);\n    return null;\n  }\n  let path = getEdgeElement(aId, bId);\n  if (!path) {\n    const container = mapState.edgeLayer || mapState.g || mapState.svg;\n    if (!container) return null;\n    path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    path.setAttribute('fill', 'none');\n    path.setAttribute('class', 'map-edge');\n    path.setAttribute('vector-effect', 'non-scaling-stroke');\n    path.dataset.a = String(aId);\n    path.dataset.b = String(bId);\n    container.appendChild(path);\n    registerEdgeElement(path, String(aId), String(bId));\n    attachEdgeInteraction(path, String(aId), String(bId));\n  }\n  path.dataset.label = info.name || '';\n  applyLineStyle(path, info);\n  return path;\n}\n\nfunction removeEdgeBetween(aId, bId) {\n  const edge = getEdgeElement(aId, bId);\n  if (!edge) return;\n  hideEdgeTooltip(edge);\n  clearLineHover(edge, { force: true });\n  removeLineOverlay(edge);\n  removeLineHandles(edge);\n  removeLineGap(edge);\n  removeEdgeAnimation(edge);\n  unregisterEdgeElement(edge);\n  edge.remove();\n}\n\nfunction applyLinkVisibility(aId, bId, info = {}) {\n  if (info.hidden) {\n    removeEdgeBetween(aId, bId);\n    return null;\n  }\n  return ensureEdgeBetween(aId, bId, info);\n}\n\nfunction normalizeLinkEntry(targetId, info = {}) {\n  const appearance = normalizeLinkAppearance({\n    style: info.style ?? info.linkStyle ?? DEFAULT_LINE_STYLE,\n    decoration: info.decoration,\n    decorationDirection: info.decorationDirection ?? info.direction,\n    glow: info.glow\n  });\n  const entry = {\n    id: targetId,\n    style: appearance.style,\n    decoration: appearance.decoration,\n    decorationDirection: appearance.decorationDirection,\n    glow: Boolean(appearance.glow),\n    thickness: info.thickness || DEFAULT_LINE_THICKNESS,\n    color: info.color || DEFAULT_LINK_COLOR,\n    name: typeof info.name === 'string' ? info.name : '',\n    hidden: Boolean(info.hidden)\n  };\n  if (Object.prototype.hasOwnProperty.call(info, 'curve')) {\n    const curve = Number(info.curve);\n    if (Number.isFinite(curve)) entry.curve = curve;\n  }\n  if (Object.prototype.hasOwnProperty.call(info, 'curveAnchor')) {\n    const anchor = normalizeAnchorValue(info.curveAnchor);\n    if (Number.isFinite(anchor)) entry.curveAnchor = anchor;\n  }\n  const handles = parseCurveHandles(\n    info.curveHandles\n    ?? info.curvePoints\n    ?? info.curveOffsets\n    ?? info.handles\n  );\n  if (handles && handles.length) {\n    entry.curveHandles = handles.map(handle => ({\n      position: clampHandlePosition(handle.position),\n      offset: clampHandleOffset(handle.offset)\n    }));\n  }\n  return entry;\n}\n\nfunction updatePendingHighlight() {\n  mapState.elements.forEach(({ circle, label }, id) => {\n    if (mapState.pendingLink === id) {\n      circle.classList.add('pending');\n      label.classList.add('pending');\n    } else {\n      circle.classList.remove('pending');\n      label.classList.remove('pending');\n    }\n  });\n}\n\nfunction edgeAnimationAllowed() {\n  if (typeof window === 'undefined' || typeof document === 'undefined') {\n    return false;\n  }\n  if (mapState.prefersReducedMotion == null && typeof window.matchMedia === 'function') {\n    try {\n      const query = window.matchMedia('(prefers-reduced-motion: reduce)');\n      mapState.prefersReducedMotion = query.matches;\n      if (!mapState.motionMedia) {\n        const listener = event => {\n          mapState.prefersReducedMotion = event.matches;\n        };\n        if (typeof query.addEventListener === 'function') {\n          query.addEventListener('change', listener);\n        } else if (typeof query.addListener === 'function') {\n          query.addListener(listener);\n        }\n        mapState.motionMedia = { query, listener };\n      }\n    } catch {\n      mapState.prefersReducedMotion = false;\n    }\n  }\n  return !mapState.prefersReducedMotion;\n}\n\nfunction removeEdgeAnimation(line) {\n  const animation = line?._pathAnimation;\n  if (!animation) return;\n  if (animation._timer && typeof window !== 'undefined') {\n    window.clearTimeout(animation._timer);\n  }\n  try {\n    animation.remove();\n  } catch {}\n  if (line) {\n    line._pathAnimation = null;\n  }\n}\n\nfunction animatePathTransition(line, from, to, options = {}) {\n  if (!line || !from || !to || from === to) return;\n  if (!edgeAnimationAllowed()) return;\n  if (typeof document === 'undefined') return;\n  const duration = Math.max(16, Number(options.duration) || EDGE_ANIMATION_DURATION);\n  const animateEl = document.createElementNS('http://www.w3.org/2000/svg', 'animate');\n  animateEl.setAttribute('attributeName', 'd');\n  animateEl.setAttribute('from', from);\n  animateEl.setAttribute('to', to);\n  animateEl.setAttribute('dur', `${duration}ms`);\n  animateEl.setAttribute('fill', 'freeze');\n  animateEl.setAttribute('repeatCount', '1');\n  animateEl.setAttribute('calcMode', 'linear');\n  const cleanup = () => {\n    if (typeof window !== 'undefined' && animateEl._timer) {\n      window.clearTimeout(animateEl._timer);\n    }\n    if (animateEl.parentNode === line) {\n      animateEl.remove();\n    }\n    if (line._pathAnimation === animateEl) {\n      line._pathAnimation = null;\n    }\n  };\n  animateEl.addEventListener('endEvent', cleanup);\n  animateEl.addEventListener('repeatEvent', cleanup);\n  removeEdgeAnimation(line);\n  line._pathAnimation = animateEl;\n  line.appendChild(animateEl);\n  if (typeof window !== 'undefined') {\n    animateEl._timer = window.setTimeout(cleanup, duration + 40);\n  }\n  if (typeof animateEl.beginElement === 'function') {\n    try {\n      animateEl.beginElement();\n    } catch {}\n  }\n}\n\nfunction refreshEdgeGeometry(line, options = {}) {\n  if (!line) return;\n  const aId = line.dataset?.a;\n  const bId = line.dataset?.b;\n  if (!aId || !bId) return;\n  const geometry = options.geometry || getLineGeometry(aId, bId, { line });\n  if (geometry?.pathData) {\n    const previousPath = line.getAttribute('d') || '';\n    line.setAttribute('d', geometry.pathData);\n    if (options.animate && previousPath && previousPath !== geometry.pathData) {\n      animatePathTransition(line, previousPath, geometry.pathData, options);\n    } else {\n      removeEdgeAnimation(line);\n    }\n    line._geometry = geometry;\n    syncLineHandles(line, geometry);\n    updateLineStrokeWidth(line);\n  } else {\n    removeEdgeAnimation(line);\n    removeLineHandles(line);\n  }\n  syncLineDecoration(line, geometry);\n}\n\nfunction updateEdgesFor(id, options = {}) {\n  ensureEdgeRegistry();\n  if (!mapState.edgeRefs) return;\n  const key = String(id);\n  let edges = mapState.edgeRefs.get(key);\n  let list = edges && edges.size ? Array.from(edges) : [];\n  if (!list.length && mapState.allEdges && mapState.allEdges.size) {\n    list = Array.from(mapState.allEdges).filter(edge => {\n      const da = edge?.dataset?.a;\n      const db = edge?.dataset?.b;\n      return da === key || db === key;\n    });\n  }\n  if (!list.length) return;\n  const stale = [];\n  list.forEach(edge => {\n    if (!edge || !edge.isConnected || !edge.ownerSVGElement) {\n      stale.push(edge);\n      return;\n    }\n    refreshEdgeGeometry(edge, options);\n  });\n  if (stale.length) {\n    stale.forEach(edge => {\n      unregisterEdgeElement(edge);\n    });\n  }\n}\n\nfunction buildToolbox(container, hiddenNodeCount, hiddenLinkCount) {\n  const tools = [\n    { id: TOOL.NAVIGATE, icon: '\uD83E\uDDED', label: 'Navigate' },\n    { id: TOOL.HIDE, icon: '\uD83E\uDE84', label: 'Hide' },\n    { id: TOOL.BREAK, icon: '\u2702\uFE0F', label: 'Break link' },\n    { id: TOOL.ADD_LINK, icon: '\uD83D\uDD17', label: 'Add link' },\n    { id: TOOL.AREA, icon: '\uD83D\uDCE6', label: 'Select area' }\n  ];\n\n  const box = document.createElement('div');\n  box.className = 'map-toolbox';\n  box.style.left = `${mapState.toolboxPos.x}px`;\n  box.style.top = `${mapState.toolboxPos.y}px`;\n  mapState.toolboxEl = box;\n  mapState.toolboxContainer = container;\n\n  box.addEventListener('mousedown', event => {\n    if (event.button !== 0) return;\n    if (event.target.closest('.map-tool') || event.target.closest('.map-toolbox-drag')) return;\n    startToolboxDrag(event);\n  });\n\n  const handle = document.createElement('button');\n  handle.type = 'button';\n  handle.className = 'map-toolbox-drag';\n  handle.setAttribute('aria-label', 'Drag toolbar');\n  handle.innerHTML = '<span>\u22EE</span>';\n  handle.addEventListener('mousedown', startToolboxDrag);\n  box.appendChild(handle);\n\n  const list = document.createElement('div');\n  list.className = 'map-tool-list';\n  tools.forEach(tool => {\n    const btn = document.createElement('button');\n    btn.type = 'button';\n    btn.className = 'map-tool' + (mapState.tool === tool.id ? ' active' : '');\n    btn.textContent = tool.icon;\n    btn.title = tool.label;\n    btn.addEventListener('click', () => {\n      if (mapState.tool !== tool.id) {\n        mapState.tool = tool.id;\n        if (tool.id !== TOOL.AREA) {\n          mapState.selectionIds = [];\n          mapState.previewSelection = null;\n          mapState.selectionPreviewSignature = '';\n        }\n        if (tool.id !== TOOL.ADD_LINK) {\n          mapState.pendingLink = null;\n        }\n        if (tool.id === TOOL.HIDE) {\n          mapState.hiddenMenuTab = mapState.hiddenMenuTab === 'links' ? 'links' : 'nodes';\n          mapState.panelVisible = true;\n        }\n        mapState.cursorOverride = null;\n        renderMap(mapState.root);\n      }\n    });\n    list.appendChild(btn);\n  });\n  box.appendChild(list);\n\n  const badges = document.createElement('div');\n  badges.className = 'map-tool-badges';\n  const nodeBadge = document.createElement('span');\n  nodeBadge.className = 'map-tool-badge';\n  nodeBadge.setAttribute('title', `${hiddenNodeCount} hidden node${hiddenNodeCount === 1 ? '' : 's'}`);\n  const nodeIcon = document.createElement('span');\n  nodeIcon.textContent = '\uD83D\uDE48';\n  const nodeCountEl = document.createElement('strong');\n  nodeCountEl.textContent = hiddenNodeCount;\n  nodeBadge.append(nodeIcon, nodeCountEl);\n  badges.appendChild(nodeBadge);\n\n  const linkBadge = document.createElement('span');\n  linkBadge.className = 'map-tool-badge';\n  linkBadge.setAttribute('title', `${hiddenLinkCount} hidden link${hiddenLinkCount === 1 ? '' : 's'}`);\n  const linkIcon = document.createElement('span');\n  linkIcon.textContent = '\uD83D\uDD78\uFE0F';\n  const linkCountEl = document.createElement('strong');\n  linkCountEl.textContent = hiddenLinkCount;\n  linkBadge.append(linkIcon, linkCountEl);\n  badges.appendChild(linkBadge);\n\n  box.appendChild(badges);\n\n  container.appendChild(box);\n  ensureToolboxWithinBounds();\n  mapState.toolboxBadges = {\n    nodeBadge,\n    linkBadge,\n    nodeCountEl,\n    linkCountEl\n  };\n}\n\nfunction computeHiddenNodeCount() {\n  if (!mapState.itemMap) return 0;\n  return Object.values(mapState.itemMap).reduce((total, item) => total + (item?.mapHidden ? 1 : 0), 0);\n}\n\nfunction computeHiddenLinkCount() {\n  if (!mapState.itemMap) return 0;\n  const seen = new Set();\n  let count = 0;\n  Object.values(mapState.itemMap).forEach(item => {\n    const id = item?.id;\n    if (!id) return;\n    (item.links || []).forEach(link => {\n      if (!link?.hidden) return;\n      const otherId = link.id;\n      if (!otherId) return;\n      const key = id < otherId ? `${id}|${otherId}` : `${otherId}|${id}`;\n      if (seen.has(key)) return;\n      seen.add(key);\n      count += 1;\n    });\n  });\n  return count;\n}\n\nfunction refreshToolboxBadges() {\n  const badges = mapState.toolboxBadges;\n  if (!badges) return;\n  const hiddenNodeCount = computeHiddenNodeCount();\n  const hiddenLinkCount = computeHiddenLinkCount();\n  if (badges.nodeCountEl) {\n    badges.nodeCountEl.textContent = hiddenNodeCount;\n  }\n  if (badges.linkCountEl) {\n    badges.linkCountEl.textContent = hiddenLinkCount;\n  }\n  if (badges.nodeBadge) {\n    badges.nodeBadge.setAttribute('title', `${hiddenNodeCount} hidden node${hiddenNodeCount === 1 ? '' : 's'}`);\n  }\n  if (badges.linkBadge) {\n    badges.linkBadge.setAttribute('title', `${hiddenLinkCount} hidden link${hiddenLinkCount === 1 ? '' : 's'}`);\n  }\n}\n\nfunction buildHiddenPanel(container, hiddenNodes, hiddenLinks) {\n  const allowPanel = mapState.tool === TOOL.HIDE;\n  const panel = document.createElement('div');\n  panel.className = 'map-hidden-panel';\n  if (!(allowPanel && mapState.panelVisible)) {\n    panel.classList.add('hidden');\n  }\n\n  const header = document.createElement('div');\n  header.className = 'map-hidden-header';\n\n  const tabs = document.createElement('div');\n  tabs.className = 'map-hidden-tabs';\n\n  const nodeTab = document.createElement('button');\n  nodeTab.type = 'button';\n  nodeTab.textContent = `Nodes (${hiddenNodes.length})`;\n  nodeTab.className = mapState.hiddenMenuTab === 'nodes' ? 'active' : '';\n  nodeTab.addEventListener('click', () => {\n    mapState.hiddenMenuTab = 'nodes';\n    renderMap(mapState.root);\n  });\n  tabs.appendChild(nodeTab);\n\n  const linkTab = document.createElement('button');\n  linkTab.type = 'button';\n  linkTab.textContent = `Links (${hiddenLinks.length})`;\n  linkTab.className = mapState.hiddenMenuTab === 'links' ? 'active' : '';\n  linkTab.addEventListener('click', () => {\n    mapState.hiddenMenuTab = 'links';\n    renderMap(mapState.root);\n  });\n  tabs.appendChild(linkTab);\n\n  header.appendChild(tabs);\n\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'map-hidden-close';\n  closeBtn.textContent = mapState.panelVisible ? 'Hide' : 'Show';\n  closeBtn.addEventListener('click', () => {\n    mapState.panelVisible = !mapState.panelVisible;\n    renderMap(mapState.root);\n  });\n  header.appendChild(closeBtn);\n\n  panel.appendChild(header);\n\n  const body = document.createElement('div');\n  body.className = 'map-hidden-body';\n\n  if (mapState.hiddenMenuTab === 'nodes') {\n    const list = document.createElement('div');\n    list.className = 'map-hidden-list';\n    if (hiddenNodes.length === 0) {\n      const empty = document.createElement('div');\n      empty.className = 'map-hidden-empty';\n      empty.textContent = 'No hidden nodes.';\n      list.appendChild(empty);\n    } else {\n      hiddenNodes\n        .slice()\n        .sort((a, b) => titleOf(a).localeCompare(titleOf(b)))\n        .forEach(it => {\n          const item = document.createElement('div');\n          item.className = 'map-hidden-item';\n          item.classList.add('draggable');\n          item.textContent = titleOf(it) || it.id;\n          item.addEventListener('mousedown', e => {\n            if (mapState.tool !== TOOL.HIDE) return;\n            startMenuDrag(it, e, { source: 'hidden' });\n          });\n          list.appendChild(item);\n        });\n    }\n    body.appendChild(list);\n  } else {\n    const list = document.createElement('div');\n    list.className = 'map-hidden-list';\n    if (hiddenLinks.length === 0) {\n      const empty = document.createElement('div');\n      empty.className = 'map-hidden-empty';\n      empty.textContent = 'No hidden links.';\n      list.appendChild(empty);\n    } else {\n      hiddenLinks.forEach(link => {\n        const item = document.createElement('div');\n        item.className = 'map-hidden-item';\n        const label = document.createElement('span');\n        label.textContent = `${titleOf(link.a)} \u2194 ${titleOf(link.b)}`;\n        item.appendChild(label);\n        const btn = document.createElement('button');\n        btn.type = 'button';\n        btn.textContent = 'Unhide';\n        btn.addEventListener('click', () => {\n          applyLocalLinkHidden(link.a.id, link.b.id, false);\n          const forward = getLinkInfo(link.a.id, link.b.id);\n          if (forward) {\n            forward.hidden = false;\n            applyLinkVisibility(link.a.id, link.b.id, forward);\n          }\n          item.remove();\n          refreshToolboxBadges();\n          setLinkHidden(link.a.id, link.b.id, false)\n            .then(result => {\n              if (result) {\n                integrateItemUpdates(result.source, result.target);\n              } else {\n                return renderMap(mapState.root);\n              }\n              return null;\n            })\n            .catch(err => {\n              console.error(err);\n            });\n        });\n        item.appendChild(btn);\n        list.appendChild(item);\n      });\n    }\n    body.appendChild(list);\n  }\n\n  panel.appendChild(body);\n\n  container.appendChild(panel);\n\n  if (allowPanel && !mapState.panelVisible) {\n    const toggle = document.createElement('button');\n    toggle.type = 'button';\n    toggle.className = 'map-hidden-toggle';\n    toggle.textContent = 'Show menu';\n    toggle.addEventListener('click', () => {\n      mapState.panelVisible = true;\n      renderMap(mapState.root);\n    });\n    container.appendChild(toggle);\n  }\n}\n\nfunction startMenuDrag(item, event, options = {}) {\n  event.preventDefault();\n  const ghost = document.createElement('div');\n  ghost.className = 'map-drag-ghost';\n  ghost.textContent = titleOf(item) || item.id;\n  document.body.appendChild(ghost);\n  mapState.menuDrag = {\n    id: item.id,\n    ghost,\n    source: options.source || 'hidden',\n    tabId: options.tabId || (getActiveTab()?.id || null)\n  };\n  updateMenuDragPosition(event.clientX, event.clientY);\n}\n\nasync function finishMenuDrag(clientX, clientY) {\n  const drag = mapState.menuDrag;\n  mapState.menuDrag = null;\n  if (drag?.ghost) drag.ghost.remove();\n  if (!drag || !mapState.svg) return;\n  const rect = getSvgRect({ force: true });\n  if (!rect) return;\n  if (clientX < rect.left || clientX > rect.right || clientY < rect.top || clientY > rect.bottom) {\n    return;\n  }\n  const { x, y } = clientToMap(clientX, clientY);\n  const item = await getItem(drag.id);\n  if (!item) return;\n  if (drag.source === 'palette') {\n    const tab = getActiveTab();\n    if (!tab || !tab.manualMode) return;\n    if (drag.tabId && tab.id !== drag.tabId) return;\n    if (!Array.isArray(tab.manualIds)) {\n      tab.manualIds = [];\n    }\n    let shouldPersist = false;\n    if (!tab.manualIds.includes(item.id)) {\n      tab.manualIds.push(item.id);\n      shouldPersist = true;\n    }\n    item.mapHidden = false;\n    await upsertItem(item);\n    const layout = ensureTabLayout(tab);\n    const prev = layout[item.id];\n    layout[item.id] = { x, y };\n    if (!prev || prev.x !== x || prev.y !== y) {\n      shouldPersist = true;\n    }\n    if (shouldPersist) {\n      await persistMapConfig();\n    }\n    await renderMap(mapState.root);\n    return;\n  }\n  item.mapHidden = false;\n  await upsertItem(item);\n  const tab = getActiveTab();\n  if (tab) {\n    const layout = ensureTabLayout(tab);\n    const prev = layout[item.id];\n    layout[item.id] = { x, y };\n    if (!prev || prev.x !== x || prev.y !== y) {\n      await persistMapConfig();\n    }\n  }\n  await renderMap(mapState.root);\n}\n\nfunction updateMenuDragPosition(clientX, clientY) {\n  if (!mapState.menuDrag?.ghost) return;\n  mapState.menuDrag.ghost.style.left = `${clientX + 12}px`;\n  mapState.menuDrag.ghost.style.top = `${clientY + 12}px`;\n}\n\nfunction startToolboxDrag(event) {\n  if (event.button !== 0) return;\n  if (!mapState.toolboxEl || !mapState.toolboxContainer) return;\n  if (event.target.closest('.map-toolbox-toggle')) return;\n  event.preventDefault();\n  const boxRect = mapState.toolboxEl.getBoundingClientRect();\n  const containerRect = mapState.toolboxContainer.getBoundingClientRect();\n  mapState.toolboxDrag = {\n    offsetX: event.clientX - boxRect.left,\n    offsetY: event.clientY - boxRect.top,\n    boxWidth: boxRect.width,\n    boxHeight: boxRect.height,\n    containerRect\n  };\n  if (typeof document !== 'undefined') {\n    document.body.classList.add('map-toolbox-dragging');\n  }\n}\n\nfunction moveToolboxDrag(clientX, clientY) {\n  const drag = mapState.toolboxDrag;\n  if (!drag || !mapState.toolboxEl) return;\n  const { containerRect, offsetX, offsetY, boxWidth, boxHeight } = drag;\n  const width = containerRect.width;\n  const height = containerRect.height;\n  if (!width || !height) return;\n  let x = clientX - containerRect.left - offsetX;\n  let y = clientY - containerRect.top - offsetY;\n  const maxX = Math.max(0, width - boxWidth);\n  const maxY = Math.max(0, height - boxHeight);\n  x = clamp(x, 0, maxX);\n  y = clamp(y, 0, maxY);\n  mapState.toolboxPos = { x, y };\n  mapState.toolboxEl.style.left = `${x}px`;\n  mapState.toolboxEl.style.top = `${y}px`;\n}\n\nfunction stopToolboxDrag() {\n  if (typeof document !== 'undefined') {\n    document.body.classList.remove('map-toolbox-dragging');\n  }\n  if (!mapState.toolboxDrag) {\n    ensureToolboxWithinBounds();\n    return;\n  }\n  mapState.toolboxDrag = null;\n  ensureToolboxWithinBounds();\n}\n\nfunction ensureToolboxWithinBounds() {\n  const box = mapState.toolboxEl;\n  const container = mapState.toolboxContainer;\n  if (!box || !container || !box.isConnected || !container.isConnected) return;\n  const containerRect = container.getBoundingClientRect();\n  const boxRect = box.getBoundingClientRect();\n  const width = containerRect.width;\n  const height = containerRect.height;\n  if (!width || !height) return;\n  const maxX = Math.max(0, width - boxRect.width);\n  const maxY = Math.max(0, height - boxRect.height);\n  const x = clamp(mapState.toolboxPos.x, 0, maxX);\n  const y = clamp(mapState.toolboxPos.y, 0, maxY);\n  mapState.toolboxPos = { x, y };\n  box.style.left = `${x}px`;\n  box.style.top = `${y}px`;\n}\n\nfunction determineBaseCursor() {\n  if (mapState.draggingView || mapState.nodeDrag || mapState.areaDrag) return 'grabbing';\n  switch (mapState.tool) {\n    case TOOL.AREA:\n      return 'crosshair';\n    case TOOL.NAVIGATE:\n      return 'grab';\n    case TOOL.HIDE:\n    case TOOL.BREAK:\n    case TOOL.ADD_LINK:\n      return 'grab';\n    default:\n      return 'pointer';\n  }\n}\n\nfunction refreshCursor(options = {}) {\n  if (!mapState.svg) return;\n  const { keepOverride = false } = options;\n  const base = determineBaseCursor();\n  mapState.baseCursor = base;\n  if (mapState.cursorOverride) {\n    const overrideStyle = CURSOR_STYLE[mapState.cursorOverride];\n    if (keepOverride && overrideStyle) {\n      mapState.svg.style.cursor = overrideStyle;\n      return;\n    }\n    mapState.cursorOverride = null;\n  }\n  mapState.svg.style.cursor = base;\n}\n\nfunction applyCursorOverride(kind) {\n  if (!mapState.svg) return;\n  if (mapState.nodeDrag || mapState.areaDrag || mapState.draggingView) return;\n  const style = CURSOR_STYLE[kind];\n  if (!style) return;\n  mapState.cursorOverride = kind;\n  mapState.svg.style.cursor = style;\n}\n\nfunction clearCursorOverride(kind) {\n  if (mapState.cursorOverride !== kind) return;\n  mapState.cursorOverride = null;\n  refreshCursor();\n}\n\nasync function persistNodePosition(id, options = {}) {\n  const tab = getActiveTab();\n  if (!tab) return;\n  const pos = mapState.positions[id];\n  if (!pos) return;\n  const layout = ensureTabLayout(tab);\n  layout[id] = { x: pos.x, y: pos.y };\n  if (options.persist !== false) {\n    await persistMapConfig();\n  }\n}\n\nfunction gatherHiddenLinks(items, itemMap) {\n  const hidden = [];\n  const seen = new Set();\n  items.forEach(it => {\n    (it.links || []).forEach(link => {\n      if (!link.hidden) return;\n      const other = itemMap[link.id];\n      if (!other) return;\n      const key = it.id < link.id ? `${it.id}|${link.id}` : `${link.id}|${it.id}`;\n      if (seen.has(key)) return;\n      seen.add(key);\n      hidden.push({ a: it, b: other });\n    });\n  });\n  return hidden;\n}\n\nasync function handleAddLinkClick(nodeId) {\n  if (!mapState.pendingLink) {\n    mapState.pendingLink = nodeId;\n    updatePendingHighlight();\n    return;\n  }\n  if (mapState.pendingLink === nodeId) {\n    mapState.pendingLink = null;\n    updatePendingHighlight();\n    return;\n  }\n  const from = mapState.itemMap[mapState.pendingLink];\n  const to = mapState.itemMap[nodeId];\n  if (!from || !to) {\n    mapState.pendingLink = null;\n    updatePendingHighlight();\n    return;\n  }\n  const existing = (from.links || []).find(l => l.id === nodeId);\n  if (existing) {\n    if (existing.hidden) {\n      if (confirm('A hidden link already exists. Unhide it?')) {\n        applyLocalLinkHidden(from.id, to.id, false);\n        const forward = getLinkInfo(from.id, to.id);\n        if (forward) {\n          forward.hidden = false;\n          applyLinkVisibility(from.id, to.id, forward);\n        }\n        refreshToolboxBadges();\n        setLinkHidden(from.id, to.id, false)\n          .then(result => {\n            if (result) {\n              integrateItemUpdates(result.source, result.target);\n            } else {\n              return renderMap(mapState.root);\n            }\n            return null;\n          })\n          .catch(err => {\n            console.error(err);\n          });\n      }\n    } else {\n      alert('These concepts are already linked.');\n    }\n    mapState.pendingLink = null;\n    updatePendingHighlight();\n    return;\n  }\n  if (!confirm(`Create a link between ${titleOf(from)} and ${titleOf(to)}?`)) {\n    mapState.pendingLink = null;\n    updatePendingHighlight();\n    return;\n  }\n  const label = prompt('Optional label for this link:', '') || '';\n  const linkOptions = {\n    name: label,\n    color: DEFAULT_LINK_COLOR,\n    style: DEFAULT_LINE_STYLE,\n    decoration: DEFAULT_LINE_DECORATION,\n    decorationDirection: DEFAULT_DECORATION_DIRECTION,\n    glow: DEFAULT_LINE_GLOW,\n    thickness: DEFAULT_LINE_THICKNESS,\n    hidden: false\n  };\n  const optimistic = applyLocalLinkAddition(from.id, to.id, linkOptions);\n  const forwardInfo = optimistic?.forward\n    ? { ...optimistic.forward, hidden: false }\n    : { ...normalizeLinkEntry(to.id, linkOptions), hidden: false };\n  applyLinkVisibility(from.id, to.id, forwardInfo);\n  mapState.pendingLink = null;\n  updatePendingHighlight();\n  try {\n    const result = await createLink(from.id, to.id, linkOptions);\n    if (result) {\n      integrateItemUpdates(result.source, result.target);\n    } else {\n      await renderMap(mapState.root);\n    }\n  } catch (err) {\n    console.error(err);\n    await renderMap(mapState.root);\n  }\n}\n\nfunction openLinkAssistant(nodeId) {\n  const source = mapState.itemMap?.[nodeId];\n  if (!source) return;\n  mapState.pendingLink = nodeId;\n  updatePendingHighlight();\n  const win = createFloatingWindow({\n    title: `Link ${titleOf(source) || 'concept'}`,\n    width: 420,\n    onClose: () => {\n      if (mapState.pendingLink === nodeId) {\n        mapState.pendingLink = null;\n        updatePendingHighlight();\n      }\n    }\n  });\n\n  const container = document.createElement('div');\n  container.className = 'map-linker';\n\n  const hint = document.createElement('p');\n  hint.className = 'map-linker-hint';\n  hint.textContent = 'Search for another concept to connect to this one.';\n  container.appendChild(hint);\n\n  const labelField = document.createElement('label');\n  labelField.className = 'map-linker-field';\n  labelField.textContent = 'Link label (optional)';\n  const labelInput = document.createElement('input');\n  labelInput.type = 'text';\n  labelInput.className = 'input map-linker-label-input';\n  labelInput.placeholder = 'Add a short description for this relationship';\n  labelField.appendChild(labelInput);\n  container.appendChild(labelField);\n\n  const searchField = document.createElement('label');\n  searchField.className = 'map-linker-field';\n  searchField.textContent = 'Link to';\n  const searchInput = document.createElement('input');\n  searchInput.type = 'search';\n  searchInput.className = 'input map-linker-search';\n  searchInput.placeholder = 'Search concepts\u2026';\n  searchField.appendChild(searchInput);\n  container.appendChild(searchField);\n\n  const list = document.createElement('div');\n  list.className = 'map-linker-results';\n  container.appendChild(list);\n\n  const allItems = Object.values(mapState.itemMap || {});\n  const existingLinks = new Map();\n  (source.links || []).forEach(link => {\n    if (link?.id) {\n      existingLinks.set(link.id, link);\n    }\n  });\n\n  const renderResults = () => {\n    const query = searchInput.value.trim().toLowerCase();\n    list.innerHTML = '';\n    const matches = allItems\n      .filter(item => item && item.id !== source.id)\n      .filter(item => {\n        if (!query) return true;\n        const label = (titleOf(item) || '').toLowerCase();\n        return label.includes(query);\n      })\n      .sort((a, b) => (titleOf(a) || '').localeCompare(titleOf(b) || ''))\n      .slice(0, 15);\n\n    if (!matches.length) {\n      const empty = document.createElement('div');\n      empty.className = 'map-linker-empty';\n      empty.textContent = query ? 'No matching concepts.' : 'No available concepts to link.';\n      list.appendChild(empty);\n      return;\n    }\n\n    matches.forEach(target => {\n      const row = document.createElement('div');\n      row.className = 'map-linker-result';\n\n      const info = document.createElement('div');\n      info.className = 'map-linker-result-info';\n      const name = document.createElement('div');\n      name.className = 'map-linker-result-title';\n      name.textContent = titleOf(target) || target.id;\n      info.appendChild(name);\n      if (target.kind) {\n        const meta = document.createElement('div');\n        meta.className = 'map-linker-result-meta';\n        meta.textContent = target.kind;\n        info.appendChild(meta);\n      }\n      row.appendChild(info);\n\n      const actions = document.createElement('div');\n      actions.className = 'map-linker-result-actions';\n      const linkInfo = existingLinks.get(target.id);\n      if (linkInfo) {\n        const status = document.createElement('span');\n        status.className = 'map-linker-result-status';\n        status.textContent = linkInfo.hidden ? 'Hidden link' : 'Already linked';\n        actions.appendChild(status);\n        if (linkInfo.hidden) {\n          const unhideBtn = document.createElement('button');\n          unhideBtn.type = 'button';\n          unhideBtn.className = 'btn secondary';\n          unhideBtn.textContent = 'Unhide link';\n          unhideBtn.addEventListener('click', () => {\n            applyLocalLinkHidden(source.id, target.id, false);\n            const forward = getLinkInfo(source.id, target.id);\n            if (forward) {\n              forward.hidden = false;\n              existingLinks.set(target.id, forward);\n              applyLinkVisibility(source.id, target.id, forward);\n            }\n            updatePendingHighlight();\n            refreshToolboxBadges();\n            renderResults();\n            setLinkHidden(source.id, target.id, false)\n              .then(result => {\n                if (result) {\n                  integrateItemUpdates(result.source, result.target);\n                } else {\n                  return renderMap(mapState.root);\n                }\n                return null;\n              })\n              .catch(err => {\n                console.error(err);\n              });\n          });\n          actions.appendChild(unhideBtn);\n        }\n      } else {\n        const linkBtn = document.createElement('button');\n        linkBtn.type = 'button';\n        linkBtn.className = 'btn primary';\n        linkBtn.textContent = 'Link concepts';\n        linkBtn.addEventListener('click', async () => {\n          try {\n            const label = labelInput.value.trim();\n        const result = await createLink(source.id, target.id, {\n          name: label,\n          color: DEFAULT_LINK_COLOR,\n          style: DEFAULT_LINE_STYLE,\n          decoration: DEFAULT_LINE_DECORATION,\n          decorationDirection: DEFAULT_DECORATION_DIRECTION,\n          glow: DEFAULT_LINE_GLOW,\n          thickness: DEFAULT_LINE_THICKNESS,\n          hidden: false\n        });\n            if (result) {\n              integrateItemUpdates(result.source, result.target);\n              existingLinks.set(target.id, result.forward);\n              applyLinkVisibility(source.id, target.id, result.forward);\n              updatePendingHighlight();\n              labelInput.value = '';\n              requestAnimationFrame(() => {\n                searchInput.focus();\n                searchInput.select();\n              });\n              refreshToolboxBadges();\n              renderResults();\n            }\n          } catch (err) {\n            console.error(err);\n          }\n        });\n        actions.appendChild(linkBtn);\n      }\n\n      row.appendChild(actions);\n      list.appendChild(row);\n    });\n  };\n\n  searchInput.addEventListener('input', renderResults);\n\n  renderResults();\n  win.setContent(container);\n  requestAnimationFrame(() => {\n    searchInput.focus();\n    searchInput.select();\n  });\n}\n\nfunction handleEdgeClick(path, aId, bId, evt) {\n  hideEdgeTooltip(path);\n  if (mapState.edgeDragJustCompleted) {\n    mapState.edgeDragJustCompleted = false;\n    return;\n  }\n  if (mapState.tool === TOOL.NAVIGATE) {\n    openLineMenu(evt, path, aId, bId);\n  } else if (mapState.tool === TOOL.BREAK) {\n    if (confirm('Are you sure you want to delete this link?')) {\n      applyLocalLinkRemoval(aId, bId);\n      removeEdgeBetween(aId, bId);\n      updatePendingHighlight();\n      refreshToolboxBadges();\n      removeLink(aId, bId)\n        .then(result => {\n          if (result) {\n            integrateItemUpdates(result.source, result.target);\n          } else {\n            return renderMap(mapState.root);\n          }\n          return null;\n        })\n        .catch(err => {\n          console.error(err);\n        });\n    }\n  } else if (mapState.tool === TOOL.HIDE) {\n    if (confirm('Hide this link on the map?')) {\n      applyLocalLinkHidden(aId, bId, true);\n      applyLinkVisibility(aId, bId, { hidden: true });\n      updatePendingHighlight();\n      refreshToolboxBadges();\n      setLinkHidden(aId, bId, true)\n        .then(result => {\n          if (result) {\n            integrateItemUpdates(result.source, result.target);\n          } else {\n            return renderMap(mapState.root);\n          }\n          return null;\n        })\n        .catch(err => {\n          console.error(err);\n        });\n    }\n  }\n}\n\nfunction showEdgeTooltip(line, evt) {\n  const tooltip = mapState.edgeTooltip;\n  const container = mapState.container;\n  if (!tooltip || !container) return;\n  const text = line?.dataset?.label || '';\n  if (!text) {\n    hideEdgeTooltip(line);\n    return;\n  }\n  tooltip.textContent = text;\n  tooltip.classList.remove('hidden');\n  mapState.hoveredEdge = line;\n  if (evt && Number.isFinite(evt.clientX) && Number.isFinite(evt.clientY)) {\n    mapState.hoveredEdgePointer = { x: evt.clientX, y: evt.clientY };\n  }\n  positionEdgeTooltip(evt);\n}\n\nfunction moveEdgeTooltip(line, evt) {\n  if (mapState.hoveredEdge !== line) return;\n  if (!mapState.edgeTooltip || mapState.edgeTooltip.classList.contains('hidden')) return;\n  if (evt && Number.isFinite(evt.clientX) && Number.isFinite(evt.clientY)) {\n    mapState.hoveredEdgePointer = { x: evt.clientX, y: evt.clientY };\n  }\n  positionEdgeTooltip(evt);\n}\n\nfunction hideEdgeTooltip(line) {\n  if (line && mapState.hoveredEdge && mapState.hoveredEdge !== line) return;\n  const tooltip = mapState.edgeTooltip;\n  if (!tooltip) return;\n  tooltip.classList.add('hidden');\n  tooltip.textContent = '';\n  mapState.hoveredEdge = null;\n}\n\nfunction positionEdgeTooltip(evt) {\n  const tooltip = mapState.edgeTooltip;\n  const container = mapState.container;\n  if (!tooltip || !container) return;\n  const rect = container.getBoundingClientRect();\n  const pointer = evt && Number.isFinite(evt.clientX) && Number.isFinite(evt.clientY)\n    ? { x: evt.clientX, y: evt.clientY }\n    : mapState.hoveredEdgePointer;\n  const rawX = pointer.x - rect.left + 14;\n  const rawY = pointer.y - rect.top + 14;\n  const maxX = rect.width - tooltip.offsetWidth - 12;\n  const maxY = rect.height - tooltip.offsetHeight - 12;\n  const clampedX = clamp(rawX, 12, Math.max(12, maxX));\n  const clampedY = clamp(rawY, 12, Math.max(12, maxY));\n  tooltip.style.left = `${clampedX}px`;\n  tooltip.style.top = `${clampedY}px`;\n}\n\nfunction adjustScale() {\n  const svg = mapState.svg;\n  if (!svg) return;\n  const vb = svg.getAttribute('viewBox');\n  if (!vb) return;\n  const parts = vb.split(/\\s+/).map(Number);\n  const [, , w, h] = parts;\n  if (!Number.isFinite(w) || w <= 0) return;\n  const height = Number.isFinite(h) && h > 0 ? h : w;\n  const defaultSize = Number.isFinite(mapState.defaultViewSize) ? mapState.defaultViewSize : w;\n  const zoomRatio = w / defaultSize;\n  const normalized = clamp(zoomRatio, 0.35, 4.5);\n  const nodeScale = clamp(Math.pow(normalized, 0.28), 0.78, 1.6);\n  const labelScale = clamp(Math.pow(normalized, 0.34), 0.92, 2.85);\n  const lineScale = clamp(Math.pow(normalized, -0.4), 0.55, 2.1);\n\n  mapState.lastScaleSize = { w, h: height };\n  mapState.currentScales = { nodeScale, labelScale, lineScale, zoomRatio };\n  updateMarkerSizes();\n\n  mapState.elements.forEach((entry, id) => {\n    updateNodeGeometry(id, entry);\n  });\n\n  const allEdges = mapState.allEdges;\n  if (allEdges && allEdges.size) {\n    const stale = [];\n    allEdges.forEach(line => {\n      if (!line || !line.isConnected || !line.ownerSVGElement) {\n        stale.push(line);\n        return;\n      }\n      if (line.dataset.a && line.dataset.b) {\n        const geometry = getLineGeometry(line.dataset.a, line.dataset.b, { line });\n        if (geometry?.pathData) {\n          refreshEdgeGeometry(line, { geometry, animate: false });\n        } else {\n          removeEdgeAnimation(line);\n          removeLineHandles(line);\n          syncLineDecoration(line, geometry);\n          updateLineStrokeWidth(line);\n        }\n      } else {\n        updateLineStrokeWidth(line);\n        syncLineDecoration(line);\n      }\n    });\n    if (stale.length) {\n      stale.forEach(unregisterEdgeElement);\n    }\n  } else {\n    const edgeContainer = mapState.edgeLayer || svg;\n    edgeContainer.querySelectorAll('.map-edge').forEach(line => {\n      if (line.dataset.a && line.dataset.b) {\n        const geometry = getLineGeometry(line.dataset.a, line.dataset.b, { line });\n        if (geometry?.pathData) {\n          refreshEdgeGeometry(line, { geometry, animate: false });\n        } else {\n          removeEdgeAnimation(line);\n          removeLineHandles(line);\n          syncLineDecoration(line, geometry);\n          updateLineStrokeWidth(line);\n        }\n      } else {\n        updateLineStrokeWidth(line);\n        syncLineDecoration(line);\n      }\n    });\n  }\n}\n\nfunction getNodeBaseRadius(id) {\n  if (mapState.nodeRadii && mapState.nodeRadii.has(id)) {\n    return mapState.nodeRadii.get(id);\n  }\n  const entry = mapState.elements?.get(id);\n  if (entry?.circle) {\n    return Number(entry.circle.dataset.radius) || 20;\n  }\n  return 20;\n}\n\nfunction getNodeRadius(id) {\n  const base = getNodeBaseRadius(id);\n  const scales = getCurrentScales();\n  return base * (scales.nodeScale || 1);\n}\n\nfunction getNodeFill(item) {\n  if (!item || typeof item !== 'object') {\n    return 'var(--gray)';\n  }\n  if (item.color && typeof item.color === 'string') {\n    return item.color;\n  }\n  return KIND_FALLBACK_COLORS[item.kind] || 'var(--gray)';\n}\n\nfunction refreshNodeColor(id) {\n  const entry = mapState.elements?.get(id);\n  const item = mapState.itemMap?.[id];\n  if (entry?.circle && item) {\n    entry.circle.setAttribute('fill', getNodeFill(item));\n  }\n}\n\nfunction computeTrimmedSegment(aId, bId, options = {}) {\n  const positions = mapState.positions || {};\n  const a = positions[aId];\n  const b = positions[bId];\n  if (!a || !b) return null;\n  const dx = b.x - a.x;\n  const dy = b.y - a.y;\n  const len = Math.hypot(dx, dy);\n  if (!len) return null;\n  const ux = dx / len;\n  const uy = dy / len;\n  const extraA = Number(options.trimA) || 0;\n  const extraB = Number(options.trimB) || 0;\n  const trimA = Math.min(getNodeRadius(aId) + 6 + extraA, len / 2);\n  const trimB = Math.min(getNodeRadius(bId) + 6 + extraB, len / 2);\n  const startX = a.x + ux * trimA;\n  const startY = a.y + uy * trimA;\n  const endX = b.x - ux * trimB;\n  const endY = b.y - uy * trimB;\n  const trimmedLength = Math.hypot(endX - startX, endY - startY);\n  return {\n    startX,\n    startY,\n    endX,\n    endY,\n    ux,\n    uy,\n    trimmedLength: trimmedLength || 0\n  };\n}\n\nfunction getDefaultHandlePositions(count = CURVE_HANDLE_COUNT) {\n  const total = Math.max(0, Math.round(Number(count) || 0));\n  if (total <= 0) {\n    return [];\n  }\n  return Array.from({ length: total }, (_, idx) => {\n    const raw = (idx + 1) / (total + 1);\n    return clampHandlePosition(raw);\n  });\n}\n\nfunction clampHandleOffset(value) {\n  const num = Number(value);\n  if (!Number.isFinite(num)) return 0;\n  return clamp(num, -CURVE_HANDLE_MAX_OFFSET, CURVE_HANDLE_MAX_OFFSET);\n}\n\nfunction clampHandlePosition(value) {\n  const num = Number(value);\n  if (!Number.isFinite(num)) return DEFAULT_CURVE_ANCHOR;\n  return clamp(num, 0.08, 0.92);\n}\n\nfunction normalizeCurveHandle(entry) {\n  if (!entry) return null;\n  if (Array.isArray(entry)) {\n    if (entry.length < 2) return null;\n    return {\n      position: clampHandlePosition(entry[0]),\n      offset: clampHandleOffset(entry[1])\n    };\n  }\n  if (typeof entry === 'object') {\n    if (Object.prototype.hasOwnProperty.call(entry, 'position') || Object.prototype.hasOwnProperty.call(entry, 'offset')) {\n      return {\n        position: clampHandlePosition(entry.position),\n        offset: clampHandleOffset(entry.offset)\n      };\n    }\n  }\n  const num = Number(entry);\n  if (Number.isFinite(num)) {\n    return {\n      position: DEFAULT_CURVE_ANCHOR,\n      offset: clampHandleOffset(num)\n    };\n  }\n  return null;\n}\n\nfunction parseCurveHandles(value) {\n  if (!value) return null;\n  if (Array.isArray(value)) {\n    const normalized = value\n      .map(normalizeCurveHandle)\n      .filter(Boolean);\n    return normalized.length ? normalized : null;\n  }\n  if (typeof value === 'string') {\n    try {\n      const parsed = JSON.parse(value);\n      if (Array.isArray(parsed)) {\n        const normalized = parsed\n          .map(normalizeCurveHandle)\n          .filter(Boolean);\n        if (normalized.length) return normalized;\n      }\n    } catch {}\n    const pieces = value.split(/[|,\\s]+/).map(Number).filter(n => Number.isFinite(n));\n    if (pieces.length) {\n      const positions = getDefaultHandlePositions(pieces.length);\n      return pieces.map((offset, idx) => ({\n        position: positions[idx] ?? DEFAULT_CURVE_ANCHOR,\n        offset: clampHandleOffset(offset)\n      }));\n    }\n    return null;\n  }\n  if (typeof value === 'object') {\n    return parseCurveHandles(Object.values(value));\n  }\n  return null;\n}\n\nfunction mergeCurveHandles(baseHandles, overrides) {\n  const base = Array.isArray(baseHandles) ? baseHandles.map(handle => ({ position: handle.position, offset: handle.offset })) : [];\n  if (!Array.isArray(overrides) || !overrides.length) {\n    return base;\n  }\n  overrides.forEach(override => {\n    const handle = normalizeCurveHandle(override);\n    if (!handle) return;\n    if (!base.length) {\n      base.push({\n        position: clampHandlePosition(handle.position),\n        offset: clampHandleOffset(handle.offset)\n      });\n      return;\n    }\n    let bestIndex = 0;\n    let bestDist = Infinity;\n    base.forEach((candidate, idx) => {\n      const candidatePos = candidate?.position ?? DEFAULT_CURVE_ANCHOR;\n      const dist = Math.abs(candidatePos - handle.position);\n      if (dist < bestDist) {\n        bestDist = dist;\n        bestIndex = idx;\n      }\n    });\n    const nextPosition = Object.prototype.hasOwnProperty.call(handle, 'position')\n      ? clampHandlePosition(handle.position)\n      : clampHandlePosition(base[bestIndex].position);\n    const replacement = {\n      position: nextPosition,\n      offset: clampHandleOffset(handle.offset)\n    };\n    if (bestDist > 0.12) {\n      base.splice(bestIndex + (replacement.position > base[bestIndex].position ? 1 : 0), 0, replacement);\n    } else {\n      base[bestIndex] = replacement;\n    }\n  });\n  base.sort((a, b) => a.position - b.position);\n  return base;\n}\n\nfunction encodeCurveHandles(handles) {\n  if (!Array.isArray(handles) || !handles.length) return '';\n  const simplified = handles.map(handle => ({\n    position: clampHandlePosition(handle.position),\n    offset: clampHandleOffset(handle.offset)\n  }));\n  return JSON.stringify(simplified);\n}\n\nfunction getHandleWeight() {\n  return 1;\n}\n\nfunction resolveLineHandles(line, info = {}, overrides = {}, context = {}, options = {}) {\n  const datasetHandles = line?.dataset?.handles ? parseCurveHandles(line.dataset.handles) : null;\n  const hasExplicitHandles =\n    Object.prototype.hasOwnProperty.call(info, 'curveHandles')\n    || Object.prototype.hasOwnProperty.call(info, 'curvePoints')\n    || Object.prototype.hasOwnProperty.call(info, 'curveOffsets')\n    || Object.prototype.hasOwnProperty.call(info, 'handles');\n  const infoHandleSource = hasExplicitHandles\n    ? info.curveHandles ?? info.curvePoints ?? info.curveOffsets ?? info.handles\n    : undefined;\n  const infoHandles = parseCurveHandles(infoHandleSource);\n  const clearExisting = options?.clearExisting === true\n    || (hasExplicitHandles\n      && (!infoHandles || !infoHandles.length)\n      && (Array.isArray(infoHandleSource) ? infoHandleSource.length === 0 : infoHandleSource == null || infoHandleSource === ''));\n  let handles = [];\n  if (!clearExisting && datasetHandles && datasetHandles.length) {\n    handles = mergeCurveHandles(handles, datasetHandles);\n  }\n  if (infoHandles && infoHandles.length) {\n    handles = mergeCurveHandles(handles, infoHandles);\n  } else if (clearExisting) {\n    handles = [];\n  }\n\n  if (Number.isFinite(overrides.curveOverride)) {\n    const anchor = Number.isFinite(overrides.anchorOverride) ? overrides.anchorOverride : DEFAULT_CURVE_ANCHOR;\n    handles = mergeCurveHandles(handles, [{ position: anchor, offset: overrides.curveOverride }]);\n  }\n\n  return handles.map(handle => ({\n    position: clampHandlePosition(handle.position),\n    offset: clampHandleOffset(handle.offset)\n  }));\n}\n\nfunction distanceSq(a, b) {\n  if (!a || !b) return Infinity;\n  const dx = (a.x ?? 0) - (b.x ?? 0);\n  const dy = (a.y ?? 0) - (b.y ?? 0);\n  return dx * dx + dy * dy;\n}\n\nfunction segmentsIntersect(p1, p2, p3, p4) {\n  if (!p1 || !p2 || !p3 || !p4) return false;\n  const threshold = 1e-6;\n  if (distanceSq(p1, p3) < threshold || distanceSq(p1, p4) < threshold || distanceSq(p2, p3) < threshold || distanceSq(p2, p4) < threshold) {\n    return false;\n  }\n  const orient = (a, b, c) => (b.x - a.x) * (c.y - a.y) - (b.y - a.y) * (c.x - a.x);\n  const o1 = orient(p1, p2, p3);\n  const o2 = orient(p1, p2, p4);\n  const o3 = orient(p3, p4, p1);\n  const o4 = orient(p3, p4, p2);\n\n  if (Math.abs(o1) < threshold && onSegment(p1, p2, p3)) return true;\n  if (Math.abs(o2) < threshold && onSegment(p1, p2, p4)) return true;\n  if (Math.abs(o3) < threshold && onSegment(p3, p4, p1)) return true;\n  if (Math.abs(o4) < threshold && onSegment(p3, p4, p2)) return true;\n\n  return (o1 > 0) !== (o2 > 0) && (o3 > 0) !== (o4 > 0);\n}\n\nfunction onSegment(p, q, r) {\n  const minX = Math.min(p.x, r.x) - 0.001;\n  const maxX = Math.max(p.x, r.x) + 0.001;\n  const minY = Math.min(p.y, r.y) - 0.001;\n  const maxY = Math.max(p.y, r.y) + 0.001;\n  return q.x >= minX && q.x <= maxX && q.y >= minY && q.y <= maxY;\n}\n\nfunction buildCurvePoints(segment, handles) {\n  const { startX, startY, endX, endY, ux, uy } = segment;\n  const dx = endX - startX;\n  const dy = endY - startY;\n  const length = segment.trimmedLength || Math.hypot(dx, dy) || 1;\n  const nx = -uy;\n  const ny = ux;\n  const points = [{ x: startX, y: startY }];\n  const meta = [];\n  handles.forEach(handle => {\n    const position = clampHandlePosition(handle.position);\n    const baseX = startX + dx * position;\n    const baseY = startY + dy * position;\n    const normalized = clampHandleOffset(handle.offset);\n    const weight = getHandleWeight(position);\n    const offset = normalized * length * weight;\n    const point = {\n      x: baseX + nx * offset,\n      y: baseY + ny * offset\n    };\n    points.push(point);\n    meta.push({\n      position,\n      offset: normalized,\n      base: { x: baseX, y: baseY },\n      weight,\n      point\n    });\n  });\n  points.push({ x: endX, y: endY });\n  return { points, meta };\n}\n\nfunction buildCurveSegments(points) {\n  if (!Array.isArray(points) || points.length < 2) return [];\n  const segments = [];\n  for (let i = 0; i < points.length - 1; i += 1) {\n    const p0 = points[i === 0 ? i : i - 1];\n    const p1 = points[i];\n    const p2 = points[i + 1];\n    const p3 = points[i + 2 < points.length ? i + 2 : points.length - 1];\n    const c1 = {\n      x: p1.x + (p2.x - p0.x) / 6,\n      y: p1.y + (p2.y - p0.y) / 6\n    };\n    const c2 = {\n      x: p2.x - (p3.x - p1.x) / 6,\n      y: p2.y - (p3.y - p1.y) / 6\n    };\n    segments.push({\n      from: p1,\n      to: p2,\n      c1,\n      c2\n    });\n  }\n  return segments;\n}\n\nfunction cubicPoint(p0, c1, c2, p1, t) {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const t2 = t * t;\n  return {\n    x: mt2 * mt * p0.x + 3 * mt2 * t * c1.x + 3 * mt * t2 * c2.x + t * t2 * p1.x,\n    y: mt2 * mt * p0.y + 3 * mt2 * t * c1.y + 3 * mt * t2 * c2.y + t * t2 * p1.y\n  };\n}\n\nfunction cubicTangent(p0, c1, c2, p1, t) {\n  const dx = 3 * (1 - t) * (1 - t) * (c1.x - p0.x) + 6 * (1 - t) * t * (c2.x - c1.x) + 3 * t * t * (p1.x - c2.x);\n  const dy = 3 * (1 - t) * (1 - t) * (c1.y - p0.y) + 6 * (1 - t) * t * (c2.y - c1.y) + 3 * t * t * (p1.y - c2.y);\n  const len = Math.hypot(dx, dy) || 1;\n  return { x: dx / len, y: dy / len };\n}\n\nfunction approximateCubicLength(p0, c1, c2, p1) {\n  let prev = p0;\n  let length = 0;\n  const steps = 12;\n  for (let i = 1; i <= steps; i += 1) {\n    const t = i / steps;\n    const next = cubicPoint(p0, c1, c2, p1, t);\n    length += Math.hypot(next.x - prev.x, next.y - prev.y);\n    prev = next;\n  }\n  return length;\n}\n\nfunction buildPathData(start, segments) {\n  if (!start) return '';\n  if (!segments.length) return '';\n  let path = `M${start.x} ${start.y}`;\n  segments.forEach(segment => {\n    path += ` C${segment.c1.x} ${segment.c1.y} ${segment.c2.x} ${segment.c2.y} ${segment.to.x} ${segment.to.y}`;\n  });\n  return path;\n}\n\nfunction computeSegmentIntersectionPoint(a1, a2, b1, b2) {\n  const denom = (a1.x - a2.x) * (b1.y - b2.y) - (a1.y - a2.y) * (b1.x - b2.x);\n  if (!Number.isFinite(denom) || Math.abs(denom) < 1e-9) {\n    return null;\n  }\n  const detA = a1.x * a2.y - a1.y * a2.x;\n  const detB = b1.x * b2.y - b1.y * b2.x;\n  const x = (detA * (b1.x - b2.x) - (a1.x - a2.x) * detB) / denom;\n  const y = (detA * (b1.y - b2.y) - (a1.y - a2.y) * detB) / denom;\n  if (!Number.isFinite(x) || !Number.isFinite(y)) {\n    return null;\n  }\n  return { x, y };\n}\n\nfunction boundsOverlap(a, b, buffer = LINE_GAP_MIN_DISTANCE) {\n  if (!a || !b) return false;\n  return !(\n    a.maxX + buffer < b.minX\n    || a.minX - buffer > b.maxX\n    || a.maxY + buffer < b.minY\n    || a.minY - buffer > b.maxY\n  );\n}\n\nfunction segmentBoundsOverlap(a, b) {\n  return boundsOverlap(a, b, LINE_GAP_MIN_DISTANCE * 0.6);\n}\n\nfunction edgesShareEndpoint(lineA, lineB) {\n  if (!lineA?.dataset || !lineB?.dataset) return false;\n  const a1 = String(lineA.dataset.a ?? '');\n  const a2 = String(lineA.dataset.b ?? '');\n  const b1 = String(lineB.dataset.a ?? '');\n  const b2 = String(lineB.dataset.b ?? '');\n  return a1 === b1 || a1 === b2 || a2 === b1 || a2 === b2;\n}\n\nfunction computeSampledGeometry(geometry) {\n  if (!geometry) {\n    return { points: [], segments: [], bounds: null };\n  }\n  const points = [];\n  const segments = geometry.segments || [];\n  const start = { x: geometry.startX, y: geometry.startY };\n  if (Number.isFinite(start.x) && Number.isFinite(start.y)) {\n    points.push(start);\n  }\n  if (Array.isArray(segments) && segments.length) {\n    segments.forEach(segment => {\n      const length = approximateCubicLength(segment.from, segment.c1, segment.c2, segment.to);\n      const steps = Math.max(4, Math.ceil(length / 24));\n      for (let i = 1; i <= steps; i += 1) {\n        const t = i / steps;\n        const point = cubicPoint(segment.from, segment.c1, segment.c2, segment.to, t);\n        points.push(point);\n      }\n    });\n  } else {\n    points.push({ x: geometry.endX, y: geometry.endY });\n  }\n\n  const filtered = [];\n  points.forEach(point => {\n    if (!point || !Number.isFinite(point.x) || !Number.isFinite(point.y)) return;\n    const last = filtered[filtered.length - 1];\n    if (last && distanceSq(last, point) < 1e-6) return;\n    filtered.push(point);\n  });\n\n  const sampleSegments = [];\n  const bounds = { minX: Infinity, maxX: -Infinity, minY: Infinity, maxY: -Infinity };\n  filtered.forEach((point, index) => {\n    bounds.minX = Math.min(bounds.minX, point.x);\n    bounds.maxX = Math.max(bounds.maxX, point.x);\n    bounds.minY = Math.min(bounds.minY, point.y);\n    bounds.maxY = Math.max(bounds.maxY, point.y);\n    if (index === 0) return;\n    const prev = filtered[index - 1];\n    const segmentBounds = {\n      minX: Math.min(prev.x, point.x),\n      maxX: Math.max(prev.x, point.x),\n      minY: Math.min(prev.y, point.y),\n      maxY: Math.max(prev.y, point.y)\n    };\n    sampleSegments.push({ from: prev, to: point, bounds: segmentBounds });\n  });\n\n  if (!sampleSegments.length) {\n    return { points: filtered, segments: [], bounds: null };\n  }\n\n  return { points: filtered, segments: sampleSegments, bounds };\n}\n\nfunction getLineGapSample(line, geometry) {\n  if (!line) {\n    return computeSampledGeometry(geometry);\n  }\n  const key = geometry?.pathData || '';\n  const cached = line._gapSample;\n  if (cached && cached.key === key) {\n    return cached.value;\n  }\n  const value = computeSampledGeometry(geometry);\n  line._gapSample = { key, value };\n  return value;\n}\n\nfunction ensureLineGapLayer(line) {\n  if (!line) return null;\n  const parent = line.parentNode;\n  if (!parent) return null;\n  let layer = line._gapLayer;\n  if (!layer || layer.parentNode !== parent) {\n    if (layer?.parentNode) {\n      layer.remove();\n    }\n    layer = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    layer.classList.add('map-edge-gap-layer');\n    layer.setAttribute('pointer-events', 'none');\n    parent.appendChild(layer);\n    line._gapLayer = layer;\n  }\n  return layer;\n}\n\nfunction removeLineGap(line) {\n  if (!line) return;\n  if (line._gapLayer) {\n    line._gapLayer.remove();\n    line._gapLayer = null;\n  }\n  if (line._gapSample) {\n    line._gapSample = null;\n  }\n}\n\nfunction updateLineGapVisuals(line) {\n  if (!line?._gapLayer) return;\n  const baseWidth = Number(line.dataset?.baseWidth) || getLineThicknessValue(line.dataset?.thickness);\n  const strokeWidth = Math.max(baseWidth * LINE_GAP_STROKE_MULTIPLIER, baseWidth + 4);\n  const radius = Math.max(baseWidth * 0.75, 3);\n  line._gapLayer.querySelectorAll('.map-edge-gap').forEach(circle => {\n    circle.setAttribute('stroke-width', strokeWidth);\n    circle.setAttribute('r', radius);\n  });\n}\n\nfunction updateLineCrossovers(line, geometry, options = {}) {\n  removeLineGap(line);\n}\n\nfunction getPointAlongSegments(segments, ratio) {\n  if (!segments.length) return null;\n  const clamped = clamp(ratio, 0, 1);\n  let total = 0;\n  const lengths = segments.map(segment => {\n    const length = approximateCubicLength(segment.from, segment.c1, segment.c2, segment.to);\n    total += length;\n    return length;\n  });\n  if (!total) {\n    const first = segments[0].from;\n    const last = segments[segments.length - 1].to;\n    return {\n      point: {\n        x: first.x + (last.x - first.x) * clamped,\n        y: first.y + (last.y - first.y) * clamped\n      },\n      tangent: normalizeVector(last.x - first.x, last.y - first.y)\n    };\n  }\n  let accumulated = 0;\n  for (let i = 0; i < segments.length; i += 1) {\n    const segment = segments[i];\n    const length = lengths[i];\n    const nextAccum = accumulated + length;\n    const threshold = clamped * total;\n    if (threshold <= nextAccum || i === segments.length - 1) {\n      const remaining = threshold - accumulated;\n      const localT = length ? clamp(remaining / length, 0, 1) : 0;\n      const point = cubicPoint(segment.from, segment.c1, segment.c2, segment.to, localT);\n      const tangent = cubicTangent(segment.from, segment.c1, segment.c2, segment.to, localT);\n      return { point, tangent };\n    }\n    accumulated = nextAccum;\n  }\n  const lastSegment = segments[segments.length - 1];\n  const lastPoint = { ...lastSegment.to };\n  const tangent = cubicTangent(lastSegment.from, lastSegment.c1, lastSegment.c2, lastSegment.to, 1);\n  return { point: lastPoint, tangent };\n}\n\nfunction findNearestHandleIndex(geometry, pointer) {\n  if (!geometry || !Array.isArray(geometry.handles) || !geometry.handles.length || !pointer) {\n    return 0;\n  }\n  let bestIndex = 0;\n  let bestDist = Infinity;\n  geometry.handles.forEach((handle, index) => {\n    const px = handle.point?.x ?? handle.base?.x ?? 0;\n    const py = handle.point?.y ?? handle.base?.y ?? 0;\n    const dist = Math.hypot(pointer.x - px, pointer.y - py);\n    if (dist < bestDist) {\n      bestDist = dist;\n      bestIndex = index;\n    }\n  });\n  return bestIndex;\n}\n\nfunction buildHandleMetaFromPointer(geometry, pointer) {\n  if (!geometry || !pointer) return null;\n  const dx = geometry.endX - geometry.startX;\n  const dy = geometry.endY - geometry.startY;\n  const baseLength = geometry.trimmedLength || Math.hypot(dx, dy) || 1;\n  if (!baseLength) return null;\n  const projection = ((pointer.x - geometry.startX) * dx + (pointer.y - geometry.startY) * dy) / (baseLength * baseLength);\n  const position = clampHandlePosition(projection);\n  const baseX = geometry.startX + dx * position;\n  const baseY = geometry.startY + dy * position;\n  const nx = -geometry.uy;\n  const ny = geometry.ux;\n  const weight = getHandleWeight(position);\n  const rawOffset = ((pointer.x - baseX) * nx + (pointer.y - baseY) * ny) / (baseLength || 1);\n  const normalized = clampHandleOffset(rawOffset / (weight || 1));\n  const offsetDistance = normalized * baseLength * weight;\n  const point = {\n    x: baseX + nx * offsetDistance,\n    y: baseY + ny * offsetDistance\n  };\n  return { position, offset: normalized, base: { x: baseX, y: baseY }, weight, point };\n}\n\nfunction prepareHandlesForDrag(geometry, pointer, hintIndex = 0, options = {}) {\n  if (!geometry) {\n    return { handles: [], index: -1 };\n  }\n  const handles = Array.isArray(geometry.handles)\n    ? geometry.handles.map(handle => ({\n      position: clampHandlePosition(handle.position),\n      offset: clampHandleOffset(handle.offset),\n      base: handle.base,\n      point: handle.point,\n      weight: handle.weight ?? getHandleWeight(handle.position)\n    }))\n    : [];\n\n  const originalLength = handles.length;\n  let createdIndex = -1;\n  const { forceCreate = false } = options;\n  let insertedHandle = null;\n  let index = clamp(Math.round(hintIndex ?? 0), 0, Math.max(0, handles.length - 1));\n  const pointerMeta = pointer ? { x: pointer.x, y: pointer.y } : null;\n\n  if (pointerMeta) {\n    let nearestIndex = handles.length ? findNearestHandleIndex({ ...geometry, handles }, pointerMeta) : -1;\n    let nearestDistance = Infinity;\n    if (handles.length && nearestIndex >= 0) {\n      const candidate = handles[nearestIndex];\n      const px = candidate?.point?.x ?? candidate?.base?.x ?? geometry.startX;\n      const py = candidate?.point?.y ?? candidate?.base?.y ?? geometry.startY;\n      nearestDistance = Math.hypot(pointerMeta.x - px, pointerMeta.y - py);\n    }\n    const threshold = Math.max((geometry.baseWidth || 6) * 2.4, 26);\n    const shouldInsert = forceCreate || !handles.length || nearestDistance > threshold;\n    if (shouldInsert) {\n      const inserted = buildHandleMetaFromPointer(geometry, pointerMeta);\n      if (inserted) {\n        handles.push(inserted);\n        handles.sort((a, b) => a.position - b.position);\n        nearestIndex = handles.indexOf(inserted);\n        createdIndex = nearestIndex;\n        insertedHandle = inserted;\n      }\n    }\n    if (handles.length) {\n      const targetIndex = nearestIndex >= 0 ? nearestIndex : handles.indexOf(insertedHandle);\n      index = clamp(targetIndex >= 0 ? targetIndex : index, 0, handles.length - 1);\n    }\n  } else if (forceCreate) {\n    const defaultPointer = {\n      x: geometry.startX + (geometry.endX - geometry.startX) * DEFAULT_CURVE_ANCHOR,\n      y: geometry.startY + (geometry.endY - geometry.startY) * DEFAULT_CURVE_ANCHOR\n    };\n    const inserted = buildHandleMetaFromPointer(geometry, defaultPointer);\n    if (inserted) {\n      handles.push(inserted);\n      handles.sort((a, b) => a.position - b.position);\n      createdIndex = handles.indexOf(inserted);\n      index = clamp(createdIndex, 0, handles.length - 1);\n    }\n  }\n\n  geometry.handles = handles;\n  return { handles, index, createdIndex, originalLength };\n}\n\nfunction computeDecorationTrim(decoration, direction, baseWidth) {\n  const arrowAllowance = Math.max(22, baseWidth * 4.2);\n  const inhibitAllowance = Math.max(12, baseWidth * 2.6);\n  let trimA = 0;\n  let trimB = 0;\n  if (decoration === 'arrow') {\n    if (direction === 'start' || direction === 'both') {\n      trimA += arrowAllowance;\n    }\n    if (direction === 'end' || direction === 'both') {\n      trimB += arrowAllowance;\n    }\n  }\n  if (decoration === 'inhibit') {\n    if (direction === 'start' || direction === 'both') {\n      trimA += inhibitAllowance;\n    }\n    if (direction === 'end' || direction === 'both') {\n      trimB += inhibitAllowance;\n    }\n  }\n  return { trimA, trimB };\n}\n\nfunction getLineGeometry(aId, bId, options = {}) {\n  const line = options.line || null;\n  const appearanceSource = {\n    style: options.style ?? options.linkStyle ?? line?.dataset?.style,\n    decoration: options.decoration ?? line?.dataset?.decoration,\n    decorationDirection:\n      options.decorationDirection ?? options.direction ?? line?.dataset?.direction ?? line?.dataset?.decorationDirection,\n    glow: options.glow ?? line?.dataset?.glow\n  };\n  const appearance = normalizeLinkAppearance(appearanceSource);\n  const { style, decoration, decorationDirection } = appearance;\n  const thicknessKey = options.thickness ?? line?.dataset?.thickness ?? DEFAULT_LINE_THICKNESS;\n  const baseWidth = getLineThicknessValue(thicknessKey);\n  const trims = computeDecorationTrim(decoration, decorationDirection, baseWidth);\n  const segment = computeTrimmedSegment(aId, bId, trims);\n  if (!segment) return null;\n  let curveOverride;\n  if (Object.prototype.hasOwnProperty.call(options, 'curve')) {\n    const manual = Number(options.curve);\n    curveOverride = Number.isFinite(manual) ? clampHandleOffset(manual) : undefined;\n  } else if (line && Object.prototype.hasOwnProperty.call(line.dataset || {}, 'curve')) {\n    const manual = Number(line.dataset.curve);\n    curveOverride = Number.isFinite(manual) ? clampHandleOffset(manual) : undefined;\n  }\n\n  let anchorOverride;\n  if (Object.prototype.hasOwnProperty.call(options, 'anchor')) {\n    anchorOverride = normalizeAnchorValue(options.anchor);\n  } else if (Object.prototype.hasOwnProperty.call(options, 'curveAnchor')) {\n    anchorOverride = normalizeAnchorValue(options.curveAnchor);\n  } else if (line && Object.prototype.hasOwnProperty.call(line.dataset || {}, 'anchor')) {\n    anchorOverride = normalizeAnchorValue(line.dataset.anchor);\n  }\n\n  const handles = resolveLineHandles(\n    line,\n    options,\n    { curveOverride, anchorOverride },\n    { segment, aId, bId, decoration, decorationDirection }\n  );\n  const { points, meta } = buildCurvePoints(segment, handles);\n  const segments = buildCurveSegments(points);\n  const pathData = buildPathData(points[0], segments);\n  const mid = getPointAlongSegments(segments, 0.5) || { point: points[Math.floor(points.length / 2)], tangent: { x: segment.ux, y: segment.uy } };\n  const firstSegment = segments[0];\n  const lastSegment = segments[segments.length - 1];\n  const startTangent = firstSegment ? cubicTangent(firstSegment.from, firstSegment.c1, firstSegment.c2, firstSegment.to, 0) : { x: segment.ux, y: segment.uy };\n  const endTangent = lastSegment ? cubicTangent(lastSegment.from, lastSegment.c1, lastSegment.c2, lastSegment.to, 1) : { x: segment.ux, y: segment.uy };\n  let dominant = { position: DEFAULT_CURVE_ANCHOR, offset: 0 };\n  meta.forEach(handle => {\n    if (Math.abs(handle.offset) > Math.abs(dominant.offset)) {\n      dominant = { position: handle.position, offset: handle.offset };\n    }\n  });\n\n  const geometry = {\n    ...segment,\n    style,\n    decoration,\n    decorationDirection,\n    baseWidth,\n    anchor: dominant.position,\n    curve: dominant.offset,\n    handles: meta,\n    pathData,\n    startTangent,\n    endTangent,\n    midPoint: mid.point,\n    midTangent: mid.tangent,\n    segments\n  };\n\n  if (line) {\n    line._lastSegment = segment;\n  }\n\n  return geometry;\n}\n\nfunction calcPath(aId, bId, line = null, info = {}) {\n  const geometry = getLineGeometry(aId, bId, { ...info, line });\n  if (!geometry) return '';\n  return geometry.pathData || '';\n}\n\nfunction hashMarkerKey(input = '') {\n  const text = String(input);\n  let hash = 2166136261;\n  for (let i = 0; i < text.length; i += 1) {\n    hash ^= text.charCodeAt(i);\n    hash = Math.imul(hash, 16777619);\n  }\n  return (hash >>> 0).toString(36);\n}\n\nfunction applyMarkerColor(marker, color) {\n  if (!marker) return;\n  marker.setAttribute('color', color);\n  marker.style.color = color;\n  marker.querySelectorAll('path').forEach(path => {\n    path.setAttribute('fill', color);\n    path.setAttribute('stroke', color);\n  });\n}\n\nfunction ensureArrowMarker(color, direction) {\n  const defs = mapState.markerDefs;\n  if (!defs || !direction) {\n    return direction === 'start' ? 'arrow-start' : 'arrow-end';\n  }\n  const normalizedColor = (color || DEFAULT_LINK_COLOR).trim();\n  if (!mapState.lineMarkerCache) {\n    mapState.lineMarkerCache = new Map();\n  }\n  const key = `${direction}:${normalizedColor}`;\n  if (mapState.lineMarkerCache.has(key)) {\n    return mapState.lineMarkerCache.get(key);\n  }\n  const baseId = direction === 'start' ? 'arrow-start' : 'arrow-end';\n  const baseMarker = mapState.lineMarkers?.get(baseId) || document.getElementById(baseId);\n  const uniqueId = `${baseId}-${hashMarkerKey(key)}`;\n  let marker = mapState.lineMarkers?.get(uniqueId) || document.getElementById(uniqueId);\n  if (!marker) {\n    if (baseMarker) {\n      marker = baseMarker.cloneNode(true);\n    } else {\n      marker = document.createElementNS('http://www.w3.org/2000/svg', 'marker');\n      marker.setAttribute('viewBox', '0 0 16 16');\n      marker.setAttribute('markerUnits', 'strokeWidth');\n      marker.setAttribute('markerWidth', '9');\n      marker.setAttribute('markerHeight', '9');\n      marker.setAttribute('orient', 'auto');\n      const path = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n      const d = direction === 'start' ? 'M14 2 L2 8 L14 14 L10 8 Z' : 'M2 2 L14 8 L2 14 L6 8 Z';\n      path.setAttribute('d', d);\n      marker.appendChild(path);\n    }\n    marker.setAttribute('id', uniqueId);\n    defs.appendChild(marker);\n  }\n  applyMarkerColor(marker, normalizedColor);\n  if (mapState.lineMarkers) {\n    mapState.lineMarkers.set(uniqueId, marker);\n  }\n  mapState.lineMarkerCache.set(key, uniqueId);\n  updateMarkerSizes();\n  return uniqueId;\n}\n\n\nfunction applyLineStyle(line, info = {}) {\n  if (!line) return;\n  if (line.dataset && Object.prototype.hasOwnProperty.call(line.dataset, 'autoCurve')) {\n    delete line.dataset.autoCurve;\n  }\n  const previousColor = line.dataset.color;\n  const previousThickness = line.dataset.thickness;\n  const previousLabel = line.dataset.label;\n  const color = info.color ?? previousColor ?? DEFAULT_LINK_COLOR;\n  const thickness = info.thickness ?? previousThickness ?? DEFAULT_LINE_THICKNESS;\n  const label = info.name ?? previousLabel ?? '';\n\n  const datasetAppearance = {\n    style: line.dataset.style,\n    decoration: line.dataset.decoration,\n    decorationDirection: line.dataset.direction ?? line.dataset.decorationDirection,\n    glow: line.dataset.glow\n  };\n  const overrideAppearance = {};\n  if (Object.prototype.hasOwnProperty.call(info, 'style')) overrideAppearance.style = info.style;\n  if (Object.prototype.hasOwnProperty.call(info, 'decoration')) overrideAppearance.decoration = info.decoration;\n  if (Object.prototype.hasOwnProperty.call(info, 'decorationDirection')) {\n    overrideAppearance.decorationDirection = info.decorationDirection;\n  } else if (Object.prototype.hasOwnProperty.call(info, 'direction')) {\n    overrideAppearance.decorationDirection = info.direction;\n  }\n  if (Object.prototype.hasOwnProperty.call(info, 'glow')) overrideAppearance.glow = info.glow;\n  const appearance = normalizeLinkAppearance({\n    ...datasetAppearance,\n    ...overrideAppearance\n  });\n  const { style, decoration, decorationDirection, glow } = appearance;\n\n  line.dataset.color = color;\n  line.dataset.style = style;\n  if (decoration && decoration !== 'none') {\n    line.dataset.decoration = decoration;\n  } else {\n    delete line.dataset.decoration;\n  }\n  if (decorationDirection) {\n    line.dataset.direction = decorationDirection;\n  } else {\n    delete line.dataset.direction;\n  }\n  if (glow) {\n    line.dataset.glow = '1';\n  } else {\n    delete line.dataset.glow;\n  }\n  const baseWidthValue = getLineThicknessValue(thickness);\n  line.dataset.thickness = thickness;\n  line.dataset.baseWidth = String(baseWidthValue);\n  line.dataset.label = label;\n\n  const hasExplicitHandles =\n    Object.prototype.hasOwnProperty.call(info, 'curveHandles')\n    || Object.prototype.hasOwnProperty.call(info, 'curvePoints')\n    || Object.prototype.hasOwnProperty.call(info, 'curveOffsets')\n    || Object.prototype.hasOwnProperty.call(info, 'handles');\n  const handleSource = hasExplicitHandles\n    ? info.curveHandles ?? info.curvePoints ?? info.curveOffsets ?? info.handles\n    : undefined;\n  const shouldClearHandles = hasExplicitHandles\n    && (!handleSource || (Array.isArray(handleSource) && handleSource.length === 0));\n\n  let curveOverride = Object.prototype.hasOwnProperty.call(info, 'curve')\n    ? clampHandleOffset(info.curve)\n    : undefined;\n  let anchorOverride = Object.prototype.hasOwnProperty.call(info, 'anchor')\n    ? normalizeAnchorValue(info.anchor)\n    : Object.prototype.hasOwnProperty.call(info, 'curveAnchor')\n      ? normalizeAnchorValue(info.curveAnchor)\n      : undefined;\n  if (shouldClearHandles) {\n    curveOverride = undefined;\n    if (!Number.isFinite(anchorOverride)) {\n      anchorOverride = undefined;\n    }\n  }\n\n  const aId = line.dataset.a;\n  const bId = line.dataset.b;\n  let segmentContext = null;\n  if (aId && bId) {\n    segmentContext = computeTrimmedSegment(aId, bId, computeDecorationTrim(decoration, decorationDirection, baseWidthValue));\n  }\n  const handles = resolveLineHandles(\n    line,\n    info,\n    { curveOverride, anchorOverride },\n    { segment: segmentContext, aId, bId, decoration, decorationDirection },\n    { clearExisting: shouldClearHandles }\n  );\n  const encodedHandles = encodeCurveHandles(handles);\n  if (encodedHandles) {\n    line.dataset.handles = encodedHandles;\n  } else {\n    delete line.dataset.handles;\n  }\n\n  let dominant = { position: DEFAULT_CURVE_ANCHOR, offset: 0 };\n  handles.forEach(handle => {\n    if (Math.abs(handle.offset) > Math.abs(dominant.offset)) {\n      dominant = handle;\n    }\n  });\n  if (handles.length && Math.abs(dominant.offset) > 0.0001) {\n    line.dataset.curve = String(clampHandleOffset(dominant.offset));\n  } else {\n    delete line.dataset.curve;\n  }\n  if (handles.length && Number.isFinite(dominant.position)) {\n    line.dataset.anchor = String(clampHandlePosition(dominant.position));\n  } else {\n    delete line.dataset.anchor;\n  }\n\n  let geometry = null;\n  if (line.dataset.a && line.dataset.b) {\n    geometry = getLineGeometry(line.dataset.a, line.dataset.b, {\n      ...info,\n      style,\n      decoration,\n      decorationDirection,\n      curveHandles: handles,\n      curve: dominant.offset,\n      anchor: dominant.position,\n      line\n    });\n    if (geometry?.pathData) {\n      line.setAttribute('d', geometry.pathData);\n    }\n  }\n\n  line._lastGeometry = geometry || null;\n\n  updateLineCrossovers(line, geometry);\n\n  updateLineStrokeWidth(line);\n\n  syncLineHandles(line, geometry);\n\n  LINE_STYLE_CLASSNAMES.forEach(cls => line.classList.remove(cls));\n  if (style) {\n    line.classList.add(`map-edge--${style}`);\n  }\n  LINE_DECORATION_CLASSNAMES.forEach(cls => line.classList.remove(cls));\n  if (decoration && decoration !== 'none') {\n    line.classList.add(`map-edge--decoration-${decoration}`);\n  }\n  line.classList.toggle('map-edge--glow', glow);\n  line.classList.toggle('edge-glow', glow);\n\n  line.style.stroke = color;\n  line.style.color = color;\n  line.setAttribute('stroke', color);\n  line.setAttribute('color', color);\n  line.style.filter = '';\n  line.removeAttribute('marker-start');\n  line.removeAttribute('marker-end');\n  line.removeAttribute('marker-mid');\n  line.removeAttribute('stroke-dasharray');\n\n  if (style === 'dashed') {\n    const base = getLineThicknessValue(thickness);\n    line.setAttribute('stroke-dasharray', `${base * 3},${base * 2}`);\n    line.setAttribute('stroke-linecap', 'round');\n  } else if (style === 'dotted') {\n    const base = Math.max(1, getLineThicknessValue(thickness) * 0.9);\n    line.setAttribute('stroke-dasharray', `${base},${base * 2.1}`);\n    line.setAttribute('stroke-linecap', 'round');\n  } else {\n    line.removeAttribute('stroke-dasharray');\n    line.setAttribute('stroke-linecap', 'round');\n  }\n\n  if (decoration === 'arrow') {\n    if (decorationDirection === 'start' || decorationDirection === 'both') {\n      const startId = ensureArrowMarker(color, 'start');\n      line.setAttribute('marker-start', `url(#${startId})`);\n    }\n    if (decorationDirection === 'end' || decorationDirection === 'both') {\n      const endId = ensureArrowMarker(color, 'end');\n      line.setAttribute('marker-end', `url(#${endId})`);\n    }\n  }\n\n  const title = line.querySelector('title');\n  if (title) title.remove();\n  if (label) {\n    line.setAttribute('aria-label', label);\n  } else {\n    line.removeAttribute('aria-label');\n  }\n\n  if (mapState.hoveredEdge === line) {\n    if (label) {\n      showEdgeTooltip(line, { clientX: mapState.hoveredEdgePointer.x, clientY: mapState.hoveredEdgePointer.y });\n    } else {\n      hideEdgeTooltip(line);\n    }\n  }\n\n  syncLineDecoration(line, geometry);\n}\n\nfunction clamp(value, min, max) {\n  return Math.min(Math.max(value, min), max);\n}\n\nfunction normalizeAnchorValue(value) {\n  const num = Number(value);\n  if (!Number.isFinite(num)) return undefined;\n  return clamp(num, 0.1, 0.9);\n}\n\nfunction updateLineStrokeWidth(line) {\n  if (!line) return;\n  const baseWidth = Number(line.dataset.baseWidth) || getLineThicknessValue(line.dataset.thickness);\n  const { lineScale = 1 } = getCurrentScales();\n  const multiplier = line._hoverActive ? LINE_HOVER_WIDTH_MULTIPLIER : 1;\n  const strokeWidth = baseWidth * lineScale * multiplier;\n  if (Number.isFinite(strokeWidth)) {\n    line.setAttribute('stroke-width', strokeWidth);\n  }\n  if (line._overlay) {\n    const overlayBase = Number(line._overlay.dataset.baseWidth) || baseWidth * 0.85;\n    const overlayWidth = overlayBase * lineScale * multiplier;\n    if (Number.isFinite(overlayWidth)) {\n      line._overlay.setAttribute('stroke-width', overlayWidth);\n    }\n  }\n  updateLineGapVisuals(line);\n}\n\nfunction isLineHovered(line) {\n  if (!line) return false;\n  if (typeof line.matches === 'function' && line.matches(':hover')) {\n    return true;\n  }\n  if (Array.isArray(line._handleElements)) {\n    return line._handleElements.some(handle => typeof handle.matches === 'function' && handle.matches(':hover'));\n  }\n  return false;\n}\n\nfunction applyLineHover(line) {\n  if (!line || line._hoverActive) return;\n  line._hoverActive = true;\n  updateLineStrokeWidth(line);\n  line.classList.add('map-edge--hover');\n}\n\nfunction clearLineHover(line, options = {}) {\n  if (!line) return;\n  const { force = false } = options;\n  if (!force && isLineHovered(line)) {\n    return;\n  }\n  if (line._hoverActive) {\n    line._hoverActive = false;\n    updateLineStrokeWidth(line);\n  }\n  line.classList.remove('map-edge--hover');\n}\n\nfunction removeLineHandles(line) {\n  if (!line) return;\n  if (line._handleElements) {\n    line._handleElements.forEach(circle => circle.remove());\n  }\n  line._handleElements = null;\n  if (line._handleHideTimer) {\n    clearTimeout(line._handleHideTimer);\n    line._handleHideTimer = null;\n  }\n  if (line._handleStickyRelease) {\n    clearTimeout(line._handleStickyRelease);\n    line._handleStickyRelease = null;\n  }\n  line._handleVisible = false;\n  line._handleSticky = false;\n}\n\nfunction holdLineHandles(line) {\n  if (!line) return;\n  if (line._handleStickyRelease) {\n    clearTimeout(line._handleStickyRelease);\n    line._handleStickyRelease = null;\n  }\n  setLineHandlesVisible(line, true, { sticky: true });\n}\n\nfunction scheduleHandleRelease(line) {\n  if (!line) return;\n  if (line._handleStickyRelease) {\n    clearTimeout(line._handleStickyRelease);\n  }\n  line._handleStickyRelease = setTimeout(() => {\n    line._handleStickyRelease = null;\n    line._handleSticky = false;\n    if (!isLineHovered(line)) {\n      hideLineHandles(line, { force: true });\n    }\n  }, HANDLE_STICKY_RELEASE_DELAY);\n}\n\nfunction ensureLineHandles(line, geometry) {\n  if (!line) return;\n  const parent = line.parentNode;\n  if (!parent) {\n    removeLineHandles(line);\n    return;\n  }\n  const handles = Array.isArray(geometry?.handles) ? geometry.handles : [];\n  if (!handles.length) {\n    removeLineHandles(line);\n    return;\n  }\n  const elements = Array.isArray(line._handleElements) ? line._handleElements.slice() : [];\n  const nextElements = [];\n  const color = getLineStrokeColor(line);\n  const { lineScale = 1 } = getCurrentScales();\n  const baseRadius = clamp((geometry?.baseWidth || 3) * lineScale * 1.15 + 6, 6, 16);\n  const targetRadius = baseRadius + Math.max(6, baseRadius * 0.8);\n\n  const updateEntry = (entry, handle, index) => {\n    const point = handle?.point || handle?.base || {\n      x: geometry.startX + (geometry.endX - geometry.startX) * (handle?.position ?? DEFAULT_CURVE_ANCHOR),\n      y: geometry.startY + (geometry.endY - geometry.startY) * (handle?.position ?? DEFAULT_CURVE_ANCHOR)\n    };\n    entry.dataset.index = String(index);\n    entry.dataset.position = String(handle?.position ?? DEFAULT_CURVE_ANCHOR);\n    entry._target.dataset.index = entry.dataset.index;\n    entry._target.dataset.position = entry.dataset.position;\n    entry._target.setAttribute('cx', point.x);\n    entry._target.setAttribute('cy', point.y);\n    entry._target.setAttribute('r', targetRadius);\n    entry._visual.setAttribute('cx', point.x);\n    entry._visual.setAttribute('cy', point.y);\n    entry._visual.setAttribute('r', baseRadius);\n    entry._visual.style.stroke = color;\n    entry._visual.style.color = color;\n  };\n\n  const createHandleEntry = () => {\n    const wrapper = document.createElementNS('http://www.w3.org/2000/svg', 'g');\n    wrapper.classList.add('map-edge-handle');\n    const target = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n    target.classList.add('map-edge-handle__target');\n    target.setAttribute('fill', 'transparent');\n    target.setAttribute('stroke', 'rgba(34, 197, 94, 0)');\n    target.setAttribute('stroke-width', '10');\n    target.setAttribute('pointer-events', 'all');\n    target.style.cursor = 'grab';\n    target.style.transition = 'stroke 140ms ease, stroke-width 140ms ease';\n    const visual = document.createElementNS('http://www.w3.org/2000/svg', 'circle');\n    visual.classList.add('map-edge-handle__visual');\n    visual.setAttribute('fill', 'rgba(15, 23, 42, 0.85)');\n    visual.setAttribute('stroke-width', '2');\n    visual.setAttribute('pointer-events', 'none');\n    visual.style.transition = 'transform 140ms ease, fill 140ms ease, filter 140ms ease';\n    wrapper.append(target, visual);\n    wrapper._target = target;\n    wrapper._visual = visual;\n    wrapper._hoverActive = false;\n    wrapper._setHover = active => {\n      wrapper._hoverActive = active;\n      wrapper.classList.toggle('is-hovered', active);\n      target.setAttribute('stroke', active ? 'rgba(34, 197, 94, 0.6)' : 'rgba(34, 197, 94, 0)');\n      target.setAttribute('stroke-width', active ? '12' : '10');\n      visual.setAttribute('fill', active ? 'rgba(34, 197, 94, 0.82)' : 'rgba(15, 23, 42, 0.85)');\n      visual.style.filter = active ? 'drop-shadow(0 0 10px rgba(34, 197, 94, 0.45))' : '';\n      visual.style.transform = active ? 'scale(1.18)' : 'scale(1)';\n    };\n    target.addEventListener('pointerdown', evt => {\n      if (evt.button !== 0) return;\n      if (mapState.tool !== TOOL.NAVIGATE) return;\n      evt.stopPropagation();\n      if (typeof evt.preventDefault === 'function') {\n        evt.preventDefault();\n      }\n      const handleIndex = Number(evt.currentTarget?.dataset?.index) || 0;\n      startHandlePress(line, handleIndex, evt);\n    });\n    target.addEventListener('pointerenter', () => {\n      if (typeof wrapper._setHover === 'function') {\n        wrapper._setHover(true);\n      }\n      showLineHandles(line);\n      holdLineHandles(line);\n      applyLineHover(line);\n    });\n    target.addEventListener('pointerleave', () => {\n      if (typeof wrapper._setHover === 'function') {\n        wrapper._setHover(false);\n      }\n      scheduleHandleRelease(line);\n      clearLineHover(line);\n    });\n    target.addEventListener('pointercancel', () => {\n      if (typeof wrapper._setHover === 'function') {\n        wrapper._setHover(false);\n      }\n    });\n    parent.appendChild(wrapper);\n    return wrapper;\n  };\n\n  handles.forEach((handle, index) => {\n    let entry = elements.shift();\n    if (!entry) {\n      entry = createHandleEntry();\n    }\n    updateEntry(entry, handle, index);\n    nextElements.push(entry);\n  });\n\n  elements.forEach(entry => entry.remove());\n  line._handleElements = nextElements;\n  line._handleGeometry = geometry || null;\n}\n\nfunction setLineHandlesVisible(line, visible, options = {}) {\n  if (!line?._handleElements) return;\n  const { force = false, sticky } = options;\n  if (typeof sticky === 'boolean') {\n    line._handleSticky = sticky;\n  }\n  if (!visible && line._handleSticky && !force) {\n    return;\n  }\n  if (line._handleHideTimer) {\n    clearTimeout(line._handleHideTimer);\n    line._handleHideTimer = null;\n  }\n  line._handleElements.forEach(entry => {\n    if (!visible && typeof entry._setHover === 'function') {\n      entry._setHover(false);\n    }\n    entry.classList.toggle('visible', visible);\n    if (entry._target) {\n      entry._target.style.pointerEvents = visible ? 'auto' : 'none';\n    }\n  });\n  line._handleVisible = visible;\n}\n\nfunction showLineHandles(line, geometry = null) {\n  if (!line) return;\n  const geo = geometry || getLineGeometry(line.dataset?.a, line.dataset?.b, { line });\n  if (!geo) return;\n  ensureLineHandles(line, geo);\n  setLineHandlesVisible(line, true);\n}\n\nfunction hideLineHandles(line, options = {}) {\n  if (!line) return;\n  const { force = false } = options;\n  if (line._handleSticky && !force) {\n    return;\n  }\n  if (line._handleStickyRelease) {\n    clearTimeout(line._handleStickyRelease);\n    line._handleStickyRelease = null;\n  }\n  if (line._handleHideTimer) {\n    clearTimeout(line._handleHideTimer);\n  }\n  const delay = force ? 0 : 120;\n  line._handleHideTimer = setTimeout(() => {\n    line._handleHideTimer = null;\n    if ((line._handleSticky && !force) || (!force && isLineHovered(line))) {\n      if (!force) {\n        setLineHandlesVisible(line, true, { force: true });\n      }\n      return;\n    }\n    setLineHandlesVisible(line, false, { force: true });\n    if (!isLineHovered(line) || force) {\n      clearLineHover(line, { force: true });\n    }\n  }, delay);\n}\n\nfunction syncLineHandles(line, geometry = null) {\n  if (!line) return;\n  if (!line._handleElements || (!line._handleVisible && !line._handleSticky && mapState.edgeDrag?.line !== line)) {\n    return;\n  }\n  const geo = geometry || getLineGeometry(line.dataset?.a, line.dataset?.b, { line });\n  if (!geo) return;\n  ensureLineHandles(line, geo);\n  if (line._handleVisible) {\n    setLineHandlesVisible(line, true, { force: true });\n  }\n}\n\nfunction syncLineDecoration(line, geometry = null) {\n  const decoration = line?.dataset?.decoration || DEFAULT_LINE_DECORATION;\n  if (decoration === 'block') {\n    const overlay = ensureLineOverlay(line);\n    if (overlay) updateBlockedOverlay(line, overlay, geometry);\n  } else if (decoration === 'inhibit') {\n    const overlay = ensureLineOverlay(line);\n    if (overlay) updateInhibitOverlay(line, overlay, geometry);\n  } else {\n    removeLineOverlay(line);\n  }\n}\n\nfunction getLineStrokeColor(line) {\n  if (!line) return DEFAULT_LINK_COLOR;\n  return line.dataset?.color || line.getAttribute?.('stroke') || DEFAULT_LINK_COLOR;\n}\n\nfunction ensureLineOverlay(line) {\n  if (!line || !line.parentNode) return null;\n  let overlay = line._overlay;\n  if (overlay && overlay.parentNode !== line.parentNode) {\n    overlay.remove();\n    overlay = null;\n  }\n  if (!overlay) {\n    overlay = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n    overlay.classList.add('map-edge-decoration');\n    overlay.setAttribute('fill', 'none');\n    overlay.setAttribute('pointer-events', 'none');\n    overlay.setAttribute('stroke-linecap', 'round');\n    overlay.setAttribute('stroke-linejoin', 'round');\n    line.parentNode.insertBefore(overlay, line.nextSibling);\n    line._overlay = overlay;\n  }\n  return overlay;\n}\n\nfunction removeLineOverlay(line) {\n  if (line && line._overlay) {\n    line._overlay.remove();\n    line._overlay = null;\n  }\n}\n\nfunction normalizeVector(x, y) {\n  const len = Math.hypot(x, y) || 1;\n  return { x: x / len, y: y / len };\n}\n\nfunction updateBlockedOverlay(line, overlay, geometryOverride = null) {\n  if (!line || !overlay) return;\n  const geometry = geometryOverride || getLineGeometry(line.dataset.a, line.dataset.b, { line });\n  if (!geometry) return;\n  const mid = geometry.midPoint || {\n    x: (geometry.startX + geometry.endX) / 2,\n    y: (geometry.startY + geometry.endY) / 2\n  };\n  const tangent = geometry.midTangent || { x: geometry.ux, y: geometry.uy };\n  const normal = { x: -tangent.y, y: tangent.x };\n  const diag1 = normalizeVector(tangent.x + normal.x, tangent.y + normal.y);\n  const diag2 = normalizeVector(tangent.x - normal.x, tangent.y - normal.y);\n  const { lineScale = 1 } = getCurrentScales();\n  const scaledWidth = geometry.baseWidth * lineScale;\n  const armLength = Math.max(26, scaledWidth * 3.8);\n  const pathData =\n    `M${mid.x - diag1.x * armLength} ${mid.y - diag1.y * armLength}`\n    + ` L${mid.x + diag1.x * armLength} ${mid.y + diag1.y * armLength}`\n    + ` M${mid.x - diag2.x * armLength} ${mid.y - diag2.y * armLength}`\n    + ` L${mid.x + diag2.x * armLength} ${mid.y + diag2.y * armLength}`;\n  overlay.setAttribute('d', pathData);\n  const overlayBase = Math.max(geometry.baseWidth * 1.35, 2.8);\n  overlay.dataset.baseWidth = String(overlayBase);\n  overlay.dataset.decoration = 'block';\n  const color = getLineStrokeColor(line);\n  overlay.setAttribute('stroke', color);\n  overlay.style.stroke = color;\n  overlay.setAttribute('stroke-width', overlayBase * lineScale);\n}\n\nfunction ensureItemLinks(item) {\n  if (!item) return [];\n  if (!Array.isArray(item.links)) {\n    item.links = [];\n  }\n  return item.links;\n}\n\nfunction applyLocalLinkAddition(aId, bId, info = {}) {\n  const source = mapState.itemMap?.[aId];\n  const target = mapState.itemMap?.[bId];\n  if (!source || !target) return null;\n  const forward = normalizeLinkEntry(bId, info);\n  const reverse = normalizeLinkEntry(aId, info);\n  if (reverse.decoration && reverse.decoration !== 'none' && reverse.decoration !== 'block') {\n    reverse.decorationDirection = flipDecorationDirection(forward.decorationDirection);\n  }\n  source.links = ensureItemLinks(source).filter(link => String(link?.id) !== String(bId));\n  target.links = ensureItemLinks(target).filter(link => String(link?.id) !== String(aId));\n  source.links.push({ ...forward });\n  target.links.push({ ...reverse });\n  return { forward: { ...forward }, reverse: { ...reverse }, source, target };\n}\n\nfunction applyLocalLinkHidden(aId, bId, hidden) {\n  const source = mapState.itemMap?.[aId];\n  const target = mapState.itemMap?.[bId];\n  if (source) {\n    ensureItemLinks(source).forEach(link => {\n      if (String(link?.id) === String(bId)) {\n        link.hidden = hidden;\n      }\n    });\n  }\n  if (target) {\n    ensureItemLinks(target).forEach(link => {\n      if (String(link?.id) === String(aId)) {\n        link.hidden = hidden;\n      }\n    });\n  }\n}\n\nfunction applyLocalLinkRemoval(aId, bId) {\n  const source = mapState.itemMap?.[aId];\n  const target = mapState.itemMap?.[bId];\n  if (source) {\n    source.links = ensureItemLinks(source).filter(link => String(link?.id) !== String(bId));\n  }\n  if (target) {\n    target.links = ensureItemLinks(target).filter(link => String(link?.id) !== String(aId));\n  }\n}\n\nfunction applyLocalNodeHidden(id, hidden) {\n  const item = mapState.itemMap?.[id];\n  if (item) {\n    item.mapHidden = hidden;\n  }\n  if (!hidden) {\n    return;\n  }\n  if (mapState.selectionIds?.length) {\n    mapState.selectionIds = mapState.selectionIds.filter(selected => selected !== id);\n    updateSelectionHighlight();\n  }\n  if (mapState.positions && Object.prototype.hasOwnProperty.call(mapState.positions, id)) {\n    delete mapState.positions[id];\n  }\n  const entry = mapState.elements.get(id);\n  if (entry) {\n    entry.circle?.remove();\n    entry.label?.remove();\n    mapState.elements.delete(id);\n  }\n  if (mapState.edgeRefs) {\n    const edges = mapState.edgeRefs.get(String(id));\n    if (edges && edges.size) {\n      Array.from(edges).forEach(edge => {\n        const other = edge?.dataset?.a === String(id) ? edge?.dataset?.b : edge?.dataset?.a;\n        if (other) {\n          applyLinkVisibility(id, other, { hidden: true });\n        }\n      });\n    }\n  }\n  updatePendingHighlight();\n}\n\nfunction updateInhibitOverlay(line, overlay, geometryOverride = null) {\n  if (!line || !overlay) return;\n  const geometry = geometryOverride || getLineGeometry(line.dataset.a, line.dataset.b, { line });\n  if (!geometry) return;\n  const start = { x: geometry.startX, y: geometry.startY };\n  const end = { x: geometry.endX, y: geometry.endY };\n  const { lineScale = 1 } = getCurrentScales();\n  const scaledWidth = geometry.baseWidth * lineScale;\n  const stemLength = Math.max(24, scaledWidth * 4.4);\n  const barLength = Math.max(22, scaledWidth * 3.2);\n  const retreat = Math.max(8, scaledWidth * 1.35);\n  const segments = [];\n  const buildSegment = (tip, tangent, directionSign) => {\n    const stemStart = { x: tip.x - tangent.x * stemLength * directionSign, y: tip.y - tangent.y * stemLength * directionSign };\n    const mid = { x: tip.x - tangent.x * retreat * directionSign, y: tip.y - tangent.y * retreat * directionSign };\n    const normal = { x: -tangent.y, y: tangent.x };\n    const halfBar = barLength / 2;\n    const barA = { x: mid.x + normal.x * halfBar, y: mid.y + normal.y * halfBar };\n    const barB = { x: mid.x - normal.x * halfBar, y: mid.y - normal.y * halfBar };\n    return `M${stemStart.x} ${stemStart.y} L${tip.x} ${tip.y} M${barA.x} ${barA.y} L${barB.x} ${barB.y}`;\n  };\n  const direction = geometry.decorationDirection || line.dataset.direction || DEFAULT_DECORATION_DIRECTION;\n  if (direction === 'start' || direction === 'both') {\n    const tangentStart = geometry.startTangent || { x: geometry.ux, y: geometry.uy };\n    segments.push(buildSegment(start, tangentStart, -1));\n  }\n  if (direction === 'end' || direction === 'both') {\n    const tangentEnd = geometry.endTangent || { x: geometry.ux, y: geometry.uy };\n    segments.push(buildSegment(end, tangentEnd, 1));\n  }\n  overlay.setAttribute('d', segments.join(' '));\n  const overlayBase = Math.max(geometry.baseWidth * 0.95, 2.6);\n  overlay.dataset.baseWidth = String(overlayBase);\n  overlay.dataset.decoration = 'inhibit';\n  overlay.dataset.direction = direction;\n  const color = getLineStrokeColor(line);\n  overlay.setAttribute('stroke', color);\n  overlay.style.stroke = color;\n  overlay.setAttribute('stroke-width', overlayBase * lineScale);\n}\n\nasync function setNodeHidden(id, hidden) {\n  const item = await getItem(id);\n  if (!item) return;\n  item.mapHidden = hidden;\n  await upsertItem(item);\n}\n\nasync function createLink(aId, bId, info) {\n  const a = await getItem(aId);\n  const b = await getItem(bId);\n  if (!a || !b) return null;\n  const linkInfo = normalizeLinkEntry(bId, info);\n  const reverseInfo = normalizeLinkEntry(aId, info);\n  if (reverseInfo.decoration && reverseInfo.decoration !== 'none' && reverseInfo.decoration !== 'block') {\n    reverseInfo.decorationDirection = flipDecorationDirection(linkInfo.decorationDirection);\n  }\n  a.links = Array.isArray(a.links) ? a.links.filter(l => String(l?.id) !== String(bId)) : [];\n  b.links = Array.isArray(b.links) ? b.links.filter(l => String(l?.id) !== String(aId)) : [];\n  a.links.push({ ...linkInfo });\n  b.links.push({ ...reverseInfo });\n  await upsertItem(a);\n  await upsertItem(b);\n  return { source: a, target: b, forward: { ...linkInfo }, reverse: { ...reverseInfo } };\n}\n\nasync function removeLink(aId, bId) {\n  const a = await getItem(aId);\n  const b = await getItem(bId);\n  if (!a || !b) return null;\n  a.links = (a.links || []).filter(l => l.id !== bId);\n  b.links = (b.links || []).filter(l => l.id !== aId);\n  await upsertItem(a);\n  await upsertItem(b);\n  return { source: a, target: b };\n}\n\nasync function setLinkHidden(aId, bId, hidden) {\n  return updateLink(aId, bId, { hidden });\n}\n\nfunction titleOf(item) {\n  return item?.name || item?.concept || '';\n}\n\nfunction closeLineMenu(options = {}) {\n  const { commit = false } = options;\n  const active = mapState.activeLineMenu;\n  if (!active) return;\n  if (active.cleanup) {\n    try {\n      active.cleanup();\n    } catch {}\n  }\n  if (!commit && active.restore) {\n    try {\n      active.restore();\n    } catch {}\n  }\n  if (active.menu?.parentNode) {\n    active.menu.remove();\n  }\n  mapState.activeLineMenu = null;\n}\n\nfunction positionLineMenu(menu, pageX, pageY) {\n  if (!menu) return;\n  const margin = 12;\n  const width = menu.offsetWidth || 0;\n  const height = menu.offsetHeight || 0;\n  const viewportWidth = (typeof window !== 'undefined' && window.innerWidth) || document.documentElement.clientWidth || width;\n  const viewportHeight = (typeof window !== 'undefined' && window.innerHeight) || document.documentElement.clientHeight || height;\n  const scrollX = typeof window !== 'undefined' ? window.scrollX : document.documentElement?.scrollLeft || 0;\n  const scrollY = typeof window !== 'undefined' ? window.scrollY : document.documentElement?.scrollTop || 0;\n  const left = clamp(pageX + margin, margin + scrollX, scrollX + viewportWidth - width - margin);\n  const top = clamp(pageY + margin, margin + scrollY, scrollY + viewportHeight - height - margin);\n  menu.style.left = `${left}px`;\n  menu.style.top = `${top}px`;\n}\n\nasync function openLineMenu(evt, line, aId, bId) {\n  closeLineMenu();\n\n  const existing = await getItem(aId);\n  if (!existing) return;\n  const link = existing.links.find(l => l.id === bId) || {};\n  const appearance = normalizeLinkAppearance({\n    style: link.style ?? link.linkStyle ?? DEFAULT_LINE_STYLE,\n    decoration: link.decoration,\n    decorationDirection: link.decorationDirection,\n    glow: link.glow\n  });\n  const initial = {\n    color: line?.dataset?.color || link.color || DEFAULT_LINK_COLOR,\n    style: line?.dataset?.style || appearance.style,\n    decoration: line?.dataset?.decoration || appearance.decoration,\n    decorationDirection:\n      line?.dataset?.direction\n        || line?.dataset?.decorationDirection\n        || appearance.decorationDirection\n        || DEFAULT_DECORATION_DIRECTION,\n    glow: line?.dataset?.glow === '1' || Boolean(appearance.glow),\n    thickness: line?.dataset?.thickness || link.thickness || DEFAULT_LINE_THICKNESS,\n    name: line?.dataset?.label || link.name || ''\n  };\n\n  const existingHandles = parseCurveHandles(line?.dataset?.handles) || [];\n  const initialCurveMagnitude = Math.abs(Number(line?.dataset?.curve || 0));\n  const canStraighten = existingHandles.length > 0 || initialCurveMagnitude > 0.001;\n\n  const menu = document.createElement('div');\n  menu.className = 'line-menu';\n\n  const header = document.createElement('div');\n  header.className = 'line-menu__header';\n  const titleEl = document.createElement('h3');\n  titleEl.textContent = 'Line styling';\n  header.appendChild(titleEl);\n  const closeBtn = document.createElement('button');\n  closeBtn.type = 'button';\n  closeBtn.className = 'line-menu__close';\n  closeBtn.innerHTML = ICONS.close;\n  closeBtn.addEventListener('click', () => closeLineMenu());\n  header.appendChild(closeBtn);\n  menu.appendChild(header);\n\n  const body = document.createElement('div');\n  body.className = 'line-menu__body';\n  menu.appendChild(body);\n\n  const colorLabel = document.createElement('label');\n  colorLabel.className = 'line-menu__field';\n  colorLabel.textContent = 'Color';\n  const colorInput = document.createElement('input');\n  colorInput.type = 'color';\n  colorInput.value = /^#([0-9a-f]{3}|[0-9a-f]{6})$/i.test(initial.color) ? initial.color : '#888888';\n  colorLabel.appendChild(colorInput);\n  body.appendChild(colorLabel);\n\n  const typeLabel = document.createElement('label');\n  typeLabel.className = 'line-menu__field';\n  typeLabel.textContent = 'Line type';\n  const typeSel = document.createElement('select');\n  LINE_TYPE_PRESETS.forEach(option => {\n    const opt = document.createElement('option');\n    opt.value = option.value;\n    opt.textContent = option.label;\n    typeSel.appendChild(opt);\n  });\n  const initialPresetValue = inferLineTypePreset(initial.style, initial.decoration);\n  typeSel.value = initialPresetValue;\n  typeLabel.appendChild(typeSel);\n  const typeRow = document.createElement('div');\n  typeRow.className = 'line-menu__row';\n  typeRow.appendChild(typeLabel);\n  const flipBtn = document.createElement('button');\n  flipBtn.type = 'button';\n  flipBtn.className = 'btn ghost';\n  flipBtn.textContent = 'Flip direction';\n  typeRow.appendChild(flipBtn);\n  body.appendChild(typeRow);\n\n  let currentDirection = initial.decoration === 'arrow' || initial.decoration === 'inhibit'\n    ? initial.decorationDirection\n    : DEFAULT_DECORATION_DIRECTION;\n\n  const glowField = document.createElement('label');\n  glowField.className = 'line-menu-toggle';\n  const glowInput = document.createElement('input');\n  glowInput.type = 'checkbox';\n  glowInput.checked = initial.glow;\n  glowField.appendChild(glowInput);\n  glowField.appendChild(document.createTextNode(' Glow highlight'));\n  body.appendChild(glowField);\n\n  const thickLabel = document.createElement('label');\n  thickLabel.className = 'line-menu__field';\n  thickLabel.textContent = 'Thickness';\n  const thickSel = document.createElement('select');\n  LINE_THICKNESS_OPTIONS.forEach(option => {\n    const opt = document.createElement('option');\n    opt.value = option.value;\n    opt.textContent = option.label;\n    thickSel.appendChild(opt);\n  });\n  thickSel.value = initial.thickness;\n  thickLabel.appendChild(thickSel);\n  body.appendChild(thickLabel);\n\n  const nameLabel = document.createElement('label');\n  nameLabel.className = 'line-menu__field';\n  nameLabel.textContent = 'Label';\n  const nameInput = document.createElement('input');\n  nameInput.type = 'text';\n  nameInput.value = initial.name;\n  nameLabel.appendChild(nameInput);\n  body.appendChild(nameLabel);\n\n  let updateStraightenState = () => {};\n\n  const buildPatch = () => {\n    const preset = getLineTypePreset(typeSel.value);\n    const styleValue = preset?.style ?? DEFAULT_LINE_STYLE;\n    const decorationValue = preset?.decoration ?? DEFAULT_LINE_DECORATION;\n    const directional = isDirectionalPreset(preset);\n    const directionValue = directional\n      ? normalizeDecorationDirection(currentDirection, decorationValue, styleValue)\n      : DEFAULT_DECORATION_DIRECTION;\n    return {\n      color: colorInput.value,\n      style: styleValue,\n      decoration: decorationValue,\n      decorationDirection: directionValue,\n      glow: glowInput.checked,\n      thickness: thickSel.value,\n      name: nameInput.value\n    };\n  };\n\n  const applyPreview = () => {\n    applyLineStyle(line, buildPatch());\n    updateStraightenState();\n  };\n\n  const updateFlipState = () => {\n    const preset = getLineTypePreset(typeSel.value);\n    const directional = isDirectionalPreset(preset);\n    if (directional) {\n      currentDirection = normalizeDecorationDirection(currentDirection, preset.decoration, preset.style);\n    } else {\n      currentDirection = DEFAULT_DECORATION_DIRECTION;\n    }\n    flipBtn.hidden = !directional;\n    flipBtn.disabled = !directional || currentDirection === 'both';\n  };\n\n  flipBtn.addEventListener('click', () => {\n    const preset = getLineTypePreset(typeSel.value);\n    if (!isDirectionalPreset(preset)) return;\n    if (currentDirection === 'both') {\n      currentDirection = preset.direction ?? DEFAULT_DECORATION_DIRECTION;\n    } else {\n      currentDirection = currentDirection === 'start' ? 'end' : 'start';\n    }\n    updateFlipState();\n    applyPreview();\n  });\n\n  typeSel.addEventListener('change', () => {\n    const preset = getLineTypePreset(typeSel.value);\n    if (isDirectionalPreset(preset)) {\n      if (preset.value !== initialPresetValue) {\n        currentDirection = preset.direction ?? DEFAULT_DECORATION_DIRECTION;\n      } else {\n        currentDirection = normalizeDecorationDirection(currentDirection, preset.decoration, preset.style);\n      }\n    } else {\n      currentDirection = DEFAULT_DECORATION_DIRECTION;\n    }\n    updateFlipState();\n    applyPreview();\n  });\n\n  const actions = document.createElement('div');\n  actions.className = 'line-menu__actions';\n\n  const straightenBtn = document.createElement('button');\n  straightenBtn.type = 'button';\n  straightenBtn.className = 'btn ghost';\n  straightenBtn.textContent = 'Straighten line';\n  straightenBtn.disabled = !canStraighten;\n  straightenBtn.addEventListener('click', async () => {\n    if (straightenBtn.disabled) return;\n    straightenBtn.disabled = true;\n    await straightenLine(line);\n    applyPreview();\n  });\n  actions.appendChild(straightenBtn);\n\n  const saveBtn = document.createElement('button');\n  saveBtn.type = 'button';\n  saveBtn.className = 'btn primary';\n  saveBtn.textContent = 'Save changes';\n  saveBtn.addEventListener('click', async () => {\n    const patch = buildPatch();\n    await updateLink(aId, bId, patch);\n    applyLineStyle(line, patch);\n    closeLineMenu({ commit: true });\n  });\n  actions.appendChild(saveBtn);\n\n  menu.appendChild(actions);\n\n  updateStraightenState = () => {\n    const handles = parseCurveHandles(line?.dataset?.handles) || [];\n    const magnitude = Math.abs(Number(line?.dataset?.curve || 0));\n    straightenBtn.disabled = !(handles.length || magnitude > 0.001);\n  };\n  updateStraightenState();\n\n  let observer = null;\n  if (typeof MutationObserver !== 'undefined' && line) {\n    observer = new MutationObserver(updateStraightenState);\n    observer.observe(line, { attributes: true, attributeFilter: ['data-handles', 'data-curve'] });\n  }\n\n  colorInput.addEventListener('input', applyPreview);\n  glowInput.addEventListener('change', applyPreview);\n  thickSel.addEventListener('change', applyPreview);\n  nameInput.addEventListener('input', applyPreview);\n\n  updateFlipState();\n  applyPreview();\n\n  document.body.appendChild(menu);\n  requestAnimationFrame(() => {\n    positionLineMenu(menu, evt.pageX, evt.pageY);\n  });\n\n  const handleOutside = event => {\n    if (menu.contains(event.target)) return;\n    closeLineMenu();\n  };\n  document.addEventListener('pointerdown', handleOutside, true);\n\n  const menuState = {\n    menu,\n    restore: () => applyLineStyle(line, initial),\n    cleanup: () => {\n      document.removeEventListener('pointerdown', handleOutside, true);\n      if (observer) observer.disconnect();\n    }\n  };\n  mapState.activeLineMenu = menuState;\n}\n\nasync function updateLink(aId, bId, patch) {\n  const a = await getItem(aId);\n  const b = await getItem(bId);\n  if (!a || !b) return null;\n  const existingForward = Array.isArray(a.links)\n    ? a.links.find(x => String(x?.id) === String(bId))\n    : null;\n  const forwardDecoration = Object.prototype.hasOwnProperty.call(patch, 'decoration')\n    ? patch.decoration\n    : existingForward?.decoration ?? DEFAULT_LINE_DECORATION;\n  const forwardDirection = Object.prototype.hasOwnProperty.call(patch, 'decorationDirection')\n    ? patch.decorationDirection\n    : existingForward?.decorationDirection ?? DEFAULT_DECORATION_DIRECTION;\n  const reversePatch = { ...patch };\n  if (Object.prototype.hasOwnProperty.call(patch, 'decoration')) {\n    reversePatch.decoration = forwardDecoration;\n  }\n  if (forwardDecoration && forwardDecoration !== 'none' && forwardDecoration !== 'block') {\n    reversePatch.decorationDirection = flipDecorationDirection(forwardDirection);\n  } else if (Object.prototype.hasOwnProperty.call(patch, 'decorationDirection')) {\n    reversePatch.decorationDirection = DEFAULT_DECORATION_DIRECTION;\n  }\n\n  const apply = (item, otherId, patchValue) => {\n    item.links = item.links || [];\n    let link = item.links.find(x => String(x?.id) === String(otherId));\n    if (link) {\n      Object.assign(link, patchValue);\n    } else {\n      link = normalizeLinkEntry(otherId, patchValue);\n      item.links.push(link);\n    }\n    return { ...link };\n  };\n  const forward = apply(a, bId, patch);\n  const reverse = apply(b, aId, reversePatch);\n  await upsertItem(a);\n  await upsertItem(b);\n  return { source: a, target: b, forward, reverse };\n}\n\nfunction applyLinkPatchToState(aId, bId, patch = {}) {\n  const source = mapState.itemMap?.[aId];\n  const forwardLink = source?.links?.find(x => String(x?.id) === String(bId)) || null;\n  const forwardDecoration = Object.prototype.hasOwnProperty.call(patch, 'decoration')\n    ? patch.decoration\n    : forwardLink?.decoration ?? DEFAULT_LINE_DECORATION;\n  const forwardDirection = Object.prototype.hasOwnProperty.call(patch, 'decorationDirection')\n    ? patch.decorationDirection\n    : forwardLink?.decorationDirection ?? DEFAULT_DECORATION_DIRECTION;\n  const reversePatch = { ...patch };\n  if (Object.prototype.hasOwnProperty.call(patch, 'decoration')) {\n    reversePatch.decoration = forwardDecoration;\n  }\n  if (forwardDecoration && forwardDecoration !== 'none' && forwardDecoration !== 'block') {\n    reversePatch.decorationDirection = flipDecorationDirection(forwardDirection);\n  } else if (Object.prototype.hasOwnProperty.call(patch, 'decorationDirection')) {\n    reversePatch.decorationDirection = DEFAULT_DECORATION_DIRECTION;\n  }\n\n  const assign = (item, otherId, patchValue) => {\n    if (!item || !Array.isArray(item.links)) return;\n    const link = item.links.find(x => String(x?.id) === String(otherId));\n    if (link) Object.assign(link, patchValue);\n  };\n  assign(source, bId, patch);\n  assign(mapState.itemMap?.[bId], aId, reversePatch);\n}\n", "import { openEditor } from './editor.js';\n\nconst defaultOptions = [\n  { value: 'disease', label: 'Disease' },\n  { value: 'drug', label: 'Drug' },\n  { value: 'concept', label: 'Concept' }\n];\n\nexport function createEntryAddControl(onAdded, initialKind = 'disease') {\n  const wrapper = document.createElement('div');\n  wrapper.className = 'entry-add-control';\n\n  const button = document.createElement('button');\n  button.type = 'button';\n  button.className = 'fab-btn';\n  button.innerHTML = '<span class=\"sr-only\">Add new entry</span><svg viewBox=\"0 0 24 24\" aria-hidden=\"true\" focusable=\"false\"><path d=\"M12 5v14M5 12h14\" stroke=\"currentColor\" stroke-width=\"2.4\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/></svg>';\n  button.setAttribute('aria-label', 'Add new entry');\n  const menu = document.createElement('div');\n  menu.className = 'entry-add-menu hidden';\n\n  const options = [...defaultOptions];\n  if (initialKind) {\n    const idx = options.findIndex(opt => opt.value === initialKind);\n    if (idx > 0) {\n      const [preferred] = options.splice(idx, 1);\n      options.unshift(preferred);\n    }\n  }\n\n  options.forEach(opt => {\n    const item = document.createElement('button');\n    item.type = 'button';\n    item.className = 'entry-add-menu-item';\n    item.textContent = opt.label;\n    item.addEventListener('click', () => {\n      closeMenu();\n      openEditor(opt.value, onAdded);\n    });\n    menu.appendChild(item);\n  });\n\n  function setOpen(open) {\n    menu.classList.toggle('hidden', !open);\n    wrapper.classList.toggle('open', open);\n    button.setAttribute('aria-expanded', open ? 'true' : 'false');\n    if (open) document.addEventListener('mousedown', handleOutside);\n    else document.removeEventListener('mousedown', handleOutside);\n  }\n\n  function closeMenu() {\n    setOpen(false);\n  }\n\n  function handleOutside(e) {\n    if (!wrapper.contains(e.target)) {\n      closeMenu();\n    }\n  }\n\n  button.addEventListener('click', () => {\n    const willOpen = menu.classList.contains('hidden');\n    setOpen(willOpen);\n  });\n\n  wrapper.appendChild(button);\n  wrapper.appendChild(menu);\n  setOpen(false);\n  return wrapper;\n}\n", "export function createAppShell({\n  state,\n  setTab,\n  setSubtab,\n  setQuery,\n  findItemsByFilter,\n  renderSettings,\n  renderCardList,\n  renderCards,\n  renderBuilder,\n  renderLectures,\n  renderFlashcards,\n  renderReview,\n  renderQuiz,\n  renderBlockMode,\n  renderBlockBoard,\n  renderExams,\n  renderExamRunner,\n  renderMap,\n  createEntryAddControl\n}) {\n  const tabs = [\"Block Board\",\"Lists\",\"Cards\",\"Study\",\"Exams\",\"Map\",\"Lectures\"];\n\n  const listTabConfig = [\n    { label: 'Diseases', kind: 'disease' },\n    { label: 'Drugs', kind: 'drug' },\n    { label: 'Concepts', kind: 'concept' }\n  ];\n\n  function resolveListKind() {\n    const active = state?.subtab?.Lists;\n    const match = listTabConfig.find(cfg => cfg.label === active);\n    return match ? match.kind : 'disease';\n  }\n\n  async function renderApp() {\n    const root = document.getElementById('app');\n    const activeEl = document.activeElement;\n    const shouldRestoreSearch = activeEl && activeEl.dataset && activeEl.dataset.role === 'global-search';\n    const selectionStart = shouldRestoreSearch && typeof activeEl.selectionStart === 'number' ? activeEl.selectionStart : null;\n    const selectionEnd = shouldRestoreSearch && typeof activeEl.selectionEnd === 'number' ? activeEl.selectionEnd : null;\n\n    root.innerHTML = '';\n\n    const header = document.createElement('header');\n    header.className = 'header';\n\n    const left = document.createElement('div');\n    left.className = 'header-left';\n    const brand = document.createElement('div');\n    brand.className = 'brand';\n    brand.textContent = '\u2728 Sevenn';\n    left.appendChild(brand);\n\n    const nav = document.createElement('nav');\n    nav.className = 'tabs';\n    nav.setAttribute('aria-label', 'Primary sections');\n    const tabClassMap = {\n      'Block Board': 'tab-block-board',\n      Lists: 'tab-lists',\n      Lectures: 'tab-lectures',\n      Cards: 'tab-cards',\n      Study: 'tab-study',\n      Exams: 'tab-exams',\n      Map: 'tab-map'\n    };\n    tabs.forEach(t => {\n      const btn = document.createElement('button');\n      btn.type = 'button';\n      btn.className = 'tab';\n      if (state.tab === t) btn.classList.add('active');\n      const variant = tabClassMap[t];\n      if (variant) btn.classList.add(variant);\n      btn.textContent = t;\n      btn.addEventListener('click', () => {\n        const wasActive = state.tab === t;\n        if (t === 'Study' && wasActive && state.subtab?.Study === 'Review' && !state.flashSession && !state.quizSession) {\n          setSubtab('Study', 'Builder');\n        }\n        setTab(t);\n        renderApp();\n      });\n      nav.appendChild(btn);\n    });\n    left.appendChild(nav);\n    header.appendChild(left);\n\n    const right = document.createElement('div');\n    right.className = 'header-right';\n\n    const searchField = document.createElement('label');\n    searchField.className = 'search-field';\n    searchField.setAttribute('aria-label', 'Search entries');\n\n    const searchIcon = document.createElement('span');\n    searchIcon.className = 'search-icon';\n    searchIcon.setAttribute('aria-hidden', 'true');\n    searchIcon.innerHTML = '<svg viewBox=\"0 0 20 20\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14.5 14.5L18 18\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\"/><circle cx=\"9\" cy=\"9\" r=\"5.8\" stroke=\"currentColor\" stroke-width=\"1.6\"/></svg>';\n    searchField.appendChild(searchIcon);\n\n    const search = document.createElement('input');\n    search.type = 'search';\n    search.placeholder = 'Search entries';\n    search.value = state.query;\n    search.autocomplete = 'off';\n    search.spellcheck = false;\n    search.className = 'search-input';\n    search.dataset.role = 'global-search';\n    search.addEventListener('input', e => {\n      setQuery(e.target.value);\n      renderApp();\n    });\n    search.addEventListener('search', e => {\n      setQuery(e.target.value);\n      renderApp();\n    });\n    searchField.appendChild(search);\n    right.appendChild(searchField);\n\n    const settingsBtn = document.createElement('button');\n    settingsBtn.type = 'button';\n    settingsBtn.className = 'header-settings-btn';\n    if (state.tab === 'Settings') settingsBtn.classList.add('active');\n    settingsBtn.setAttribute('aria-label', 'Settings');\n    settingsBtn.innerHTML = '<svg viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.325.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 0 1 1.37.49l1.296 2.247a1.125 1.125 0 0 1-.26 1.431l-1.003.827c-.293.241-.438.613-.43.992a7.723 7.723 0 0 1 0 .255c-.008.378.137.75.43.991l1.004.827c.424.35.534.955.26 1.43l-1.298 2.247a1.125 1.125 0 0 1-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.47 6.47 0 0 1-.22.128c-.331.183-.581.495-.644.869l-.213 1.281c-.09.543-.56.94-1.11.94h-2.594c-.55 0-1.019-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 0 1-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 0 1-1.369-.49l-1.297-2.247a1.125 1.125 0 0 1 .26-1.431l1.004-.827c.292-.24.437-.613.43-.991a6.932 6.932 0 0 1 0-.255c.007-.38-.138-.751-.43-.992l-1.004-.827a1.125 1.125 0 0 1-.26-1.43l1.297-2.247a1.125 1.125 0 0 1 1.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.086.22-.128.332-.183.582-.495.644-.869z\" stroke=\"currentColor\" stroke-width=\"1.6\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/><circle cx=\"12\" cy=\"12\" r=\"2.8\" stroke=\"currentColor\" stroke-width=\"1.6\"/></svg>';\n    settingsBtn.addEventListener('click', () => {\n      setTab('Settings');\n      renderApp();\n    });\n    right.appendChild(settingsBtn);\n\n    header.appendChild(right);\n    root.appendChild(header);\n\n    if (shouldRestoreSearch) {\n      requestAnimationFrame(() => {\n        search.focus();\n        if (selectionStart !== null && selectionEnd !== null && search.setSelectionRange) {\n          search.setSelectionRange(selectionStart, selectionEnd);\n        } else {\n          const len = search.value.length;\n          if (search.setSelectionRange) search.setSelectionRange(len, len);\n        }\n      });\n    }\n\n    const main = document.createElement('main');\n    if (state.tab === 'Map') main.className = 'map-main';\n    root.appendChild(main);\n    if (state.tab === 'Settings') {\n      await renderSettings(main);\n    } else if (state.tab === 'Lists') {\n      const kind = resolveListKind();\n      const listMeta = listTabConfig.find(cfg => cfg.kind === kind) || listTabConfig[0];\n      const createTarget = listMeta?.kind || 'disease';\n      main.appendChild(createEntryAddControl(renderApp, createTarget));\n\n      const content = document.createElement('div');\n      content.className = 'tab-content';\n      main.appendChild(content);\n\n      const selector = document.createElement('div');\n      selector.className = 'list-subtabs';\n      selector.setAttribute('role', 'tablist');\n      listTabConfig.forEach(cfg => {\n        const btn = document.createElement('button');\n        btn.type = 'button';\n        btn.className = 'list-subtab';\n        btn.textContent = cfg.label;\n        btn.dataset.listKind = cfg.kind;\n        btn.setAttribute('role', 'tab');\n        if (cfg.kind === kind) btn.classList.add('active');\n        btn.addEventListener('click', () => {\n          if (state.subtab?.Lists === cfg.label) return;\n          setSubtab('Lists', cfg.label);\n          renderApp();\n        });\n        selector.appendChild(btn);\n      });\n      content.appendChild(selector);\n\n      const listHost = document.createElement('div');\n      listHost.className = 'list-host';\n      content.appendChild(listHost);\n\n      const filter = { ...state.filters, types:[kind], query: state.query };\n      const query = findItemsByFilter(filter);\n      await renderCardList(listHost, query, kind, renderApp);\n    } else if (state.tab === 'Block Board') {\n      main.appendChild(createEntryAddControl(renderApp, 'disease'));\n      const content = document.createElement('div');\n      content.className = 'tab-content';\n      main.appendChild(content);\n      await renderBlockBoard(content, renderApp);\n    } else if (state.tab === 'Lectures') {\n      const content = document.createElement('div');\n      content.className = 'tab-content';\n      main.appendChild(content);\n      await renderLectures(content, renderApp);\n    } else if (state.tab === 'Cards') {\n      main.appendChild(createEntryAddControl(renderApp, 'disease'));\n      const content = document.createElement('div');\n      content.className = 'tab-content';\n      main.appendChild(content);\n      const filter = { ...state.filters, query: state.query };\n      const query = findItemsByFilter(filter);\n      const items = await query.toArray();\n      await renderCards(content, items, renderApp);\n    } else if (state.tab === 'Study') {\n      main.appendChild(createEntryAddControl(renderApp, 'disease'));\n      const content = document.createElement('div');\n      content.className = 'tab-content';\n      main.appendChild(content);\n      if (state.flashSession) {\n        renderFlashcards(content, renderApp);\n      } else if (state.quizSession) {\n        renderQuiz(content, renderApp);\n      } else {\n        const activeStudy = state.subtab.Study === 'Blocks' ? 'Blocks' : (state.subtab.Study || 'Builder');\n        if (activeStudy === 'Review') {\n          await renderReview(content, renderApp);\n        } else if (activeStudy === 'Blocks') {\n          renderBlockMode(content, renderApp);\n        } else {\n          const wrap = document.createElement('div');\n          await renderBuilder(wrap, renderApp);\n          content.appendChild(wrap);\n        }\n      }\n    } else if (state.tab === 'Exams') {\n      main.appendChild(createEntryAddControl(renderApp, 'disease'));\n      const content = document.createElement('div');\n      content.className = 'tab-content';\n      main.appendChild(content);\n      if (state.examSession) {\n        renderExamRunner(content, renderApp);\n      } else {\n        await renderExams(content, renderApp);\n      }\n    } else if (state.tab === 'Map') {\n      main.appendChild(createEntryAddControl(renderApp, 'disease'));\n      const mapHost = document.createElement('div');\n      mapHost.className = 'tab-content map-host';\n      main.appendChild(mapHost);\n      await renderMap(mapHost);\n    } else {\n      main.textContent = `Currently viewing: ${state.tab}`;\n    }\n  }\n\n  return { renderApp, tabs, resolveListKind };\n}\n"],
  "mappings": "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",
}
